<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap - Conflux å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€</title>
  
  <!-- æ”¶è—å›¾æ ‡ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== åŸºç¡€æ ·å¼ ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --accent-orange: #ff6b35;
      --accent-teal: #00b4d8;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-orange: linear-gradient(135deg, #ff6b35, #ff9e6d);
      --gradient-teal: linear-gradient(135deg, #00b4d8, #48cae4);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== å¤´éƒ¨æ ·å¼ ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 22px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* ========== æ ‡ç­¾é¡µæ ·å¼ ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== å¡ç‰‡æ ·å¼ ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    /* ========== å…‘æ¢é¡µé¢æ ·å¼ ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      margin-bottom: 8px;
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 12px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
    }
    
    .token-logo {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 16px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .percent-btn {
      flex: 1;
      max-width: 70px;
      padding: 8px 12px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 28px;
      font-weight: 700;
      padding: 8px 0;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }
    
    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
      background: transparent;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      color: var(--accent-yellow);
      z-index: 2;
    }
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      background: rgba(255, 215, 0, 0.1);
    }
    
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      font-size: 13px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .slippage-options {
      display: flex;
      gap: 8px;
    }
    
    .slippage-btn {
      padding: 6px 10px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 40px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 12px 16px;
      margin: 12px 0;
      font-size: 13px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* ========== æµåŠ¨æ€§é¡µé¢æ ·å¼ ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .stat-value-large {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .user-position {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }
    
    .position-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .position-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .position-value {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .position-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .position-stat {
      text-align: center;
    }
    
    .position-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .position-amount {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-yellow);
    }
    
    .lp-amount {
      color: var(--text-primary);
    }
    
    .pool-share {
      color: var(--success);
    }
    
    .position-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .position-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    /* ========== è´¨æŠ¼é¡µé¢æ ·å¼ ========== */
    .staking-container {
      padding: 2px 0;
    }
    
    .staking-overview-card {
      background: var(--gradient-card);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .staking-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .staking-title {
      font-size: 22px;
      font-weight: 800;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .staking-icon {
      font-size: 28px;
    }
    
    .apr-badge {
      background: var(--gradient-orange);
      color: #0f172a;
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    .staking-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .stat-icon {
      color: var(--accent-yellow);
      font-size: 14px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
      margin-bottom: 4px;
    }
    
    .stat-value.green {
      color: var(--accent-green);
    }
    
    .stat-value.yellow {
      color: var(--accent-yellow);
    }
    
    .stat-value.teal {
      color: var(--accent-teal);
    }
    
    .stat-value.orange {
      color: var(--accent-orange);
    }
    
    .stat-unit {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .time-multiplier-bar {
      margin: 20px 0;
    }
    
    .multiplier-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .multiplier-text {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .multiplier-value {
      font-size: 18px;
      font-weight: 800;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .multiplier-progress {
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    
    .multiplier-progress-fill {
      height: 100%;
      background: var(--gradient-yellow);
      border-radius: 5px;
      transition: width 1s ease-in-out;
      position: relative;
    }
    
    .multiplier-stages {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-secondary);
    }
    
    .stage {
      text-align: center;
      position: relative;
      flex: 1;
    }
    
    .stage.active {
      color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .stage::before {
      content: '';
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-secondary);
    }
    
    .stage.active::before {
      background: var(--accent-yellow);
      box-shadow: 0 0 8px var(--accent-yellow);
    }
    
    .action-section {
      margin-bottom: 20px;
    }
    
    .action-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .action-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    .lp-balance-display {
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .lp-balance-label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    
    .lp-balance-value {
      font-size: 32px;
      font-weight: 800;
      color: var(--accent-yellow);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .lp-balance-unit {
      font-size: 16px;
      color: var(--text-secondary);
      margin-left: 8px;
    }
    
    .activation-requirements {
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .requirements-icon {
      color: var(--primary-blue);
      margin-right: 8px;
    }
    
    .invite-system {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .invite-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .invite-icon {
      color: var(--accent-yellow);
      font-size: 24px;
    }
    
    .invite-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .invite-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .invite-input-container {
      position: relative;
      margin-bottom: 16px;
    }
    
    .invite-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255, 215, 0, 0.05);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 15px;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .invite-input:focus {
      border-color: var(--accent-yellow);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
    }
    
    .invite-input::placeholder {
      color: var(--text-muted);
    }
    
    .invite-input-error {
      border-color: var(--accent-red) !important;
      background: rgba(255, 71, 87, 0.05) !important;
    }
    
    .invite-error-text {
      color: var(--accent-red);
      font-size: 13px;
      margin-top: 8px;
      display: none;
    }
    
    .invite-error-text.show {
      display: block;
    }
    
    .invite-locked {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--success);
      margin-top: 20px;
      animation: fadeIn 0.5s ease;
    }
    
    .invite-locked-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .invite-locked-text {
      font-size: 16px;
      color: var(--success);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .locked-icon {
      font-size: 20px;
    }
    
    .invite-address-container {
      background: rgba(46, 160, 67, 0.15);
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .invite-address-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .invite-address {
      font-size: 15px;
      color: var(--text-primary);
      font-weight: 600;
      word-break: break-all;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      margin-top: 8px;
    }
    
    .invite-benefits {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .benefit-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-yellow);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .benefit-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .benefit-item {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 10px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      line-height: 1.5;
    }
    
    .benefit-item:last-child {
      margin-bottom: 0;
    }
    
    .benefit-icon {
      color: var(--accent-yellow);
      font-size: 14px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .action-button {
      flex: 1;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-height: 56px;
    }
    
    .action-button.primary {
      background: var(--gradient-yellow);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    .action-button.claim {
      background: var(--gradient-green);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(46, 160, 67, 0.3);
    }
    
    .action-button.referral {
      background: var(--gradient-teal);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(0, 180, 216, 0.3);
    }
    
    .action-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    .penalty-warning {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .penalty-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    
    .penalty-icon {
      color: var(--accent-red);
      font-size: 20px;
    }
    
    .penalty-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-red);
    }
    
    .penalty-content {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .rewards-detail-card {
      background: var(--gradient-card);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .rewards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .reward-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .reward-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .reward-value {
      font-size: 22px;
      font-weight: 800;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
      margin-bottom: 4px;
    }
    
    .reward-value.green {
      color: var(--accent-green);
    }
    
    .reward-value.orange {
      color: var(--accent-orange);
    }
    
    .reward-value.teal {
      color: var(--accent-teal);
    }
    
    .reward-value.yellow {
      color: var(--accent-yellow);
    }
    
    .cooldown-timer {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(26, 115, 232, 0.3);
      margin: 20px 0;
      display: none;
    }
    
    .cooldown-label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .cooldown-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--primary-blue);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    /* ========== é£é™©æç¤ºå’Œé¡µè„š ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 12px;
      color: var(--text-primary);
      line-height: 1.5;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 13px;
      opacity: 0.7;
    }
    
    /* ========== æ¨¡æ€æ¡†æ ·å¼ ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 20px;
      text-align: center;
    }
    
    .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .modal-btn.confirm:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.3);
    }
    
    /* ========== åŠ¨ç”»æ•ˆæœ ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== åŠ è½½åŠ¨ç”» ========== */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    /* ========== å“åº”å¼è°ƒæ•´ ========== */
    @media (max-width: 480px) {
      .app {
        max-width: 100%;
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 16px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 40px;
        height: 40px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .staking-stats-grid,
      .rewards-grid,
      .liquidity-stats,
      .position-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .position-actions {
        flex-direction: column;
      }
      
      .staking-overview-card,
      .staking-action-card,
      .rewards-detail-card {
        padding: 20px;
        margin: 10px;
      }
      
      .amount-input {
        font-size: 24px;
      }
      
      .lp-balance-value {
        font-size: 28px;
      }
      
      .stat-value {
        font-size: 22px;
      }
      
      .reward-value {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <div class="logo-container">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">è¿æ¥é’±åŒ…</button>
      </div>
    </div>

    <!-- æ ‡ç­¾é¡µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">å…‘æ¢</button>
        <button class="tab-btn" data-tab="liquidity">æµåŠ¨æ€§</button>
        <button class="tab-btn" data-tab="staking">LPå¥–åŠ±</button>
      </div>
    </div>

    <!-- å…‘æ¢é¡µé¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- è¾“å…¥ä»£å¸ -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn active" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- äº¤æ¢ç®­å¤´ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">â‡…</button>
          </div>

          <!-- è¾“å‡ºä»£å¸ -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- é”™è¯¯æç¤ºæ¡† -->
          <div class="error-box" id="swapErrorBox">
            <span>âš ï¸</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- äº¤æ˜“è¯¦æƒ… -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">æ»‘ç‚¹å®¹å·®</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="1">1%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">æœ€ä½æ”¶åˆ°</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼å½±å“</span>
              <span class="detail-value" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- äº¤æ˜“æŒ‰é’® -->
          <button class="main-action-btn" id="swapBtn">è¿æ¥é’±åŒ…</button>
        </div>
      </div>
    </div>
    
    <!-- æµåŠ¨æ€§é¡µé¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div class="card-title" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <span style="color: var(--accent-yellow); font-size: 20px;">ğŸ’§</span>
          <span style="font-size: 18px; font-weight: 700;">CFX-LOM æµåŠ¨æ± </span>
        </div>

        <div class="liquidity-summary">
          <!-- æ± å­ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small">CFX å‚¨å¤‡</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small">LOM å‚¨å¤‡</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- æˆ‘çš„æµåŠ¨æ± è¯¦æƒ… -->
          <div class="user-position">
            <div class="position-header">
              <div class="position-title">æˆ‘çš„æµåŠ¨æ± </div>
              <div class="position-value" id="positionValue">$0.00</div>
            </div>
            
            <div class="position-grid">
              <div class="position-stat">
                <div class="position-label">æˆ‘çš„CFX</div>
                <div class="position-amount" id="userCfx">0</div>
              </div>
              <div class="position-stat">
                <div class="position-label">æˆ‘çš„LOM</div>
                <div class="position-amount" id="userLom">0</div>
              </div>
              <div class="position-stat">
                <div class="position-label">æˆ‘çš„LPä»£å¸</div>
                <div class="position-amount lp-amount" id="userLp">0</div>
              </div>
              <div class="position-stat">
                <div class="position-label">æ± å­ä»½é¢</div>
                <div class="position-amount pool-share" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">æ·»åŠ æµåŠ¨æ€§</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ç§»é™¤æµåŠ¨æ€§</button>
          </div>
        </div>
        
        <!-- è´¨æŠ¼å…¥å£ -->
        <div class="lp-balance-display" style="margin-top: 20px; cursor: pointer;" onclick="switchToStakingTab()">
          <div class="lp-balance-label">ä½¿ç”¨LPä»£å¸èµšå–å¥–åŠ±</div>
          <div style="margin-top: 8px;">
            <span class="lp-balance-value">45.8%</span>
            <span class="lp-balance-unit">APY</span>
          </div>
          <div style="font-size: 14px; color: var(--accent-yellow); margin-top: 12px;">
            ğŸš€ ç‚¹å‡»è¿›å…¥LPå¥–åŠ±å†œåœº â†’
          </div>
        </div>
      </div>
    </div>

    <!-- LPå¥–åŠ±é¡µé¢ -->
    <div class="tab-content" id="stakingTab">
      <div class="staking-container">
        <!-- LPå¥–åŠ±æ¦‚è§ˆå¡ç‰‡ -->
        <div class="staking-overview-card">
          <div class="staking-header">
            <div class="staking-title">
              <span class="staking-icon">ğŸ†</span>
              <span id="stakingTitle">LPæŒä»“å¥–åŠ±å†œåœº</span>
            </div>
            <div class="apr-badge" id="aprBadge">APR: 45.8%</div>
          </div>
          
          <div class="staking-stats-grid">
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ’°</span>
                <span id="lpBalanceLabel">æˆ‘çš„LPæŒä»“</span>
              </div>
              <div class="stat-value yellow" id="myLPHolding">0</div>
              <div class="stat-unit" id="lpUnit">LP</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ“Š</span>
                <span id="activeSharesLabel">æ´»è·ƒä»½é¢</span>
              </div>
              <div class="stat-value teal" id="activeShares">0</div>
              <div class="stat-unit">LP</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ“ˆ</span>
                <span id="pendingRewardLabel">å¾…é¢†å–å¥–åŠ±</span>
              </div>
              <div class="stat-value green" id="pendingReward">0</div>
              <div class="stat-unit">LOM</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ‘¥</span>
                <span id="referralRewardLabel">é‚€è¯·å¥–åŠ±</span>
              </div>
              <div class="stat-value orange" id="referralReward">0</div>
              <div class="stat-unit">LOM</div>
            </div>
          </div>
          
          <!-- æ—¶é—´å€ç‡è¿›åº¦æ¡ -->
          <div class="time-multiplier-bar">
            <div class="multiplier-label">
              <div class="multiplier-text">
                <span>â±ï¸</span>
                <span id="multiplierLabel">æ—¶é—´å€ç‡:</span>
              </div>
              <div class="multiplier-value" id="multiplierValue">1.0x</div>
            </div>
            <div class="multiplier-progress">
              <div class="multiplier-progress-fill" id="multiplierProgress" style="width: 0%"></div>
            </div>
            <div class="multiplier-stages">
              <div class="stage" id="stage30">30å¤©</div>
              <div class="stage" id="stage90">90å¤©</div>
              <div class="stage" id="stage180">180å¤©</div>
              <div class="stage" id="stage360">360å¤©</div>
            </div>
          </div>
        </div>

        <!-- æ¿€æ´»æ“ä½œå¡ç‰‡ -->
        <div class="card">
          <div class="action-section">
            <div class="action-title">
              <span class="action-icon">ğŸš€</span>
              <span id="activateTitle">æ¿€æ´»LPæŒä»“å¥–åŠ±</span>
            </div>
            
            <div class="lp-balance-display">
              <div class="lp-balance-label" id="lpBalanceLabel">æ‚¨çš„LPä»£å¸ä½™é¢</div>
              <div>
                <span class="lp-balance-value" id="lpBalance">0.000000</span>
                <span class="lp-balance-unit">LP</span>
              </div>
            </div>
            
            <div class="activation-requirements">
              <span class="requirements-icon">âš¡</span>
              <span id="activationRequirements">æ¿€æ´»æ¡ä»¶ï¼šé’±åŒ…ä¸­éœ€æŒæœ‰è‡³å°‘ 100 LP ä»£å¸</span>
              <div style="font-size: 13px; margin-top: 12px; color: var(--text-secondary);">
                ğŸ“Œ æ¿€æ´»ååˆçº¦å°†è®°å½•æ‚¨çš„LPæŒä»“ï¼Œå¥–åŠ±åŸºäºå®æ—¶æŒä»“è®¡ç®—<br>
                ğŸ“Œ æ— éœ€è´¨æŠ¼æˆ–è½¬ç§»LPä»£å¸ï¼Œèµ„é‡‘å§‹ç»ˆåœ¨æ‚¨é’±åŒ…ä¸­<br>
                ğŸ“Œ ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ‚¨çš„LPä½™é¢å˜åŒ–
              </div>
            </div>
            
            <!-- é‚€è¯·ç³»ç»Ÿ -->
            <div class="invite-system" id="inviteSystem">
              <div class="invite-header">
                <span class="invite-icon">ğŸ‘¥</span>
                <span class="invite-title" id="inviteTitle">é‚€è¯·ç³»ç»Ÿ (å¯é€‰)</span>
              </div>
              
              <div class="invite-subtitle" id="inviteSubtitle">
                ç»‘å®šé‚€è¯·äººåœ°å€å¯è·å¾—é¢å¤–5%å¥–åŠ±åˆ†æˆã€‚é‚€è¯·äººå¯è·å¾—æ‚¨æ”¶ç›Šçš„5%ä½œä¸ºå¥–åŠ±ã€‚
              </div>
              
              <div class="invite-input-container">
                <input type="text" class="invite-input" id="inviteAddress" 
                       placeholder="è¯·è¾“å…¥é‚€è¯·äººé’±åŒ…åœ°å€ (0xå¼€å¤´)" 
                       pattern="^0x[a-fA-F0-9]{40}$">
                <div class="invite-error-text" id="inviteErrorText">
                  è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)
                </div>
              </div>
              
              <div class="invite-benefits">
                <div class="benefit-title">
                  <span>ğŸ</span>
                  <span>é‚€è¯·å¥–åŠ±å¥½å¤„</span>
                </div>
                <ul class="benefit-list">
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>é‚€è¯·äººè·å¾—æ‚¨æ”¶ç›Šçš„5%ä½œä¸ºå¥–åŠ±</span>
                  </li>
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>è¢«é‚€è¯·äººæ— ä»»ä½•æŸå¤±</span>
                  </li>
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>å¥–åŠ±é”å®š30å¤©åå¯é¢†å–</span>
                  </li>
                </ul>
              </div>
            </div>
            
            <!-- å·²æ¿€æ´»çŠ¶æ€ -->
            <div class="invite-locked" id="activatedSection" style="display:none">
              <div class="invite-locked-header">
                <div class="invite-locked-text">
                  <span class="locked-icon">âœ…</span>
                  <span id="activatedTitle">å¥–åŠ±å·²æ¿€æ´»</span>
                </div>
              </div>
              
              <div class="invite-address-container">
                <div class="invite-address-label">
                  <span>â°</span>
                  <span>æ¿€æ´»æ—¶é—´:</span>
                </div>
                <div class="invite-address" id="activationTime">--</div>
              </div>
              
              <div class="invite-address-container" id="referrerContainer" style="display:none">
                <div class="invite-address-label">
                  <span>ğŸ‘¤</span>
                  <span>é‚€è¯·äºº:</span>
                </div>
                <div class="invite-address" id="referrerAddress">--</div>
              </div>
              
              <div class="invite-address-container">
                <div class="invite-address-label">
                  <span>ğŸ“Š</span>
                  <span>å½“å‰æ£€æµ‹åˆ°LP:</span>
                </div>
                <div class="invite-address" id="currentLPBalance">--</div>
              </div>
            </div>
            
            <div class="action-buttons" id="activationButtons">
              <button class="action-button primary" id="activateBtn" onclick="activateStaking()">
                <span>ğŸš€</span>
                <span id="activateBtnText">æ¿€æ´»å¥–åŠ±</span>
              </button>
            </div>
          </div>
        </div>

        <!-- å¥–åŠ±è¯¦æƒ…å¡ç‰‡ -->
        <div class="rewards-detail-card">
          <div class="action-title">
            <span class="action-icon">ğŸ†</span>
            <span id="rewardsTitle">å¥–åŠ±ç®¡ç†</span>
          </div>
          
          <div class="rewards-grid">
            <div class="reward-item">
              <div class="reward-label">
                <span>ğŸ’°</span>
                <span>å¾…é¢†å–å¥–åŠ±</span>
              </div>
              <div class="reward-value green" id="pendingRewardDetail">0</div>
              <div class="stat-unit">LOM</div>
            </div>
            
            <div class="reward-item">
              <div class="reward-label">
                <span>ğŸ‘¥</span>
                <span>é‚€è¯·å¥–åŠ±</span>
              </div>
              <div class="reward-value orange" id="pendingReferralDetail">0</div>
              <div class="stat-unit">LOM</div>
            </div>
            
            <div class="reward-item">
              <div class="reward-label">
                <span>â°</span>
                <span>ä¸‹æ¬¡å¯é¢†å–</span>
              </div>
              <div class="reward-value teal" id="nextClaimTime">--</div>
            </div>
            
            <div class="reward-item">
              <div class="reward-label">
                <span>ğŸ“…</span>
                <span>æ¿€æ´»æ—¶é•¿</span>
              </div>
              <div class="reward-value yellow" id="activeDuration">0å¤©</div>
            </div>
          </div>
          
          <!-- æƒ©ç½šè­¦å‘Š -->
          <div class="penalty-warning" id="penaltyWarning">
            <div class="penalty-header">
              <span class="penalty-icon">âš ï¸</span>
              <span class="penalty-title" id="penaltyTitle">å‡æŒæƒ©ç½šè­¦å‘Š</span>
            </div>
            <div class="penalty-content" id="penaltyContent">
              âš ï¸ æ¿€æ´»åå‡æŒLPå°†é¢ä¸´50%çš„å¥–åŠ±æƒ©ç½šï¼<br>
              âš ï¸ 30å¤©å†…å‡æŒå°†å¤±å»é‚€è¯·å¥–åŠ±èµ„æ ¼<br>
              âš ï¸ 7å¤©å†…æœ€å¤šå‡æŒ30%ï¼Œä¸”éœ€è¦1å¤©å†·å´æ—¶é—´
            </div>
          </div>
          
          <!-- å†·å´æ—¶é—´æ˜¾ç¤º -->
          <div class="cooldown-timer" id="cooldownTimer">
            <div class="cooldown-label">
              <span>â³</span>
              <span id="cooldownLabel">å‡æŒå†·å´æ—¶é—´</span>
            </div>
            <div class="cooldown-value" id="cooldownValue">00:00:00</div>
          </div>
          
          <div class="action-buttons">
            <button class="action-button claim" id="claimBtn" onclick="claimRewards()" disabled>
              <span>ğŸ’°</span>
              <span id="claimBtnText">é¢†å–å¥–åŠ±</span>
            </button>
            <button class="action-button referral" id="claimReferralBtn" onclick="claimReferralRewards()" disabled>
              <span>ğŸ‘¥</span>
              <span id="claimReferralBtnText">é¢†å–é‚€è¯·å¥–åŠ±</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- é£é™©æç¤º -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>âš ï¸</span>
        <span id="riskTitle">é£é™©æç¤º</span>
      </div>
      <div id="riskText">
        æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚
      </div>
    </div>

    <!-- é¡µè„š -->
    <div class="footer" id="footerText">LOMswap Â· Conflux eSpace</div>
  </div>

  <!-- ç¡®è®¤æ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal-card">
      <h3 class="modal-title" id="confirmTitle">ç¡®è®¤æ“ä½œ</h3>
      <div class="modal-content" id="confirmContent">
        <!-- å†…å®¹åŠ¨æ€å¡«å…… -->
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="confirmCancelBtn">å–æ¶ˆ</button>
        <button class="modal-btn confirm" id="confirmActionBtn">ç¡®è®¤</button>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // ==================== é…ç½® ====================
    const CONFIG = {
      REWARD_CONTRACT: "0x233f9C12514A29d860e482eB29f1EE1f8fcC59aa",
      LP_TOKEN: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85", // CFX-LOM LPä»£å¸
      LOM_TOKEN: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3", // LOMä»£å¸
      WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
      ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
      PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85",
      CHAIN_ID: 1030,
      MIN_ACTIVATION: 100 // æœ€å°æ¿€æ´»è¦æ±‚ 100 LP
    };

    // ==================== åˆçº¦ABI ====================
    const REWARD_ABI = [
      "function activate(address referrer)",
      "function claimAll()",
      "function claimReferral()",
      "function lpToken() view returns (address)",
      "function rewardToken() view returns (address)",
      "function minActivation() view returns (uint256)",
      "function totalShares() view returns (uint256)",
      "function accRewardPerShare() view returns (uint256)",
      "function lastRewardTime() view returns (uint256)",
      "function rewardPerSecond() view returns (uint256)",
      "function users(address) view returns (uint256 shares, uint256 rewardDebt, uint256 pendingReferral, uint256 lastClaimTime, uint256 activeTime, uint256 lastReduceTime, uint256 referralUnlockTime, address referrer, bool cleanInFirst30Days)",
      "function pendingReward(address user) view returns (uint256)",
      "function blacklist(address) view returns (bool)",
      "function paused() view returns (bool)"
    ];

    const ERC20_ABI = [
      "function balanceOf(address owner) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function symbol() view returns (string)",
      "function name() view returns (string)",
      "function totalSupply() view returns (uint256)",
      "function approve(address spender, uint256 amount) returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)"
    ];

    const PAIR_ABI = [
      "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address owner) view returns (uint256)",
      "function token0() view returns (address)",
      "function token1() view returns (address)"
    ];

    const ROUTER_ABI = [
      "function getAmountsOut(uint amountIn, address[] path) view returns (uint[] memory amounts)",
      "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) payable",
      "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
      "function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
      "function addLiquidityETH(address token, uint amountTokenDesired, uint amountTokenMin, uint amountETHMin, address to, uint deadline) payable returns (uint amountToken, uint amountETH, uint liquidity)",
      "function removeLiquidityETH(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountToken, uint amountETH)"
    ];

    // ==================== å…¨å±€å˜é‡ ====================
    let provider, signer, account;
    let rewardContract, lpTokenContract, lomTokenContract, pairContract, routerContract;
    let isChinese = true;
    let fromToken = "CFX";
    let toToken = "LOM";
    let slippage = 0.1;
    let refreshInterval;
    let cooldownInterval;
    let userStakingData = null;
    let currentReserves = { cfx: 0, lom: 0 };

    // ==================== å·¥å…·å‡½æ•° ====================
    class Utils {
      static formatNumber(num, decimals = 6) {
        if (!num && num !== 0) return '0.000000';
        const n = parseFloat(num);
        if (isNaN(n)) return '0.000000';
        
        const factor = Math.pow(10, decimals);
        const truncated = Math.floor(n * factor) / factor;
        
        const parts = truncated.toString().split('.');
        let integerPart = parts[0];
        let decimalPart = parts[1] || '';
        
        if (decimalPart.length < decimals) {
          decimalPart = decimalPart.padEnd(decimals, '0');
        } else if (decimalPart.length > decimals) {
          decimalPart = decimalPart.substring(0, decimals);
        }
        
        const result = integerPart + '.' + decimalPart;
        return this.removeTrailingZeros(result);
      }

      static removeTrailingZeros(str) {
        if (!str.includes('.')) return str;
        let result = str.replace(/0+$/, '');
        if (result.endsWith('.')) result = result.slice(0, -1);
        return result;
      }

      static formatAddress(address) {
        if (!address) return '';
        return address.slice(0, 6) + '...' + address.slice(-4);
      }

      static isValidAddress(address) {
        return /^0x[a-fA-F0-9]{40}$/.test(address);
      }

      static formatTime(seconds) {
        if (!seconds) return '--';
        const date = new Date(seconds * 1000);
        return date.toLocaleString('zh-CN');
      }

      static formatDuration(seconds) {
        if (!seconds) return '0å¤©';
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        
        if (days > 0) {
          return `${days}å¤©${hours > 0 ? ` ${hours}å°æ—¶` : ''}`;
        } else if (hours > 0) {
          return `${hours}å°æ—¶${minutes > 0 ? ` ${minutes}åˆ†é’Ÿ` : ''}`;
        } else {
          return `${minutes}åˆ†é’Ÿ`;
        }
      }

      static formatCountdown(seconds) {
        if (!seconds || seconds <= 0) return '00:00:00';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }

      static async showConfirm(title, content) {
        return new Promise((resolve) => {
          const modal = document.getElementById('confirmModal');
          const titleEl = document.getElementById('confirmTitle');
          const contentEl = document.getElementById('confirmContent');
          const cancelBtn = document.getElementById('confirmCancelBtn');
          const actionBtn = document.getElementById('confirmActionBtn');
          
          titleEl.textContent = title;
          contentEl.innerHTML = content;
          
          modal.style.display = 'flex';
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            actionBtn.removeEventListener('click', onAction);
            modal.style.display = 'none';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onAction = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          actionBtn.addEventListener('click', onAction);
        });
      }

      static showError(message) {
        const errorBox = document.getElementById('swapErrorBox');
        const errorText = document.getElementById('swapErrorText');
        errorText.textContent = message;
        errorBox.classList.add('show');
        
        setTimeout(() => {
          errorBox.classList.remove('show');
        }, 5000);
      }

      static showLoading(button, text) {
        button.disabled = true;
        const originalText = button.innerHTML;
        button.innerHTML = `<div class="loading-spinner"></div> ${text}`;
        return () => {
          button.disabled = false;
          button.innerHTML = originalText;
        };
      }
    }

    // ==================== é’±åŒ…ç®¡ç† ====================
    class WalletManager {
      static async connect() {
        try {
          if (!window.ethereum) {
            Utils.showError(isChinese ? "è¯·å®‰è£…TPæˆ–web3é’±åŒ…" : "Please install TP or WEB3 wallet");
            return false;
          }
          
          const walletBtn = document.getElementById('walletBtn');
          walletBtn.textContent = isChinese ? 'è¿æ¥ä¸­...' : 'Connecting...';
          walletBtn.classList.add('connecting');
          
          const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
          });
          
          if (!accounts || accounts.length === 0) {
            throw new Error(isChinese ? 'ç”¨æˆ·æ‹’ç»è¿æ¥' : 'User rejected connection');
          }
          
          account = accounts[0];
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          
          await this.checkNetwork();
          await this.initContracts();
          this.updateUI();
          
          if (refreshInterval) clearInterval(refreshInterval);
          refreshInterval = setInterval(() => {
            DataManager.refreshAll();
            StakingManager.refreshData();
          }, 10000);
          
          return true;
        } catch (error) {
          console.error("é’±åŒ…è¿æ¥å¤±è´¥:", error);
          Utils.showError(isChinese ? `è¿æ¥å¤±è´¥: ${error.message}` : `Connection failed: ${error.message}`);
          return false;
        } finally {
          this.updateUI();
        }
      }

      static async checkNetwork() {
        const network = await provider.getNetwork();
        if (network.chainId !== CONFIG.CHAIN_ID) {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x' + CONFIG.CHAIN_ID.toString(16) }]
            });
          } catch (error) {
            if (error.code === 4902) {
              Utils.showError(isChinese ? 'è¯·æ·»åŠ Conflux eSpaceç½‘ç»œ' : 'Please add Conflux eSpace network');
            } else {
              Utils.showError(isChinese ? 'è¯·åˆ‡æ¢åˆ°Conflux eSpaceç½‘ç»œ' : 'Please switch to Conflux eSpace network');
            }
            throw error;
          }
        }
      }

      static async initContracts() {
        rewardContract = new ethers.Contract(CONFIG.REWARD_CONTRACT, REWARD_ABI, signer);
        lpTokenContract = new ethers.Contract(CONFIG.LP_TOKEN, ERC20_ABI, signer);
        lomTokenContract = new ethers.Contract(CONFIG.LOM_TOKEN, ERC20_ABI, signer);
        pairContract = new ethers.Contract(CONFIG.PAIR, PAIR_ABI, signer);
        routerContract = new ethers.Contract(CONFIG.ROUTER, ROUTER_ABI, signer);
      }

      static updateUI() {
        const walletBtn = document.getElementById("walletBtn");
        const swapBtn = document.getElementById("swapBtn");
        
        walletBtn.classList.remove('connecting');
        
        if (account) {
          const displayAddress = Utils.formatAddress(account);
          walletBtn.textContent = displayAddress;
          walletBtn.classList.add('connected');
          swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
          swapBtn.disabled = false;
        } else {
          walletBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          walletBtn.classList.remove('connected');
          swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          swapBtn.disabled = false;
        }
      }

      static disconnect() {
        account = null;
        provider = null;
        signer = null;
        rewardContract = null;
        lpTokenContract = null;
        lomTokenContract = null;
        pairContract = null;
        routerContract = null;
        
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
        
        if (cooldownInterval) {
          clearInterval(cooldownInterval);
          cooldownInterval = null;
        }
        
        this.updateUI();
        DataManager.resetAllData();
        StakingManager.resetData();
      }
    }

    // ==================== æ•°æ®ç®¡ç† ====================
    class DataManager {
      static async refreshAll() {
        if (!account) return;
        
        try {
          await this.updateAllBalances();
          await this.updatePoolInfo();
          this.updateSwapButtonState();
        } catch (error) {
          console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
        }
      }

      static async updateAllBalances() {
        if (!account) return;
        
        try {
          // è·å–CFXä½™é¢
          const cfxBal = await provider.getBalance(account);
          const cfxBalance = parseFloat(ethers.utils.formatEther(cfxBal));
          
          // è·å–LOMä½™é¢
          const lomBal = await lomTokenContract.balanceOf(account);
          const lomBalance = parseFloat(ethers.utils.formatUnits(lomBal, 18));
          
          // æ›´æ–°æ˜¾ç¤º
          if (fromToken === "CFX") {
            document.getElementById('fromBal').textContent = Utils.formatNumber(cfxBalance);
          }
          if (toToken === "LOM") {
            document.getElementById('toBal').textContent = Utils.formatNumber(lomBalance);
          }
          
        } catch (error) {
          console.error("æ›´æ–°ä½™é¢å¤±è´¥:", error);
        }
      }

      static async updatePoolInfo() {
        try {
          if (!pairContract || !account) return;
          
          // è·å–æ± å­å‚¨å¤‡
          const [r0, r1] = await pairContract.getReserves();
          const t0 = await pairContract.token0();
          
          const reserveCfx = t0.toLowerCase() === CONFIG.WCFX.toLowerCase() ? r0 : r1;
          const reserveLom = t0.toLowerCase() === CONFIG.WCFX.toLowerCase() ? r1 : r0;
          
          const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
          const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
          
          currentReserves.cfx = cfxReserve;
          currentReserves.lom = lomReserve;
          
          // è·å–æ€»ä¾›åº”é‡
          const totalSupply = await pairContract.totalSupply();
          const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
          
          // è·å–ç”¨æˆ·LPä½™é¢
          const lpBal = await pairContract.balanceOf(account);
          const lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
          
          let share = 0;
          let userCfx = 0;
          let userLom = 0;
          
          if (totalSupplyNum > 0 && lpAmt > 0) {
            share = (lpAmt / totalSupplyNum) * 100;
            userCfx = cfxReserve * (share / 100);
            userLom = lomReserve * (share / 100);
          }
          
          // æ›´æ–°æ˜¾ç¤º
          document.getElementById("cfxReserve").textContent = cfxReserve.toFixed(2);
          document.getElementById("lomReserve").textContent = lomReserve.toFixed(2);
          document.getElementById("userCfx").textContent = Utils.formatNumber(userCfx);
          document.getElementById("userLom").textContent = Utils.formatNumber(userLom);
          document.getElementById("userLp").textContent = Utils.formatNumber(lpAmt);
          document.getElementById("userPoolShare").textContent = share.toFixed(4) + "%";
          
          const removeBtn = document.getElementById("removeBtn");
          if (removeBtn) {
            removeBtn.disabled = lpAmt <= 0;
          }
          
        } catch (error) {
          console.error("æ›´æ–°æ± å­ä¿¡æ¯å¤±è´¥:", error);
        }
      }

      static updateSwapButtonState() {
        const swapBtn = document.getElementById("swapBtn");
        const fromAmount = document.getElementById("fromAmount").value;
        
        if (!account) {
          swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          swapBtn.disabled = false;
          return;
        }
        
        if (!fromAmount || fromAmount === "0" || fromAmount === "") {
          swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
          swapBtn.disabled = true;
          return;
        }
        
        swapBtn.textContent = isChinese ? "ç«‹å³å…‘æ¢" : "Swap Now";
        swapBtn.disabled = false;
      }

      static resetAllData() {
        const elements = {
          'fromBal': '0.000000',
          'toBal': '0.000000',
          'cfxReserve': '0.00',
          'lomReserve': '0.00',
          'userCfx': '0.000000',
          'userLom': '0.000000',
          'userLp': '0.000000',
          'userPoolShare': '0%',
          'price': '1 CFX = 0 LOM',
          'minReceived': '0 LOM'
        };
        
        Object.keys(elements).forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = elements[id];
        });
        
        document.getElementById("fromAmount").value = "";
        document.getElementById("toAmount").value = "";
        document.getElementById("removeBtn").disabled = true;
      }
    }

    // ==================== å…‘æ¢ç®¡ç† ====================
    class SwapManager {
      static async updateOutputFromInput() {
        const amount = document.getElementById('fromAmount').value;
        
        if (!amount || amount === '0' || amount === '' || !routerContract) {
          document.getElementById('toAmount').value = "";
          document.getElementById('minReceived').textContent = `0 ${toToken}`;
          DataManager.updateSwapButtonState();
          return;
        }
        
        try {
          const fromDecimals = fromToken === 'CFX' ? 18 : 18;
          const toDecimals = toToken === 'LOM' ? 18 : 18;
          
          const amountIn = ethers.utils.parseUnits(amount, fromDecimals);
          const path = this.getSwapPath();
          
          const amounts = await routerContract.getAmountsOut(amountIn, path);
          const out = ethers.utils.formatUnits(amounts[amounts.length - 1], toDecimals);
          
          document.getElementById('toAmount').value = Utils.formatNumber(out);
          
          // è®¡ç®—æœ€å°æ”¶åˆ°æ•°é‡
          const minOut = parseFloat(out) * (1 - slippage / 100);
          document.getElementById('minReceived').textContent = 
            `${Utils.formatNumber(minOut)} ${toToken}`;
          
          // è®¡ç®—ä»·æ ¼
          const price = parseFloat(out) / parseFloat(amount);
          document.getElementById('price').textContent = 
            `1 ${fromToken} = ${Utils.formatNumber(price)} ${toToken}`;
          
          DataManager.updateSwapButtonState();
          
        } catch (error) {
          console.error('è®¡ç®—è¾“å‡ºå¤±è´¥:', error);
          document.getElementById('toAmount').value = "";
          document.getElementById('swapBtn').textContent = isChinese ? 'è®¡ç®—å¤±è´¥' : 'Calculation Failed';
          document.getElementById('swapBtn').disabled = true;
        }
      }

      static getSwapPath() {
        const path = [];
        
        if (fromToken === 'CFX') {
          path.push(CONFIG.WCFX);
          if (toToken === 'LOM') path.push(CONFIG.LOM_TOKEN);
        } else if (fromToken === 'LOM') {
          path.push(CONFIG.LOM_TOKEN);
          if (toToken === 'CFX') path.push(CONFIG.WCFX);
        }
        
        return path;
      }

      static async executeSwap() {
        const fromAmount = document.getElementById('fromAmount').value;
        const toAmount = document.getElementById('toAmount').value;
        
        if (!fromAmount || fromAmount === '0') {
          Utils.showError(isChinese ? "è¯·è¾“å…¥å…‘æ¢æ•°é‡" : "Please enter swap amount");
          return;
        }
        
        try {
          const resetLoading = Utils.showLoading(
            document.getElementById('swapBtn'),
            isChinese ? 'å¤„ç†ä¸­...' : 'Processing...'
          );
          
          const fromDecimals = fromToken === 'CFX' ? 18 : 18;
          const toDecimals = toToken === 'LOM' ? 18 : 18;
          
          const amountIn = ethers.utils.parseUnits(fromAmount, fromDecimals);
          const path = this.getSwapPath();
          
          const amounts = await routerContract.getAmountsOut(amountIn, path);
          const minOut = amounts[amounts.length - 1].mul(1000 - slippage * 10).div(1000);
          
          const deadline = Math.floor(Date.now() / 1000) + 1200;
          
          let tx;
          
          if (fromToken === 'CFX') {
            tx = await routerContract.swapExactETHForTokensSupportingFeeOnTransferTokens(
              minOut, path, account, deadline, 
              { value: amountIn }
            );
          } else {
            // å…ˆæˆæƒ
            const allowance = await lomTokenContract.allowance(account, CONFIG.ROUTER);
            if (allowance.lt(amountIn)) {
              const approveTx = await lomTokenContract.approve(CONFIG.ROUTER, ethers.constants.MaxUint256);
              await approveTx.wait();
            }
            
            tx = await routerContract.swapExactTokensForETHSupportingFeeOnTransferTokens(
              amountIn, minOut, path, account, deadline
            );
          }
          
          await tx.wait();
          
          document.getElementById('fromAmount').value = '';
          document.getElementById('toAmount').value = '';
          
          await DataManager.refreshAll();
          
          Utils.showError(isChinese ? 'å…‘æ¢æˆåŠŸï¼' : 'Swap successful!');
          
        } catch (error) {
          console.error('å…‘æ¢å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('insufficient funds')) {
            Utils.showError(isChinese ? 'ä½™é¢ä¸è¶³' : 'Insufficient balance');
          } else {
            Utils.showError(isChinese ? 'å…‘æ¢å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Swap failed, please try again');
          }
        } finally {
          const swapBtn = document.getElementById('swapBtn');
          swapBtn.disabled = false;
          swapBtn.innerHTML = isChinese ? 'ç«‹å³å…‘æ¢' : 'Swap Now';
        }
      }

      static reverseTokens() {
        const tempToken = fromToken;
        fromToken = toToken;
        toToken = tempToken;
        
        document.getElementById("fromTokenSymbol").textContent = fromToken;
        document.getElementById("toTokenSymbol").textContent = toToken;
        
        const fromTokenLogo = fromToken === 'CFX' ? 
          "url('https://i.imgur.com/70cXbUI.jpeg')" : 
          "url('https://i.imgur.com/HddyTrv.jpeg')";
        
        const toTokenLogo = toToken === 'LOM' ? 
          "url('https://i.imgur.com/HddyTrv.jpeg')" : 
          "url('https://i.imgur.com/70cXbUI.jpeg')";
        
        document.getElementById("fromTokenLogo").style.backgroundImage = fromTokenLogo;
        document.getElementById("toTokenLogo").style.backgroundImage = toTokenLogo;
        
        document.getElementById("fromAmount").value = "";
        document.getElementById("toAmount").value = "";
        
        DataManager.updateAllBalances();
        DataManager.updateSwapButtonState();
        document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
        document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
      }

      static handlePercentageClick(percent) {
        if (!account) {
          Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
          return;
        }
        
        const balanceText = document.getElementById("fromBal").textContent;
        const balance = parseFloat(balanceText);
        
        if (balance > 0) {
          let amount;
          
          if (percent === 1) {
            if (fromToken === 'CFX') {
              amount = Math.max(0, balance - 0.1); // ç•™ä¸€ç‚¹gasè´¹
            } else {
              amount = balance;
            }
          } else {
            amount = balance * percent;
          }
          
          if (amount > 0) {
            document.getElementById("fromAmount").value = Utils.formatNumber(amount);
            this.updateOutputFromInput();
          }
        }
      }
    }

    // ==================== è´¨æŠ¼ç®¡ç† ====================
    class StakingManager {
      static async refreshData() {
        if (!account) return;
        
        try {
          await this.updateLPBalance();
          await this.updateUserStakingData();
          await this.updatePoolInfo();
          this.updateUI();
        } catch (error) {
          console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
        }
      }

      static async updateLPBalance() {
        if (!account || !lpTokenContract) return;
        
        try {
          const balance = await lpTokenContract.balanceOf(account);
          const lpBalance = parseFloat(ethers.utils.formatUnits(balance, 18));
          
          document.getElementById('lpBalance').textContent = Utils.formatNumber(lpBalance);
          document.getElementById('myLPHolding').textContent = Utils.formatNumber(lpBalance);
          
          // æ›´æ–°å½“å‰LPä½™é¢æ˜¾ç¤º
          const currentLPBalanceEl = document.getElementById('currentLPBalance');
          if (currentLPBalanceEl) {
            currentLPBalanceEl.textContent = Utils.formatNumber(lpBalance) + ' LP';
          }
          
        } catch (error) {
          console.error('è·å–LPä½™é¢å¤±è´¥:', error);
        }
      }

      static async updateUserStakingData() {
        if (!account || !rewardContract) return;
        
        try {
          // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨é»‘åå•
          const isBlacklisted = await rewardContract.blacklist(account);
          if (isBlacklisted) {
            userStakingData = null;
            return;
          }
          
          // è·å–ç”¨æˆ·æ•°æ®
          const userData = await rewardContract.users(account);
          
          if (userData.shares.gt(0)) {
            userStakingData = {
              shares: parseFloat(ethers.utils.formatUnits(userData.shares, 18)),
              rewardDebt: parseFloat(ethers.utils.formatUnits(userData.rewardDebt, 18)),
              pendingReferral: parseFloat(ethers.utils.formatUnits(userData.pendingReferral, 18)),
              lastClaimTime: userData.lastClaimTime.toNumber(),
              activeTime: userData.activeTime.toNumber(),
              lastReduceTime: userData.lastReduceTime.toNumber(),
              referralUnlockTime: userData.referralUnlockTime.toNumber(),
              referrer: userData.referrer,
              cleanInFirst30Days: userData.cleanInFirst30Days
            };
            
            // è·å–å¾…é¢†å–å¥–åŠ±
            const pending = await rewardContract.pendingReward(account);
            userStakingData.pendingReward = parseFloat(ethers.utils.formatUnits(pending, 18));
            
            // æ›´æ–°å†·å´æ—¶é—´æ˜¾ç¤º
            this.updateCooldownDisplay();
          } else {
            userStakingData = null;
          }
        } catch (error) {
          console.error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
          userStakingData = null;
        }
      }

      static async updatePoolInfo() {
        if (!rewardContract) return;
        
        try {
          // è·å–æ± å­æ€»ä¿¡æ¯
          const totalShares = await rewardContract.totalShares();
          const totalSharesFormatted = parseFloat(ethers.utils.formatUnits(totalShares, 18));
          
          document.getElementById('activeShares').textContent = Utils.formatNumber(totalSharesFormatted);
          
          // æ›´æ–°æˆ‘çš„æ•°æ®
          if (userStakingData) {
            document.getElementById('pendingReward').textContent = Utils.formatNumber(userStakingData.pendingReward || 0);
            document.getElementById('referralReward').textContent = Utils.formatNumber(userStakingData.pendingReferral || 0);
            
            document.getElementById('pendingRewardDetail').textContent = Utils.formatNumber(userStakingData.pendingReward || 0);
            document.getElementById('pendingReferralDetail').textContent = Utils.formatNumber(userStakingData.pendingReferral || 0);
            
            // è®¡ç®—æ¿€æ´»æ—¶é•¿
            const now = Math.floor(Date.now() / 1000);
            const activeDuration = now - userStakingData.activeTime;
            document.getElementById('activeDuration').textContent = Utils.formatDuration(activeDuration);
            
            // è®¡ç®—ä¸‹æ¬¡å¯é¢†å–æ—¶é—´
            const nextClaimTime = userStakingData.lastClaimTime + (7 * 24 * 3600);
            if (nextClaimTime > now) {
              const remaining = nextClaimTime - now;
              document.getElementById('nextClaimTime').textContent = Utils.formatDuration(remaining);
            } else {
              document.getElementById('nextClaimTime').textContent = 'ç°åœ¨';
            }
            
            // æ›´æ–°æ¿€æ´»æ—¶é—´æ˜¾ç¤º
            document.getElementById('activationTime').textContent = Utils.formatTime(userStakingData.activeTime);
            
            // æ›´æ–°é‚€è¯·äººæ˜¾ç¤º
            if (userStakingData.referrer !== ethers.constants.AddressZero) {
              document.getElementById('referrerContainer').style.display = 'block';
              document.getElementById('referrerAddress').textContent = Utils.formatAddress(userStakingData.referrer);
            } else {
              document.getElementById('referrerContainer').style.display = 'none';
            }
            
            // æ›´æ–°æ—¶é—´å€ç‡
            this.updateTimeMultiplier();
          }
        } catch (error) {
          console.error('è·å–æ± å­ä¿¡æ¯å¤±è´¥:', error);
        }
      }

      static updateTimeMultiplier() {
        if (!userStakingData) {
          document.getElementById('multiplierValue').textContent = '1.0x';
          document.getElementById('multiplierProgress').style.width = '0%';
          return;
        }
        
        const now = Math.floor(Date.now() / 1000);
        const duration = now - userStakingData.activeTime;
        
        let multiplier = 1.0;
        let progress = 0;
        
        if (duration >= 360 * 24 * 3600) {
          multiplier = 3.0;
          progress = 100;
          this.setActiveStage('stage360');
        } else if (duration >= 180 * 24 * 3600) {
          multiplier = 2.0;
          progress = Math.min(100, (duration - 180 * 24 * 3600) / (180 * 24 * 3600) * 100);
          this.setActiveStage('stage180');
        } else if (duration >= 90 * 24 * 3600) {
          multiplier = 1.5;
          progress = Math.min(100, (duration - 90 * 24 * 3600) / (90 * 24 * 3600) * 100);
          this.setActiveStage('stage90');
        } else if (duration >= 30 * 24 * 3600) {
          multiplier = 1.0;
          progress = Math.min(100, (duration - 30 * 24 * 3600) / (60 * 24 * 3600) * 100);
          this.setActiveStage('stage30');
        } else {
          multiplier = 1.0;
          progress = Math.min(100, duration / (30 * 24 * 3600) * 100);
          this.setActiveStage('stage30');
        }
        
        document.getElementById('multiplierValue').textContent = `${multiplier.toFixed(1)}x`;
        document.getElementById('multiplierProgress').style.width = `${progress}%`;
      }

      static setActiveStage(stageId) {
        const stages = ['stage30', 'stage90', 'stage180', 'stage360'];
        stages.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.classList.toggle('active', id === stageId);
          }
        });
      }

      static updateCooldownDisplay() {
        if (!userStakingData) {
          document.getElementById('cooldownTimer').style.display = 'none';
          return;
        }
        
        const now = Math.floor(Date.now() / 1000);
        const cooldownEnd = userStakingData.lastReduceTime + (24 * 3600);
        
        if (now < cooldownEnd) {
          const remaining = cooldownEnd - now;
          document.getElementById('cooldownValue').textContent = Utils.formatCountdown(remaining);
          document.getElementById('cooldownTimer').style.display = 'block';
        } else {
          document.getElementById('cooldownTimer').style.display = 'none';
        }
      }

      static updateUI() {
        const activateSection = document.getElementById('activationButtons');
        const activatedSection = document.getElementById('activatedSection');
        const inviteSystem = document.getElementById('inviteSystem');
        const activateBtn = document.getElementById('activateBtn');
        const claimBtn = document.getElementById('claimBtn');
        const claimReferralBtn = document.getElementById('claimReferralBtn');
        
        if (!account) {
          // æœªè¿æ¥é’±åŒ…
          if (activatedSection) activatedSection.style.display = 'none';
          if (inviteSystem) inviteSystem.style.display = 'block';
          if (activateBtn) {
            activateBtn.disabled = false;
            activateBtn.textContent = isChinese ? 'è¿æ¥é’±åŒ…' : 'Connect Wallet';
          }
          if (claimBtn) claimBtn.disabled = true;
          if (claimReferralBtn) claimReferralBtn.disabled = true;
          return;
        }
        
        if (userStakingData) {
          // å·²æ¿€æ´»
          if (activatedSection) activatedSection.style.display = 'block';
          if (inviteSystem) inviteSystem.style.display = 'none';
          if (activateSection) activateSection.style.display = 'none';
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          const now = Math.floor(Date.now() / 1000);
          
          // é¢†å–å¥–åŠ±æŒ‰é’®
          if (userStakingData.lastClaimTime + (7 * 24 * 3600) <= now && userStakingData.pendingReward > 0) {
            if (claimBtn) {
              claimBtn.disabled = false;
              claimBtn.textContent = isChinese ? 'é¢†å–å¥–åŠ±' : 'Claim Rewards';
            }
          } else {
            if (claimBtn) {
              claimBtn.disabled = true;
              const nextClaim = userStakingData.lastClaimTime + (7 * 24 * 3600);
              if (nextClaim > now) {
                const remaining = nextClaim - now;
                claimBtn.textContent = `${Utils.formatDuration(remaining)}å`;
              } else {
                claimBtn.textContent = isChinese ? 'æš‚æ— å¥–åŠ±' : 'No Rewards';
              }
            }
          }
          
          // é¢†å–é‚€è¯·å¥–åŠ±æŒ‰é’®
          if (userStakingData.pendingReferral > 0 && now >= userStakingData.referralUnlockTime) {
            if (claimReferralBtn) {
              claimReferralBtn.disabled = false;
              claimReferralBtn.textContent = isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral';
            }
          } else {
            if (claimReferralBtn) {
              claimReferralBtn.disabled = true;
              if (userStakingData.pendingReferral > 0) {
                if (now < userStakingData.referralUnlockTime) {
                  const remaining = userStakingData.referralUnlockTime - now;
                  claimReferralBtn.textContent = `${Utils.formatDuration(remaining)}åè§£é”`;
                } else {
                  claimReferralBtn.textContent = isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral';
                }
              } else {
                claimReferralBtn.textContent = isChinese ? 'æš‚æ— é‚€è¯·å¥–åŠ±' : 'No Referral';
              }
            }
          }
        } else {
          // æœªæ¿€æ´»
          if (activatedSection) activatedSection.style.display = 'none';
          if (inviteSystem) inviteSystem.style.display = 'block';
          if (activateSection) activateSection.style.display = 'block';
          if (activateBtn) {
            activateBtn.disabled = false;
            activateBtn.textContent = isChinese ? 'æ¿€æ´»å¥–åŠ±' : 'Activate Rewards';
          }
          if (claimBtn) claimBtn.disabled = true;
          if (claimReferralBtn) claimReferralBtn.disabled = true;
        }
      }

      static resetData() {
        userStakingData = null;
        
        // é‡ç½®æ‰€æœ‰æ˜¾ç¤º
        const resetElements = [
          'lpBalance', 'myLPHolding', 'activeShares', 'pendingReward',
          'referralReward', 'pendingRewardDetail', 'pendingReferralDetail',
          'nextClaimTime', 'activeDuration', 'activationTime', 'multiplierValue',
          'currentLPBalance'
        ];
        
        resetElements.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = id.includes('Time') ? '--' : '0';
        });
        
        const progressBar = document.getElementById('multiplierProgress');
        if (progressBar) progressBar.style.width = '0%';
        
        const cooldownTimer = document.getElementById('cooldownTimer');
        if (cooldownTimer) cooldownTimer.style.display = 'none';
        
        this.updateUI();
      }

      static async activateStaking() {
        if (!account) {
          await WalletManager.connect();
          return;
        }
        
        try {
          // è·å–é‚€è¯·åœ°å€
          const inviteAddress = document.getElementById('inviteAddress').value.trim();
          let referrer = ethers.constants.AddressZero;
          
          if (inviteAddress) {
            if (!Utils.isValidAddress(inviteAddress)) {
              Utils.showError(isChinese ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚€è¯·åœ°å€' : 'Please enter valid invite address');
              return;
            }
            
            if (inviteAddress.toLowerCase() === account.toLowerCase()) {
              Utils.showError(isChinese ? 'ä¸èƒ½é‚€è¯·è‡ªå·±' : 'Cannot invite yourself');
              return;
            }
            
            referrer = inviteAddress;
          }
          
          // æ£€æŸ¥LPä½™é¢
          const lpBalance = await lpTokenContract.balanceOf(account);
          const minActivation = ethers.utils.parseUnits(CONFIG.MIN_ACTIVATION.toString(), 18);
          
          if (lpBalance.lt(minActivation)) {
            Utils.showError(isChinese ? `æœ€ä½æ¿€æ´»è¦æ±‚: ${CONFIG.MIN_ACTIVATION} LP` : `Min activation: ${CONFIG.MIN_ACTIVATION} LP`);
            return;
          }
          
          // ç¡®è®¤æ¿€æ´»
          const confirmed = await Utils.showConfirm(
            isChinese ? 'æ¿€æ´»LPå¥–åŠ±' : 'Activate LP Rewards',
            isChinese ? 
              `ç¡®è®¤æ¿€æ´»LPæŒä»“å¥–åŠ±?` + (referrer !== ethers.constants.AddressZero ? `<br>é‚€è¯·äºº: ${Utils.formatAddress(referrer)}` : '') :
              `Confirm to activate LP holding rewards?` + (referrer !== ethers.constants.AddressZero ? `<br>Referrer: ${Utils.formatAddress(referrer)}` : '')
          );
          
          if (!confirmed) return;
          
          const resetLoading = Utils.showLoading(
            document.getElementById('activateBtn'),
            isChinese ? 'æ¿€æ´»ä¸­...' : 'Activating...'
          );
          
          try {
            const tx = await rewardContract.activate(referrer);
            await tx.wait();
            
            // æ¸…ç©ºé‚€è¯·è¾“å…¥æ¡†
            document.getElementById('inviteAddress').value = '';
            
            // åˆ·æ–°æ•°æ®
            await this.refreshData();
            
            Utils.showError(isChinese ? 'å¥–åŠ±æ¿€æ´»æˆåŠŸï¼' : 'Rewards activated successfully!');
          } finally {
            resetLoading();
          }
          
        } catch (error) {
          console.error('æ¿€æ´»å¥–åŠ±å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('Activated')) {
            Utils.showError(isChinese ? 'å·²ç»æ¿€æ´»è¿‡å¥–åŠ±' : 'Already activated rewards');
          } else if (message.includes('Below minimum')) {
            Utils.showError(isChinese ? `æœ€ä½æ¿€æ´»è¦æ±‚: ${CONFIG.MIN_ACTIVATION} LP` : `Min activation: ${CONFIG.MIN_ACTIVATION} LP`);
          } else {
            Utils.showError(isChinese ? 'æ¿€æ´»å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Activation failed, please try again');
          }
        }
      }

      static async claimRewards() {
        if (!account || !userStakingData) return;
        
        try {
          const confirmed = await Utils.showConfirm(
            isChinese ? 'é¢†å–å¥–åŠ±' : 'Claim Rewards',
            isChinese ? 
              `ç¡®è®¤é¢†å– ${Utils.formatNumber(userStakingData.pendingReward)} LOM å¥–åŠ±?` :
              `Confirm to claim ${Utils.formatNumber(userStakingData.pendingReward)} LOM rewards?`
          );
          
          if (!confirmed) return;
          
          const resetLoading = Utils.showLoading(
            document.getElementById('claimBtn'),
            isChinese ? 'é¢†å–ä¸­...' : 'Claiming...'
          );
          
          try {
            const tx = await rewardContract.claimAll();
            await tx.wait();
            
            // åˆ·æ–°æ•°æ®
            await this.refreshData();
            
            Utils.showError(isChinese ? 'å¥–åŠ±é¢†å–æˆåŠŸï¼' : 'Rewards claimed successfully!');
          } finally {
            resetLoading();
          }
          
        } catch (error) {
          console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('Too soon')) {
            Utils.showError(isChinese ? 'é¢†å–é—´éš”éœ€è¦7å¤©ä»¥ä¸Š' : 'Claim interval must be 7 days or more');
          } else {
            Utils.showError(isChinese ? 'é¢†å–å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Claim failed, please try again');
          }
        }
      }

      static async claimReferralRewards() {
        if (!account || !userStakingData) return;
        
        try {
          const confirmed = await Utils.showConfirm(
            isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral Rewards',
            isChinese ? 
              `ç¡®è®¤é¢†å– ${Utils.formatNumber(userStakingData.pendingReferral)} LOM é‚€è¯·å¥–åŠ±?` :
              `Confirm to claim ${Utils.formatNumber(userStakingData.pendingReferral)} LOM referral rewards?`
          );
          
          if (!confirmed) return;
          
          const resetLoading = Utils.showLoading(
            document.getElementById('claimReferralBtn'),
            isChinese ? 'é¢†å–ä¸­...' : 'Claiming...'
          );
          
          try {
            const tx = await rewardContract.claimReferral();
            await tx.wait();
            
            // åˆ·æ–°æ•°æ®
            await this.refreshData();
            
            Utils.showError(isChinese ? 'é‚€è¯·å¥–åŠ±é¢†å–æˆåŠŸï¼' : 'Referral rewards claimed successfully!');
          } finally {
            resetLoading();
          }
          
        } catch (error) {
          console.error('é¢†å–é‚€è¯·å¥–åŠ±å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('Locked')) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = userStakingData.referralUnlockTime - now;
            Utils.showError(isChinese ? 
              `é‚€è¯·å¥–åŠ±é”å®šä¸­ï¼Œ${Utils.formatDuration(remaining)}åè§£é”` :
              `Referral rewards locked, unlock in ${Utils.formatDuration(remaining)}`
            );
          } else {
            Utils.showError(isChinese ? 'é¢†å–å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Claim failed, please try again');
          }
        }
      }
    }

    // ==================== UIç®¡ç† ====================
    class UIManager {
      static init() {
        this.setupEventListeners();
        this.setupTabs();
        this.updateTexts();
        
        // æ£€æŸ¥å†·å´æ—¶é—´
        if (cooldownInterval) clearInterval(cooldownInterval);
        cooldownInterval = setInterval(() => {
          if (userStakingData) {
            StakingManager.updateCooldownDisplay();
          }
        }, 1000);
      }

      static setupEventListeners() {
        // é’±åŒ…æŒ‰é’®
        document.getElementById('walletBtn').addEventListener('click', async () => {
          if (account) {
            if (confirm(isChinese ? 'ç¡®å®šè¦æ–­å¼€é’±åŒ…è¿æ¥å—ï¼Ÿ' : 'Are you sure to disconnect?')) {
              WalletManager.disconnect();
            }
          } else {
            await WalletManager.connect();
          }
        });
        
        // è¯­è¨€åˆ‡æ¢
        document.getElementById('langBtn').addEventListener('click', () => {
          isChinese = !isChinese;
          document.getElementById('langBtn').textContent = isChinese ? 'EN' : 'ZN';
          this.updateTexts();
        });
        
        // å…‘æ¢é¡µé¢äº‹ä»¶
        document.getElementById('fromAmount').addEventListener('input', () => {
          SwapManager.updateOutputFromInput();
        });
        
        document.getElementById('reverse').addEventListener('click', () => {
          SwapManager.reverseTokens();
        });
        
        document.getElementById('swapBtn').addEventListener('click', async () => {
          if (!account) {
            await WalletManager.connect();
          } else {
            await SwapManager.executeSwap();
          }
        });
        
        // ç™¾åˆ†æ¯”æŒ‰é’®
        document.querySelectorAll('.percent-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('.percent-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            const percent = parseFloat(e.target.dataset.percent);
            SwapManager.handlePercentageClick(percent);
          });
        });
        
        // æ»‘ç‚¹æŒ‰é’®
        document.querySelectorAll('.slippage-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('.slippage-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            slippage = parseFloat(e.target.dataset.slip);
            
            // é‡æ–°è®¡ç®—è¾“å‡º
            if (document.getElementById("fromAmount").value) {
              SwapManager.updateOutputFromInput();
            }
          });
        });
        
        // é‚€è¯·åœ°å€éªŒè¯
        document.getElementById('inviteAddress').addEventListener('input', (e) => {
          const errorText = document.getElementById('inviteErrorText');
          e.target.classList.remove('invite-input-error');
          errorText.classList.remove('show');
        });
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        this.setupTabs();
        
        // ç›‘å¬é’±åŒ…äº‹ä»¶
        if (window.ethereum) {
          window.ethereum.on('accountsChanged', (accounts) => {
            if (accounts.length === 0) {
              WalletManager.disconnect();
            } else {
              location.reload();
            }
          });
          
          window.ethereum.on('chainChanged', () => {
            location.reload();
          });
        }
      }

      static setupTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const tabId = btn.dataset.tab;
            
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            // åˆ‡æ¢åˆ°ç›¸å…³é¡µé¢æ—¶åˆ·æ–°æ•°æ®
            if (account) {
              if (tabId === 'swap' || tabId === 'liquidity') {
                DataManager.refreshAll();
              } else if (tabId === 'staking') {
                StakingManager.refreshData();
              }
            }
          });
        });
      }

      static updateTexts() {
        // æ›´æ–°æ‰€æœ‰æ–‡æœ¬
        const texts = {
          // è´¨æŠ¼é¡µé¢
          'stakingTitle': isChinese ? 'LPæŒä»“å¥–åŠ±å†œåœº' : 'LP Holding Rewards Farm',
          'lpBalanceLabel': isChinese ? 'æˆ‘çš„LPæŒä»“' : 'My LP Holding',
          'activeSharesLabel': isChinese ? 'æ´»è·ƒä»½é¢' : 'Active Shares',
          'pendingRewardLabel': isChinese ? 'å¾…é¢†å–å¥–åŠ±' : 'Pending Rewards',
          'referralRewardLabel': isChinese ? 'é‚€è¯·å¥–åŠ±' : 'Referral Rewards',
          'multiplierLabel': isChinese ? 'æ—¶é—´å€ç‡:' : 'Time Multiplier:',
          'activateTitle': isChinese ? 'æ¿€æ´»LPæŒä»“å¥–åŠ±' : 'Activate LP Rewards',
          'activationRequirements': isChinese ? 'æ¿€æ´»æ¡ä»¶ï¼šé’±åŒ…ä¸­éœ€æŒæœ‰è‡³å°‘ 100 LP ä»£å¸' : 'Activation: Need at least 100 LP tokens',
          'inviteTitle': isChinese ? 'é‚€è¯·ç³»ç»Ÿ (å¯é€‰)' : 'Referral System (Optional)',
          'inviteSubtitle': isChinese ? 'ç»‘å®šé‚€è¯·äººåœ°å€å¯è·å¾—é¢å¤–5%å¥–åŠ±åˆ†æˆã€‚é‚€è¯·äººå¯è·å¾—æ‚¨æ”¶ç›Šçš„5%ä½œä¸ºå¥–åŠ±ã€‚' : 
                                      'Bind referrer to get extra 5% reward share. Referrer gets 5% of your rewards.',
          'activatedTitle': isChinese ? 'å¥–åŠ±å·²æ¿€æ´»' : 'Rewards Activated',
          'activateBtnText': isChinese ? 'æ¿€æ´»å¥–åŠ±' : 'Activate Rewards',
          'rewardsTitle': isChinese ? 'å¥–åŠ±ç®¡ç†' : 'Rewards Management',
          'penaltyTitle': isChinese ? 'å‡æŒæƒ©ç½šè­¦å‘Š' : 'Reduction Penalty Warning',
          'penaltyContent': isChinese ? 'âš ï¸ æ¿€æ´»åå‡æŒLPå°†é¢ä¸´50%çš„å¥–åŠ±æƒ©ç½šï¼<br>âš ï¸ 30å¤©å†…å‡æŒå°†å¤±å»é‚€è¯·å¥–åŠ±èµ„æ ¼<br>âš ï¸ 7å¤©å†…æœ€å¤šå‡æŒ30%ï¼Œä¸”éœ€è¦1å¤©å†·å´æ—¶é—´' :
                                      'âš ï¸ Reducing LP incurs 50% penalty!<br>âš ï¸ Reduction within 30 days loses referral<br>âš ï¸ Max 30% reduction in 7 days, 1-day cooldown',
          'cooldownLabel': isChinese ? 'å‡æŒå†·å´æ—¶é—´' : 'Reduction Cooldown',
          'claimBtnText': isChinese ? 'é¢†å–å¥–åŠ±' : 'Claim Rewards',
          'claimReferralBtnText': isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral',
          
          // é£é™©æç¤º
          'riskTitle': isChinese ? 'é£é™©æç¤º' : 'Risk Warning',
          'riskText': isChinese ? 
            'æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚' :
            'This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.',
          
          // é¡µè„š
          'footerText': isChinese ? 'LOMswap Â· Conflux eSpace' : 'LOMswap Â· Conflux eSpace',
          
          // æ ‡ç­¾é¡µ
          'swap': isChinese ? 'å…‘æ¢' : 'Swap',
          'liquidity': isChinese ? 'æµåŠ¨æ€§' : 'Liquidity',
          'staking': isChinese ? 'LPå¥–åŠ±' : 'LP Rewards'
        };
        
        Object.keys(texts).forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = texts[id];
          }
        });
        
        // æ›´æ–°é‚€è¯·è¾“å…¥æ¡†placeholder
        const inviteInput = document.getElementById('inviteAddress');
        if (inviteInput) {
          inviteInput.placeholder = isChinese ? 
            'è¯·è¾“å…¥é‚€è¯·äººé’±åŒ…åœ°å€ (0xå¼€å¤´)' : 
            'Enter referrer wallet address (0x...)';
        }
        
        // æ›´æ–°é‚€è¯·é”™è¯¯æ–‡æœ¬
        const inviteError = document.getElementById('inviteErrorText');
        if (inviteError) {
          inviteError.textContent = isChinese ? 
            'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)' : 
            'Please enter valid wallet address (0x..., 42 chars)';
        }
      }
    }

    // ==================== å·¥å…·å‡½æ•°å¯¼å‡º ====================
    function switchToStakingTab() {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector('[data-tab="staking"]').classList.add('active');
      document.getElementById('stakingTab').classList.add('active');
      
      if (account) {
        StakingManager.refreshData();
      }
    }

    async function activateStaking() {
      await StakingManager.activateStaking();
    }

    async function claimRewards() {
      await StakingManager.claimRewards();
    }

    async function claimReferralRewards() {
      await StakingManager.claimReferralRewards();
    }

    // ==================== åˆå§‹åŒ– ====================
    document.addEventListener('DOMContentLoaded', () => {
      UIManager.init();
      
      // å°è¯•è‡ªåŠ¨è¿æ¥é’±åŒ…
      if (window.ethereum && window.ethereum.selectedAddress) {
        setTimeout(() => {
          WalletManager.connect();
        }, 1000);
      }
    });
  </script>
</body>
</html>
