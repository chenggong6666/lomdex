<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap</title>
  
  <!-- Êî∂ËóèÂõæÊ†áÂíåÁ§æ‰∫§Â™í‰ΩìÊ†áÁ≠æ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <!-- Open Graph Ê†áÁ≠æ -->
  <meta property="og:title" content="LOMswap - Conflux Âéª‰∏≠ÂøÉÂåñ‰∫§ÊòìÊâÄ">
  <meta property="og:description" content="Âú® Conflux eSpace ‰∏ä‰∫§Êòì LOM ‰ª£Â∏Å">
  <meta property="og:image" content="https://i.imgur.com/HddyTrv.jpeg">
  <meta property="og:url" content="https://lom-dex.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- ÂÆâÂÖ®Á≠ñÁï• -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self' https:;
                 script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https://i.imgur.com data:;
                 connect-src 'self' https://*.confluxrpc.com wss: blob:;
                 font-src 'self' data:;
                 frame-src 'none';
                 object-src 'none';">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== Âü∫Á°ÄÊ†∑Âºè ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== È°πÁõÆ‰ªãÁªçÂºπÁ™ó ========== */
    .project-intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .project-intro-overlay.show {
      display: flex;
    }
    
    .project-intro-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
      position: relative;
      animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .project-intro-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .project-intro-logo {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 3px solid var(--accent-yellow);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    }
    
    .project-intro-title {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 10px;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }
    
    .project-intro-close-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: var(--accent-yellow);
      transform: rotate(90deg);
    }
    
    /* ========== Â§¥ÈÉ®Ê†∑Âºè ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
      position: relative;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-container:hover {
      transform: translateY(-2px);
    }
    
    .logo-img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }
    
    .wallet-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      width: auto;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
      max-width: 220px;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 0;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    #walletBtn {
      min-width: 110px !important;
      max-width: 110px !important;
      width: 110px !important;
    }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      max-width: 40px;
      max-height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ========== Ê†áÁ≠æÈ°µÊ†∑Âºè ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== Âç°ÁâáÊ†∑Âºè ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* ========== ‰∫§ÊòìÁïåÈù¢Ê†∑Âºè ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      position: relative;
      margin-bottom: 6px;
    }
    
    .token-input-wrapper.focused {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      position: relative;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
      transform: translateY(-4px);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
      margin-bottom: -4px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
      transform: translateY(-1px);
    }
    
    .token-logo {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      margin-bottom: 12px;
      justify-content: flex-end;
    }
    
    .percent-btn {
      flex: none;
      width: 40px;
      padding: 6px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      text-align: right;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
      padding: 0;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }

    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: -6px 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
      background: transparent;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      color: var(--text-secondary);
      z-index: 2;
    }
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4);
    }
    
    /* ========== ‰∫§ÊòìËØ¶ÊÉÖ ========== */
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
      font-size: 12px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .detail-value.positive {
      color: var(--success);
    }
    
    /* ========== ÊªëÁÇπÊéßÂà∂ ========== */
    .slippage-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }
    
    .slippage-options {
      display: flex;
      gap: 4px;
    }
    
    .slippage-btn {
      padding: 4px 8px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 35px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    /* ========== ‰∏ªÊìç‰ΩúÊåâÈíÆ ========== */
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:active {
      transform: translateY(0);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========== ÊµÅÂä®ÊÄßÈ°µÈù¢Ê†∑Âºè ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stat-value-large {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stat-value-large.positive {
      color: var(--accent-yellow);
    }
    
    .user-position {
      background: var(--gradient-card);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      border: 1px solid var(--border-color);
    }
    
    .position-actions {
      display: flex;
      gap: 8px;
    }
    
    .position-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    /* ========== LPÂ•ñÂä±È°µÈù¢Ê†∑Âºè ========== */
    .lp-reward-panel {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .lp-reward-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));
      border-radius: 16px;
      padding: 16px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .lp-reward-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 215, 0, 0.2);
    }
    
    .lp-reward-card-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .lp-reward-card-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
    }
    
    .lp-reward-card-value.success {
      color: var(--success);
    }
    
    .lp-reward-stats {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .lp-reward-stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lp-reward-stat-row:last-child {
      border-bottom: none;
    }
    
    .lp-reward-stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .lp-reward-stat-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .lp-reward-multiplier {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .lp-reward-multiplier-item {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      border: 1px solid rgba(26, 115, 232, 0.2);
      transition: all 0.3s ease;
    }
    
    .lp-reward-multiplier-item.active {
      background: rgba(255, 215, 0, 0.2);
      border-color: var(--accent-yellow);
      transform: scale(1.05);
    }
    
    .lp-reward-multiplier-days {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .lp-reward-multiplier-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .lp-reward-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .lp-reward-action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .lp-reward-action-btn.activate {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .lp-reward-action-btn.claim {
      background: var(--gradient-primary);
      color: white;
    }
    
    .lp-reward-action-btn.referral {
      background: var(--gradient-green);
      color: white;
    }
    
    .lp-reward-action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .lp-reward-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .lp-reward-referral {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin-top: 20px;
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .lp-reward-referral-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .lp-reward-referral-icon {
      color: var(--success);
      font-size: 18px;
    }
    
    .lp-reward-referral-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .lp-reward-referral-input {
      width: 100%;
      padding: 10px 14px;
      background: rgba(46, 160, 67, 0.05);
      border: 1px solid rgba(46, 160, 67, 0.3);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
      transition: all 0.3s ease;
      margin-bottom: 12px;
    }
    
    .lp-reward-referral-input:focus {
      border-color: var(--success);
      box-shadow: 0 0 0 2px rgba(46, 160, 67, 0.1);
    }
    
    .lp-reward-referral-info {
      font-size: 11px;
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.4;
    }
    
    /* ========== Ê®°ÊÄÅÊ°ÜÊ†∑Âºè ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .modal-input-group {
      margin-bottom: 12px;
    }
    
    .modal-input-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .modal-input:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    /* ========== ‰ª£Â∏ÅÈÄâÊã©Âô® ========== */
    .token-selector-modal {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .token-selector-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .token-search {
      width: 100%;
      padding: 10px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 12px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .token-search:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-search:hover {
      border-color: var(--accent-yellow);
    }
    
    .token-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .token-item:hover {
      background: rgba(26, 115, 232, 0.1);
      transform: translateX(4px);
    }
    
    .token-item-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease;
    }
    
    .token-item:hover .token-item-logo {
      transform: scale(1.1);
    }
    
    .token-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .token-item-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.2s ease;
    }
    
    .token-item:hover .token-item-symbol {
      color: var(--accent-yellow);
    }
    
    .token-item-name {
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-item-balance {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    
    /* ========== ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ ========== */
    .tx-status-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 4000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .tx-status-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      max-width: 350px;
      text-align: center;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .tx-status-icon {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tx-status-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .tx-status-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .tx-status-done-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
    }
    
    .tx-status-done-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    /* ========== ÈîôËØØÊèêÁ§∫Ê°Ü ========== */
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 10px 14px;
      margin: 10px 0;
      font-size: 12px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .error-icon {
      display: inline-block;
      margin-right: 6px;
    }
    
    /* ========== ÁßªÈô§ÊµÅÂä®ÊÄßÂºπÁ™ó ========== */
    .remove-percentage {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: var(--text-primary);
      margin: 8px 0;
    }
    
    .percentage-slider {
      width: 100%;
      margin: 16px 0;
      -webkit-appearance: none;
      height: 6px;
      background: rgba(26, 115, 232, 0.1);
      border-radius: 3px;
      outline: none;
    }
    
    .percentage-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
    }
    
    .percentage-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    
    .percentage-option {
      padding: 8px;
      text-align: center;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-option:hover {
      border-color: var(--primary-blue);
    }
    
    .percentage-option.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .remove-estimate {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .remove-estimate-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .remove-estimate-amounts {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .remove-estimate-amount {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .token-amount-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 15px;
    }
    
    /* ========== È£éÈô©ÊèêÁ§∫ÂíåÈ°µËÑö ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 11px;
      color: var(--text-primary);
      line-height: 1.5;
      position: relative;
      overflow: hidden;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 12px;
      opacity: 0.7;
    }
    
    /* ========== Âä®Áîª ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== Âä†ËΩΩÂä®Áîª ========== */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    .loading-spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }
    
    .loading-spinner.white {
      border-color: rgba(255, 255, 255, 0.3);
      border-top-color: white;
    }
    
    /* ========== ÂìçÂ∫îÂºèË∞ÉÊï¥ ========== */
    @media (max-width: 480px) {
      .app {
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 14px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 44px;
        height: 44px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .header-buttons {
        min-width: 150px;
        max-width: 180px;
      }
      
      #walletBtn {
        min-width: 120px;
        max-width: 140px;
        padding: 8px 12px;
        font-size: 12px;
        height: 36px;
      }
      
      #langBtn {
        width: 36px;
        height: 36px;
        min-width: 36px;
        min-height: 36px;
        max-width: 36px;
        max-height: 36px;
        font-size: 12px;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .modal-card {
        padding: 16px;
      }
      
      .project-intro-card {
        padding: 20px;
      }
      
      .project-intro-title {
        font-size: 24px;
      }
      
      .lp-reward-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 380px) {
      .logo-text {
        font-size: 16px;
      }
      
      .logo-img {
        width: 36px;
        height: 36px;
      }
      
      .header-buttons {
        min-width: 130px;
        max-width: 150px;
      }
      
      #walletBtn {
        min-width: 100px;
        max-width: 120px;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      #langBtn {
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        max-width: 32px;
        max-height: 32px;
      }
      
      .lp-reward-multiplier {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- È°πÁõÆ‰ªãÁªçÂºπÁ™ó -->
  <div class="project-intro-overlay" id="projectIntroOverlay">
    <div class="project-intro-card">
      <button class="project-intro-close-btn" id="projectIntroCloseBtn">√ó</button>
      
      <div class="project-intro-header">
        <div class="project-intro-logo"></div>
        <h1 class="project-intro-title">ÈæôËÑâ LOM</h1>
        <div class="project-intro-subtitle">Conflux.ÁîüÊÄÅÊ†∏ÂøÉËµÑ‰∫ß</div>
        <div class="project-intro-slogan">ÂÖ±ËØÜÂàõÈÄ†‰ª∑ÂÄº</div>
      </div>
      
      <div class="project-intro-content">
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üêâ</span>
            <span>ÂÖ≥‰∫éÈæôËÑâLOM</span>
          </div>
          <div class="project-intro-section-content">
            <p>ÈæôËÑâLOMÁÅµÊÑüÊ∫êËá™‰∏≠ÂõΩ‰º†ÁªüÊñáÂåñ‰∏≠ÁöÑ"ÈæôËÑâ"Ê¶ÇÂøµÔºåË±°ÂæÅÁùÄË¥¢ÂØå„ÄÅÁπÅËç£ÂíåËÉΩÈáèÁöÑÊµÅÂä®„ÄÇÊòØÊ∑±Â∫¶ËµãËÉΩ‰∏≠ÂõΩÂîØ‰∏ÄÂêàËßÑÂÖ¨Èìæ‚Äî‚ÄîÊ†ëÂõæÔºàConfluxÔºâÁöÑÁîüÊÄÅÊ†∏ÂøÉËµÑ‰∫ßÔºåÊõ¥ÊòØÈìæÊé•ÂÖ¨Èìæ‰ª∑ÂÄº„ÄÅÁî®Êà∑Êî∂Áõä‰∏éÁîüÊÄÅÁπÅËç£ÁöÑÂÖ≥ÈîÆÁ∫ΩÂ∏¶Ôºå‰æùÊâòÂÖ¨Èìæ‰ºòÂäøÊûÑÂª∫‰∏ìÂ±û‰ª∑ÂÄºÈó≠ÁéØÔºå‰∏∫ÂèÇ‰∏éËÄÖÂ∏¶Êù•Á°ÆÂÆöÊÄßÂõûÊä•„ÄÇ</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Â∫îÁî®ÁïåÈù¢ -->
  <div class="app">
    <!-- Â§¥ÈÉ® -->
    <div class="header">
      <div class="logo-container" id="logoContainer">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">ËøûÊé•Èí±ÂåÖ</button>
      </div>
    </div>

    <!-- Ê†áÁ≠æÈ°µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">ÂÖëÊç¢</button>
        <button class="tab-btn" data-tab="liquidity">ÊµÅÂä®ÊÄß</button>
        <button class="tab-btn" data-tab="lpReward">LPÂ•ñÂä±</button>
      </div>
    </div>

    <!-- ÂÖëÊç¢È°µÈù¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- ËæìÂÖ•‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- ‰∫§Êç¢ÁÆ≠Â§¥ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">üîÉ</button>
          </div>

          <!-- ËæìÂá∫‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- ÈîôËØØÊèêÁ§∫Ê°Ü -->
          <div class="error-box" id="swapErrorBox">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- ‰∫§ÊòìËØ¶ÊÉÖ -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">ÊªëÁÇπÂÆπÂ∑Æ</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
                <button class="slippage-btn" data-slip="10">10%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†º</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ÊúÄ‰ΩéÊî∂Âà∞</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†ºÂΩ±Âìç</span>
              <span class="detail-value positive" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- ‰∫§ÊòìÊåâÈíÆ -->
          <button class="main-action-btn" id="swapBtn">ËøûÊé•Èí±ÂåÖ</button>
        </div>
      </div>
    </div>
    
    <!-- ÊµÅÂä®ÊÄßÈ°µÈù¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">üíß</span>
          <span id="poolInfoTitle">CFX-LOM Ê±†</span>
        </div>

        <div class="liquidity-summary">
          <!-- Ê±†Â≠êÁªüËÆ°‰ø°ÊÅØ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small" id="cfxReserveLabel">CFX ÂÇ®Â§á</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small" id="lomReserveLabel">LOM ÂÇ®Â§á</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- ÊàëÁöÑÊµÅÂä®Ê±†ËØ¶ÊÉÖ -->
          <div class="user-position">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);" id="myPositionTitle">ÊàëÁöÑÊµÅÂä®Ê±†</div>
              <div style="font-size: 12px; color: var(--text-secondary);" id="positionValue">$0.00</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myCfxLabel">ÊàëÁöÑCFX</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userCfx">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLomLabel">ÊàëÁöÑLOM</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userLom">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLpLabel">ÊàëÁöÑLP‰ª£Â∏Å</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);" id="userLp">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myShareLabel">Ê±†Â≠ê‰ªΩÈ¢ù</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--success);" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">Ê∑ªÂä†ÊµÅÂä®ÊÄß</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ÁßªÈô§ÊµÅÂä®ÊÄß</button>
          </div>
        </div>
      </div>
    </div>

    <!-- LPÂ•ñÂä±È°µÈù¢ -->
    <div class="tab-content" id="lpRewardTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">üèÜ</span>
          <span>LPÊåÅÂ∏ÅÂ•ñÂä±</span>
        </div>

        <!-- ÊøÄÊ¥ªÁä∂ÊÄÅÈù¢Êùø -->
        <div id="activationStatusPanel">
          <div class="lp-reward-panel">
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>üìä</span>
                <span>ÊøÄÊ¥ªÁä∂ÊÄÅ</span>
              </div>
              <div class="lp-reward-card-value" id="activationStatus">Êú™ÊøÄÊ¥ª</div>
            </div>
            
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>üí∞</span>
                <span>LPÊåÅ‰ªì</span>
              </div>
              <div class="lp-reward-card-value" id="lpBalance">0 LPT</div>
            </div>
            
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>‚è±Ô∏è</span>
                <span>ÊåÅÊúâÊó∂Èïø</span>
              </div>
              <div class="lp-reward-card-value" id="daysHeld">0 Â§©</div>
            </div>
            
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>üöÄ</span>
                <span>Â•ñÂä±ÂÄçÁéá</span>
              </div>
              <div class="lp-reward-card-value success" id="rewardMultiplier">1.0x</div>
            </div>
          </div>
        </div>

        <!-- Â•ñÂä±‰ø°ÊÅØÈù¢Êùø -->
        <div class="lp-reward-stats">
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>üíé</span>
              <span>ÂæÖÈ¢ÜÂèñÂ•ñÂä±</span>
            </div>
            <div class="lp-reward-stat-value" id="pendingReward">0 LOM</div>
          </div>
          
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>üìà</span>
              <span>ÊØèÊó•È¢Ñ‰º∞Êî∂Áõä</span>
            </div>
            <div class="lp-reward-stat-value" id="dailyReward">0 LOM</div>
          </div>
          
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>‚ö°</span>
              <span>Êé®ËçêÂ•ñÂä±</span>
            </div>
            <div class="lp-reward-stat-value success" id="pendingReferral">0 LOM</div>
          </div>
        </div>

        <!-- Êó∂Èó¥ÂÄçÁéáÁ≥ªÁªü -->
        <div class="lp-reward-multiplier">
          <div class="lp-reward-multiplier-item" id="multiplier30d">
            <div class="lp-reward-multiplier-days">30Â§©</div>
            <div class="lp-reward-multiplier-value">1.0x</div>
          </div>
          
          <div class="lp-reward-multiplier-item" id="multiplier90d">
            <div class="lp-reward-multiplier-days">90Â§©</div>
            <div class="lp-reward-multiplier-value">1.5x</div>
          </div>
          
          <div class="lp-reward-multiplier-item" id="multiplier180d">
            <div class="lp-reward-multiplier-days">180Â§©</div>
            <div class="lp-reward-multiplier-value">2.0x</div>
          </div>
          
          <div class="lp-reward-multiplier-item" id="multiplier360d">
            <div class="lp-reward-multiplier-days">360Â§©</div>
            <div class="lp-reward-multiplier-value">3.0x</div>
          </div>
        </div>

        <!-- ‰∏ªÊìç‰ΩúÊåâÈíÆ -->
        <div class="lp-reward-actions">
          <button class="lp-reward-action-btn activate" id="activateBtn" disabled>
            <span>üöÄ</span>
            <span>ÊøÄÊ¥ªÂ•ñÂä±</span>
          </button>
          
          <button class="lp-reward-action-btn claim" id="claimBtn" disabled>
            <span>üí∞</span>
            <span>È¢ÜÂèñÂ•ñÂä±</span>
          </button>
          
          <button class="lp-reward-action-btn referral" id="claimReferralBtn" disabled>
            <span>üéÅ</span>
            <span>È¢ÜÂèñÊé®Ëçê</span>
          </button>
        </div>

        <!-- Êé®ËçêÁ≥ªÁªü -->
        <div class="lp-reward-referral" id="referralSection">
          <div class="lp-reward-referral-header">
            <span class="lp-reward-referral-icon">üë•</span>
            <span class="lp-reward-referral-title">Êé®ËçêÁ≥ªÁªü</span>
          </div>
          
          <input type="text" class="lp-reward-referral-input" id="referrerAddress" 
                 placeholder="ËæìÂÖ•Êé®Ëçê‰∫∫Âú∞ÂùÄ (ÂèØÈÄâ)">
          
          <div class="lp-reward-referral-info">
            ÁªëÂÆöÊé®Ëçê‰∫∫ÂèØ‰∫´ÂèóÈ¢ùÂ§ñ5%Â•ñÂä±Âä†ÊàêÔºåÊé®ËçêÂ•ñÂä±ÈîÅÂÆö30Â§©
          </div>
        </div>
      </div>
    </div>

    <!-- È£éÈô©ÊèêÁ§∫ -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>‚ö†Ô∏è</span>
        <span id="riskTitle">È£éÈô©ÊèêÁ§∫</span>
      </div>
      <div id="riskText">
        Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ
      </div>
    </div>

    <!-- È°µËÑö -->
    <div class="footer" id="footerText">LOMswap ¬∑ Conflux eSpace</div>
  </div>

  <!-- ‰ª£Â∏ÅÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
  <div class="token-selector-modal" id="tokenSelectorModal">
    <div class="token-selector-card">
      <h3 class="modal-title" id="tokenSelectorTitle">ÈÄâÊã©‰ª£Â∏Å</h3>
      <input type="text" class="token-search" id="tokenSearch" placeholder="ÊêúÁ¥¢‰ª£Â∏ÅÂêçÁß∞ÊàñÂú∞ÂùÄ">
      <div class="token-list" id="tokenList">
        <!-- ‰ª£Â∏ÅÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
      </div>
    </div>
  </div>

  <!-- Ê∑ªÂä†ÊµÅÂä®ÊÄßÊ®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay" id="addModal">
    <div class="modal-card">
      <h3 class="modal-title" id="addTitle">Ê∑ªÂä†ÊµÅÂä®ÊÄß</h3>
      
      <div class="modal-input-group">
        <label class="modal-input-label">CFX Êï∞Èáè</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addCfx" placeholder="0" step="any" min="0">
          <button class="btn" id="cfxMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ‰ΩôÈ¢ù: <span id="addCfxBal">0</span> CFX
        </div>
      </div>
      
      <div style="text-align: center; font-size: 20px; color: var(--text-primary); margin: 12px 0;">+</div>
      
      <div class="modal-input-group">
        <label class="modal-input-label">LOM Êï∞Èáè</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addLom" placeholder="0" step="any" min="0">
          <button class="btn" id="lomMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ‰ΩôÈ¢ù: <span id="addLomBal">0</span> LOM
        </div>
      </div>
      
      <div style="background: rgba(26, 115, 232, 0.1); border-radius: 10px; padding: 10px; margin: 12px 0; text-align: center;">
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">ÊØî‰æã</div>
        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); word-break: break-all;" id="addRatio">1 CFX = 0 LOM</div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelAddBtn">ÂèñÊ∂à</button>
        <button class="modal-btn confirm" id="confirmAddBtn" disabled>Á°ÆËÆ§Ê∑ªÂä†</button>
      </div>
    </div>
  </div>

  <!-- ÁßªÈô§ÊµÅÂä®ÊÄßÊ®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay" id="removeModal">
    <div class="modal-card">
      <h3 class="modal-title" id="removeTitle">ÁßªÈô§ÊµÅÂä®ÊÄß</h3>
      
      <div>
        <div class="remove-percentage">
          <span id="removePercent">100%</span>
        </div>
        
        <input type="range" min="0" max="100" value="100" step="1" class="percentage-slider" id="removeSlider">
        
        <div class="percentage-options">
          <div class="percentage-option" data-percent="25">25%</div>
          <div class="percentage-option" data-percent="50">50%</div>
          <div class="percentage-option" data-percent="75">75%</div>
          <div class="percentage-option active" data-percent="100">100%</div>
        </div>
        
        <div class="remove-estimate">
          <div class="remove-estimate-title">È¢ÑËÆ°Ëé∑Âæó</div>
          <div class="remove-estimate-amounts">
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstCfx">0</span> CFX
            </div>
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstLom">0</span> LOM
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn cancel" id="cancelRemoveBtn">ÂèñÊ∂à</button>
          <button class="modal-btn confirm" id="confirmRemoveBtn" style="background: var(--gradient-red);">Á°ÆËÆ§ÁßªÈô§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ -->
  <div class="tx-status-overlay" id="txStatusOverlay">
    <div class="tx-status-card">
      <div class="tx-status-icon" id="txStatusIcon">
        <div class="loading-spinner white"></div>
      </div>
      <div class="tx-status-title" id="txStatusTitle">‰∫§ÊòìÂ§ÑÁêÜ‰∏≠</div>
      <div class="tx-status-message" id="txStatusMessage">ËØ∑Á≠âÂæÖÂå∫ÂùóÈìæÁ°ÆËÆ§...</div>
      <button class="tx-status-done-btn" id="txStatusDoneBtn" style="display:none;">ÂÆåÊàê</button>
    </div>
  </div>

  <script>
'use strict';

// ==================== Áªü‰∏ÄÈÖçÁΩÆ ====================
const APP_CONFIG = {
  CONTRACTS: {
    ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
    LOM: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3",
    WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
    PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85",
    USDC: "0x6963efed0ab40f6c3d7bda44a05dcf1437c44372",
    AXCNH: "0x70BFD7F7eADF9b9827541272589A6B2Bb760aE2E",
    USDT0: "0xaf37e8b6c9ed7f6318979f56fc287d76c30847ff",
    CNHT0: "0xDEd1660192d4d82e7c0B628ba556861EdBB5CAda",
    LP_REWARD: "0x6Cbb8a3Eb043Bf7A04412F01096997609cc6D5a3"
  },
  TOKEN_LOGOS: {
    CFX: "https://i.imgur.com/70cXbUI.jpeg",
    LOM: "https://i.imgur.com/HddyTrv.jpeg",
    USDC: "https://i.imgur.com/9UDXcUF.jpeg",
    AXCNH: "https://i.imgur.com/x8317um.jpeg",
    USDT0: "https://i.imgur.com/KgnTsn1.jpeg",
    CNHT0: "https://i.imgur.com/zObg9RY.jpeg"
  },
  CHAIN_ID: 1030,
  TOTAL_REWARD_POOL: 25555555
};

// ==================== Â∫îÁî®Áä∂ÊÄÅ ====================
let provider, signer, account;
let router, pair, lom, usdc, axcnh, usdt0, cnht0, lpRewardContract;
let slippage = 0.1;
let isChinese = true;
let currentRatio = 0;
let fromToken = "CFX";
let toToken = "LOM";
let refreshInterval;
let currentTokenSelector = null;
let currentReserves = { cfx: 0, lom: 0 };
let walletInviteMap = JSON.parse(localStorage.getItem('lomswap_wallet_invite_map') || '{}');

// ==================== Ê†∏ÂøÉ‰ª£Â∏ÅÂàóË°® ====================
const TOKEN_LIST = [
  {
    symbol: "CFX",
    name: "Conflux",
    address: APP_CONFIG.CONTRACTS.WCFX,
    logo: APP_CONFIG.TOKEN_LOGOS.CFX,
    decimals: 18,
    isNative: true
  },
  {
    symbol: "LOM",
    name: "Longmai",
    address: APP_CONFIG.CONTRACTS.LOM,
    logo: APP_CONFIG.TOKEN_LOGOS.LOM,
    decimals: 18
  },
  {
    symbol: "USDC",
    name: "USD Coin",
    address: APP_CONFIG.CONTRACTS.USDC,
    logo: APP_CONFIG.TOKEN_LOGOS.USDC,
    decimals: 18
  },
  {
    symbol: "AXCNH",
    name: "AxCNH",
    address: APP_CONFIG.CONTRACTS.AXCNH,
    logo: APP_CONFIG.TOKEN_LOGOS.AXCNH,
    decimals: 6
  },
  {
    symbol: "USDT0",
    name: "Tether USD (Test)",
    address: APP_CONFIG.CONTRACTS.USDT0,
    logo: APP_CONFIG.TOKEN_LOGOS.USDT0,
    decimals: 6
  },
  {
    symbol: "CNHT0",
    name: "CNH Token (Test)",
    address: APP_CONFIG.CONTRACTS.CNHT0,
    logo: APP_CONFIG.TOKEN_LOGOS.CNHT0,
    decimals: 6
  }
];

// ==================== ÂêàÁ∫¶ABIÂÆö‰πâ ====================
const ROUTER_ABI = [
  "function getAmountsOut(uint amountIn, address[] path) view returns (uint[] memory amounts)",
  "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) payable",
  "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function addLiquidityETH(address token, uint amountTokenDesired, uint amountTokenMin, uint amountETHMin, address to, uint deadline) payable returns (uint amountToken, uint amountETH, uint liquidity)",
  "function removeLiquidityETH(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountToken, uint amountETH)"
];

const ERC20_ABI = [
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function name() view returns (string)",
  "function symbol() view returns (string)"
];

const PAIR_ABI = [
  "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function token0() view returns (address)",
  "function token1() view returns (address)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)"
];

const LP_REWARD_ABI = [
  "function activate(address referrer)",
  "function claimAll()",
  "function claimReferral()",
  "function pendingReward(address user) view returns (uint256)",
  "function pendingReferral(address user) view returns (uint256)",
  "function users(address) view returns (uint256 shares, uint256 rewardDebt, uint256 pendingReferral, uint256 lastClaimTime, uint256 activeTime, uint256 lastReduceTime, uint256 referralUnlockTime, address referrer, bool cleanInFirst30Days)",
  "function minActivation() view returns (uint256)",
  "function totalShares() view returns (uint256)",
  "function rewardPerSecond() view returns (uint256)",
  "function paused() view returns (bool)"
];

// ==================== Â∑•ÂÖ∑Ê®°Âùó ====================
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  formatDisplay(value) {
    if (!value && value !== 0) return '0.000000';
    const num = parseFloat(value);
    if (isNaN(num)) return '0.000000';
    const truncated = Math.floor(num * 1000000) / 1000000;
    let result = truncated.toString();
    if (!result.includes('.')) result += '.000000';
    const parts = result.split('.');
    let decimalPart = parts[1] || '';
    if (decimalPart.length < 6) {
      decimalPart = decimalPart.padEnd(6, '0');
    } else if (decimalPart.length > 6) {
      decimalPart = decimalPart.substring(0, 6);
    }
    return parts[0] + '.' + decimalPart;
  },

  formatAddress(address) {
    if (!address) return '';
    return address.slice(0, 6) + '...' + address.slice(-4);
  },

  isValidAddress(address) {
    return /^0x[a-fA-F0-9]{40}$/.test(address);
  },

  showError(message) {
    const errorBox = document.getElementById('swapErrorBox');
    const errorText = document.getElementById('swapErrorText');
    if (errorBox && errorText) {
      errorText.textContent = message;
      errorBox.classList.add('show');
      setTimeout(() => {
        errorBox.classList.remove('show');
      }, 5000);
    }
  },

  showNotification(message, type = 'info') {
    const status = document.getElementById('txStatusOverlay');
    const icon = document.getElementById('txStatusIcon');
    const title = document.getElementById('txStatusTitle');
    const msg = document.getElementById('txStatusMessage');
    const doneBtn = document.getElementById('txStatusDoneBtn');
    
    if (!status || !icon || !title || !msg) return;
    
    const statusConfig = {
      info: { 
        icon: '<div class="loading-spinner white"></div>', 
        title: isChinese ? 'Â§ÑÁêÜ‰∏≠' : 'Processing' 
      },
      success: { 
        icon: '‚úÖ', 
        title: isChinese ? 'Êìç‰ΩúÊàêÂäü' : 'Success' 
      },
      error: { 
        icon: '‚ùå', 
        title: isChinese ? 'Êìç‰ΩúÂ§±Ë¥•' : 'Failed' 
      }
    };
    
    const config = statusConfig[type] || statusConfig.info;
    icon.innerHTML = config.icon;
    title.textContent = config.title;
    msg.textContent = message;
    
    if (type === 'success' || type === 'error') {
      if (doneBtn) doneBtn.style.display = 'block';
    } else {
      if (doneBtn) doneBtn.style.display = 'none';
    }
    
    status.style.display = 'flex';
  },

  hideNotification() {
    const status = document.getElementById('txStatusOverlay');
    if (status) status.style.display = 'none';
    document.querySelectorAll('button').forEach(btn => {
      btn.disabled = false;
    });
  },

  getErrorMessage(error) {
    const message = error.message || error.toString();
    const errorMap = {
      'user rejected': isChinese ? 'Áî®Êà∑ÂèñÊ∂à‰∫Ü‰∫§Êòì' : 'Transaction rejected by user',
      'INSUFFICIENT_OUTPUT_AMOUNT': isChinese ? 'ËæìÂá∫Êï∞Èáè‰∏çË∂≥ÔºåËØ∑ÊèêÈ´òÊªëÁÇπÂÆπÂ∑Æ' : 'Insufficient output amount, increase slippage',
      'INSUFFICIENT_INPUT_AMOUNT': isChinese ? 'ËæìÂÖ•Êï∞Èáè‰∏çË∂≥' : 'Insufficient input amount',
      'insufficient funds': isChinese ? '‰ΩôÈ¢ù‰∏çË∂≥' : 'Insufficient balance',
      'allowance': isChinese ? 'ËØ∑ÂÖàÊéàÊùÉ‰ª£Â∏Å' : 'Please approve token first',
      'Not enough liquidity': isChinese ? 'ÊµÅÂä®ÊÄß‰∏çË∂≥' : 'Insufficient liquidity',
      'execution reverted': isChinese ? '‰∫§ÊòìÊâßË°åÂ§±Ë¥•' : 'Transaction execution failed'
    };
    
    for (const [key, value] of Object.entries(errorMap)) {
      if (message.toLowerCase().includes(key.toLowerCase())) {
        return value;
      }
    }
    return isChinese ? '‰∫§ÊòìÂ§±Ë¥•ÔºåËØ∑ÈáçËØï' : 'Transaction failed, please try again';
  }
};

// ==================== ‰ª£Â∏ÅÂ∑•ÂÖ∑Ê®°Âùó ====================
const TokenUtils = {
  getToken(symbol) {
    return TOKEN_LIST.find(t => t.symbol === symbol);
  },

  getTokenDecimals(symbol) {
    const token = this.getToken(symbol);
    return token ? token.decimals : 18;
  },

  getTokenContract(symbol) {
    const tokenContracts = {
      "LOM": lom,
      "USDC": usdc,
      "AXCNH": axcnh,
      "USDT0": usdt0,
      "CNHT0": cnht0
    };
    return tokenContracts[symbol] || null;
  },

  formatTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      const formatted = ethers.utils.formatUnits(amount, decimals);
      return Utils.formatDisplay(formatted);
    } catch {
      return '0.000000';
    }
  },

  parseTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      return ethers.utils.parseUnits(amount.toString(), decimals);
    } catch {
      return ethers.BigNumber.from(0);
    }
  }
};

// ==================== Ê†∏ÂøÉÂ∫îÁî®Ê®°Âùó ====================
class AppCore {
  static async connectWallet() {
    try {
      if (!window.ethereum) {
        Utils.showError(isChinese ? "ËØ∑ÂÆâË£ÖTPÊàñweb3Èí±ÂåÖ" : "Please install TP or WEB3 wallet");
        return false;
      }
      
      const walletBtn = document.getElementById('walletBtn');
      walletBtn.textContent = isChinese ? 'ËøûÊé•‰∏≠...' : 'Connecting...';
      walletBtn.classList.add('connecting');
      
      const accounts = await window.ethereum.request({
        method: 'eth_requestAccounts'
      });
      
      if (!accounts || accounts.length === 0) {
        throw new Error(isChinese ? 'Áî®Êà∑ÊãíÁªùËøûÊé•' : 'User rejected connection');
      }
      
      account = accounts[0];
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      
      await this.checkNetwork();
      this.initContracts();
      this.restoreInviteAddress();
      this.updateUI();
      
      // ÂêØÂä®Êï∞ÊçÆÂà∑Êñ∞
      if (refreshInterval) clearInterval(refreshInterval);
      refreshInterval = setInterval(() => {
        DataManager.refreshAll();
      }, 10000);
      
      Utils.showNotification(
        isChinese ? 'Èí±ÂåÖËøûÊé•ÊàêÂäü' : 'Wallet connected successfully',
        'success'
      );
      
      // ÂàùÂßãÂåñÊï∞ÊçÆ
      await DataManager.refreshAll();
      
      return true;
    } catch (error) {
      console.error("Èí±ÂåÖËøûÊé•Â§±Ë¥•:", error);
      Utils.showError(
        isChinese ? `ËøûÊé•Â§±Ë¥•: ${error.message}` : `Connection failed: ${error.message}`
      );
      return false;
    } finally {
      this.updateUI();
    }
  }

  static async checkNetwork() {
    const network = await provider.getNetwork();
    if (network.chainId !== APP_CONFIG.CHAIN_ID) {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x' + APP_CONFIG.CHAIN_ID.toString(16) }]
        });
      } catch (error) {
        if (error.code === 4902) {
          Utils.showError(isChinese ? 'ËØ∑Ê∑ªÂä†Conflux eSpaceÁΩëÁªú' : 'Please add Conflux eSpace network');
        } else {
          Utils.showError(isChinese ? 'ËØ∑ÂàáÊç¢Âà∞Conflux eSpaceÁΩëÁªú' : 'Please switch to Conflux eSpace network');
        }
        throw error;
      }
    }
  }

  static initContracts() {
    router = new ethers.Contract(APP_CONFIG.CONTRACTS.ROUTER, ROUTER_ABI, signer);
    pair = new ethers.Contract(APP_CONFIG.CONTRACTS.PAIR, PAIR_ABI, signer);
    lom = new ethers.Contract(APP_CONFIG.CONTRACTS.LOM, ERC20_ABI, signer);
    usdc = new ethers.Contract(APP_CONFIG.CONTRACTS.USDC, ERC20_ABI, signer);
    axcnh = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH, ERC20_ABI, signer);
    usdt0 = new ethers.Contract(APP_CONFIG.CONTRACTS.USDT0, ERC20_ABI, signer);
    cnht0 = new ethers.Contract(APP_CONFIG.CONTRACTS.CNHT0, ERC20_ABI, signer);
    
    // ÂàùÂßãÂåñLPÂ•ñÂä±ÂêàÁ∫¶
    if (APP_CONFIG.CONTRACTS.LP_REWARD) {
      const contractProvider = signer || provider;
      lpRewardContract = new ethers.Contract(
        APP_CONFIG.CONTRACTS.LP_REWARD,
        LP_REWARD_ABI,
        contractProvider
      );
      console.log('‚úÖ LPÂ•ñÂä±ÂêàÁ∫¶ÂàùÂßãÂåñÊàêÂäü');
    }
  }

  static restoreInviteAddress() {
    if (account && walletInviteMap[account.toLowerCase()]) {
      const referrerInput = document.getElementById('referrerAddress');
      if (referrerInput) {
        referrerInput.value = walletInviteMap[account.toLowerCase()];
      }
    }
  }

  static updateUI() {
    const walletBtn = document.getElementById("walletBtn");
    const swapBtn = document.getElementById("swapBtn");
    
    if (walletBtn) walletBtn.classList.remove('connecting');
    
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      if (walletBtn) {
        walletBtn.textContent = displayAddress;
        walletBtn.classList.add('connected');
      }
      if (swapBtn) {
        swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
        swapBtn.disabled = false;
      }
    } else {
      if (walletBtn) {
        walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
        walletBtn.classList.remove('connected');
      }
      if (swapBtn) {
        swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
        swapBtn.disabled = false;
      }
    }
  }

  static disconnect() {
    account = null;
    provider = null;
    signer = null;
    router = null;
    pair = null;
    lom = null;
    usdc = null;
    axcnh = null;
    usdt0 = null;
    cnht0 = null;
    lpRewardContract = null;
    
    if (refreshInterval) {
      clearInterval(refreshInterval);
      refreshInterval = null;
    }
    
    DataManager.resetAllData();
    this.updateUI();
    
    Utils.showNotification(
      isChinese ? "Èí±ÂåÖÂ∑≤Êñ≠ÂºÄËøûÊé•" : "Wallet disconnected",
      'success'
    );
  }
}

// ==================== Êï∞ÊçÆÁÆ°ÁêÜÂô® ====================
const DataManager = {
  async refreshAll() {
    if (!account) return;
    try {
      await this.updateAllBalances();
      await this.updatePoolInfo();
      this.updateSwapButtonState();
    } catch (error) {
      console.error('Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•:', error);
    }
  },

  async updateAllBalances() {
    if (!account) return;
    
    try {
      const balancePromises = TOKEN_LIST.map(async (token) => {
        try {
          let balance = 0;
          
          if (token.symbol === 'CFX' && provider) {
            const cfxBal = await provider.getBalance(account);
            balance = parseFloat(ethers.utils.formatEther(cfxBal));
          } else {
            const contract = TokenUtils.getTokenContract(token.symbol);
            if (contract) {
              const tokenBal = await contract.balanceOf(account);
              balance = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
            }
          }
          
          return { symbol: token.symbol, balance };
        } catch (error) {
          console.error(`Ëé∑Âèñ ${token.symbol} ‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
          return { symbol: token.symbol, balance: 0 };
        }
      });
      
      const balances = await Promise.all(balancePromises);
      
      balances.forEach(({ symbol, balance }) => {
        this.updateBalanceUI(symbol, balance);
      });
      
      const cfxBal = balances.find(b => b.symbol === 'CFX')?.balance || 0;
      const lomBal = balances.find(b => b.symbol === 'LOM')?.balance || 0;
      
      document.getElementById("addCfxBal").textContent = Utils.formatDisplay(cfxBal);
      document.getElementById("addLomBal").textContent = Utils.formatDisplay(lomBal);
      
      if (pair) {
        try {
          const lpBal = await pair.balanceOf(account);
          const removeBtn = document.getElementById("removeBtn");
          if (removeBtn) removeBtn.disabled = lpBal.isZero();
        } catch (error) {
          console.error("Ëé∑ÂèñLP‰ΩôÈ¢ùÂ§±Ë¥•:", error);
        }
      }
      
    } catch (error) {
      console.error("Êõ¥Êñ∞‰ΩôÈ¢ùÂ§±Ë¥•:", error);
    }
  },

  updateBalanceUI(symbol, balance) {
    const formattedBalance = Utils.formatDisplay(balance);
    
    if (symbol === fromToken) {
      const fromBalEl = document.getElementById('fromBal');
      if (fromBalEl) fromBalEl.textContent = formattedBalance;
    }
    
    if (symbol === toToken) {
      const toBalEl = document.getElementById('toBal');
      if (toBalEl) toBalEl.textContent = formattedBalance;
    }
  },

  async updatePoolInfo() {
    try {
      if (!pair || !account) return;
      
      const [r0, r1] = await pair.getReserves();
      const t0 = await pair.token0();
      const totalSupply = await pair.totalSupply();
      
      const reserveCfx = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r0 : r1;
      const reserveLom = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r1 : r0;
      
      const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
      const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
      
      currentReserves.cfx = cfxReserve;
      currentReserves.lom = lomReserve;
      
      const price = lomReserve / cfxReserve;
      currentRatio = price;
      
      const priceFormatted = Utils.formatDisplay(price);
      const priceElement = document.getElementById("price");
      if (priceElement) priceElement.textContent = `1 CFX = ${priceFormatted} LOM`;
      
      const addRatioElement = document.getElementById("addRatio");
      if (addRatioElement) addRatioElement.textContent = `1 CFX = ${priceFormatted} LOM`;

      const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
      
      let lpAmt = 0;
      let share = 0;
      let userCfx = 0;
      let userLom = 0;
      
      const lpBal = await pair.balanceOf(account);
      lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
      
      if (totalSupplyNum > 0 && lpAmt > 0) {
        share = (lpAmt / totalSupplyNum) * 100;
        userCfx = cfxReserve * (share / 100);
        userLom = lomReserve * (share / 100);
      }
      
      const cfxReserveEl = document.getElementById("cfxReserve");
      const lomReserveEl = document.getElementById("lomReserve");
      
      if (cfxReserveEl) cfxReserveEl.textContent = cfxReserve.toFixed(2);
      if (lomReserveEl) lomReserveEl.textContent = lomReserve.toFixed(2);
      
      const userCfxEl = document.getElementById("userCfx");
      const userLomEl = document.getElementById("userLom");
      const userLpEl = document.getElementById("userLp");
      const userPoolShareEl = document.getElementById("userPoolShare");
      
      if (userCfxEl) userCfxEl.textContent = userCfx.toFixed(2);
      if (userLomEl) userLomEl.textContent = userLom.toFixed(2);
      if (userLpEl) userLpEl.textContent = lpAmt.toFixed(2);
      if (userPoolShareEl) userPoolShareEl.textContent = share.toFixed(4) + "%";
      
      const removeBtn = document.getElementById("removeBtn");
      if (removeBtn) {
        removeBtn.disabled = lpAmt <= 0;
      }
      
    } catch (error) {
      console.error("Êõ¥Êñ∞Ê±†Â≠ê‰ø°ÊÅØÂ§±Ë¥•:", error);
    }
  },

  updateSwapButtonState() {
    const swapBtn = document.getElementById("swapBtn");
    if (!swapBtn) return;
    
    const fromAmount = document.getElementById("fromAmount").value;
    
    if (!account) {
      swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      swapBtn.disabled = false;
      return;
    }
    
    if (!fromAmount || fromAmount === "0" || fromAmount === "") {
      swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
      swapBtn.disabled = true;
      return;
    }
    
    swapBtn.textContent = isChinese ? "Á´ãÂç≥ÂÖëÊç¢" : "Swap Now";
    swapBtn.disabled = false;
  },

  resetAllData() {
    const elements = {
      'fromBal': '0.000000',
      'toBal': '0.000000',
      'addCfxBal': '0.000000',
      'addLomBal': '0.000000',
      'price': '1 CFX = 0.000000 LOM',
      'minReceived': '0.000000 LOM'
    };
    
    Object.keys(elements).forEach(id => {
      const element = document.getElementById(id);
      if (element) element.textContent = elements[id];
    });
    
    const fromAmount = document.getElementById("fromAmount");
    const toAmount = document.getElementById("toAmount");
    if (fromAmount) fromAmount.value = "";
    if (toAmount) toAmount.value = "";
    
    const removeBtn = document.getElementById("removeBtn");
    if (removeBtn) removeBtn.disabled = true;
  }
};

// ==================== ‰∫§Êç¢Ê®°Âùó ====================
const SwapModule = {
  async executeSwap() {
    const fromAmount = document.getElementById('fromAmount').value;
    
    if (!fromAmount || fromAmount === '0') {
      Utils.showError(isChinese ? "ËØ∑ËæìÂÖ•ÂÖëÊç¢Êï∞Èáè" : "Please enter swap amount");
      return;
    }
    
    try {
      Utils.showNotification(isChinese ? 'Â§ÑÁêÜÂÖëÊç¢‰∏≠...' : 'Processing swap...', 'info');
      
      const amountIn = TokenUtils.parseTokenAmount(fromAmount, fromToken);
      const path = this.getSwapPath();
      
      const amounts = await router.getAmountsOut(amountIn, path);
      const minOut = amounts[amounts.length - 1].mul(1000 - slippage * 10).div(1000);
      
      const deadline = Math.floor(Date.now() / 1000) + 1200;
      
      let tx;
      
      if (fromToken === "CFX") {
        tx = await router.swapExactETHForTokensSupportingFeeOnTransferTokens(
          minOut, path, account, deadline, 
          { value: amountIn }
        );
      } else if (toToken === "CFX") {
        const tokenContract = TokenUtils.getTokenContract(fromToken);
        if (!tokenContract) throw new Error('‰ª£Â∏ÅÂêàÁ∫¶Êú™ÊâæÂà∞');
        
        const allowance = await tokenContract.allowance(account, APP_CONFIG.CONTRACTS.ROUTER);
        if (allowance.lt(amountIn)) {
          Utils.showNotification(isChinese ? 'ÊéàÊùÉ‰ª£Â∏Å‰∏≠...' : 'Approving token...', 'info');
          const approveTx = await tokenContract.approve(APP_CONFIG.CONTRACTS.ROUTER, ethers.constants.MaxUint256);
          await approveTx.wait();
        }
        
        tx = await router.swapExactTokensForETHSupportingFeeOnTransferTokens(
          amountIn, minOut, path, account, deadline
        );
      } else {
        const tokenContract = TokenUtils.getTokenContract(fromToken);
        if (!tokenContract) throw new Error('‰ª£Â∏ÅÂêàÁ∫¶Êú™ÊâæÂà∞');
        
        const allowance = await tokenContract.allowance(account, APP_CONFIG.CONTRACTS.ROUTER);
        if (allowance.lt(amountIn)) {
          Utils.showNotification(isChinese ? 'ÊéàÊùÉ‰ª£Â∏Å‰∏≠...' : 'Approving token...', 'info');
          const approveTx = await tokenContract.approve(APP_CONFIG.CONTRACTS.ROUTER, ethers.constants.MaxUint256);
          await approveTx.wait();
        }
        
        tx = await router.swapExactTokensForTokensSupportingFeeOnTransferTokens(
          amountIn, minOut, path, account, deadline
        );
      }
      
      await tx.wait();
      
      document.getElementById('fromAmount').value = '';
      document.getElementById('toAmount').value = '';
      
      Utils.showNotification(
        isChinese ? 'ÂÖëÊç¢ÊàêÂäüÔºÅ' : 'Swap successful!',
        'success'
      );
      
      await DataManager.refreshAll();
      
    } catch (error) {
      console.error('ÂÖëÊç¢Â§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  getSwapPath() {
    let path = [];
    
    if (fromToken === 'CFX') {
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    } else if (toToken === 'CFX') {
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      path.push(APP_CONFIG.CONTRACTS.WCFX);
    } else {
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    }
    
    return path;
  },

  async updateOutputFromInput() {
    const amount = document.getElementById('fromAmount').value;
    
    if (!amount || amount === '0' || amount === '' || !router) {
      document.getElementById('toAmount').value = "";
      document.getElementById('minReceived').textContent = `0 ${toToken}`;
      DataManager.updateSwapButtonState();
      return;
    }
    
    try {
      const amountIn = TokenUtils.parseTokenAmount(amount, fromToken);
      const path = this.getSwapPath();
      
      const amounts = await router.getAmountsOut(amountIn, path);
      const out = TokenUtils.formatTokenAmount(amounts[amounts.length - 1], toToken);
      
      document.getElementById('toAmount').value = out;
      
      const minOut = amounts[amounts.length - 1].mul(1000 - slippage * 10).div(1000);
      const minOutFormatted = TokenUtils.formatTokenAmount(minOut, toToken);
      document.getElementById('minReceived').textContent = 
        `${minOutFormatted} ${toToken}`;
      
      const price = parseFloat(out) / parseFloat(amount);
      const priceFormatted = Utils.formatDisplay(price);
      document.getElementById('price').textContent = 
        `1 ${fromToken} = ${priceFormatted} ${toToken}`;
      
      DataManager.updateSwapButtonState();
      
    } catch (error) {
      console.error('ËÆ°ÁÆóËæìÂá∫Â§±Ë¥•:', error);
      document.getElementById('toAmount').value = "";
      const swapBtn = document.getElementById('swapBtn');
      if (swapBtn) {
        swapBtn.textContent = isChinese ? 'ËÆ°ÁÆóÂ§±Ë¥•' : 'Calculation Failed';
        swapBtn.disabled = true;
      }
    }
  },

  async updateSlippage(newSlippage) {
    try {
      slippage = newSlippage;
      
      const fromAmount = document.getElementById('fromAmount');
      if (fromAmount && fromAmount.value && fromAmount.value !== '0') {
        await this.updateOutputFromInput();
      }
      
    } catch (error) {
      console.error('Êõ¥Êñ∞ÊªëÁÇπÂ§±Ë¥•:', error);
    }
  }
};

// ==================== ÊµÅÂä®ÊÄßÊ®°Âùó ====================
const LiquidityModule = {
  async addLiquidity() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    
    if (!cfxAmount || !lomAmount || parseFloat(cfxAmount) <= 0 || parseFloat(lomAmount) <= 0) {
      Utils.showError(isChinese ? "ËØ∑ËæìÂÖ•ÊúâÊïàÊï∞Èáè" : "Please enter valid amounts");
      return;
    }
    
    try {
      Utils.showNotification(isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄß‰∏≠...' : 'Adding liquidity...', 'info');
      
      const amountCfx = TokenUtils.parseTokenAmount(cfxAmount, 'CFX');
      const amountLom = TokenUtils.parseTokenAmount(lomAmount, 'LOM');
      
      const allowance = await lom.allowance(account, APP_CONFIG.CONTRACTS.ROUTER);
      if (allowance.lt(amountLom)) {
        Utils.showNotification(isChinese ? 'ÊéàÊùÉLOM‰∏≠...' : 'Approving LOM...', 'info');
        const approveTx = await lom.approve(APP_CONFIG.CONTRACTS.ROUTER, ethers.constants.MaxUint256);
        await approveTx.wait();
      }
      
      const minCfx = amountCfx.mul(1000 - slippage * 10).div(1000);
      const minLom = amountLom.mul(1000 - slippage * 10).div(1000);
      const deadline = Math.floor(Date.now() / 1000) + 1800;
      
      const tx = await router.addLiquidityETH(
        APP_CONFIG.CONTRACTS.LOM,
        amountLom,
        minLom,
        minCfx,
        account,
        deadline,
        { value: amountCfx }
      );
      
      await tx.wait();
      
      document.getElementById("addModal").style.display = "none";
      document.getElementById("addCfx").value = "";
      document.getElementById("addLom").value = "";
      
      Utils.showNotification(isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄßÊàêÂäüÔºÅ' : 'Liquidity added successfully!', 'success');
      
      await DataManager.refreshAll();
      
    } catch (error) {
      console.error('Ê∑ªÂä†ÊµÅÂä®ÊÄßÂ§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async removeLiquidity() {
    const percent = document.getElementById("removeSlider").value;
    
    try {
      Utils.showNotification(isChinese ? 'ÁßªÈô§ÊµÅÂä®ÊÄß‰∏≠...' : 'Removing liquidity...', 'info');
      
      const lpBal = await pair.balanceOf(account);
      const liquidity = lpBal.mul(percent).div(100);
      
      if (liquidity.isZero()) {
        throw new Error(isChinese ? 'Ê≤°ÊúâÊµÅÂä®ÊÄßÂèØÁßªÈô§' : 'No liquidity to remove');
      }
      
      const allowance = await pair.allowance(account, APP_CONFIG.CONTRACTS.ROUTER);
      if (allowance.lt(liquidity)) {
        Utils.showNotification(isChinese ? 'ÊéàÊùÉLP‰ª£Â∏Å‰∏≠...' : 'Approving LP token...', 'info');
        const approveTx = await pair.approve(APP_CONFIG.CONTRACTS.ROUTER, ethers.constants.MaxUint256);
        await approveTx.wait();
      }
      
      const deadline = Math.floor(Date.now() / 1000) + 1800;
      
      const tx = await router.removeLiquidityETH(
        APP_CONFIG.CONTRACTS.LOM, 
        liquidity, 
        0,
        0,
        account, 
        deadline
      );
      
      await tx.wait();
      
      document.getElementById("removeModal").style.display = "none";
      
      const cfxEst = document.getElementById("removeEstCfx").textContent;
      const lomEst = document.getElementById("removeEstLom").textContent;
      
      Utils.showNotification(
        isChinese ? `ÁßªÈô§ÊµÅÂä®ÊÄßÊàêÂäüÔºÅËé∑Âæó ${cfxEst} CFX Âíå ${lomEst} LOM` : 
                   `Success! Received ${cfxEst} CFX and ${lomEst} LOM`,
        'success'
      );
      
      await DataManager.refreshAll();
      
    } catch (error) {
      console.error('ÁßªÈô§ÊµÅÂä®ÊÄßÂ§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async updateRemoveEstimate(percent) {
    try {
      if (!account || !pair) return;
      
      document.getElementById("removePercent").textContent = percent + "%";
      
      const lpBal = await pair.balanceOf(account);
      const liquidity = lpBal.mul(percent).div(100);
      
      if (liquidity.isZero()) {
        document.getElementById("removeEstCfx").textContent = "0.000000";
        document.getElementById("removeEstLom").textContent = "0.000000";
        return;
      }
      
      const total = await pair.totalSupply();
      const { cfx: rCfx, lom: rLom } = currentReserves;
      
      const cfxReserve = TokenUtils.parseTokenAmount(rCfx.toString(), 'CFX');
      const lomReserve = TokenUtils.parseTokenAmount(rLom.toString(), 'LOM');
      
      const cfxOut = cfxReserve.mul(liquidity).div(total);
      const lomOut = lomReserve.mul(liquidity).div(total);
      
      const cfxOutFormatted = TokenUtils.formatTokenAmount(cfxOut, 'CFX');
      const lomOutFormatted = TokenUtils.formatTokenAmount(lomOut, 'LOM');
      
      document.getElementById("removeEstCfx").textContent = cfxOutFormatted;
      document.getElementById("removeEstLom").textContent = lomOutFormatted;
      
    } catch (error) {
      console.error("Êõ¥Êñ∞ÁßªÈô§‰º∞ÁÆóÂ§±Ë¥•:", error);
      document.getElementById("removeEstCfx").textContent = "0.000000";
      document.getElementById("removeEstLom").textContent = "0.000000";
    }
  },

  updateAddButtonState() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    const cfxBalance = parseFloat(document.getElementById("addCfxBal").textContent);
    const lomBalance = parseFloat(document.getElementById("addLomBal").textContent);
    const confirmButton = document.getElementById("confirmAddBtn");
    
    if (!confirmButton) return;
    
    if (!cfxAmount || !lomAmount || cfxAmount === "" || lomAmount === "") {
      confirmButton.disabled = true;
      return;
    }
    
    const cfxNum = parseFloat(cfxAmount);
    const lomNum = parseFloat(lomAmount);
    
    if (isNaN(cfxNum) || isNaN(lomNum) || cfxNum <= 0 || lomNum <= 0) {
      confirmButton.disabled = true;
      return;
    }
    
    if (cfxNum > cfxBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    if (lomNum > lomBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    const remainingCfx = cfxBalance - cfxNum;
    if (remainingCfx < 0.01) {
      confirmButton.disabled = true;
      return;
    }
    
    confirmButton.disabled = false;
  },

  async setMaxCfx() {
    const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
    if (cfxBal <= 0) {
      Utils.showError(isChinese ? "CFX‰ΩôÈ¢ù‰∏çË∂≥" : "Insufficient CFX balance");
      return;
    }
    
    const maxCfx = Math.max(0, cfxBal - 0.1);
    document.getElementById("addCfx").value = Utils.formatDisplay(maxCfx);
    
    if (currentRatio > 0) {
      const requiredLom = maxCfx * currentRatio;
      const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
      
      if (requiredLom <= lomBal) {
        document.getElementById("addLom").value = Utils.formatDisplay(requiredLom);
      } else {
        const adjustedCfx = lomBal / currentRatio;
        document.getElementById("addCfx").value = Utils.formatDisplay(Math.min(adjustedCfx, maxCfx));
        document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
      }
    }
    
    this.updateAddButtonState();
  },

  async setMaxLom() {
    const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
    if (lomBal <= 0) {
      Utils.showError(isChinese ? "LOM‰ΩôÈ¢ù‰∏çË∂≥" : "Insufficient LOM balance");
      return;
    }
    
    document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
    
    if (currentRatio > 0) {
      const requiredCfx = lomBal / currentRatio;
      const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
      const availableCfx = Math.max(0, cfxBal - 0.1);
      
      if (requiredCfx <= availableCfx) {
        document.getElementById("addCfx").value = Utils.formatDisplay(requiredCfx);
      } else {
        const adjustedLom = availableCfx * currentRatio;
        document.getElementById("addLom").value = Utils.formatDisplay(Math.min(adjustedLom, lomBal));
        document.getElementById("addCfx").value = Utils.formatDisplay(availableCfx);
      }
    }
    
    this.updateAddButtonState();
  }
};

// ==================== LPÂ•ñÂä±Ê®°Âùó ====================
const LPRewardModule = {
  async refreshLPRewardData() {
    if (!account || !lpRewardContract) return;
    
    try {
      // Ëé∑ÂèñLP‰ΩôÈ¢ù
      const lpBal = await pair.balanceOf(account);
      const lpBalance = parseFloat(ethers.utils.formatUnits(lpBal, 18));
      document.getElementById("lpBalance").textContent = Utils.formatDisplay(lpBalance) + " LPT";
      
      // Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
      const userData = await lpRewardContract.users(account).catch(() => ({
        shares: ethers.BigNumber.from(0),
        rewardDebt: ethers.BigNumber.from(0),
        pendingReferral: ethers.BigNumber.from(0),
        lastClaimTime: ethers.BigNumber.from(0),
        activeTime: ethers.BigNumber.from(0),
        referrer: '0x0000000000000000000000000000000000000000'
      }));
      
      const isActivated = userData.activeTime.toNumber() > 0;
      document.getElementById("activationStatus").textContent = isActivated ? "Â∑≤ÊøÄÊ¥ª" : "Êú™ÊøÄÊ¥ª";
      document.getElementById("activationStatus").className = isActivated ? "lp-reward-card-value success" : "lp-reward-card-value";
      
      // ËÆ°ÁÆóÊåÅÊúâÊó∂Èïø
      if (isActivated) {
        const daysHeld = Math.floor((Date.now() / 1000 - userData.activeTime.toNumber()) / 86400);
        document.getElementById("daysHeld").textContent = daysHeld + " Â§©";
        
        // ËÆ°ÁÆóÂ•ñÂä±ÂÄçÁéá
        let multiplier = 1.0;
        if (daysHeld >= 360) multiplier = 3.0;
        else if (daysHeld >= 180) multiplier = 2.0;
        else if (daysHeld >= 90) multiplier = 1.5;
        document.getElementById("rewardMultiplier").textContent = multiplier.toFixed(1) + "x";
      }
      
      // Ëé∑ÂèñÂæÖÈ¢ÜÂèñÂ•ñÂä±
      const pendingReward = await lpRewardContract.pendingReward(account).catch(() => ethers.BigNumber.from(0));
      const rewardAmount = parseFloat(ethers.utils.formatUnits(pendingReward, 18));
      document.getElementById("pendingReward").textContent = Utils.formatDisplay(rewardAmount) + " LOM";
      
      // Ëé∑ÂèñÊé®ËçêÂ•ñÂä±
      const pendingReferral = await lpRewardContract.pendingReferral(account).catch(() => ethers.BigNumber.from(0));
      const referralAmount = parseFloat(ethers.utils.formatUnits(pendingReferral, 18));
      document.getElementById("pendingReferral").textContent = Utils.formatDisplay(referralAmount) + " LOM";
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      this.updateButtonStates(isActivated, lpBalance, rewardAmount > 0, referralAmount > 0);
      
    } catch (error) {
      console.error("Âà∑Êñ∞LPÂ•ñÂä±Êï∞ÊçÆÂ§±Ë¥•:", error);
    }
  },

  updateButtonStates(isActivated, lpBalance, hasReward, hasReferral) {
    const activateBtn = document.getElementById("activateBtn");
    const claimBtn = document.getElementById("claimBtn");
    const claimReferralBtn = document.getElementById("claimReferralBtn");
    
    if (!activateBtn || !claimBtn || !claimReferralBtn) return;
    
    // Ëé∑ÂèñÊúÄÂ∞èÊøÄÊ¥ªË¶ÅÊ±Ç
    const minActivation = 100; // ÈªòËÆ§ÂÄº
    
    if (!account) {
      activateBtn.disabled = false;
      activateBtn.innerHTML = '<span>üöÄ</span><span>ËøûÊé•Èí±ÂåÖ</span>';
      claimBtn.disabled = true;
      claimReferralBtn.disabled = true;
      return;
    }
    
    if (!isActivated) {
      const canActivate = lpBalance >= minActivation;
      activateBtn.disabled = !canActivate;
      activateBtn.innerHTML = canActivate ? 
        '<span>üöÄ</span><span>ÊøÄÊ¥ªÂ•ñÂä±</span>' : 
        '<span>‚è≥</span><span>LP‰∏çË∂≥</span>';
      claimBtn.disabled = true;
      claimReferralBtn.disabled = true;
    } else {
      activateBtn.disabled = true;
      activateBtn.innerHTML = '<span>‚úÖ</span><span>Â∑≤ÊøÄÊ¥ª</span>';
      claimBtn.disabled = !hasReward;
      claimBtn.innerHTML = hasReward ? 
        '<span>üí∞</span><span>È¢ÜÂèñÂ•ñÂä±</span>' : 
        '<span>‚è≥</span><span>Á≠âÂæÖ‰∏≠</span>';
      claimReferralBtn.disabled = !hasReferral;
      claimReferralBtn.innerHTML = hasReferral ? 
        '<span>üéÅ</span><span>È¢ÜÂèñÊé®Ëçê</span>' : 
        '<span>üîí</span><span>ÈîÅÂÆö‰∏≠</span>';
    }
  },

  async activateReward() {
    if (!account || !lpRewardContract) {
      Utils.showError('ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ');
      return;
    }
    
    try {
      Utils.showNotification('ÊøÄÊ¥ªLPÂ•ñÂä±‰∏≠...', 'info');
      
      // Ëé∑ÂèñÊé®ËçêÂú∞ÂùÄ
      const referrerInput = document.getElementById('referrerAddress');
      let referrerAddress = referrerInput ? referrerInput.value.trim() : '';
      
      // È™åËØÅÊé®ËçêÂú∞ÂùÄ
      if (referrerAddress && !Utils.isValidAddress(referrerAddress)) {
        Utils.showError('Êé®ËçêÂú∞ÂùÄÊ†ºÂºèÈîôËØØ');
        return;
      }
      
      // Â¶ÇÊûúÊé®ËçêÂú∞ÂùÄ‰∏∫Á©∫ÊàñÊó†ÊïàÔºåËÆæÁΩÆ‰∏∫Èõ∂Âú∞ÂùÄ
      if (!referrerAddress || referrerAddress === account) {
        referrerAddress = '0x0000000000000000000000000000000000000000';
      }
      
      // ÊâßË°åÊøÄÊ¥ª
      const tx = await lpRewardContract.activate(referrerAddress);
      await tx.wait();
      
      Utils.showNotification('ÊøÄÊ¥ªÊàêÂäüÔºÅ', 'success');
      
      // ‰øùÂ≠òÊé®ËçêÂú∞ÂùÄÂà∞Êú¨Âú∞Â≠òÂÇ®
      if (referrerAddress !== '0x0000000000000000000000000000000000000000') {
        walletInviteMap[account.toLowerCase()] = referrerAddress;
        localStorage.setItem('lomswap_wallet_invite_map', JSON.stringify(walletInviteMap));
      }
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      await this.refreshLPRewardData();
      
    } catch (error) {
      console.error('ÊøÄÊ¥ªÂ§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async claimReward() {
    if (!account || !lpRewardContract) {
      Utils.showError('ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ');
      return;
    }
    
    try {
      Utils.showNotification('È¢ÜÂèñÂ•ñÂä±‰∏≠...', 'info');
      
      const tx = await lpRewardContract.claimAll();
      await tx.wait();
      
      Utils.showNotification('Â•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ', 'success');
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      await this.refreshLPRewardData();
      
    } catch (error) {
      console.error('È¢ÜÂèñÂ•ñÂä±Â§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async claimReferralReward() {
    if (!account || !lpRewardContract) {
      Utils.showError('ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ');
      return;
    }
    
    try {
      Utils.showNotification('È¢ÜÂèñÊé®ËçêÂ•ñÂä±‰∏≠...', 'info');
      
      const tx = await lpRewardContract.claimReferral();
      await tx.wait();
      
      Utils.showNotification('Êé®ËçêÂ•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ', 'success');
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      await this.refreshLPRewardData();
      
    } catch (error) {
      console.error('È¢ÜÂèñÊé®ËçêÂ•ñÂä±Â§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  }
};

// ==================== UI‰∫ã‰ª∂Â§ÑÁêÜÂô® ====================
const EventHandlers = {
  init() {
    this.setupWalletEvents();
    this.setupSwapEvents();
    this.setupLiquidityEvents();
    this.setupLPRewardEvents();
    this.setupModalEvents();
    this.setupTabEvents();
    this.setupLanguageToggle();
    this.setupProjectIntro();
  },

  setupLPRewardEvents() {
    const activateBtn = document.getElementById("activateBtn");
    if (activateBtn) {
      activateBtn.addEventListener("click", async () => {
        if (!account) {
          await AppCore.connectWallet();
          return;
        }
        await LPRewardModule.activateReward();
      });
    }
    
    const claimBtn = document.getElementById("claimBtn");
    if (claimBtn) {
      claimBtn.addEventListener("click", () => {
        LPRewardModule.claimReward();
      });
    }
    
    const claimReferralBtn = document.getElementById("claimReferralBtn");
    if (claimReferralBtn) {
      claimReferralBtn.addEventListener("click", () => {
        LPRewardModule.claimReferralReward();
      });
    }
    
    const referrerInput = document.getElementById("referrerAddress");
    if (referrerInput) {
      referrerInput.addEventListener("input", Utils.debounce(() => {
        const address = referrerInput.value.trim();
        if (address && !Utils.isValidAddress(address)) {
          referrerInput.style.borderColor = "var(--accent-red)";
          referrerInput.style.background = "rgba(255, 71, 87, 0.05)";
        } else {
          referrerInput.style.borderColor = "";
          referrerInput.style.background = "";
        }
      }, 500));
    }
  },

  setupWalletEvents() {
    const walletBtn = document.getElementById("walletBtn");
    if (!walletBtn) return;
    
    walletBtn.addEventListener("click", async () => {
      if (account) {
        if (confirm(isChinese ? "Á°ÆÂÆöË¶ÅÊñ≠ÂºÄÈí±ÂåÖËøûÊé•ÂêóÔºü" : "Are you sure you want to disconnect wallet?")) {
          AppCore.disconnect();
        }
        return;
      }
      
      walletBtn.disabled = true;
      try {
        const success = await AppCore.connectWallet();
        if (success) {
          DataManager.refreshAll();
          LPRewardModule.refreshLPRewardData();
        }
      } finally {
        walletBtn.disabled = false;
      }
    });
  },

  setupSwapEvents() {
    const fromAmount = document.getElementById("fromAmount");
    if (!fromAmount) return;
    
    const debouncedFromInput = Utils.debounce(() => {
      const amount = fromAmount.value;
      if (amount && amount !== "0") {
        SwapModule.updateOutputFromInput();
      } else {
        const toAmount = document.getElementById("toAmount");
        if (toAmount) toAmount.value = "";
        DataManager.updateSwapButtonState();
        const minReceived = document.getElementById("minReceived");
        if (minReceived) minReceived.textContent = `0.000000 ${toToken}`;
      }
    }, 300);
    
    fromAmount.addEventListener("input", debouncedFromInput);
    
    const reverseBtn = document.getElementById("reverse");
    if (reverseBtn) {
      reverseBtn.addEventListener("click", () => {
        const tempToken = fromToken;
        fromToken = toToken;
        toToken = tempToken;
        
        const fromTokenSymbol = document.getElementById("fromTokenSymbol");
        const toTokenSymbol = document.getElementById("toTokenSymbol");
        if (fromTokenSymbol) fromTokenSymbol.textContent = fromToken;
        if (toTokenSymbol) toTokenSymbol.textContent = toToken;
        
        const fromTokenData = TokenUtils.getToken(fromToken);
        const toTokenData = TokenUtils.getToken(toToken);
        
        const fromTokenLogo = document.getElementById("fromTokenLogo");
        const toTokenLogo = document.getElementById("toTokenLogo");
        
        if (fromTokenData && fromTokenLogo) {
          fromTokenLogo.style.backgroundImage = `url('${fromTokenData.logo}')`;
        }
        
        if (toTokenData && toTokenLogo) {
          toTokenLogo.style.backgroundImage = `url('${toTokenData.logo}')`;
        }
        
        if (fromAmount) fromAmount.value = "";
        const toAmount = document.getElementById("toAmount");
        if (toAmount) toAmount.value = "";
        
        DataManager.updateAllBalances();
        DataManager.updateSwapButtonState();
        const price = document.getElementById("price");
        if (price) price.textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
        const minReceived = document.getElementById("minReceived");
        if (minReceived) minReceived.textContent = `0.000000 ${toToken}`;
      });
    }
    
    const swapBtn = document.getElementById("swapBtn");
    if (swapBtn) {
      swapBtn.addEventListener("click", async () => {
        if (!account) {
          await AppCore.connectWallet();
        } else {
          await SwapModule.executeSwap();
        }
      });
    }
    
    document.querySelectorAll('.percent-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const percent = parseFloat(e.target.dataset.percent);
        document.querySelectorAll('.percent-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        
        if (!account) {
          Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
          return;
        }
        
        const fromBal = document.getElementById("fromBal");
        if (!fromBal) return;
        
        let balance = parseFloat(fromBal.textContent);
        if (balance > 0) {
          let amount;
          if (percent === 1) {
            amount = fromToken === 'CFX' ? Math.max(0, balance - 0.1) : balance * 0.9;
          } else {
            amount = balance * percent;
          }
          
          if (amount > 0) {
            if (fromAmount) fromAmount.value = Utils.formatDisplay(amount);
            SwapModule.updateOutputFromInput();
          }
        }
      });
    });
    
    // ÊªëÁÇπÂàáÊç¢
    document.querySelectorAll('.slippage-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const newSlippage = parseFloat(e.target.dataset.slip);
        
        document.querySelectorAll('.slippage-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        
        SwapModule.updateSlippage(newSlippage);
      });
    });
    
    const fromTokenSelector = document.getElementById("fromTokenSelector");
    const toTokenSelector = document.getElementById("toTokenSelector");
    
    if (fromTokenSelector) {
      fromTokenSelector.addEventListener("click", () => this.openTokenSelector('from'));
    }
    
    if (toTokenSelector) {
      toTokenSelector.addEventListener("click", () => this.openTokenSelector('to'));
    }
  },

  setupLiquidityEvents() {
    const addBtn = document.getElementById("addBtn");
    if (addBtn) {
      addBtn.addEventListener("click", () => {
        if (!account) {
          Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
          return;
        }
        
        const addModal = document.getElementById("addModal");
        if (addModal) addModal.style.display = "flex";
        
        const addCfx = document.getElementById("addCfx");
        const addLom = document.getElementById("addLom");
        if (addCfx) addCfx.value = "";
        if (addLom) addLom.value = "";
        
        const confirmAddBtn = document.getElementById("confirmAddBtn");
        if (confirmAddBtn) confirmAddBtn.disabled = true;
        
        if (currentRatio > 0) {
          const ratioFormatted = Utils.formatDisplay(currentRatio);
          const addRatio = document.getElementById("addRatio");
          if (addRatio) addRatio.textContent = `1 CFX = ${ratioFormatted} LOM`;
        }
      });
    }
    
    const removeBtn = document.getElementById("removeBtn");
    if (removeBtn) {
      removeBtn.addEventListener("click", () => {
        if (!account) {
          Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
          return;
        }
        
        const removeModal = document.getElementById("removeModal");
        if (removeModal) removeModal.style.display = "flex";
        LiquidityModule.updateRemoveEstimate(100);
      });
    }
    
    const addCfx = document.getElementById("addCfx");
    const addLom = document.getElementById("addLom");
    
    if (addCfx) {
      const debouncedCfxInput = Utils.debounce(() => {
        const cfxAmount = addCfx.value;
        if (!cfxAmount || cfxAmount === "" || parseFloat(cfxAmount) <= 0) {
          if (addLom) addLom.value = "";
          const confirmAddBtn = document.getElementById("confirmAddBtn");
          if (confirmAddBtn) confirmAddBtn.disabled = true;
          return;
        }
        
        if (currentRatio > 0) {
          const cfxNum = parseFloat(cfxAmount);
          const lomAmount = cfxNum * currentRatio;
          if (addLom) addLom.value = Utils.formatDisplay(lomAmount);
        }
        
        LiquidityModule.updateAddButtonState();
      }, 300);
      
      addCfx.addEventListener("input", debouncedCfxInput);
    }
    
    if (addLom) {
      const debouncedLomInput = Utils.debounce(() => {
        const lomAmount = addLom.value;
        if (!lomAmount || lomAmount === "" || parseFloat(lomAmount) <= 0) {
          if (addCfx) addCfx.value = "";
          const confirmAddBtn = document.getElementById("confirmAddBtn");
          if (confirmAddBtn) confirmAddBtn.disabled = true;
          return;
        }
        
        if (currentRatio > 0) {
          const lomNum = parseFloat(lomAmount);
          const cfxAmount = lomNum / currentRatio;
          if (addCfx) addCfx.value = Utils.formatDisplay(cfxAmount);
        }
        
        LiquidityModule.updateAddButtonState();
      }, 300);
      
      addLom.addEventListener("input", debouncedLomInput);
    }
    
    const cfxMaxBtn = document.getElementById("cfxMaxBtn");
    if (cfxMaxBtn) {
      cfxMaxBtn.addEventListener("click", () => LiquidityModule.setMaxCfx());
    }
    
    const lomMaxBtn = document.getElementById("lomMaxBtn");
    if (lomMaxBtn) {
      lomMaxBtn.addEventListener("click", () => LiquidityModule.setMaxLom());
    }
    
    const cancelAddBtn = document.getElementById("cancelAddBtn");
    if (cancelAddBtn) {
      cancelAddBtn.addEventListener("click", () => {
        const addModal = document.getElementById("addModal");
        if (addModal) addModal.style.display = "none";
      });
    }
    
    const confirmAddBtn = document.getElementById("confirmAddBtn");
    if (confirmAddBtn) {
      confirmAddBtn.addEventListener("click", async () => {
        await LiquidityModule.addLiquidity();
      });
    }
    
    const removeSlider = document.getElementById("removeSlider");
    if (removeSlider) {
      removeSlider.addEventListener("input", (e) => {
        LiquidityModule.updateRemoveEstimate(e.target.value);
      });
    }
    
    document.querySelectorAll('.percentage-option').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const percent = e.target.dataset.percent;
        document.querySelectorAll('.percentage-option').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        if (removeSlider) removeSlider.value = percent;
        const removePercent = document.getElementById("removePercent");
        if (removePercent) removePercent.textContent = percent + "%";
        LiquidityModule.updateRemoveEstimate(percent);
      });
    });
    
    const cancelRemoveBtn = document.getElementById("cancelRemoveBtn");
    if (cancelRemoveBtn) {
      cancelRemoveBtn.addEventListener("click", () => {
        const removeModal = document.getElementById("removeModal");
        if (removeModal) removeModal.style.display = "none";
      });
    }
    
    const confirmRemoveBtn = document.getElementById("confirmRemoveBtn");
    if (confirmRemoveBtn) {
      confirmRemoveBtn.addEventListener("click", async () => {
        await LiquidityModule.removeLiquidity();
      });
    }
  },

  setupModalEvents() {
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("modal-overlay") || 
          e.target.classList.contains("token-selector-modal")) {
        e.target.style.display = "none";
      }
    });
    
    const txStatusDoneBtn = document.getElementById('txStatusDoneBtn');
    if (txStatusDoneBtn) {
      txStatusDoneBtn.addEventListener('click', () => {
        Utils.hideNotification();
      });
    }
  },

  setupTabEvents() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;
        
        tabBtns.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        const tabContent = document.getElementById(tabId + 'Tab');
        if (tabContent) tabContent.classList.add('active');
        
        if (account) {
          DataManager.refreshAll();
          if (tabId === 'lpReward') {
            LPRewardModule.refreshLPRewardData();
          }
        }
      });
    });
  },

  setupLanguageToggle() {
    const langBtn = document.getElementById("langBtn");
    if (langBtn) {
      langBtn.addEventListener("click", () => {
        isChinese = !isChinese;
        langBtn.innerText = isChinese ? "EN" : "ZH";
        this.updateAllTexts();
      });
    }
  },

  setupProjectIntro() {
    const logoContainer = document.getElementById("logoContainer");
    if (logoContainer) {
      logoContainer.addEventListener("click", () => {
        const projectIntroOverlay = document.getElementById("projectIntroOverlay");
        if (projectIntroOverlay) projectIntroOverlay.style.display = "flex";
      });
    }
    
    const closeBtn = document.getElementById("projectIntroCloseBtn");
    if (closeBtn) {
      closeBtn.addEventListener("click", () => {
        const projectIntroOverlay = document.getElementById("projectIntroOverlay");
        if (projectIntroOverlay) projectIntroOverlay.style.display = "none";
      });
    }
  },

  updateAllTexts() {
    const walletBtn = document.getElementById("walletBtn");
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      if (walletBtn) {
        walletBtn.textContent = displayAddress;
        walletBtn.classList.add('connected');
      }
    } else {
      if (walletBtn) {
        walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
        walletBtn.classList.remove('connected');
      }
    }
    
    const swapTabBtn = document.querySelector('[data-tab="swap"]');
    const liquidityTabBtn = document.querySelector('[data-tab="liquidity"]');
    const lpRewardTabBtn = document.querySelector('[data-tab="lpReward"]');
    
    if (swapTabBtn) swapTabBtn.textContent = isChinese ? "ÂÖëÊç¢" : "Swap";
    if (liquidityTabBtn) liquidityTabBtn.textContent = isChinese ? "ÊµÅÂä®ÊÄß" : "Liquidity";
    if (lpRewardTabBtn) lpRewardTabBtn.textContent = isChinese ? "LPÂ•ñÂä±" : "LP Reward";
    
    const swapBtn = document.getElementById("swapBtn");
    if (swapBtn) {
      if (!account) {
        swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
        swapBtn.disabled = false;
      } else if (document.getElementById("fromAmount") && document.getElementById("fromAmount").value && document.getElementById("fromAmount").value !== "0") {
        swapBtn.textContent = isChinese ? "Á´ãÂç≥ÂÖëÊç¢" : "Swap Now";
        swapBtn.disabled = false;
      } else {
        swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
        swapBtn.disabled = true;
      }
    }
    
    const addBtn = document.getElementById("addBtn");
    const removeBtn = document.getElementById("removeBtn");
    if (addBtn) addBtn.textContent = isChinese ? "Ê∑ªÂä†ÊµÅÂä®ÊÄß" : "Add Liquidity";
    if (removeBtn) removeBtn.textContent = isChinese ? "ÁßªÈô§ÊµÅÂä®ÊÄß" : "Remove Liquidity";
    
    const tokenSelectorTitle = document.getElementById("tokenSelectorTitle");
    const addTitle = document.getElementById("addTitle");
    const removeTitle = document.getElementById("removeTitle");
    const confirmAddBtn = document.getElementById("confirmAddBtn");
    const confirmRemoveBtn = document.getElementById("confirmRemoveBtn");
    const cancelAddBtn = document.getElementById("cancelAddBtn");
    const cancelRemoveBtn = document.getElementById("cancelRemoveBtn");
    
    if (tokenSelectorTitle) tokenSelectorTitle.textContent = isChinese ? "ÈÄâÊã©‰ª£Â∏Å" : "Select Token";
    if (addTitle) addTitle.textContent = isChinese ? "Ê∑ªÂä†ÊµÅÂä®ÊÄß" : "Add Liquidity";
    if (removeTitle) removeTitle.textContent = isChinese ? "ÁßªÈô§ÊµÅÂä®ÊÄß" : "Remove Liquidity";
    if (confirmAddBtn) confirmAddBtn.textContent = isChinese ? "Á°ÆËÆ§Ê∑ªÂä†" : "Confirm Add";
    if (confirmRemoveBtn) confirmRemoveBtn.textContent = isChinese ? "Á°ÆËÆ§ÁßªÈô§" : "Confirm Remove";
    if (cancelAddBtn) cancelAddBtn.textContent = isChinese ? "ÂèñÊ∂à" : "Cancel";
    if (cancelRemoveBtn) cancelRemoveBtn.textContent = isChinese ? "ÂèñÊ∂à" : "Cancel";
    
    const riskTitle = document.getElementById("riskTitle");
    const riskText = document.getElementById("riskText");
    if (riskTitle) riskTitle.textContent = isChinese ? "È£éÈô©ÊèêÁ§∫" : "Risk Warning";
    if (riskText) riskText.textContent = isChinese ? 
      "Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ" :
      "This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.";
    
    const footerText = document.getElementById("footerText");
    if (footerText) footerText.textContent = isChinese ? "LOMswap ¬∑ Conflux eSpace" : "LOMswap ¬∑ Conflux eSpace";
  },

  openTokenSelector(type) {
    currentTokenSelector = type;
    const modal = document.getElementById("tokenSelectorModal");
    if (modal) modal.style.display = "flex";
    const tokenSearch = document.getElementById("tokenSearch");
    if (tokenSearch) tokenSearch.value = "";
    this.populateTokenList();
  },

  async populateTokenList(searchTerm = "") {
    const tokenList = document.getElementById("tokenList");
    if (!tokenList) return;
    
    tokenList.innerHTML = "";
    
    const filteredTokens = TOKEN_LIST.filter(token => {
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        return token.symbol.toLowerCase().includes(term) || 
               token.name.toLowerCase().includes(term);
      }
      return true;
    });
    
    const fragment = document.createDocumentFragment();
    
    filteredTokens.forEach(token => {
      if ((currentTokenSelector === 'from' && token.symbol === toToken) ||
          (currentTokenSelector === 'to' && token.symbol === fromToken)) {
        return;
      }
      
      const tokenItem = document.createElement("div");
      tokenItem.className = "token-item";
      tokenItem.innerHTML = `
        <div class="token-item-logo" style="background-image: url('${token.logo}')"></div>
        <div class="token-item-info">
          <div class="token-item-symbol">${token.symbol}</div>
          <div class="token-item-name">${token.name}</div>
        </div>
        <div class="token-item-balance" id="selectorBalance-${token.symbol}">0.000000</div>
      `;
      
      tokenItem.addEventListener("click", () => {
        this.selectToken(token);
      });
      
      fragment.appendChild(tokenItem);
    });
    
    tokenList.appendChild(fragment);
    
    setTimeout(() => {
      if (account) {
        filteredTokens.forEach(token => {
          this.updateTokenBalanceInSelector(token.symbol);
        });
      }
    }, 50);
    
    const searchInput = document.getElementById("tokenSearch");
    if (searchInput) {
      const debouncedSearch = Utils.debounce((e) => {
        this.populateTokenList(e.target.value);
      }, 300);
      
      searchInput.removeEventListener('input', searchInput._debouncedHandler);
      searchInput._debouncedHandler = debouncedSearch;
      searchInput.addEventListener('input', searchInput._debouncedHandler);
      
      setTimeout(() => searchInput.focus(), 100);
    }
  },

  async updateTokenBalanceInSelector(symbol) {
    try {
      const token = TokenUtils.getToken(symbol);
      if (!token) return;
      
      let amount = 0;
      
      if (symbol === 'CFX' && provider && account) {
        const cfxBal = await provider.getBalance(account);
        amount = parseFloat(ethers.utils.formatEther(cfxBal));
      } else {
        const contract = TokenUtils.getTokenContract(symbol);
        if (contract && account) {
          const tokenBal = await contract.balanceOf(account);
          amount = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
        }
      }
      
      const formattedBalance = Utils.formatDisplay(amount);
      const balanceElement = document.getElementById(`selectorBalance-${symbol}`);
      if (balanceElement) {
        balanceElement.textContent = formattedBalance;
      }
    } catch (error) {
      console.error(`Êõ¥Êñ∞${symbol}‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
    }
  },

  selectToken(token) {
    if (currentTokenSelector === 'from') {
      fromToken = token.symbol;
      const fromTokenSymbol = document.getElementById("fromTokenSymbol");
      const fromTokenLogo = document.getElementById("fromTokenLogo");
      if (fromTokenSymbol) fromTokenSymbol.textContent = token.symbol;
      if (fromTokenLogo) fromTokenLogo.style.backgroundImage = `url('${token.logo}')`;
    } else if (currentTokenSelector === 'to') {
      toToken = token.symbol;
      const toTokenSymbol = document.getElementById("toTokenSymbol");
      const toTokenLogo = document.getElementById("toTokenLogo");
      if (toTokenSymbol) toTokenSymbol.textContent = token.symbol;
      if (toTokenLogo) toTokenLogo.style.backgroundImage = `url('${token.logo}')`;
    }
    
    const tokenSelectorModal = document.getElementById("tokenSelectorModal");
    if (tokenSelectorModal) tokenSelectorModal.style.display = "none";
    DataManager.updateAllBalances();
    
    const fromAmount = document.getElementById("fromAmount");
    const toAmount = document.getElementById("toAmount");
    if (fromAmount) fromAmount.value = "";
    if (toAmount) toAmount.value = "";
    
    DataManager.updateSwapButtonState();
    const price = document.getElementById("price");
    if (price) price.textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    const minReceived = document.getElementById("minReceived");
    if (minReceived) minReceived.textContent = `0.000000 ${toToken}`;
  }
};

// ==================== ÂàùÂßãÂåñÂ∫îÁî® ====================
document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ LOMswap ÂàùÂßãÂåñ');
  
  EventHandlers.init();
  
  // ÁõëÂê¨Èí±ÂåÖ‰∫ã‰ª∂
  if (window.ethereum) {
    window.ethereum.on('accountsChanged', (accounts) => {
      if (accounts.length === 0) {
        AppCore.disconnect();
      } else {
        account = accounts[0];
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        AppCore.initContracts();
        AppCore.restoreInviteAddress();
        AppCore.updateUI();
        
        DataManager.refreshAll();
        LPRewardModule.refreshLPRewardData();
        
        if (!refreshInterval) {
          refreshInterval = setInterval(() => {
            DataManager.refreshAll();
          }, 10000);
        }
      }
    });
    
    window.ethereum.on('chainChanged', () => {
      location.reload();
    });
    
    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ËøûÊé•Èí±ÂåÖ
    window.ethereum.request({ method: 'eth_accounts' }).then(accounts => {
      if (accounts.length > 0) {
        account = accounts[0];
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        AppCore.initContracts();
        AppCore.restoreInviteAddress();
        AppCore.updateUI();
        
        DataManager.refreshAll();
        LPRewardModule.refreshLPRewardData();
        
        if (!refreshInterval) {
          refreshInterval = setInterval(() => {
            DataManager.refreshAll();
          }, 10000);
        }
      }
    }).catch(console.error);
  }
  
  console.log('‚úÖ LOMswap ÂàùÂßãÂåñÂÆåÊàê');
});
  </script>
</body>
</html>
