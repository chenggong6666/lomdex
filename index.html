<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap</title>
  
  <!-- Êî∂ËóèÂõæÊ†áÂíåÁ§æ‰∫§Â™í‰ΩìÊ†áÁ≠æ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <!-- Open Graph Ê†áÁ≠æÔºåÁî®‰∫éÁ§æ‰∫§Â™í‰ΩìÂàÜ‰∫´ -->
  <meta property="og:title" content="LOMswap - Conflux Âéª‰∏≠ÂøÉÂåñ‰∫§ÊòìÊâÄ">
  <meta property="og:description" content="Âú® Conflux eSpace ‰∏ä‰∫§Êòì LOM ‰ª£Â∏Å">
  <meta property="og:image" content="https://i.imgur.com/HddyTrv.jpeg">
  <meta property="og:url" content="https://lom-dex.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- ÂÆâÂÖ®Á≠ñÁï• (‰ºòÂåñÁâàÊú¨) -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self' https:;
                 script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https://i.imgur.com data:;
                 connect-src 'self' https://*.confluxrpc.com wss: blob:;
                 font-src 'self' data:;
                 frame-src 'none';
                 object-src 'none';">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== Âü∫Á°ÄÊ†∑Âºè ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== È°πÁõÆ‰ªãÁªçÂºπÁ™ó ========== */
    .project-intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .project-intro-overlay.show {
      display: flex;
    }
    
    .project-intro-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
      position: relative;
      animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .project-intro-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .project-intro-logo {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 3px solid var(--accent-yellow);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    }
    
    .project-intro-title {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 10px;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-subtitle {
      font-size: 18px;
      color: var(--accent-yellow);
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .project-intro-slogan {
      font-size: 14px;
      color: var(--text-secondary);
      font-style: italic;
    }
    
    .project-intro-content {
      margin-bottom: 25px;
    }
    
    .project-intro-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 215, 0, 0.2);
    }
    
    .project-intro-section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      color: var(--accent-yellow);
      font-size: 18px;
      font-weight: 700;
    }
    
    .project-intro-section-icon {
      font-size: 24px;
    }
    
    .project-intro-section-content {
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 15px;
    }
    
    .project-intro-section-content ul {
      padding-left: 20px;
      margin-top: 10px;
    }
    
    .project-intro-section-content li {
      margin-bottom: 8px;
      position: relative;
    }
    
    .project-intro-section-content li:before {
      content: "‚úì";
      color: var(--success);
      font-weight: bold;
      position: absolute;
      left: -20px;
    }
    
    .project-intro-features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 20px 0;
    }
    
    .project-intro-feature {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-feature-icon {
      font-size: 20px;
      margin-bottom: 8px;
      display: block;
    }
    
    .project-intro-feature-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .project-intro-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }
    
    .project-intro-close-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: var(--accent-yellow);
      transform: rotate(90deg);
    }
    
    .project-intro-footer {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .project-intro-footer-text {
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.5;
    }
    
    /* ========== Â§¥ÈÉ®Ê†∑Âºè‰ºòÂåñ ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
      position: relative;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-container:hover {
      transform: translateY(-2px);
    }
    
    .logo-img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .wallet-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      width: auto;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
      max-width: 220px;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 0;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
     #walletBtn {
      min-width: 110px !important;
      max-width: 110px !important;
      width: 110px !important;
   }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      max-width: 40px;
      max-height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ========== Ê†áÁ≠æÈ°µÊ†∑Âºè ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== Âç°ÁâáÊ†∑Âºè ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    /* ========== ‰∫§ÊòìÁïåÈù¢Ê†∑Âºè ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      position: relative;
      margin-bottom: 6px;
    }
    
    .token-input-wrapper.focused {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      position: relative;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
      transform: translateY(-4px);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
       margin-bottom: -4px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
      transform: translateY(-1px);
    }
    
    .token-logo {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      margin-bottom: 12px;
      justify-content: flex-end;
    }
    
    .percent-btn {
      flex: none;
      width: 40px;
      padding: 6px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      text-align: right;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
      padding: 0;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }

    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: -6px 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
  background: transparent; /* ÈÄèÊòéËÉåÊôØ */
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  color: var(--text-secondary); /* Êîπ‰∏∫Ê¨°Ë¶ÅÊñáÂ≠óÈ¢úËâ≤ */
  z-index: 2;
}
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4);
    }
    
    .swap-arrow-btn:active {
      transform: rotate(180deg) scale(0.95);
    }
    
    /* ========== ‰∫§ÊòìËØ¶ÊÉÖ ========== */
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
      font-size: 12px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .detail-value.positive {
      color: var(--success);
    }
    
    .detail-value.negative {
      color: var(--warning);
    }
    
    /* ========== ÊªëÁÇπÊéßÂà∂ ========== */
    .slippage-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }
    
    .slippage-options {
      display: flex;
      gap: 4px;
    }
    
    .slippage-btn {
      padding: 4px 8px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 35px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    /* ========== ‰∏ªÊìç‰ΩúÊåâÈíÆ ========== */
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:active {
      transform: translateY(0);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========== ÊµÅÂä®ÊÄßÈ°µÈù¢Ê†∑Âºè ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stat-value-large {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stat-value-large.positive {
      color: var(--accent-yellow);
    }
    
    .position-actions {
      display: flex;
      gap: 8px;
    }
    
    .position-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    
    
    /* ========== Ê®°ÊÄÅÊ°ÜÊ†∑Âºè ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .modal-input-group {
      margin-bottom: 12px;
    }
    
    .modal-input-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .modal-input:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    /* ========== ‰ª£Â∏ÅÈÄâÊã©Âô® ========== */
    .token-selector-modal {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .token-selector-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .token-search {
      width: 100%;
      padding: 10px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 12px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .token-search:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-search:hover {
      border-color: var(--accent-yellow);
    }
    
    .token-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .token-item:hover {
      background: rgba(26, 115, 232, 0.1);
      transform: translateX(4px);
    }
    
    .token-item-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease;
    }
    
    .token-item:hover .token-item-logo {
      transform: scale(1.1);
    }
    
    .token-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .token-item-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.2s ease;
    }
    
    .token-item:hover .token-item-symbol {
      color: var(--accent-yellow);
    }
    
    .token-item-name {
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-item-balance {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    
    /* ========== ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ ========== */
    .transaction-status {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--gradient-primary);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(26, 115, 232, 0.4);
      z-index: 3000;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 90%;
      text-align: center;
    }
    
    .transaction-status.show {
      transform: translateX(-50%) translateY(0);
    }
    
    .transaction-status.success {
      background: var(--gradient-green);
    }
    
    .transaction-status.error {
      background: var(--gradient-red);
    }
    
    /* ========== È£éÈô©ÊèêÁ§∫ÂíåÈ°µËÑö ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 11px;
      color: var(--text-primary);
      line-height: 1.5;
      position: relative;
      overflow: hidden;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 12px;
      opacity: 0.7;
    }
    
    /* ========== Âä®Áîª ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== Âä†ËΩΩÂä®Áîª ========== */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    .loading-spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }
    
    .loading-spinner.white {
      border-color: rgba(255, 255, 255, 0.3);
      border-top-color: white;
    }
    
    /* ========== ÂìçÂ∫îÂºèË∞ÉÊï¥ ========== */
    @media (max-width: 480px) {
      .app {
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 14px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 44px;
        height: 44px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .header-buttons {
        min-width: 150px;
        max-width: 180px;
      }
      
      #walletBtn {
        min-width: 120px;
        max-width: 140px;
        padding: 8px 12px;
        font-size: 12px;
        height: 36px;
      }
      
      #langBtn {
        width: 36px;
        height: 36px;
        min-width: 36px;
        min-height: 36px;
        max-width: 36px;
        max-height: 36px;
        font-size: 12px;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .modal-card {
        padding: 16px;
      }
      
      .transaction-status {
        bottom: 60px;
      }
      
      .invite-actions {
        flex-direction: column;
      }
      
      .invite-action-btn {
        width: 100%;
      }
      
      .project-intro-card {
        padding: 20px;
      }
      
      .project-intro-title {
        font-size: 24px;
      }
      
      .project-intro-features {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 380px) {
      .logo-text {
        font-size: 16px;
      }
      
      .logo-img {
        width: 36px;
        height: 36px;
      }
      
      .header-buttons {
        min-width: 130px;
        max-width: 150px;
      }
      
      #walletBtn {
        min-width: 100px;
        max-width: 120px;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      #langBtn {
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        max-width: 32px;
        max-height: 32px;
      }
    }
    
    /* ========== ÁßªÈô§ÊµÅÂä®ÊÄßÂºπÁ™ó ========== */
    .remove-liquidity-modal .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .remove-percentage {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: var(--text-primary);
      margin: 8px 0;
    }
    
    .percentage-slider {
      width: 100%;
      margin: 16px 0;
      -webkit-appearance: none;
      height: 6px;
      background: rgba(26, 115, 232, 0.1);
      border-radius: 3px;
      outline: none;
    }
    
    .percentage-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
    }
    
    .percentage-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    
    .percentage-option {
      padding: 8px;
      text-align: center;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-option:hover {
      border-color: var(--primary-blue);
    }
    
    .percentage-option.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .remove-estimate {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .remove-estimate-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .remove-estimate-amounts {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .remove-estimate-amount {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .token-amount-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 15px;
    }
    
    /* ========== ÁÆÄÂçïÁ°ÆËÆ§ÂØπËØùÊ°Ü ========== */
    .simple-confirm-modal .modal-card {
      max-width: 350px;
    }
    
    .confirm-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .confirm-icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
    }
    
    .confirm-action {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .confirm-amounts {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 16px 0;
    }
    
    .confirm-amount-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .confirm-amount-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .confirm-amount-text {
      font-size: 20px;
      font-weight: bold;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .confirm-details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    
    .confirm-detail-item {
      text-align: left;
      padding: 8px;
      background: rgba(26, 115, 232, 0.05);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .confirm-detail-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .confirm-detail-value {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .confirm-actions-simple {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .confirm-action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }
    
    .confirm-action-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .confirm-action-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    .confirm-action-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    .confirm-action-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* ========== ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ ========== */
    .tx-status-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 4000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .tx-status-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      max-width: 350px;
      text-align: center;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .tx-status-icon {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tx-status-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .tx-status-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .tx-status-done-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
    }
    
    .tx-status-done-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    /* ========== ÈîôËØØÊèêÁ§∫Ê°Ü ========== */
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 10px 14px;
      margin: 10px 0;
      font-size: 12px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .error-icon {
      display: inline-block;
      margin-right: 6px;
    }
    
   
    
    /* ========== LPÂ•ñÂä±È°µÈù¢Ê†∑Âºè ========== */
    .lp-reward-panel {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .lp-reward-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));
      border-radius: 16px;
      padding: 16px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .lp-reward-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 215, 0, 0.2);
    }
    
    .lp-reward-card-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .lp-reward-card-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
    }
    
    .lp-reward-card-value.positive {
      color: var(--accent-yellow);
    }
    
    .lp-reward-card-value.warning {
      color: var(--accent-red);
    }
    
    .lp-reward-card-value.success {
      color: var(--success);
    }
    
    .lp-reward-stats {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .lp-reward-stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lp-reward-stat-row:last-child {
      border-bottom: none;
    }
    
    .lp-reward-stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .lp-reward-stat-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .lp-reward-warning {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 107, 129, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    
    .lp-reward-warning-icon {
      color: var(--accent-red);
      font-size: 16px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .lp-reward-warning-text {
      font-size: 12px;
      color: var(--text-primary);
      line-height: 1.4;
    }
    
    .lp-reward-timer {
      background: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .lp-reward-timer-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .lp-reward-timer-value {
      font-size: 16px;
      font-weight: 700;
      color: var(--primary-blue);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .lp-reward-multiplier {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .lp-reward-multiplier-item {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      border: 1px solid rgba(26, 115, 232, 0.2);
      transition: all 0.3s ease;
    }
    
    .lp-reward-multiplier-item.active {
      background: rgba(255, 215, 0, 0.2);
      border-color: var(--accent-yellow);
      transform: scale(1.05);
    }
    
    .lp-reward-multiplier-days {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .lp-reward-multiplier-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .lp-reward-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .lp-reward-action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .lp-reward-action-btn.activate {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .lp-reward-action-btn.claim {
      background: var(--gradient-primary);
      color: white;
    }
    
    .lp-reward-action-btn.referral {
      background: var(--gradient-green);
      color: white;
    }
    
    .lp-reward-action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .lp-reward-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .lp-reward-referral {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin-top: 20px;
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .lp-reward-referral-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .lp-reward-referral-icon {
      color: var(--success);
      font-size: 18px;
    }
    
    .lp-reward-referral-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .lp-reward-referral-input {
      width: 100%;
      padding: 10px 14px;
      background: rgba(46, 160, 67, 0.05);
      border: 1px solid rgba(46, 160, 67, 0.3);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
      transition: all 0.3s ease;
      margin-bottom: 12px;
    }
    
    .lp-reward-referral-input:focus {
      border-color: var(--success);
      box-shadow: 0 0 0 2px rgba(46, 160, 67, 0.1);
    }
    
    .lp-reward-referral-info {
      font-size: 11px;
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.4;
    }
    
    .lp-reward-help {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin-top: 20px;
      border: 1px solid rgba(26, 115, 232, 0.3);
    }
    
    .lp-reward-help-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .lp-reward-help-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .lp-reward-help-item {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.4;
    }
    
    .lp-reward-help-item:last-child {
      margin-bottom: 0;
    }
    
    .lp-reward-help-icon {
      color: var(--primary-blue);
      font-size: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    /* ========== LPÂ•ñÂä±ÊøÄÊ¥ªÂºπÁ™ó ========== */
    .lp-reward-activate-modal .modal-card {
      max-width: 380px;
      text-align: center;
    }
    
    .lp-reward-activate-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--accent-yellow);
    }
    
    .lp-reward-activate-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 12px;
      color: var(--text-primary);
    }
    
    .lp-reward-activate-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .lp-reward-activate-requirements {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin: 20px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
      text-align: left;
    }
    
    .lp-reward-activate-requirement {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lp-reward-activate-requirement:last-child {
      border-bottom: none;
    }
    
    .lp-reward-activate-requirement-icon {
      font-size: 14px;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .lp-reward-activate-requirement-icon.valid {
      background: rgba(46, 160, 67, 0.2);
      color: var(--success);
    }
    
    .lp-reward-activate-requirement-icon.invalid {
      background: rgba(255, 71, 87, 0.2);
      color: var(--accent-red);
    }
    
    .lp-reward-activate-requirement-text {
      font-size: 13px;
      color: var(--text-primary);
      flex: 1;
    }
    
    .lp-reward-activate-details {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .lp-reward-activate-detail {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .lp-reward-activate-detail:last-child {
      border-bottom: none;
    }
    
    .lp-reward-activate-detail-label {
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .lp-reward-activate-detail-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
      text-align: right;
    }
    
    .lp-reward-activate-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .lp-reward-activate-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
    }
    
    .lp-reward-activate-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .lp-reward-activate-btn.confirm {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .lp-reward-activate-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    .lp-reward-activate-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <!-- È°πÁõÆ‰ªãÁªçÂºπÁ™ó -->
  <div class="project-intro-overlay" id="projectIntroOverlay">
    <div class="project-intro-card">
      <button class="project-intro-close-btn" id="projectIntroCloseBtn">√ó</button>
      
      <div class="project-intro-header">
        <div class="project-intro-logo"></div>
        <h1 class="project-intro-title">ÈæôËÑâ LOM</h1>
        <div class="project-intro-subtitle">Conflux.ÁîüÊÄÅÊ†∏ÂøÉËµÑ‰∫ß</div>
        <div class="project-intro-slogan">ÂÖ±ËØÜÂàõÈÄ†‰ª∑ÂÄº</div>
      </div>
      
      <div class="project-intro-content">
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üêâ</span>
            <span>ÂÖ≥‰∫éÈæôËÑâLOM</span>
          </div>
          <div class="project-intro-section-content">
               <p> ÈæôËÑâLOMÁÅµÊÑüÊ∫êËá™‰∏≠ÂõΩ‰º†ÁªüÊñáÂåñ‰∏≠ÁöÑ"ÈæôËÑâ"Ê¶ÇÂøµÔºåË±°ÂæÅÁùÄË¥¢ÂØå„ÄÅÁπÅËç£ÂíåËÉΩÈáèÁöÑÊµÅÂä®.ÊòØÊ∑±Â∫¶ËµãËÉΩ‰∏≠ÂõΩÂîØ‰∏ÄÂêàËßÑÂÖ¨Èìæ‚Äî‚ÄîÊ†ëÂõæÔºàConfluxÔºâÁöÑÁîüÊÄÅÊ†∏ÂøÉËµÑ‰∫ßÔºåÊõ¥ÊòØÈìæÊé•ÂÖ¨Èìæ‰ª∑ÂÄº„ÄÅÁî®Êà∑Êî∂Áõä‰∏éÁîüÊÄÅÁπÅËç£ÁöÑÂÖ≥ÈîÆÁ∫ΩÂ∏¶Ôºå‰æùÊâòÂÖ¨Èìæ‰ºòÂäøÊûÑÂª∫‰∏ìÂ±û‰ª∑ÂÄºÈó≠ÁéØÔºå‰∏∫ÂèÇ‰∏éËÄÖÂ∏¶Êù•Á°ÆÂÆöÊÄßÂõûÊä•„ÄÇ<p>
 
     <p>‰Ωú‰∏∫Ê†ëÂõæÂÖ¨ÈìæÁöÑËµãËÉΩËΩΩ‰ΩìÔºåLOMÊ∑±Â∫¶ÁªëÂÆöÂÖ¨ÈìæÊ†∏ÂøÉ‰ºòÂäøÔºöËøôÊù°Áî±Ê∏ÖÂçéÂõ¢ÈòüÊâìÈÄ†ÁöÑ"confluxÊï∞Â≠óÈæôËÑâ"Ôºå‰ª•ÂêàËßÑ‰∏∫Ê†πÔºå‰∏≤ËÅî40ÂõΩËäÇÁÇπ‰∏é"‰∏ÄÂ∏¶‰∏ÄË∑Ø"Ë∑®Â¢ÉÂú∫ÊôØÔºåÊõ¥ÂÖºÂÆπ‰ª•Â§™ÂùäÁîüÊÄÅ„ÄÇ‰ªéRWAËµÑ‰∫ß‰∏äÈìæÂà∞Á®≥ÂÆöÂ∏ÅÁªìÁÆóÔºåÂÆÉÊ≠£‰ª•Ëá™‰∏ªÂèØÊéßÁöÑÊäÄÊúØÂ∫ïÊ∞îÔºåÊâøÊé•ÂÖ®ÁêÉWeb3.0ÁàÜÂèëÊµ™ÊΩÆÔºåËÆ©‰∏≠ÂõΩÂÖ¨ÈìæÂäõÈáèË¥ØÈÄöÊï∞Â≠óÊú™Êù•„ÄÇ15000TPSË∂ÖÈ´òÊÄßËÉΩ„ÄÅ26ÁßíÊûÅÈÄüÁ°ÆËÆ§ÁöÑÊäÄÊúØÂ∫ïÂ∫ßÔºå‰ª•Âèä5000+ÂÖ®ÁêÉËäÇÁÇπ„ÄÅ2500‰∏áÁî®Êà∑ÁöÑÊàêÁÜüÁîüÊÄÅÔºåËÆ©ÊØè‰∏Ä‰ªΩLOMË¥®ÊäºÈÉΩËÉΩ‰æùÊâòÂÖ¨ÈìæÂêàËßÑËµÑË¥®‰∏éÁúüÂÆûÂ∫îÁî®Âú∫ÊôØÔºåÂÆûÁé∞‰ª∑ÂÄºÈîöÂÆö‰∏éÁ®≥Ê≠•Â¢ûÈïø„ÄÇ<p>
 
   <p>ÂÖ∂Ê†∏ÂøÉ‰ª∑ÂÄºËÅöÁÑ¶ÈîÅÂÆöË¥®Êäº+‰∫å‰ª£Â•ñÂä±ÁöÑÁîüÊÄÅÊøÄÂä±Êú∫Âà∂ÔºåÁ≤æÂáÜÂåπÈÖçÊ†ëÂõæÂÖ¨ÈìæÂèëÂ±ïÈúÄÊ±ÇÔºöÁî®Êà∑ÈÄöËøáÈîÅÂÆöLOMÂèÇ‰∏éË¥®ÊäºÔºå‰∏ç‰ªÖËÉΩÊ∑±Â∫¶‰∫´ÂèóÊ†ëÂõæÂÖ¨ÈìæÁîüÊÄÅÊâ©Âº†„ÄÅÊäÄÊúØÂçáÁ∫ßÂ∏¶Êù•ÁöÑÈïøÊúüË¥®ÊäºÊî∂ÁõäÔºåÊõ¥ËÉΩ‰æùÊâò"ËµãËÉΩÂÖ¨Èìæ"ÁöÑÊ†∏ÂøÉÂÆö‰ΩçÔºåÈÄöËøáÈÇÄËØ∑ÂàÜ‰∫´Ëß£ÈîÅ‰∏∞Âéö‰∫å‰ª£Â•ñÂä±ÔºåËÆ©Êî∂ÁõäÈöèÁîüÊÄÅËæêÂ∞ÑÊåÅÁª≠ÊîæÂ§ß„ÄÇ<p>ËøôÁßçÊ®°ÂºèÊó¢‰∏∫Ê†ëÂõæÂÖ¨ÈìæÊ≥®ÂÖ•Á®≥ÂÆöÁöÑÁîüÊÄÅÂä®ÂäõÔºå‰πüËÆ©Áî®Êà∑Êàê‰∏∫ÂÖ¨ÈìæÂèëÂ±ïÁöÑÁõ¥Êé•ÂèóÁõäËÄÖÔºåÂÆûÁé∞"Ë¥®Êäº‰∫´Á∫¢Âà©ÔºåÂàÜ‰∫´ËµöÂ•ñÂä±"ÁöÑÂèåÈáç‰ª∑ÂÄº„ÄÇ<p>
  
            <ul>
              <li><strong>ÊÄª‰æõÂ∫îÈáè</strong>Ôºö88888888ÊûöÔºàÊ∞∏‰∏çÂ¢ûÂèëÔºâ</li>
              <li><strong>Â∫ïÂ±ÇÊäÄÊúØ</strong>ÔºöÂü∫‰∫éConflux eSpaceÊô∫ËÉΩÂêàÁ∫¶</li>
              <li><strong>Ê≤ªÁêÜÊ®°Âºè</strong>ÔºöÂÆåÂÖ®Âéª‰∏≠ÂøÉÂåñÔºåÁ§æÂå∫È©±Âä®</li>
              <li><strong>ÁªèÊµéÊ®°Âûã</strong>ÔºöÈÄöÁº©Êú∫Âà∂ + ÊµÅÂä®ÊÄßÊøÄÂä±</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-features">
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">‚ö°</span>
            <div class="project-intro-feature-text">ÊÄªÈáèÁ®ÄÁº∫</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">üõ°Ô∏è</span>
            <div class="project-intro-feature-text">Âéª‰∏≠ÂøÉÂåñ</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">üìà</span>
            <div class="project-intro-feature-text">È´òÊî∂ÁõäÁéá</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">üåê</span>
            <div class="project-intro-feature-text">ÂÖ®ÁêÉ‰∫§Êòì</div>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üéØ</span>
            <span>Ê†∏ÂøÉ‰ª∑ÂÄº</span>
          </div>
          <div class="project-intro-section-content">
            <ul>
              <li><strong>‰ª∑ÂÄºÂ≠òÂÇ®</strong>ÔºöÊ∑±Â∫¶ÁªëÂÆöÂÖ¨Èìæ‰ª∑ÂÄºÁ°Æ‰øù‰ª∑ÂÄºÂ¢ûÈïø</li>
              <li><strong>ÊµÅÂä®ÊÄßÊ†∏ÂøÉ</strong>Ôºö‰Ωú‰∏∫DEX‰∫§ÊòìÂØπÁöÑÂü∫ÂáÜËµÑ‰∫ß</li>
              <li><strong>Ê≤ªÁêÜÊùÉÁõä</strong>ÔºöÊåÅÊúâËÄÖÂÖ±ÂêåÂèÇ‰∏éÁîüÊÄÅÊ≤ªÁêÜÂÜ≥Á≠ñ</li>
              <li><strong>Êî∂ÁõäÁîüÊàê</strong>ÔºöÈÄöËøáË¥®ÊäºÂíåÊµÅÂä®ÊÄßÊåñÁüøËé∑ÂæóÊî∂Áõä</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üöÄ</span>
            <span>LOMswapÂäüËÉΩ</span>
          </div>
          <div class="project-intro-section-content">
            <p>Âú®LOMswap‰∏äÔºåÊÇ®ÂèØ‰ª•Ôºö</p>
            <ul>
              <li><strong>ÂÖëÊç¢‰∫§Êòì</strong>ÔºöÂú®CFX-LOM-USDC-USDT0-AxCNH‰πãÈó¥Âø´ÈÄüÂÖëÊç¢</li>
              <li><strong>Êèê‰æõÊµÅÂä®ÊÄß</strong>ÔºöÊ∑ªÂä†CFX-LOMÊµÅÂä®ÊÄßËµöÂèñÊâãÁª≠Ë¥π</li>
            
            </ul>
          </div>
        </div>
      </div>
      
      <div class="project-intro-footer">
        <div class="project-intro-footer-text">
          üí° ÊèêÁ§∫ÔºöËØ∑Á°Æ‰øùÂ∑≤ÂÆâË£ÖTPÊàñweb3Èí±ÂåÖÔºåÂπ∂ÂàáÊç¢Âà∞Conflux eSpaceÁΩëÁªúÔºàChainID: 1030Ôºâ
        </div>
      </div>
    </div>
  </div>

  <!-- ÂéüÊúâÂ∫îÁî®ÁïåÈù¢ -->
  <div class="app">
    <!-- Â§¥ÈÉ® -->
    <div class="header">
      <div class="logo-container" id="logoContainer">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">ËøûÊé•Èí±ÂåÖ</button>
      </div>
    </div>

    <!-- Ê†áÁ≠æÈ°µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">ÂÖëÊç¢</button>
        <button class="tab-btn" data-tab="liquidity">ÊµÅÂä®ÊÄß</button>
        <button class="tab-btn" data-tab="lpReward">LPÂ•ñÂä±</button>
      </div>
    </div>

    <!-- ÂÖëÊç¢È°µÈù¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- ËæìÂÖ•‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- ‰∫§Êç¢ÁÆ≠Â§¥ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">üîÉ</button>
          </div>

          <!-- ËæìÂá∫‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- ÈîôËØØÊèêÁ§∫Ê°Ü -->
          <div class="error-box" id="swapErrorBox">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- ‰∫§ÊòìËØ¶ÊÉÖ -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">ÊªëÁÇπÂÆπÂ∑Æ</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
                <button class="slippage-btn" data-slip="10">10%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†º</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ÊúÄ‰ΩéÊî∂Âà∞</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Ë∑ØÁî±</span>
              <span class="detail-value" id="routeInfo">CFX ‚Üí LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†ºÂΩ±Âìç</span>
              <span class="detail-value positive" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- ‰∫§ÊòìÊåâÈíÆ -->
          <button class="main-action-btn" id="swapBtn">ËøûÊé•Èí±ÂåÖ</button>
        </div>
      </div>
    </div>
    
    <!-- ÊµÅÂä®ÊÄßÈ°µÈù¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">üíß</span>
          <span id="poolInfoTitle">CFX-LOM Ê±†</span>
        </div>

        <div class="liquidity-summary">
          <!-- Ê±†Â≠êÁªüËÆ°‰ø°ÊÅØ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small" id="cfxReserveLabel">CFX ÂÇ®Â§á</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small" id="lomReserveLabel">LOM ÂÇ®Â§á</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- ÊàëÁöÑÊµÅÂä®Ê±†ËØ¶ÊÉÖ -->
          <div class="user-position" style="background: var(--gradient-card); border-radius: 12px; padding: 16px; margin-top: 16px; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);" id="myPositionTitle">ÊàëÁöÑÊµÅÂä®Ê±†</div>
              <div style="font-size: 12px; color: var(--text-secondary);" id="positionValue">$0.00</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myCfxLabel">ÊàëÁöÑCFX</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userCfx">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLomLabel">ÊàëÁöÑLOM</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userLom">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLpLabel">ÊàëÁöÑLP‰ª£Â∏Å</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);" id="userLp">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myShareLabel">Ê±†Â≠ê‰ªΩÈ¢ù</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--success);" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">Ê∑ªÂä†ÊµÅÂä®ÊÄß</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ÁßªÈô§ÊµÅÂä®ÊÄß</button>
          </div>
        </div>
      </div>
    </div>

    <!-- LPÂ•ñÂä±È°µÈù¢ -->
    <div class="tab-content" id="lpRewardTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">üèÜ</span>
          <span>LPÊåÅÂ∏ÅÂ•ñÂä±</span>
        </div>

        <!-- ÊøÄÊ¥ªÁä∂ÊÄÅÈù¢Êùø -->
        <div id="activationStatusPanel">
          <div class="lp-reward-panel">
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>üìä</span>
                <span>ÊøÄÊ¥ªÁä∂ÊÄÅ</span>
              </div>
              <div class="lp-reward-card-value" id="activationStatus">Êú™ÊøÄÊ¥ª</div>
            </div>
            
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>üí∞</span>
                <span>LPÊåÅ‰ªì</span>
              </div>
              <div class="lp-reward-card-value" id="lpBalance">0 LPT</div>
            </div>
            
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>‚è±Ô∏è</span>
                <span>ÊåÅÊúâÊó∂Èïø</span>
              </div>
              <div class="lp-reward-card-value" id="daysHeld">0 Â§©</div>
            </div>
            
            <div class="lp-reward-card">
              <div class="lp-reward-card-title">
                <span>üöÄ</span>
                <span>Â•ñÂä±ÂÄçÁéá</span>
              </div>
              <div class="lp-reward-card-value success" id="rewardMultiplier">1.0x</div>
            </div>
          </div>
        </div>

        <!-- Â•ñÂä±‰ø°ÊÅØÈù¢Êùø -->
        <div class="lp-reward-stats">
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>üíé</span>
              <span>ÂæÖÈ¢ÜÂèñÂ•ñÂä±</span>
            </div>
            <div class="lp-reward-stat-value" id="pendingReward">0 LOM</div>
          </div>
          
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>üìà</span>
              <span>ÊØèÊó•È¢Ñ‰º∞Êî∂Áõä</span>
            </div>
            <div class="lp-reward-stat-value" id="dailyReward">0 LOM</div>
          </div>
          
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>‚è∞</span>
              <span>‰∏ãÊ¨°È¢ÜÂèñÊó∂Èó¥</span>
            </div>
            <div class="lp-reward-stat-value" id="nextClaimTime">--</div>
          </div>
          
          <div class="lp-reward-stat-row">
            <div class="lp-reward-stat-label">
              <span>‚ö°</span>
              <span>Êé®ËçêÂ•ñÂä±</span>
            </div>
            <div class="lp-reward-stat-value success" id="pendingReferral">0 LOM</div>
          </div>
        </div>

        <!-- Êó∂Èó¥ÂÄçÁéáÁ≥ªÁªü -->
        <div class="lp-reward-multiplier">
          <div class="lp-reward-multiplier-item" id="multiplier30d">
            <div class="lp-reward-multiplier-days">30Â§©</div>
            <div class="lp-reward-multiplier-value">1.0x</div>
          </div>
          
          <div class="lp-reward-multiplier-item" id="multiplier90d">
            <div class="lp-reward-multiplier-days">90Â§©</div>
            <div class="lp-reward-multiplier-value">1.5x</div>
          </div>
          
          <div class="lp-reward-multiplier-item" id="multiplier180d">
            <div class="lp-reward-multiplier-days">180Â§©</div>
            <div class="lp-reward-multiplier-value">2.0x</div>
          </div>
          
          <div class="lp-reward-multiplier-item" id="multiplier360d">
            <div class="lp-reward-multiplier-days">360Â§©</div>
            <div class="lp-reward-multiplier-value">3.0x</div>
          </div>
        </div>

        <!-- LPÊåÅ‰ªìÁõëÊéß -->
        <div id="lpMonitorPanel">
          <div class="lp-reward-warning" id="lpWarning" style="display: none;">
            <div class="lp-reward-warning-icon">‚ö†Ô∏è</div>
            <div class="lp-reward-warning-text" id="lpWarningText"></div>
          </div>
          
          <div class="lp-reward-timer" id="cooldownTimer" style="display: none;">
            <div class="lp-reward-timer-label">ÂáèÊåÅÂÜ∑Âç¥Ââ©‰Ωô</div>
            <div class="lp-reward-timer-value" id="cooldownTime">00:00:00</div>
          </div>
        </div>

        <!-- ‰∏ªÊìç‰ΩúÊåâÈíÆ -->
        <div class="lp-reward-actions">
          <button class="lp-reward-action-btn activate" id="activateBtn" disabled>
            <span>üöÄ</span>
            <span>ÊøÄÊ¥ªÂ•ñÂä±</span>
          </button>
          
          <button class="lp-reward-action-btn claim" id="claimBtn" disabled>
            <span>üí∞</span>
            <span>È¢ÜÂèñÂ•ñÂä±</span>
          </button>
          
          <button class="lp-reward-action-btn referral" id="claimReferralBtn" disabled>
            <span>üéÅ</span>
            <span>È¢ÜÂèñÊé®Ëçê</span>
          </button>
        </div>

        <!-- Êé®ËçêÁ≥ªÁªü -->
        <div class="lp-reward-referral" id="referralSection">
          <div class="lp-reward-referral-header">
            <span class="lp-reward-referral-icon">üë•</span>
            <span class="lp-reward-referral-title">Êé®ËçêÁ≥ªÁªü</span>
          </div>
          
          <input type="text" class="lp-reward-referral-input" id="referrerAddress" 
                 placeholder="ËæìÂÖ•Êé®Ëçê‰∫∫Âú∞ÂùÄ (ÂèØÈÄâ)">
          
          <div class="lp-reward-referral-info">
            ÁªëÂÆöÊé®Ëçê‰∫∫ÂèØ‰∫´ÂèóÈ¢ùÂ§ñ5%Â•ñÂä±Âä†ÊàêÔºåÊé®ËçêÂ•ñÂä±ÈîÅÂÆö30Â§©
          </div>
        </div>

        <!-- Â∏ÆÂä©‰ø°ÊÅØ -->
        <div class="lp-reward-help">
          <div class="lp-reward-help-title">
            <span>‚ùì</span>
            <span>ÈáçË¶ÅÊèêÁ§∫</span>
          </div>
          <ul class="lp-reward-help-list">
            <li class="lp-reward-help-item">
              <span class="lp-reward-help-icon">‚úì</span>
              <span>ÊåÅÊúâÊó∂ÈïøË∂äÈïøÔºåÂ•ñÂä±ÂÄçÁéáË∂äÈ´òÔºàÊúÄÈ´ò3ÂÄçÔºâ</span>
            </li>
            <li class="lp-reward-help-item">
              <span class="lp-reward-help-icon">‚úì</span>
              <span>30Â§©ÂÜÖÂáèÊåÅLPÂ∞ÜÂ§±ÂéªÊé®ËçêËµÑÊ†º</span>
            </li>
            <li class="lp-reward-help-item">
              <span class="lp-reward-help-icon">‚úì</span>
              <span>ÂáèÊåÅÊúâ50%ÊÉ©ÁΩöÔºåÂçïÊ¨°ÊúÄÂ§öÂáèÊåÅ30%</span>
            </li>
            <li class="lp-reward-help-item">
              <span class="lp-reward-help-icon">‚úì</span>
              <span>ÂáèÊåÅÂêéÈúÄÁ≠âÂæÖ24Â∞èÊó∂ÂÜ∑Âç¥</span>
            </li>
            <li class="lp-reward-help-item">
              <span class="lp-reward-help-icon">‚úì</span>
              <span>ÊØè7Â§©ÂèØÈ¢ÜÂèñ‰∏ÄÊ¨°Â•ñÂä±</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- È£éÈô©ÊèêÁ§∫  -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>‚ö†Ô∏è</span>
        <span id="riskTitle">È£éÈô©ÊèêÁ§∫</span>
      </div>
      <div id="riskText">
        Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ
      </div>
    </div>

    <!-- È°µËÑö -->
    <div class="footer" id="footerText">LOMswap ¬∑ Conflux eSpace</div>
  </div>

  <!-- ‰ª£Â∏ÅÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
  <div class="token-selector-modal" id="tokenSelectorModal">
    <div class="token-selector-card">
      <h3 class="modal-title" id="tokenSelectorTitle">ÈÄâÊã©‰ª£Â∏Å</h3>
      <input type="text" class="token-search" id="tokenSearch" placeholder="ÊêúÁ¥¢‰ª£Â∏ÅÂêçÁß∞ÊàñÂú∞ÂùÄ">
      <div class="token-list" id="tokenList">
        <!-- ‰ª£Â∏ÅÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
      </div>
    </div>
  </div>

  <!-- Ê∑ªÂä†ÊµÅÂä®ÊÄßÊ®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay" id="addModal">
    <div class="modal-card">
      <h3 class="modal-title" id="addTitle">Ê∑ªÂä†ÊµÅÂä®ÊÄß</h3>
      
      <div class="modal-input-group">
        <label class="modal-input-label">CFX Êï∞Èáè</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addCfx" placeholder="0" step="any" min="0">
          <button class="btn" id="cfxMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ‰ΩôÈ¢ù: <span id="addCfxBal">0</span> CFX
        </div>
      </div>
      
      <div style="text-align: center; font-size: 20px; color: var(--text-primary); margin: 12px 0;">+</div>
      
      <div class="modal-input-group">
        <label class="modal-input-label">LOM Êï∞Èáè</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addLom" placeholder="0" step="any" min="0">
          <button class="btn" id="lomMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ‰ΩôÈ¢ù: <span id="addLomBal">0</span> LOM
        </div>
      </div>
      
      <div style="background: rgba(26, 115, 232, 0.1); border-radius: 10px; padding: 10px; margin: 12px 0; text-align: center;">
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">ÊØî‰æã</div>
        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); word-break: break-all;" id="addRatio">1 CFX = 0 LOM</div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelAddBtn">ÂèñÊ∂à</button>
        <button class="modal-btn confirm" id="confirmAddBtn" disabled>Á°ÆËÆ§Ê∑ªÂä†</button>
      </div>
    </div>
  </div>

  <!-- ÁßªÈô§ÊµÅÂä®ÊÄßÊ®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay remove-liquidity-modal" id="removeModal">
    <div class="modal-card">
      <h3 class="modal-title" id="removeTitle">ÁßªÈô§ÊµÅÂä®ÊÄß</h3>
      
      <div class="modal-content">
        <div class="remove-percentage">
          <span id="removePercent">100%</span>
        </div>
        
        <input type="range" min="0" max="100" value="100" step="1" class="percentage-slider" id="removeSlider">
        
        <div class="percentage-options">
          <div class="percentage-option" data-percent="25">25%</div>
          <div class="percentage-option" data-percent="50">50%</div>
          <div class="percentage-option" data-percent="75">75%</div>
          <div class="percentage-option active" data-percent="100">100%</div>
        </div>
        
        <div class="remove-estimate">
          <div class="remove-estimate-title">È¢ÑËÆ°Ëé∑Âæó</div>
          <div class="remove-estimate-amounts">
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstCfx">0</span> CFX
            </div>
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstLom">0</span> LOM
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn cancel" id="cancelRemoveBtn">ÂèñÊ∂à</button>
          <button class="modal-btn confirm" id="confirmRemoveBtn" style="background: var(--gradient-red);">Á°ÆËÆ§ÁßªÈô§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- LPÂ•ñÂä±ÊøÄÊ¥ªÁ°ÆËÆ§ÂºπÁ™ó -->
  <div class="modal-overlay lp-reward-activate-modal" id="lpRewardActivateModal">
    <div class="modal-card">
      <div class="lp-reward-activate-icon">üöÄ</div>
      <div class="lp-reward-activate-title" id="lpRewardActivateTitle">ÊøÄÊ¥ªLPÂ•ñÂä±</div>
      <div class="lp-reward-activate-message" id="lpRewardActivateMessage">
        ËØ∑Á°ÆËÆ§ÊøÄÊ¥ª‰ø°ÊÅØÔºåÊøÄÊ¥ªÂêéÂç≥ÂèØÂºÄÂßãËµöÂèñLPÊåÅÂ∏ÅÂ•ñÂä±
      </div>
      
      <div class="lp-reward-activate-requirements" id="lpRewardRequirements">
        <!-- ÊøÄÊ¥ªË¶ÅÊ±ÇÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
      </div>
      
      <div class="lp-reward-activate-details">
        <div class="lp-reward-activate-detail">
          <span class="lp-reward-activate-detail-label">ÊÇ®ÁöÑLP‰ΩôÈ¢ù</span>
          <span class="lp-reward-activate-detail-value" id="activateLpBalance">0 LPT</span>
        </div>
        <div class="lp-reward-activate-detail">
          <span class="lp-reward-activate-detail-label">ÊúÄÂ∞èÊøÄÊ¥ªË¶ÅÊ±Ç</span>
          <span class="lp-reward-activate-detail-value" id="minActivationRequired">100 LPT</span>
        </div>
        <div class="lp-reward-activate-detail">
          <span class="lp-reward-activate-detail-label">Êé®Ëçê‰∫∫Âú∞ÂùÄ</span>
          <span class="lp-reward-activate-detail-value" id="activateReferrerAddress">Êó†</span>
        </div>
        <div class="lp-reward-activate-detail">
          <span class="lp-reward-activate-detail-label">ÂàùÂßãÂÄçÁéá</span>
          <span class="lp-reward-activate-detail-value success">1.0x</span>
        </div>
      </div>
      
      <div class="lp-reward-activate-actions">
        <button class="lp-reward-activate-btn cancel" id="lpRewardActivateCancelBtn">ÂèñÊ∂à</button>
        <button class="lp-reward-activate-btn confirm" id="lpRewardActivateConfirmBtn" disabled>Á°ÆËÆ§ÊøÄÊ¥ª</button>
      </div>
    </div>
  </div>

  <!-- ÁÆÄÂçï‰∫§ÊòìÁ°ÆËÆ§Ê®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay simple-confirm-modal" id="simpleConfirmModal">
    <div class="modal-card">
      <div class="confirm-summary">
        <div class="confirm-icon" id="simpleConfirmIcon">üîÑ</div>
        <div class="confirm-action" id="simpleConfirmAction">ÂÖëÊç¢Á°ÆËÆ§</div>
        <div class="confirm-amounts" id="simpleConfirmAmounts">
          <!-- ÈáëÈ¢ù‰ø°ÊÅØÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div class="confirm-details-grid" id="simpleConfirmDetails">
          <!-- ËØ¶ÁªÜ‰ø°ÊÅØÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
      <div class="confirm-actions-simple">
        <button class="confirm-action-btn cancel" id="simpleCancelBtn">ÂèñÊ∂à</button>
        <button class="confirm-action-btn confirm" id="simpleConfirmBtn">Á°ÆËÆ§‰∫§Êòì</button>
      </div>
    </div>
  </div>

  <!-- ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ -->
  <div class="tx-status-overlay" id="txStatusOverlay">
    <div class="tx-status-card">
      <div class="tx-status-icon" id="txStatusIcon">
        <div class="loading-spinner white"></div>
      </div>
      <div class="tx-status-title" id="txStatusTitle">‰∫§ÊòìÂ§ÑÁêÜ‰∏≠</div>
      <div class="tx-status-message" id="txStatusMessage">ËØ∑Á≠âÂæÖÂå∫ÂùóÈìæÁ°ÆËÆ§...</div>
      <button class="tx-status-done-btn" id="txStatusDoneBtn" style="display:none;">ÂÆåÊàê</button>
    </div>
  </div>


// ==================== È°πÁõÆ‰ªãÁªçÂºπÁ™óÂäüËÉΩ ====================
document.addEventListener('DOMContentLoaded', function() {
  const logoContainer = document.getElementById('logoContainer');
  const projectIntroOverlay = document.getElementById('projectIntroOverlay');
  const projectIntroCloseBtn = document.getElementById('projectIntroCloseBtn');
  
  // ÁÇπÂáªLogoÊòæÁ§∫È°πÁõÆ‰ªãÁªçÂºπÁ™ó
  logoContainer.addEventListener('click', function() {
    projectIntroOverlay.classList.add('show');
  });
  
  // ÁÇπÂáªÂÖ≥Èó≠ÊåâÈíÆÂÖ≥Èó≠ÂºπÁ™ó
  projectIntroCloseBtn.addEventListener('click', function() {
    projectIntroOverlay.classList.remove('show');
  });
  
  // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
  projectIntroOverlay.addEventListener('click', function(e) {
    if (e.target === projectIntroOverlay) {
      projectIntroOverlay.classList.remove('show');
    }
  });
  
  // ÊåâESCÈîÆÂÖ≥Èó≠
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && projectIntroOverlay.classList.contains('show')) {
      projectIntroOverlay.classList.remove('show');
    }
  });
});

// ==================== Áªü‰∏ÄÈÖçÁΩÆ ====================
const APP_CONFIG = {
  CONTRACTS: {
    ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
    LOM: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3",
    WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
    PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85", // CFX-LOMÊ±†
    USDC: "0x6963efed0ab40f6c3d7bda44a05dcf1437c44372",
    AXCNH: "0x70BFD7F7eADF9b9827541272589A6B2Bb760aE2E",
    USDT0: "0xaf37e8b6c9ed7f6318979f56fc287d76c30847ff",
    CNHT0: "0xDEd1660192d4d82e7c0B628ba556861EdBB5CAda",
    AXCNH_USDT0_PAIR: "0x50b095DF7a8f856C6fA07fF89bcBC2dF8491A8df",
    // LPÂ•ñÂä±ÂêàÁ∫¶
    LP_REWARD: "0x233f9C12514A29d860e482eB29f1EE1f8fcC59aa"
  },
  TOKEN_LOGOS: {
    CFX: "https://i.imgur.com/70cXbUI.jpeg",
    LOM: "https://i.imgur.com/HddyTrv.jpeg",
    USDC: "https://i.imgur.com/9UDXcUF.jpeg",
    AXCNH: "https://i.imgur.com/x8317um.jpeg",
    USDT0: "https://i.imgur.com/KgnTsn1.jpeg",
    CNHT0: "https://i.imgur.com/zObg9RY.jpeg"
  },
  STAKING_URL: "https://stake.fatsale.org/#/cfx/0x90117C51DD5e17C4A306fea71B0f260Df057F6e3",
  CHAIN_ID: 1030 // Conflux eSpace
};

// ==================== Â∫îÁî®Áä∂ÊÄÅ ====================
let provider, signer, account, router, pair, lom, usdc, axcnh, usdt0, cnht0, axcnhUsdt0Pair, lpRewardContract;
let slippage = 0.1;
let isChinese = true;
let currentRatio = 0;
let fromToken = "CFX";
let toToken = "LOM";
let refreshInterval;
let currentTokenSelector = null;
let transactionLock = false;
let currentReserves = { cfx: 0, lom: 0 };
let lastInputWasFrom = true;
let inviteAddress = localStorage.getItem('lomswap_invite_address') || '';
let walletInviteMap = JSON.parse(localStorage.getItem('lomswap_wallet_invite_map') || '{}');

// LPÂ•ñÂä±Áõ∏ÂÖ≥Áä∂ÊÄÅ
let lpRewardUserInfo = null;
let lpRewardContractInfo = null;
let lpBalance = 0;
let cooldownInterval = null;

// ==================== Ê†∏ÂøÉ‰ª£Â∏ÅÂàóË°® ====================
const TOKEN_LIST = [
  {
    symbol: "CFX",
    name: "Conflux",
    address: APP_CONFIG.CONTRACTS.WCFX,
    logo: APP_CONFIG.TOKEN_LOGOS.CFX,
    decimals: 18,
    isNative: true
  },
  {
    symbol: "LOM",
    name: "Longmai",
    address: APP_CONFIG.CONTRACTS.LOM,
    logo: APP_CONFIG.TOKEN_LOGOS.LOM,
    decimals: 18
  },
  {
    symbol: "USDC",
    name: "USD Coin",
    address: APP_CONFIG.CONTRACTS.USDC,
    logo: APP_CONFIG.TOKEN_LOGOS.USDC,
    decimals: 18
  },
  {
    symbol: "AXCNH",
    name: "AxCNH",
    address: APP_CONFIG.CONTRACTS.AXCNH,
    logo: APP_CONFIG.TOKEN_LOGOS.AXCNH,
    decimals: 6
  },
  {
    symbol: "USDT0",
    name: "Tether USD (Test)",
    address: APP_CONFIG.CONTRACTS.USDT0,
    logo: APP_CONFIG.TOKEN_LOGOS.USDT0,
    decimals: 6
  },
  {
    symbol: "CNHT0",
    name: "CNH Token (Test)",
    address: APP_CONFIG.CONTRACTS.CNHT0,
    logo: APP_CONFIG.TOKEN_LOGOS.CNHT0,
    decimals: 6
  }
];

// ==================== ÂêàÁ∫¶ ABI ====================
const ROUTER_ABI = [
  "function getAmountsOut(uint amountIn, address[] path) view returns (uint[] memory amounts)",
  "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) payable",
  "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function addLiquidityETH(address token, uint amountTokenDesired, uint amountTokenMin, uint amountETHMin, address to, uint deadline) payable returns (uint amountToken, uint amountETH, uint liquidity)",
  "function removeLiquidityETHSupportingFeeOnTransferTokens(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountETH)",
  "function removeLiquidityETH(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountToken, uint amountETH)"
];

const ERC20_ABI = [
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function totalSupply() view returns (uint256)"
];

const PAIR_ABI = [
  "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function token0() view returns (address)",
  "function token1() view returns (address)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)"
];

// LPÂ•ñÂä±ÂêàÁ∫¶ABI
const LP_REWARD_ABI = [
  // Áä∂ÊÄÅÂèòÈáè
  "function lpToken() view returns (address)",
  "function rewardToken() view returns (address)",
  "function admin() view returns (address)",
  "function paused() view returns (bool)",
  "function minActivation() view returns (uint256)",
  "function blacklist(address) view returns (bool)",
  "function totalShares() view returns (uint256)",
  "function accRewardPerShare() view returns (uint256)",
  "function lastRewardTime() view returns (uint256)",
  "function rewardPerSecond() view returns (uint256)",
  
  // Áî®Êà∑‰ø°ÊÅØ
  "function users(address) view returns (uint256 shares, uint256 rewardDebt, uint256 pendingReferral, uint256 lastClaimTime, uint256 activeTime, uint256 lastReduceTime, uint256 referralUnlockTime, address referrer, bool cleanInFirst30Days)",
  
  // ËßÜÂõæÂáΩÊï∞
  "function pendingReward(address user) view returns (uint256)",
  
  // Áî®Êà∑Êìç‰Ωú
  "function activate(address referrer)",
  "function claimAll()",
  "function claimReferral()",
  
  // ‰∫ã‰ª∂
  "event Activated(address indexed user, uint256 amount, address referrer)",
  "event RewardClaimed(address indexed user, uint256 amount)",
  "event ReferralClaimed(address indexed user, uint256 amount)",
  "event Reduced(address indexed user, uint256 oldShares, uint256 newShares)"
];

// ==================== Â∑•ÂÖ∑Ê®°Âùó ====================
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  simpleFormat(value) {
    if (!value && value !== 0) return '0.000000';
    
    const num = parseFloat(value);
    if (isNaN(num)) return '0.000000';
    
    const truncated = Math.floor(num * 1000000) / 1000000;
    
    const parts = truncated.toString().split('.');
    let integerPart = parts[0];
    let decimalPart = parts[1] || '';
    
    if (decimalPart.length < 6) {
      decimalPart = decimalPart.padEnd(6, '0');
    } else if (decimalPart.length > 6) {
      decimalPart = decimalPart.substring(0, 6);
    }
    
    return integerPart + '.' + decimalPart;
  },

  removeTrailingZeros(str) {
    if (!str.includes('.')) return str;
    
    let result = str.replace(/0+$/, '');
    if (result.endsWith('.')) {
      result = result.slice(0, -1);
    }
    return result;
  },

  formatDisplay(value) {
    const formatted = this.simpleFormat(value);
    return this.removeTrailingZeros(formatted);
  },

  formatAddress(address) {
    if (!address) return '';
    return address.slice(0, 4) + '...' + address.slice(-6);
  },

  isValidAddress(address) {
    return /^0x[a-fA-F0-9]{40}$/.test(address);
  },

  showError(message) {
    const errorBox = document.getElementById('swapErrorBox');
    const errorText = document.getElementById('swapErrorText');
    errorText.textContent = message;
    errorBox.classList.add('show');
    
    setTimeout(() => {
      errorBox.classList.remove('show');
    }, 5000);
  },

  showNotification(message, type = 'info') {
    const status = document.getElementById('txStatusOverlay');
    const icon = document.getElementById('txStatusIcon');
    const title = document.getElementById('txStatusTitle');
    const msg = document.getElementById('txStatusMessage');
    const doneBtn = document.getElementById('txStatusDoneBtn');
    
    const statusConfig = {
      info: { 
        icon: '<div class="loading-spinner white"></div>', 
        title: isChinese ? 'Â§ÑÁêÜ‰∏≠' : 'Processing' 
      },
      success: { 
        icon: '‚úÖ', 
        title: isChinese ? 'Êìç‰ΩúÊàêÂäü' : 'Success' 
      },
      error: { 
        icon: '‚ùå', 
        title: isChinese ? 'Êìç‰ΩúÂ§±Ë¥•' : 'Failed' 
      },
      warning: { 
        icon: '‚ö†Ô∏è', 
        title: isChinese ? 'ÊèêÁ§∫' : 'Notice' 
      }
    };
    
    const config = statusConfig[type] || statusConfig.info;
    icon.innerHTML = config.icon;
    title.textContent = config.title;
    msg.textContent = message;
    
    if (type === 'success' || type === 'error' || type === 'warning') {
      doneBtn.style.display = 'block';
    } else {
      doneBtn.style.display = 'none';
    }
    
    status.style.display = 'flex';
  },

  hideNotification() {
    document.getElementById('txStatusOverlay').style.display = 'none';
    document.querySelectorAll('button').forEach(btn => {
      btn.disabled = false;
    });
  },

  getErrorMessage(error) {
    const message = error.message || error.toString();
    
    const errorMap = {
      'user rejected': isChinese ? 'Áî®Êà∑ÂèñÊ∂à‰∫Ü‰∫§Êòì' : 'Transaction rejected by user',
      'INSUFFICIENT_OUTPUT_AMOUNT': isChinese ? 'ËæìÂá∫Êï∞Èáè‰∏çË∂≥ÔºåËØ∑ÊèêÈ´òÊªëÁÇπÂÆπÂ∑Æ' : 'Insufficient output amount, increase slippage',
      'INSUFFICIENT_INPUT_AMOUNT': isChinese ? 'ËæìÂÖ•Êï∞Èáè‰∏çË∂≥' : 'Insufficient input amount',
      'insufficient funds': isChinese ? '‰ΩôÈ¢ù‰∏çË∂≥' : 'Insufficient balance',
      'allowance': isChinese ? 'ËØ∑ÂÖàÊéàÊùÉ‰ª£Â∏Å' : 'Please approve token first',
      'deadline': isChinese ? '‰∫§ÊòìË∂ÖÊó∂ÔºåËØ∑ÈáçËØï' : 'Transaction expired, please try again',
      'Not enough liquidity': isChinese ? 'ÊµÅÂä®ÊÄß‰∏çË∂≥' : 'Insufficient liquidity',
      'execution reverted': isChinese ? '‰∫§ÊòìÊâßË°åÂ§±Ë¥•' : 'Transaction execution failed',
      'reverted': isChinese ? '‰∫§ÊòìÂ§±Ë¥•' : 'Transaction failed',
      'invalid decimal value': isChinese ? 'Êï∞ÈáèÊ†ºÂºèÈîôËØØ' : 'Invalid amount format',
      'underflow': isChinese ? 'Êï∞ÈáèÂ§™Â∞è' : 'Amount too small'
    };
    
    for (const [key, value] of Object.entries(errorMap)) {
      if (message.toLowerCase().includes(key.toLowerCase())) {
        return value;
      }
    }
    
    return isChinese ? '‰∫§ÊòìÂ§±Ë¥•ÔºåËØ∑ÈáçËØï' : 'Transaction failed, please try again';
  },

  async confirmDialog(message) {
    return new Promise((resolve) => {
      Utils.showNotification(message, 'warning');
      
      const doneBtn = document.getElementById('txStatusDoneBtn');
      const oldClick = doneBtn.onclick;
      
      doneBtn.onclick = () => {
        Utils.hideNotification();
        doneBtn.onclick = oldClick;
        resolve(true);
      };
      
      const cancelBtn = document.createElement('button');
      cancelBtn.className = 'confirm-action-btn cancel';
      cancelBtn.textContent = isChinese ? 'ÂèñÊ∂à' : 'Cancel';
      cancelBtn.style.marginTop = '10px';
      cancelBtn.style.width = '100%';
      
      cancelBtn.onclick = () => {
        Utils.hideNotification();
        doneBtn.onclick = oldClick;
        cancelBtn.remove();
        resolve(false);
      };
      
      const card = document.querySelector('.tx-status-card');
      if (!card.querySelector('.confirm-action-btn.cancel')) {
        card.appendChild(cancelBtn);
      }
    });
  },

  formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  },

  formatDate(timestamp) {
    if (!timestamp || timestamp === 0) return '--';
    
    const date = new Date(timestamp * 1000);
    const now = new Date();
    
    // Â¶ÇÊûúÊòØ‰ªäÂ§©
    if (date.toDateString() === now.toDateString()) {
      return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    }
    
    // Â¶ÇÊûúÊòØÊòéÂ§©
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    if (date.toDateString() === tomorrow.toDateString()) {
      return 'ÊòéÂ§© ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    }
    
    // ÂÖ∂‰ªñÊÉÖÂÜµ
    return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
  }
};

// ==================== LPÂ•ñÂä±ÁÆ°ÁêÜÂô® ====================
const LPRewardManager = {
  async initContract() {
    if (!provider || !APP_CONFIG.CONTRACTS.LP_REWARD) return null;
    
    try {
      lpRewardContract = new ethers.Contract(
        APP_CONFIG.CONTRACTS.LP_REWARD,
        LP_REWARD_ABI,
        signer || provider
      );
      return lpRewardContract;
    } catch (error) {
      console.error('ÂàùÂßãÂåñLPÂ•ñÂä±ÂêàÁ∫¶Â§±Ë¥•:', error);
      return null;
    }
  },

  async refreshUserInfo() {
    if (!account || !lpRewardContract) {
      this.resetUserInfo();
      return;
    }
    
    try {
      // Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
      const userInfo = await lpRewardContract.users(account);
      
      lpRewardUserInfo = {
        shares: parseFloat(ethers.utils.formatUnits(userInfo.shares, 18)),
        rewardDebt: parseFloat(ethers.utils.formatUnits(userInfo.rewardDebt, 18)),
        pendingReferral: parseFloat(ethers.utils.formatUnits(userInfo.pendingReferral, 18)),
        lastClaimTime: userInfo.lastClaimTime.toNumber(),
        activeTime: userInfo.activeTime.toNumber(),
        lastReduceTime: userInfo.lastReduceTime.toNumber(),
        referralUnlockTime: userInfo.referralUnlockTime.toNumber(),
        referrer: userInfo.referrer,
        cleanInFirst30Days: userInfo.cleanInFirst30Days
      };
      
      // Ëé∑ÂèñÂêàÁ∫¶‰ø°ÊÅØ
      const minActivation = await lpRewardContract.minActivation();
      const totalShares = await lpRewardContract.totalShares();
      const rewardPerSecond = await lpRewardContract.rewardPerSecond();
      
      lpRewardContractInfo = {
        minActivation: parseFloat(ethers.utils.formatUnits(minActivation, 18)),
        totalShares: parseFloat(ethers.utils.formatUnits(totalShares, 18)),
        rewardPerSecond: parseFloat(ethers.utils.formatUnits(rewardPerSecond, 18))
      };
      
      // Ëé∑ÂèñLP‰ΩôÈ¢ù
      if (pair && account) {
        const lpBal = await pair.balanceOf(account);
        lpBalance = parseFloat(ethers.utils.formatUnits(lpBal, 18));
      }
      
      // Ëé∑ÂèñÂæÖÈ¢ÜÂèñÂ•ñÂä±
      const pendingReward = await lpRewardContract.pendingReward(account);
      const pendingRewardAmount = parseFloat(ethers.utils.formatUnits(pendingReward, 18));
      
      this.updateUI();
      this.updateTimer();
      
    } catch (error) {
      console.error('Âà∑Êñ∞LPÂ•ñÂä±‰ø°ÊÅØÂ§±Ë¥•:', error);
      this.resetUserInfo();
    }
  },

  resetUserInfo() {
    lpRewardUserInfo = null;
    lpRewardContractInfo = null;
    lpBalance = 0;
    
    this.updateUI();
  },

  updateUI() {
    const isActivated = lpRewardUserInfo && lpRewardUserInfo.shares > 0;
    
    // Êõ¥Êñ∞ÊøÄÊ¥ªÁä∂ÊÄÅ
    document.getElementById('activationStatus').textContent = isActivated ? 'Â∑≤ÊøÄÊ¥ª' : 'Êú™ÊøÄÊ¥ª';
    document.getElementById('activationStatus').className = isActivated ? 
      'lp-reward-card-value success' : 'lp-reward-card-value warning';
    
    // Êõ¥Êñ∞LP‰ΩôÈ¢ù
    document.getElementById('lpBalance').textContent = `${Utils.formatDisplay(lpBalance)} LPT`;
    
    if (isActivated) {
      // ËÆ°ÁÆóÊåÅÊúâÊó∂Èïø
      const daysHeld = Math.floor((Date.now() / 1000 - lpRewardUserInfo.activeTime) / 86400);
      document.getElementById('daysHeld').textContent = `${daysHeld} Â§©`;
      
      // ËÆ°ÁÆóÂ•ñÂä±ÂÄçÁéá
      const multiplier = this.calculateMultiplier(daysHeld);
      document.getElementById('rewardMultiplier').textContent = `${multiplier.toFixed(1)}x`;
      
      // È´ò‰∫ÆÂΩìÂâçÂÄçÁéá
      this.highlightMultiplier(daysHeld);
      
      // Êõ¥Êñ∞Â•ñÂä±‰ø°ÊÅØ
      this.updateRewardInfo();
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      document.getElementById('activateBtn').disabled = true;
      document.getElementById('activateBtn').innerHTML = '<span>‚úÖ</span><span>Â∑≤ÊøÄÊ¥ª</span>';
      
      // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•È¢ÜÂèñ
      const canClaim = this.canClaimReward();
      document.getElementById('claimBtn').disabled = !canClaim;
      document.getElementById('claimBtn').innerHTML = canClaim ? 
        '<span>üí∞</span><span>È¢ÜÂèñÂ•ñÂä±</span>' : 
        '<span>‚è≥</span><span>Á≠âÂæÖ‰∏≠</span>';
      
      // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•È¢ÜÂèñÊé®ËçêÂ•ñÂä±
      const canClaimReferral = this.canClaimReferral();
      document.getElementById('claimReferralBtn').disabled = !canClaimReferral;
      document.getElementById('claimReferralBtn').innerHTML = canClaimReferral ? 
        '<span>üéÅ</span><span>È¢ÜÂèñÊé®Ëçê</span>' : 
        '<span>üîí</span><span>ÈîÅÂÆö‰∏≠</span>';
      
      // Ê£ÄÊü•LPÂáèÊåÅË≠¶Âëä
      this.checkLPWarning();
      
    } else {
      // Êú™ÊøÄÊ¥ªÁä∂ÊÄÅ
      document.getElementById('daysHeld').textContent = '0 Â§©';
      document.getElementById('rewardMultiplier').textContent = '1.0x';
      
      // ÈáçÁΩÆÂÄçÁéáÈ´ò‰∫Æ
      this.resetMultiplierHighlight();
      
      // Ê£ÄÊü•ÊòØÂê¶Êª°Ë∂≥ÊøÄÊ¥ªÊù°‰ª∂
      const canActivate = this.canActivate();
      document.getElementById('activateBtn').disabled = !canActivate;
      document.getElementById('activateBtn').innerHTML = canActivate ? 
        '<span>üöÄ</span><span>ÊøÄÊ¥ªÂ•ñÂä±</span>' : 
        '<span>‚è≥</span><span>Êù°‰ª∂‰∏çÁ¨¶</span>';
      
      // Á¶ÅÁî®ÂÖ∂‰ªñÊåâÈíÆ
      document.getElementById('claimBtn').disabled = true;
      document.getElementById('claimReferralBtn').disabled = true;
      document.getElementById('claimBtn').innerHTML = '<span>üí∞</span><span>È¢ÜÂèñÂ•ñÂä±</span>';
      document.getElementById('claimReferralBtn').innerHTML = '<span>üéÅ</span><span>È¢ÜÂèñÊé®Ëçê</span>';
      
      // ÈöêËóèË≠¶Âëä
      document.getElementById('lpWarning').style.display = 'none';
      document.getElementById('cooldownTimer').style.display = 'none';
    }
  },

  calculateMultiplier(daysHeld) {
    if (daysHeld >= 360) return 3.0;
    if (daysHeld >= 180) return 2.0;
    if (daysHeld >= 90) return 1.5;
    return 1.0;
  },

  highlightMultiplier(daysHeld) {
    // ÈáçÁΩÆÊâÄÊúâÈ´ò‰∫Æ
    this.resetMultiplierHighlight();
    
    // Ê†πÊçÆÊåÅÊúâÊó∂ÈïøÈ´ò‰∫ÆÂØπÂ∫îÂÄçÁéá
    if (daysHeld >= 360) {
      document.getElementById('multiplier360d').classList.add('active');
    } else if (daysHeld >= 180) {
      document.getElementById('multiplier180d').classList.add('active');
    } else if (daysHeld >= 90) {
      document.getElementById('multiplier90d').classList.add('active');
    } else {
      document.getElementById('multiplier30d').classList.add('active');
    }
  },

  resetMultiplierHighlight() {
    const items = document.querySelectorAll('.lp-reward-multiplier-item');
    items.forEach(item => item.classList.remove('active'));
  },

  async updateRewardInfo() {
    if (!lpRewardContract || !lpRewardUserInfo) return;
    
    try {
      // Ëé∑ÂèñÂæÖÈ¢ÜÂèñÂ•ñÂä±
      const pendingReward = await lpRewardContract.pendingReward(account);
      const pendingRewardAmount = parseFloat(ethers.utils.formatUnits(pendingReward, 18));
      
      document.getElementById('pendingReward').textContent = `${Utils.formatDisplay(pendingRewardAmount)} LOM`;
      
      // ËÆ°ÁÆóÊØèÊó•È¢Ñ‰º∞Êî∂Áõä
      const daysHeld = Math.floor((Date.now() / 1000 - lpRewardUserInfo.activeTime) / 86400);
      const multiplier = this.calculateMultiplier(daysHeld);
      const dailyReward = lpRewardContractInfo.rewardPerSecond * lpRewardUserInfo.shares / lpRewardContractInfo.totalShares * 86400 * multiplier;
      
      document.getElementById('dailyReward').textContent = `${Utils.formatDisplay(dailyReward)} LOM`;
      
      // ËÆ°ÁÆó‰∏ãÊ¨°È¢ÜÂèñÊó∂Èó¥
      const nextClaimTime = lpRewardUserInfo.lastClaimTime + 7 * 86400;
      const now = Math.floor(Date.now() / 1000);
      
      if (now >= nextClaimTime) {
        document.getElementById('nextClaimTime').textContent = 'Áé∞Âú®ÂèØ‰ª•È¢ÜÂèñ';
      } else {
        const timeLeft = nextClaimTime - now;
        const daysLeft = Math.floor(timeLeft / 86400);
        const hoursLeft = Math.floor((timeLeft % 86400) / 3600);
        document.getElementById('nextClaimTime').textContent = `${daysLeft}Â§©${hoursLeft}Â∞èÊó∂Âêé`;
      }
      
      // Êõ¥Êñ∞Êé®ËçêÂ•ñÂä±
      document.getElementById('pendingReferral').textContent = `${Utils.formatDisplay(lpRewardUserInfo.pendingReferral)} LOM`;
      
    } catch (error) {
      console.error('Êõ¥Êñ∞Â•ñÂä±‰ø°ÊÅØÂ§±Ë¥•:', error);
    }
  },

  canActivate() {
    if (!account || !pair || !lpRewardContractInfo) return false;
    
    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊøÄÊ¥ª
    if (lpRewardUserInfo && lpRewardUserInfo.shares > 0) return false;
    
    // Ê£ÄÊü•LP‰ΩôÈ¢ùÊòØÂê¶Êª°Ë∂≥ÊúÄÂ∞èÊøÄÊ¥ªË¶ÅÊ±Ç
    if (lpBalance < lpRewardContractInfo.minActivation) return false;
    
    return true;
  },

  canClaimReward() {
    if (!lpRewardUserInfo) return false;
    
    const now = Math.floor(Date.now() / 1000);
    const timeSinceLastClaim = now - lpRewardUserInfo.lastClaimTime;
    
    // ÈúÄË¶ÅËá≥Â∞ë7Â§©ÊâçËÉΩÈ¢ÜÂèñ
    return timeSinceLastClaim >= 7 * 86400;
  },

  canClaimReferral() {
    if (!lpRewardUserInfo || lpRewardUserInfo.pendingReferral <= 0) return false;
    
    const now = Math.floor(Date.now() / 1000);
    
    // Ê£ÄÊü•Êé®ËçêÂ•ñÂä±ÊòØÂê¶Â∑≤Ëß£ÈîÅ
    return now >= lpRewardUserInfo.referralUnlockTime;
  },

  checkLPWarning() {
    if (!lpRewardUserInfo || !pair || !account) return;
    
    const warningPanel = document.getElementById('lpWarning');
    const timerPanel = document.getElementById('cooldownTimer');
    
    // Ê£ÄÊü•LPÂáèÊåÅ
    if (lpBalance < lpRewardUserInfo.shares) {
      const reduction = lpRewardUserInfo.shares - lpBalance;
      const reductionPercent = (reduction / lpRewardUserInfo.shares * 100).toFixed(2);
      
      // Ê£ÄÊü•ÊòØÂê¶Âú®30Â§©ÂÜÖ
      const now = Math.floor(Date.now() / 1000);
      const timeSinceActivation = now - lpRewardUserInfo.activeTime;
      const isInFirst30Days = timeSinceActivation < 30 * 86400;
      
      let warningText = `Ê£ÄÊµãÂà∞LPÂáèÊåÅ ${reductionPercent}%Ôºå‰∏ãÊ¨°È¢ÜÂèñÂ∞ÜÊúâ50%ÊÉ©ÁΩö`;
      
      if (isInFirst30Days && lpRewardUserInfo.cleanInFirst30Days) {
        warningText += 'Ôºå‰∏î‰ºöÂ§±ÂéªÊé®ËçêËµÑÊ†º';
      }
      
      document.getElementById('lpWarningText').textContent = warningText;
      warningPanel.style.display = 'flex';
      
      // Ê£ÄÊü•ÂÜ∑Âç¥Êó∂Èó¥
      const timeSinceLastReduce = now - lpRewardUserInfo.lastReduceTime;
      const cooldownRemaining = 86400 - timeSinceLastReduce;
      
      if (cooldownRemaining > 0) {
        document.getElementById('cooldownTime').textContent = Utils.formatTime(cooldownRemaining);
        timerPanel.style.display = 'block';
      } else {
        timerPanel.style.display = 'none';
      }
      
    } else {
      warningPanel.style.display = 'none';
      timerPanel.style.display = 'none';
    }
  },

  updateTimer() {
    if (cooldownInterval) {
      clearInterval(cooldownInterval);
    }
    
    cooldownInterval = setInterval(() => {
      if (!lpRewardUserInfo) return;
      
      const now = Math.floor(Date.now() / 1000);
      const timeSinceLastReduce = now - lpRewardUserInfo.lastReduceTime;
      
      if (timeSinceLastReduce < 86400) {
        const cooldownRemaining = 86400 - timeSinceLastReduce;
        document.getElementById('cooldownTime').textContent = Utils.formatTime(cooldownRemaining);
        document.getElementById('cooldownTimer').style.display = 'block';
      } else {
        document.getElementById('cooldownTimer').style.display = 'none';
      }
      
      // Êõ¥Êñ∞‰∏ãÊ¨°È¢ÜÂèñÊó∂Èó¥
      this.updateRewardInfo();
      
    }, 1000);
  },

  async activateReward() {
    if (!account || !lpRewardContract) {
      Utils.showError(isChinese ? 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ' : 'Please connect wallet first');
      return;
    }
    
    const referrerAddress = document.getElementById('referrerAddress').value.trim();
    let referrer = referrerAddress;
    
    // È™åËØÅÊé®Ëçê‰∫∫Âú∞ÂùÄ
    if (referrer && !Utils.isValidAddress(referrer)) {
      Utils.showError(isChinese ? 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊé®Ëçê‰∫∫Âú∞ÂùÄ' : 'Please enter a valid referrer address');
      return;
    }
    
    // Â¶ÇÊûúÊòØËá™Â∑±ÁöÑÂú∞ÂùÄÊàñÊó†ÊïàÂú∞ÂùÄÔºåËÆæ‰∏∫0Âú∞ÂùÄ
    if (!referrer || referrer.toLowerCase() === account.toLowerCase() || 
        (referrer && !Utils.isValidAddress(referrer))) {
      referrer = ethers.constants.AddressZero;
    }
    
    try {
      Utils.showNotification(isChinese ? 'ÊøÄÊ¥ªLPÂ•ñÂä±‰∏≠...' : 'Activating LP reward...', 'info');
      
      const tx = await lpRewardContract.activate(referrer);
      await tx.wait();
      
      Utils.showNotification(isChinese ? 'ÊøÄÊ¥ªÊàêÂäüÔºÅÁé∞Âú®ÂºÄÂßãËµöÂèñLPÂ•ñÂä±' : 'Activated successfully! Now earning LP rewards', 'success');
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      await this.refreshUserInfo();
      
    } catch (error) {
      console.error('ÊøÄÊ¥ªLPÂ•ñÂä±Â§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async claimReward() {
    if (!account || !lpRewardContract) {
      Utils.showError(isChinese ? 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ' : 'Please connect wallet first');
      return;
    }
    
    try {
      Utils.showNotification(isChinese ? 'È¢ÜÂèñÂ•ñÂä±‰∏≠...' : 'Claiming reward...', 'info');
      
      const tx = await lpRewardContract.claimAll();
      await tx.wait();
      
      Utils.showNotification(isChinese ? 'Â•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ' : 'Reward claimed successfully!', 'success');
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      await this.refreshUserInfo();
      
    } catch (error) {
      console.error('È¢ÜÂèñÂ•ñÂä±Â§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async claimReferralReward() {
    if (!account || !lpRewardContract) {
      Utils.showError(isChinese ? 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ' : 'Please connect wallet first');
      return;
    }
    
    try {
      Utils.showNotification(isChinese ? 'È¢ÜÂèñÊé®ËçêÂ•ñÂä±‰∏≠...' : 'Claiming referral reward...', 'info');
      
      const tx = await lpRewardContract.claimReferral();
      await tx.wait();
      
      Utils.showNotification(isChinese ? 'Êé®ËçêÂ•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ' : 'Referral reward claimed successfully!', 'success');
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      await this.refreshUserInfo();
      
    } catch (error) {
      console.error('È¢ÜÂèñÊé®ËçêÂ•ñÂä±Â§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
    }
  },

  async showActivateConfirmation() {
    if (!account || !lpRewardContractInfo) return;
    
    const modal = document.getElementById('lpRewardActivateModal');
    const requirementsDiv = document.getElementById('lpRewardRequirements');
    const referrerAddress = document.getElementById('referrerAddress').value.trim();
    
    // Ê£ÄÊü•ÊøÄÊ¥ªË¶ÅÊ±Ç
    const requirements = [
      {
        text: isChinese ? 'ËøûÊé•Èí±ÂåÖ' : 'Wallet Connected',
        valid: !!account,
        icon: account ? '‚úì' : '‚úó'
      },
      {
        text: isChinese ? `LP‰ΩôÈ¢ù ‚â• ${lpRewardContractInfo.minActivation} LPT` : `LP Balance ‚â• ${lpRewardContractInfo.minActivation} LPT`,
        valid: lpBalance >= lpRewardContractInfo.minActivation,
        icon: lpBalance >= lpRewardContractInfo.minActivation ? '‚úì' : '‚úó'
      },
      {
        text: isChinese ? 'Êú™ÊøÄÊ¥ªËøáÂ•ñÂä±' : 'Not Activated Before',
        valid: !lpRewardUserInfo || lpRewardUserInfo.shares === 0,
        icon: (!lpRewardUserInfo || lpRewardUserInfo.shares === 0) ? '‚úì' : '‚úó'
      }
    ];
    
    // ÁîüÊàêË¶ÅÊ±ÇÂàóË°®HTML
    requirementsDiv.innerHTML = '';
    requirements.forEach(req => {
      const requirementDiv = document.createElement('div');
      requirementDiv.className = 'lp-reward-activate-requirement';
      
      requirementDiv.innerHTML = `
        <div class="lp-reward-activate-requirement-icon ${req.valid ? 'valid' : 'invalid'}">
          ${req.icon}
        </div>
        <div class="lp-reward-activate-requirement-text">${req.text}</div>
      `;
      
      requirementsDiv.appendChild(requirementDiv);
    });
    
    // Êõ¥Êñ∞ËØ¶ÁªÜ‰ø°ÊÅØ
    document.getElementById('activateLpBalance').textContent = `${Utils.formatDisplay(lpBalance)} LPT`;
    document.getElementById('minActivationRequired').textContent = `${lpRewardContractInfo.minActivation} LPT`;
    document.getElementById('activateReferrerAddress').textContent = 
      referrerAddress && Utils.isValidAddress(referrerAddress) ? 
      Utils.formatAddress(referrerAddress) : 
      (isChinese ? 'Êó†' : 'None');
    
    // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÊøÄÊ¥ª
    const canActivate = requirements.every(req => req.valid);
    document.getElementById('lpRewardActivateConfirmBtn').disabled = !canActivate;
    
    // ÊòæÁ§∫ÂºπÁ™ó
    modal.style.display = 'flex';
    
    // ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂
    const cancelBtn = document.getElementById('lpRewardActivateCancelBtn');
    const confirmBtn = document.getElementById('lpRewardActivateConfirmBtn');
    
    const cleanup = () => {
      cancelBtn.removeEventListener('click', onCancel);
      confirmBtn.removeEventListener('click', onConfirm);
      modal.style.display = 'none';
    };
    
    const onCancel = () => {
      cleanup();
    };
    
    const onConfirm = async () => {
      cleanup();
      await this.activateReward();
    };
    
    cancelBtn.addEventListener('click', onCancel);
    confirmBtn.addEventListener('click', onConfirm);
  }
};

// ==================== ‰ª£Â∏ÅÂ∑•ÂÖ∑Ê®°Âùó ====================
const TokenUtils = {
  getToken(symbol) {
    return TOKEN_LIST.find(t => t.symbol === symbol);
  },

  getTokenDecimals(symbol) {
    const token = this.getToken(symbol);
    return token ? token.decimals : 18;
  },

  getTokenContract(symbol) {
    const tokenContracts = {
      "LOM": lom,
      "USDC": usdc,
      "AXCNH": axcnh,
      "USDT0": usdt0,
      "CNHT0": cnht0
    };
    return tokenContracts[symbol] || null;
  },

  formatTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      const formatted = ethers.utils.formatUnits(amount, decimals);
      return Utils.formatDisplay(formatted);
    } catch {
      return '0.000000';
    }
  },

  parseTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      return ethers.utils.parseUnits(amount.toString(), decimals);
    } catch {
      return ethers.BigNumber.from(0);
    }
  }
};

// ==================== ÊªëÁÇπÁÆ°ÁêÜÂô® ====================
const SlippageManager = {
  calculateRequiredSlippage(fromToken, currentSlippage) {
    return fromToken === 'LOM' ? Math.max(currentSlippage, 5) : currentSlippage;
  },

  calculateMinAmount(amount, slippagePercent) {
    if (!amount || isNaN(amount)) return '0';
    const amountNum = parseFloat(amount);
    const minAmount = amountNum * (1 - slippagePercent / 100);
    return Utils.formatDisplay(minAmount);
  },

  calculateMinAmountBigNumber(amountBN, slippagePercent, decimals) {
    const multiplier = Math.floor(1000 - slippagePercent * 10);
    return amountBN.mul(multiplier).div(1000);
  }
};

// ==================== ‰∫§ÊòìÁÆ°ÁêÜÂô® ====================
const TransactionManager = {
  async executeTransaction(operation) {
    if (transactionLock) {
      Utils.showError(isChinese ? 'Â∑≤Êúâ‰∫§ÊòìÂú®Â§ÑÁêÜ‰∏≠' : 'Transaction already in progress');
      return false;
    }
    
    if (!account) {
      Utils.showError(isChinese ? 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ' : 'Please connect wallet first');
      return false;
    }
    
    transactionLock = true;
    
    try {
      // ÊòæÁ§∫Á°ÆËÆ§ÂØπËØùÊ°Ü
      const confirmed = await ConfirmDialog.show(operation);
      if (!confirmed) {
        transactionLock = false;
        return false;
      }
      
      // ÊâßË°å‰∫§Êòì
      Utils.showNotification(operation.processingMessage, 'info');
      await operation.execute();
      
      // ‰∫§ÊòìÊàêÂäü
      Utils.showNotification(operation.successMessage, 'success');
      await DataManager.refreshAll();
      return true;
      
    } catch (error) {
      console.error('‰∫§ÊòìÂ§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
      return false;
    } finally {
      transactionLock = false;
    }
  },

  async checkAndApprove(tokenContract, spenderAddress, amount) {
    if (!tokenContract || !account) return true;
    
    try {
      const allowance = await tokenContract.allowance(account, spenderAddress);
      if (allowance.lt(amount)) {
        Utils.showNotification(isChinese ? 'ÊéàÊùÉ‰ª£Â∏Å‰∏≠...' : 'Approving token...', 'info');
        const approveTx = await tokenContract.approve(spenderAddress, ethers.constants.MaxUint256);
        await approveTx.wait();
      }
      return true;
    } catch (error) {
      console.error('ÊéàÊùÉÂ§±Ë¥•:', error);
      throw new Error('approval');
    }
  }
};

// ==================== Á°ÆËÆ§ÂØπËØùÊ°ÜÁÆ°ÁêÜÂô® ====================
const ConfirmDialog = {
  async show(operation) {
    return new Promise((resolve) => {
      const modal = document.getElementById('simpleConfirmModal');
      const icon = document.getElementById('simpleConfirmIcon');
      const action = document.getElementById('simpleConfirmAction');
      const amountsDiv = document.getElementById('simpleConfirmAmounts');
      const detailsDiv = document.getElementById('simpleConfirmDetails');
      
      // ËÆæÁΩÆÂÜÖÂÆπ
      icon.textContent = operation.icon;
      action.textContent = operation.title;
      
      // ËÆæÁΩÆÈáëÈ¢ùÊòæÁ§∫
      amountsDiv.innerHTML = this.generateAmountsHTML(operation);
      
      // ËÆæÁΩÆËØ¶ÊÉÖÊòæÁ§∫
      detailsDiv.innerHTML = this.generateDetailsHTML(operation);
      
      // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
      modal.style.display = "flex";
      
      // ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂
      const cancelBtn = document.getElementById('simpleCancelBtn');
      const confirmBtn = document.getElementById('simpleConfirmBtn');
      
      const cleanup = () => {
        cancelBtn.removeEventListener('click', onCancel);
        confirmBtn.removeEventListener('click', onConfirm);
        modal.style.display = 'none';
        if (operation.confirmBtnStyle) {
          confirmBtn.style.background = '';
        }
      };
      
      const onCancel = () => {
        cleanup();
        resolve(false);
      };
      
      const onConfirm = () => {
        cleanup();
        resolve(true);
      };
      
      cancelBtn.addEventListener('click', onCancel);
      confirmBtn.addEventListener('click', onConfirm);
      
      // ËÆæÁΩÆÁ°ÆËÆ§ÊåâÈíÆÊ†∑Âºè
      if (operation.confirmBtnStyle) {
        confirmBtn.style.background = operation.confirmBtnStyle;
      }
    });
  },

  generateAmountsHTML(operation) {
    if (operation.type === 'swap') {
      const fromTokenData = TokenUtils.getToken(operation.fromToken);
      const toTokenData = TokenUtils.getToken(operation.toToken);
      
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${fromTokenData?.logo || ''}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.fromAmount)} ${operation.fromToken}</div>
        </div>
        <div style="font-size: 20px; color: var(--text-secondary);">‚Üì</div>
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${toTokenData?.logo || ''}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.toAmount)} ${operation.toToken}</div>
        </div>
      `;
    } else if (operation.type === 'addLiquidity') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.CFX}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.cfxAmount)} CFX</div>
        </div>
        <div style="font-size: 20px; color: var(--text-secondary);">+</div>
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.lomAmount)} LOM</div>
        </div>
      `;
    } else if (operation.type === 'removeLiquidity') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.CFX}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.cfxEst)} CFX</div>
        </div>
        <div style="font-size: 20px; color: var(--text-secondary);">+</div>
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.lomEst)} LOM</div>
        </div>
      `;
    }
    return '';
  },

  generateDetailsHTML(operation) {
    if (operation.type === 'swap') {
      const price = parseFloat(operation.toAmount) / parseFloat(operation.fromAmount);
      const priceFormatted = Utils.formatDisplay(price);
      const requiredSlippage = SlippageManager.calculateRequiredSlippage(operation.fromToken, operation.slippage);
      const minReceived = SlippageManager.calculateMinAmount(operation.toAmount, requiredSlippage);
      
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Ê±áÁéá' : 'Rate'}</div>
          <div class="confirm-detail-value">1 ${operation.fromToken} = ${priceFormatted} ${operation.toToken}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ÊªëÁÇπ' : 'Slippage'}</div>
          <div class="confirm-detail-value">${requiredSlippage}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ÊúÄ‰ΩéÊî∂Âà∞' : 'Min Received'}</div>
          <div class="confirm-detail-value">${minReceived} ${operation.toToken}</div>
        </div>
      `;
    } else if (operation.type === 'addLiquidity') {
      const ratio = currentRatio > 0 ? currentRatio : (parseFloat(operation.lomAmount) / parseFloat(operation.cfxAmount));
      const ratioFormatted = Utils.formatDisplay(ratio);
      
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? '‰ª∑Ê†ºÊØî‰æã' : 'Price Ratio'}</div>
          <div class="confirm-detail-value">1 CFX = ${ratioFormatted} LOM</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ÊªëÁÇπ' : 'Slippage'}</div>
          <div class="confirm-detail-value">${operation.slippage}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'È¢ÑËÆ°LP' : 'Estimated LP'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(parseFloat(operation.cfxAmount) * 0.5)}</div>
        </div>
      `;
    } else if (operation.type === 'removeLiquidity') {
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ÁßªÈô§ÊØî‰æã' : 'Remove %'}</div>
          <div class="confirm-detail-value">${operation.percent}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ÊªëÁÇπ' : 'Slippage'}</div>
          <div class="confirm-detail-value">${operation.slippage}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'È¢ÑËÆ°Ëé∑Âæó' : 'Est. Receive'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(operation.cfxEst)} CFX</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'È¢ÑËÆ°Ëé∑Âæó' : 'Est. Receive'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(operation.lomEst)} LOM</div>
        </div>
      `;
    }
    return '';
  }
};



// ==================== Èí±ÂåÖÁÆ°ÁêÜÂô® ====================
const WalletManager = {
  async connect() {
    try {
      if (!window.ethereum) {
        Utils.showError(isChinese ? 
          "ËØ∑ÂÆâË£ÖTPÊàñweb3Èí±ÂåÖ" : 
          "Please install TP or WEB3 wallet");
        return false;
      }
      
      const walletBtn = document.getElementById('walletBtn');
      walletBtn.textContent = isChinese ? 'ËøûÊé•‰∏≠...' : 'Connecting...';
      walletBtn.classList.add('connecting');
      
      const accounts = await window.ethereum.request({
        method: 'eth_requestAccounts'
      });
      
      if (!accounts || accounts.length === 0) {
        throw new Error(isChinese ? 'Áî®Êà∑ÊãíÁªùËøûÊé•' : 'User rejected connection');
      }
      
      account = accounts[0];
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      
      await this.checkNetwork();
      this.initContracts();
      this.restoreInviteAddress();
      this.updateUI();
      
      if (refreshInterval) {
        clearInterval(refreshInterval);
      }
      refreshInterval = setInterval(() => {
        DataManager.refreshAll();
        LPRewardManager.refreshUserInfo();
      }, 10000);
      
      Utils.showNotification(
        isChinese ? 'Èí±ÂåÖËøûÊé•ÊàêÂäü' : 'Wallet connected successfully',
        'success'
      );
      
      return true;
    } catch (error) {
      console.error("Èí±ÂåÖËøûÊé•Â§±Ë¥•:", error);
      Utils.showError(
        isChinese ? `ËøûÊé•Â§±Ë¥•: ${error.message}` : `Connection failed: ${error.message}`
      );
      return false;
    } finally {
      this.updateUI();
    }
  },

  async checkNetwork() {
    const network = await provider.getNetwork();
    if (network.chainId !== APP_CONFIG.CHAIN_ID) {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x' + APP_CONFIG.CHAIN_ID.toString(16) }]
        });
      } catch (error) {
        if (error.code === 4902) {
          Utils.showError(isChinese ? 'ËØ∑Ê∑ªÂä†Conflux eSpaceÁΩëÁªú' : 'Please add Conflux eSpace network');
        } else {
          Utils.showError(isChinese ? 'ËØ∑ÂàáÊç¢Âà∞Conflux eSpaceÁΩëÁªú' : 'Please switch to Conflux eSpace network');
        }
        throw error;
      }
    }
  },

  initContracts() {
    router = new ethers.Contract(APP_CONFIG.CONTRACTS.ROUTER, ROUTER_ABI, signer);
    pair = new ethers.Contract(APP_CONFIG.CONTRACTS.PAIR, PAIR_ABI, signer);
    lom = new ethers.Contract(APP_CONFIG.CONTRACTS.LOM, ERC20_ABI, signer);
    usdc = new ethers.Contract(APP_CONFIG.CONTRACTS.USDC, ERC20_ABI, signer);
    axcnh = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH, ERC20_ABI, signer);
    usdt0 = new ethers.Contract(APP_CONFIG.CONTRACTS.USDT0, ERC20_ABI, signer);
    cnht0 = new ethers.Contract(APP_CONFIG.CONTRACTS.CNHT0, ERC20_ABI, signer);
    axcnhUsdt0Pair = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH_USDT0_PAIR, PAIR_ABI, signer);
    
    // ÂàùÂßãÂåñLPÂ•ñÂä±ÂêàÁ∫¶
    LPRewardManager.initContract();
  },

  restoreInviteAddress() {
    if (account && walletInviteMap[account.toLowerCase()]) {
      inviteAddress = walletInviteMap[account.toLowerCase()];
      InviteManager.updateInviteUI();
    } else {
      inviteAddress = '';
      InviteManager.updateInviteUI();
    }
  },

  updateUI() {
    const walletBtn = document.getElementById("walletBtn");
    const swapBtn = document.getElementById("swapBtn");
    
    walletBtn.classList.remove('connecting');
    
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      walletBtn.textContent = displayAddress;
      walletBtn.classList.add('connected');
      swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
      swapBtn.disabled = false;
    } else {
      walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      walletBtn.classList.remove('connected');
      swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      swapBtn.disabled = false;
    }
  },

  disconnect() {
    account = null;
    provider = null;
    signer = null;
    router = null;
    pair = null;
    lom = null;
    usdc = null;
    axcnh = null;
    usdt0 = null;
    cnht0 = null;
    axcnhUsdt0Pair = null;
    lpRewardContract = null;
    
    if (refreshInterval) {
      clearInterval(refreshInterval);
      refreshInterval = null;
    }
    
    if (cooldownInterval) {
      clearInterval(cooldownInterval);
      cooldownInterval = null;
    }
    
    this.updateUI();
    DataManager.resetAllData();
    LPRewardManager.resetUserInfo();
    
    Utils.showNotification(
      isChinese ? "Èí±ÂåÖÂ∑≤Êñ≠ÂºÄËøûÊé•" : "Wallet disconnected",
      'success'
    );
  }
};

// ==================== Êï∞ÊçÆÁÆ°ÁêÜÂô® ====================
const DataManager = {
  async refreshAll() {
    if (!account) return;
    
    try {
      await this.updateAllBalances();
      await this.updatePoolInfo();
      this.updateSwapButtonState();
    } catch (error) {
      console.error('Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•:', error);
    }
  },

  async updateAllBalances() {
    if (!account) return;
    
    try {
      // Ëé∑ÂèñÊâÄÊúâ‰ª£Â∏Å‰ΩôÈ¢ù
      const balancePromises = TOKEN_LIST.map(async (token) => {
        try {
          let balance = 0;
          
          if (token.symbol === 'CFX' && provider) {
            const cfxBal = await provider.getBalance(account);
            balance = parseFloat(ethers.utils.formatEther(cfxBal));
          } else {
            const contract = TokenUtils.getTokenContract(token.symbol);
            if (contract) {
              const tokenBal = await contract.balanceOf(account);
              balance = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
            }
          }
          
          return { symbol: token.symbol, balance };
        } catch (error) {
          console.error(`Ëé∑Âèñ ${token.symbol} ‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
          return { symbol: token.symbol, balance: 0 };
        }
      });
      
      const balances = await Promise.all(balancePromises);
      
      // Êõ¥Êñ∞UIÊòæÁ§∫
      balances.forEach(({ symbol, balance }) => {
        this.updateBalanceUI(symbol, balance);
      });
      
      // Êõ¥Êñ∞ÊµÅÂä®ÊÄßÈ°µÈù¢ÁöÑ‰ΩôÈ¢ùÊòæÁ§∫
      if (lom && provider) {
        const cfxBal = balances.find(b => b.symbol === 'CFX')?.balance || 0;
        const lomBal = balances.find(b => b.symbol === 'LOM')?.balance || 0;
        
        document.getElementById("addCfxBal").textContent = Utils.formatDisplay(cfxBal);
        document.getElementById("addLomBal").textContent = Utils.formatDisplay(lomBal);
      }
      
      // Ê£ÄÊü•ÊòØÂê¶ÊúâLP‰ª£Â∏Å
      if (pair) {
        const lpBal = await pair.balanceOf(account);
        const lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
        document.getElementById("removeBtn").disabled = lpBal.isZero();
        
        // Êõ¥Êñ∞LPÂ•ñÂä±È°µÈù¢ÁöÑLP‰ΩôÈ¢ù
        lpBalance = lpAmt;
        if (document.getElementById('lpRewardTab').classList.contains('active')) {
          LPRewardManager.refreshUserInfo();
        }
      }
      
    } catch (error) {
      console.error("Êõ¥Êñ∞‰ΩôÈ¢ùÂ§±Ë¥•:", error);
    }
  },

  updateBalanceUI(symbol, balance) {
    const formattedBalance = Utils.formatDisplay(balance);
    
    // Êõ¥Êñ∞ÂÖëÊç¢È°µÈù¢ÁöÑ‰ΩôÈ¢ùÊòæÁ§∫
    if (symbol === fromToken) {
      const fromBalEl = document.getElementById('fromBal');
      if (fromBalEl) fromBalEl.textContent = formattedBalance;
    }
    
    if (symbol === toToken) {
      const toBalEl = document.getElementById('toBal');
      if (toBalEl) toBalEl.textContent = formattedBalance;
    }
    
    // Êõ¥Êñ∞‰ª£Â∏ÅÈÄâÊã©Âô®ÁöÑ‰ΩôÈ¢ùÊòæÁ§∫
    const selectorBalanceEl = document.getElementById(`selectorBalance-${symbol}`);
    if (selectorBalanceEl) {
      selectorBalanceEl.textContent = formattedBalance;
    }
  },

  async updatePoolInfo() {
    try {
      if (!pair || !account) return;
      
      const [r0, r1] = await pair.getReserves();
      const t0 = await pair.token0();
      const totalSupply = await pair.totalSupply();
      
      const reserveCfx = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r0 : r1;
      const reserveLom = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r1 : r0;
      
      const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
      const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
      
      currentReserves.cfx = cfxReserve;
      currentReserves.lom = lomReserve;
      
      const price = lomReserve / cfxReserve;
      currentRatio = price;
      
      const priceFormatted = Utils.formatDisplay(price);
      const priceText = isChinese ? 
        `${priceFormatted} LOM` : 
        `${priceFormatted} LOM`;
      document.getElementById("price").textContent = `1 CFX = ${priceText}`;
      document.getElementById("addRatio").textContent = `1 CFX = ${priceFormatted} LOM`;

      const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
      
      let lpAmt = 0;
      let share = 0;
      let userCfx = 0;
      let userLom = 0;
      
      const lpBal = await pair.balanceOf(account);
      lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
      
      if (totalSupplyNum > 0 && lpAmt > 0) {
        share = (lpAmt / totalSupplyNum) * 100;
        userCfx = cfxReserve * (share / 100);
        userLom = lomReserve * (share / 100);
      }
      
      const cfxReserveEl = document.getElementById("cfxReserve");
      const lomReserveEl = document.getElementById("lomReserve");
      
      if (cfxReserveEl) cfxReserveEl.textContent = cfxReserve.toFixed(2);
      if (lomReserveEl) lomReserveEl.textContent = lomReserve.toFixed(2);
      
      const userCfxEl = document.getElementById("userCfx");
      const userLomEl = document.getElementById("userLom");
      const userLpEl = document.getElementById("userLp");
      const userPoolShareEl = document.getElementById("userPoolShare");
      
      if (userCfxEl) userCfxEl.textContent = userCfx.toFixed(2);
      if (userLomEl) userLomEl.textContent = userLom.toFixed(2);
      if (userLpEl) userLpEl.textContent = lpAmt.toFixed(2);
      if (userPoolShareEl) userPoolShareEl.textContent = share.toFixed(4) + "%";
      
      const poolTitle = isChinese ? 
        `CFX-LOMÊµÅÂä®Ê±†` :
        `CFX-LOM Pool`;
      
      const poolInfoTitleEl = document.getElementById("poolInfoTitle");
      if (poolInfoTitleEl) poolInfoTitleEl.textContent = poolTitle;
      
      const removeBtn = document.getElementById("removeBtn");
      if (removeBtn) {
        removeBtn.disabled = lpAmt <= 0;
      }
      
    } catch (error) {
      console.error("Êõ¥Êñ∞Ê±†Â≠ê‰ø°ÊÅØÂ§±Ë¥•:", error);
    }
  },

  updateSwapButtonState() {
    const swapBtn = document.getElementById("swapBtn");
    const fromAmount = document.getElementById("fromAmount").value;
    
    if (!account) {
      swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      swapBtn.disabled = false;
      return;
    }
    
    if (!fromAmount || fromAmount === "0" || fromAmount === "") {
      swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
      swapBtn.disabled = true;
      return;
    }
    
    swapBtn.textContent = isChinese ? "Á´ãÂç≥ÂÖëÊç¢" : "Swap Now";
    swapBtn.disabled = false;
  },

  resetAllData() {
    const elements = {
      'fromBal': '0.000000',
      'toBal': '0.000000',
      'addCfxBal': '0.000000',
      'addLomBal': '0.000000',
      'price': '1 CFX = 0.000000 LOM',
      'minReceived': '0.000000 LOM'
    };
    
    Object.keys(elements).forEach(id => {
      const element = document.getElementById(id);
      if (element) element.textContent = elements[id];
    });
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    document.getElementById("removeBtn").disabled = true;
  }
};

// ==================== ÂÖëÊç¢Ê®°Âùó ====================
const SwapModule = {
  async executeSwap() {
    const fromAmount = document.getElementById('fromAmount').value;
    const toAmount = document.getElementById('toAmount').value;
    
    if (!fromAmount || fromAmount === '0') {
      Utils.showError(isChinese ? "ËØ∑ËæìÂÖ•ÂÖëÊç¢Êï∞Èáè" : "Please enter swap amount");
      return;
    }
    
    const requiredSlippage = SlippageManager.calculateRequiredSlippage(fromToken, slippage);
    
    const operation = {
      type: 'swap',
      icon: 'üîÑ',
      title: isChinese ? 'ÂÖëÊç¢Á°ÆËÆ§' : 'Swap Confirmation',
      fromToken,
      toToken,
      fromAmount: parseFloat(fromAmount),
      toAmount: parseFloat(toAmount),
      slippage: requiredSlippage,
      processingMessage: isChinese ? 'Â§ÑÁêÜÂÖëÊç¢‰∏≠...' : 'Processing swap...',
      successMessage: isChinese ? `ÂÖëÊç¢ÊàêÂäüÔºÅËé∑Âæó ${Utils.formatDisplay(toAmount)} ${toToken}` : 
                                 `Swap successful! Received ${Utils.formatDisplay(toAmount)} ${toToken}`,
      execute: async () => {
        await this.processSwap(fromAmount, toAmount, requiredSlippage);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async processSwap(fromAmount, toAmount, requiredSlippage) {
    const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
    const toDecimals = TokenUtils.getTokenDecimals(toToken);
    
    const amountIn = TokenUtils.parseTokenAmount(fromAmount, fromToken);
    const path = this.getSwapPath();
    
    if (!router) {
      throw new Error('Ë∑ØÁî±Âô®ÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
    }
    
    const amounts = await router.getAmountsOut(amountIn, path);
    const minOut = SlippageManager.calculateMinAmountBigNumber(
      amounts[amounts.length - 1], 
      requiredSlippage, 
      toDecimals
    );
    
    const deadline = Math.floor(Date.now() / 1000) + 1200;
    
    let tx;
    
    if (fromToken === "CFX") {
      tx = await router.swapExactETHForTokensSupportingFeeOnTransferTokens(
        minOut, path, account, deadline, 
        { value: amountIn }
      );
    } else if (toToken === "CFX") {
      const tokenContract = TokenUtils.getTokenContract(fromToken);
      if (!tokenContract) throw new Error('‰ª£Â∏ÅÂêàÁ∫¶Êú™ÊâæÂà∞');
      
      await TransactionManager.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
      
      tx = await router.swapExactTokensForETHSupportingFeeOnTransferTokens(
        amountIn, minOut, path, account, deadline
      );
    } else {
      const tokenContract = TokenUtils.getTokenContract(fromToken);
      if (!tokenContract) throw new Error('‰ª£Â∏ÅÂêàÁ∫¶Êú™ÊâæÂà∞');
      
      await TransactionManager.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
      
      tx = await router.swapExactTokensForTokensSupportingFeeOnTransferTokens(
        amountIn, minOut, path, account, deadline
      );
    }
    
    await tx.wait();
    document.getElementById('fromAmount').value = '';
    document.getElementById('toAmount').value = '';
  },

  getSwapPath() {
    let path = [];
    
    // 1. È¶ñÂÖàÂ§ÑÁêÜÁõ¥Êé•‰∫§ÊòìÂØπ AxCNH ‚Üî USDT0
    if ((fromToken === 'AXCNH' && toToken === 'USDT0') || 
        (fromToken === 'USDT0' && toToken === 'AXCNH')) {
      
      if (fromToken === 'AXCNH') {
        path.push(APP_CONFIG.CONTRACTS.AXCNH);
        path.push(APP_CONFIG.CONTRACTS.USDT0);
      } else {
        path.push(APP_CONFIG.CONTRACTS.USDT0);
        path.push(APP_CONFIG.CONTRACTS.AXCNH);
      }
      return path;
    }
    
    // 2. Â§ÑÁêÜÊ∂âÂèäCFXÁöÑ‰∫§Êòì
    if (fromToken === 'CFX') {
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    } else if (toToken === 'CFX') {
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      path.push(APP_CONFIG.CONTRACTS.WCFX);
    } else {
      // 3. ÂÖ∂‰ªñ‰ª£Â∏Å‰πãÈó¥ÁöÑ‰∫§ÊòìÔºàÈÄöËøáCFX‰∏≠ËΩ¨Ôºâ
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    }
    
    return path;
  },

  async updateOutputFromInput() {
    const amount = document.getElementById('fromAmount').value;
    
    if (!amount || amount === '0' || amount === '' || !router) {
      document.getElementById('toAmount').value = "";
      document.getElementById('minReceived').textContent = `0 ${toToken}`;
      DataManager.updateSwapButtonState();
      return;
    }
    
    try {
      const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
      const toDecimals = TokenUtils.getTokenDecimals(toToken);
      
      const amountIn = TokenUtils.parseTokenAmount(amount, fromToken);
      const path = this.getSwapPath();
      
      const amounts = await router.getAmountsOut(amountIn, path);
      const out = TokenUtils.formatTokenAmount(amounts[amounts.length - 1], toToken);
      
      document.getElementById('toAmount').value = out;
      
      const requiredSlippage = SlippageManager.calculateRequiredSlippage(fromToken, slippage);
      const minOut = SlippageManager.calculateMinAmountBigNumber(
        amounts[amounts.length - 1], 
        requiredSlippage, 
        toDecimals
      );
      
      const minOutFormatted = TokenUtils.formatTokenAmount(minOut, toToken);
      document.getElementById('minReceived').textContent = 
        `${minOutFormatted} ${toToken}`;
      
      const price = parseFloat(out) / parseFloat(amount);
      const priceFormatted = Utils.formatDisplay(price);
      document.getElementById('price').textContent = 
        `1 ${fromToken} = ${priceFormatted} ${toToken}`;
      
      if (fromToken === 'LOM' && slippage < 5) {
        this.showLOMSlippageWarning();
      } else {
        this.hideLOMSlippageWarning();
      }
      
      DataManager.updateSwapButtonState();
      
    } catch (error) {
      console.error('ËÆ°ÁÆóËæìÂá∫Â§±Ë¥•:', error);
      document.getElementById('toAmount').value = "";
      document.getElementById('swapBtn').textContent = isChinese ? 'ËÆ°ÁÆóÂ§±Ë¥•' : 'Calculation Failed';
      document.getElementById('swapBtn').disabled = true;
    }
  },

  showLOMSlippageWarning() {
    const existingWarning = document.querySelector('.lom-slippage-warning');
    if (existingWarning) return;
    
    const warningElement = document.createElement('div');
    warningElement.className = 'error-box lom-slippage-warning';
    warningElement.innerHTML = `
      <span class="error-icon">‚ö†Ô∏è</span>
      <span>LOM‰∫§ÊòìÈúÄË¶Å5%‰ª•‰∏äÊªëÁÇπ‰ª•ÈÅøÂÖç‰∫§ÊòìÂ§±Ë¥•</span>
    `;
    
    const swapDetails = document.querySelector('.swap-details');
    if (swapDetails) {
      swapDetails.parentNode.insertBefore(warningElement, swapDetails);
    }
  },

  hideLOMSlippageWarning() {
    const existingWarning = document.querySelector('.lom-slippage-warning');
    if (existingWarning) {
      existingWarning.remove();
    }
  },

  reverseTokens() {
    const tempToken = fromToken;
    fromToken = toToken;
    toToken = tempToken;
    
    document.getElementById("fromTokenSymbol").textContent = fromToken;
    document.getElementById("toTokenSymbol").textContent = toToken;
    
    const fromTokenData = TokenUtils.getToken(fromToken);
    const toTokenData = TokenUtils.getToken(toToken);
    
    if (fromTokenData) {
      document.getElementById("fromTokenLogo").style.backgroundImage = `url('${fromTokenData.logo}')`;
    }
    
    if (toTokenData) {
      document.getElementById("toTokenLogo").style.backgroundImage = `url('${toTokenData.logo}')`;
    }
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    
    DataManager.updateAllBalances();
    DataManager.updateSwapButtonState();
    document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
    
    lastInputWasFrom = true;
    this.hideLOMSlippageWarning();
  },

  handlePercentageClick(percent) {
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    let balance = parseFloat(document.getElementById("fromBal").textContent);
    
    if (balance > 0) {
      let amount;
      
      if (percent === 1) {
        if (fromToken === 'CFX') {
          amount = Math.max(0, balance - 0.1);
        } else {
          amount = balance * 0.9;
        }
      } else {
        amount = balance * percent;
      }
      
      if (amount > 0) {
        document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
        lastInputWasFrom = true;
        this.updateOutputFromInput();
      }
    }
  }
};

// ==================== ÊµÅÂä®ÊÄßÊ®°Âùó ====================
const LiquidityModule = {
  async addLiquidity() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    
    if (!cfxAmount || !lomAmount || parseFloat(cfxAmount) <= 0 || parseFloat(lomAmount) <= 0) {
      Utils.showError(isChinese ? "ËØ∑ËæìÂÖ•ÊúâÊïàÊï∞Èáè" : "Please enter valid amounts");
      return;
    }
    
    const operation = {
      type: 'addLiquidity',
      icon: 'üíß',
      title: isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄß' : 'Add Liquidity',
      cfxAmount: parseFloat(cfxAmount),
      lomAmount: parseFloat(lomAmount),
      slippage: slippage,
      processingMessage: isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄß‰∏≠...' : 'Adding liquidity...',
      successMessage: isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄßÊàêÂäüÔºÅ' : 'Liquidity added successfully!',
      execute: async () => {
        await this.executeAddLiquidity(cfxAmount, lomAmount);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async executeAddLiquidity(cfxAmount, lomAmount) {
    const amountCfx = TokenUtils.parseTokenAmount(cfxAmount, 'CFX');
    const amountLom = TokenUtils.parseTokenAmount(lomAmount, 'LOM');
    
    if (!lom || !router) {
      throw new Error('ÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
    }
    
    await TransactionManager.checkAndApprove(lom, APP_CONFIG.CONTRACTS.ROUTER, amountLom);
    
    const minCfx = SlippageManager.calculateMinAmountBigNumber(amountCfx, slippage, 18);
    const minLom = SlippageManager.calculateMinAmountBigNumber(amountLom, slippage, 18);
    const deadline = Math.floor(Date.now() / 1000) + 1800;
    
    const tx = await router.addLiquidityETH(
      APP_CONFIG.CONTRACTS.LOM,
      amountLom,
      minLom,
      minCfx,
      account,
      deadline,
      { value: amountCfx }
    );
    
    await tx.wait();
    document.getElementById("addModal").style.display = "none";
    document.getElementById("addCfx").value = "";
    document.getElementById("addLom").value = "";
  },

  async removeLiquidity() {
    const percent = document.getElementById("removeSlider").value;
    const cfxEst = document.getElementById("removeEstCfx").textContent;
    const lomEst = document.getElementById("removeEstLom").textContent;
    
    const operation = {
      type: 'removeLiquidity',
      icon: 'üî•',
      title: isChinese ? 'ÁßªÈô§ÊµÅÂä®ÊÄß' : 'Remove Liquidity',
      cfxEst: parseFloat(cfxEst),
      lomEst: parseFloat(lomEst),
      percent: parseFloat(percent),
      slippage: slippage,
      processingMessage: isChinese ? 'ÁßªÈô§ÊµÅÂä®ÊÄß‰∏≠...' : 'Removing liquidity...',
      successMessage: isChinese ? `ÁßªÈô§ÊµÅÂä®ÊÄßÊàêÂäüÔºÅËé∑Âæó ${cfxEst} CFX Âíå ${lomEst} LOM` : 
                                 `Success! Received ${cfxEst} CFX and ${lomEst} LOM`,
      confirmBtnStyle: 'var(--gradient-red)',
      execute: async () => {
        await this.executeRemoveLiquidity(percent);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async executeRemoveLiquidity(percent) {
    if (!pair || !router) {
      throw new Error('ÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
    }
    
    const lpBal = await pair.balanceOf(account);
    const liquidity = lpBal.mul(percent).div(100);
    
    if (liquidity.isZero()) {
      throw new Error(isChinese ? 'Ê≤°ÊúâÊµÅÂä®ÊÄßÂèØÁßªÈô§' : 'No liquidity to remove');
    }
    
    await TransactionManager.checkAndApprove(pair, APP_CONFIG.CONTRACTS.ROUTER, liquidity);
    
    const deadline = Math.floor(Date.now() / 1000) + 1800;
    
    const tx = await router.removeLiquidityETH(
      APP_CONFIG.CONTRACTS.LOM, 
      liquidity, 
      0,
      0,
      account, 
      deadline
    );
    
    await tx.wait();
    document.getElementById("removeModal").style.display = "none";
  },

  async updateRemoveEstimate(percent) {
    try {
      if (!account || !pair) return;
      
      document.getElementById("removePercent").textContent = percent + "%";
      
      const lpBal = await pair.balanceOf(account);
      const liquidity = lpBal.mul(percent).div(100);
      
      if (liquidity.isZero()) {
        document.getElementById("removeEstCfx").textContent = "0.000000";
        document.getElementById("removeEstLom").textContent = "0.000000";
        return;
      }
      
      const total = await pair.totalSupply();
      const { cfx: rCfx, lom: rLom } = currentReserves;
      
      const cfxReserve = TokenUtils.parseTokenAmount(rCfx.toString(), 'CFX');
      const lomReserve = TokenUtils.parseTokenAmount(rLom.toString(), 'LOM');
      
      const cfxOut = cfxReserve.mul(liquidity).div(total);
      const lomOut = lomReserve.mul(liquidity).div(total);
      
      const cfxOutFormatted = TokenUtils.formatTokenAmount(cfxOut, 'CFX');
      const lomOutFormatted = TokenUtils.formatTokenAmount(lomOut, 'LOM');
      
      document.getElementById("removeEstCfx").textContent = cfxOutFormatted;
      document.getElementById("removeEstLom").textContent = lomOutFormatted;
      
    } catch (error) {
      console.error("Êõ¥Êñ∞ÁßªÈô§‰º∞ÁÆóÂ§±Ë¥•:", error);
      document.getElementById("removeEstCfx").textContent = "0.000000";
      document.getElementById("removeEstLom").textContent = "0.000000";
    }
  },

  handleCfxInput() {
    const cfxAmount = document.getElementById("addCfx").value;
    
    if (!cfxAmount || cfxAmount === "" || parseFloat(cfxAmount) <= 0) {
      document.getElementById("addLom").value = "";
      document.getElementById("confirmAddBtn").disabled = true;
      return;
    }
    
    if (currentRatio > 0) {
      const cfxNum = parseFloat(cfxAmount);
      const lomAmount = cfxNum * currentRatio;
      document.getElementById("addLom").value = Utils.formatDisplay(lomAmount);
    }
    
    this.updateAddButtonState();
  },

  handleLomInput() {
    const lomAmount = document.getElementById("addLom").value;
    
    if (!lomAmount || lomAmount === "" || parseFloat(lomAmount) <= 0) {
      document.getElementById("addCfx").value = "";
      document.getElementById("confirmAddBtn").disabled = true;
      return;
    }
    
    if (currentRatio > 0) {
      const lomNum = parseFloat(lomAmount);
      const cfxAmount = lomNum / currentRatio;
      document.getElementById("addCfx").value = Utils.formatDisplay(cfxAmount);
    }
    
    this.updateAddButtonState();
  },

  updateAddButtonState() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    const cfxBalance = parseFloat(document.getElementById("addCfxBal").textContent);
    const lomBalance = parseFloat(document.getElementById("addLomBal").textContent);
    const confirmButton = document.getElementById("confirmAddBtn");
    
    if (!cfxAmount || !lomAmount || cfxAmount === "" || lomAmount === "") {
      confirmButton.disabled = true;
      return;
    }
    
    const cfxNum = parseFloat(cfxAmount);
    const lomNum = parseFloat(lomAmount);
    
    if (isNaN(cfxNum) || isNaN(lomNum) || cfxNum <= 0 || lomNum <= 0) {
      confirmButton.disabled = true;
      return;
    }
    
    if (cfxNum > cfxBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    if (lomNum > lomBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    const remainingCfx = cfxBalance - cfxNum;
    if (remainingCfx < 0.01) {
      confirmButton.disabled = true;
      return;
    }
    
    confirmButton.disabled = false;
  },

  async setMaxCfx() {
    const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
    if (cfxBal <= 0) {
      Utils.showError(isChinese ? "CFX‰ΩôÈ¢ù‰∏çË∂≥" : "Insufficient CFX balance");
      return;
    }
    
    const maxCfx = Math.max(0, cfxBal - 0.1);
    document.getElementById("addCfx").value = Utils.formatDisplay(maxCfx);
    
    if (currentRatio > 0) {
      const requiredLom = maxCfx * currentRatio;
      const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
      
      if (requiredLom <= lomBal) {
        document.getElementById("addLom").value = Utils.formatDisplay(requiredLom);
      } else {
        const adjustedCfx = lomBal / currentRatio;
        document.getElementById("addCfx").value = Utils.formatDisplay(Math.min(adjustedCfx, maxCfx));
        document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
      }
    }
    
    this.updateAddButtonState();
  },

  async setMaxLom() {
    const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
    if (lomBal <= 0) {
      Utils.showError(isChinese ? "LOM‰ΩôÈ¢ù‰∏çË∂≥" : "Insufficient LOM balance");
      return;
    }
    
    document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
    
    if (currentRatio > 0) {
      const requiredCfx = lomBal / currentRatio;
      const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
      const availableCfx = Math.max(0, cfxBal - 0.1);
      
      if (requiredCfx <= availableCfx) {
        document.getElementById("addCfx").value = Utils.formatDisplay(requiredCfx);
      } else {
        const adjustedLom = availableCfx * currentRatio;
        document.getElementById("addLom").value = Utils.formatDisplay(Math.min(adjustedLom, lomBal));
        document.getElementById("addCfx").value = Utils.formatDisplay(availableCfx);
      }
    }
    
    this.updateAddButtonState();
  }
};

// ==================== ÁïåÈù¢ÁÆ°ÁêÜÂô® ====================
const UIManager = {
  init() {
    this.setupEventListeners();
    this.setupTabs();
    this.updateAllTexts();
    this.setupFocusEffects();
    
    document.getElementById('txStatusDoneBtn').addEventListener('click', () => {
      Utils.hideNotification();
    });
    
    InviteManager.updateInviteUI();
    this.showFooterAndRiskWarning();
  },

  setupEventListeners() {
    // Èí±ÂåÖÂíåËØ≠Ë®ÄÊåâÈíÆ
    document.getElementById("walletBtn").addEventListener("click", () => this.handleWalletClick());
    document.getElementById("langBtn").addEventListener("click", () => this.toggleLanguage());
    
    // ÂÖëÊç¢È°µÈù¢‰∫ã‰ª∂
    const debouncedFromInput = Utils.debounce(() => this.handleFromAmountInput(), 300);
    document.getElementById("fromAmount").addEventListener("input", debouncedFromInput);
    
    document.getElementById("reverse").addEventListener("click", () => SwapModule.reverseTokens());
    document.getElementById("swapBtn").addEventListener("click", async () => {
      if (!account) {
        await this.handleWalletClick();
      } else {
        await SwapModule.executeSwap();
      }
    });
    
    // ÁôæÂàÜÊØîÊåâÈíÆ
    document.querySelectorAll('.percent-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.handlePercentageClick(e));
    });
    
    // ÊªëÁÇπÊåâÈíÆ
    document.querySelectorAll('.slippage-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.handleSlippageClick(e));
    });
    
    // ‰ª£Â∏ÅÈÄâÊã©Âô®
    document.getElementById("fromTokenSelector").addEventListener("click", () => this.openTokenSelector('from'));
    document.getElementById("toTokenSelector").addEventListener("click", () => this.openTokenSelector('to'));
    
    // ÊµÅÂä®ÊÄßÈ°µÈù¢‰∫ã‰ª∂
    document.getElementById("addBtn").addEventListener("click", () => this.openAddModal());
    document.getElementById("removeBtn").addEventListener("click", () => this.openRemoveModal());
    
    // LPÂ•ñÂä±È°µÈù¢‰∫ã‰ª∂
    document.getElementById("activateBtn").addEventListener("click", () => LPRewardManager.showActivateConfirmation());
    document.getElementById("claimBtn").addEventListener("click", () => LPRewardManager.claimReward());
    document.getElementById("claimReferralBtn").addEventListener("click", () => LPRewardManager.claimReferralReward());
    
    // ÈÇÄËØ∑Á≥ªÁªü‰∫ã‰ª∂
    document.getElementById("bindInviteBtn").addEventListener("click", () => InviteManager.bindInviteAddress());
    document.getElementById("unlockInviteBtn").addEventListener("click", () => InviteManager.unbindInviteAddress());
    document.getElementById("goToStakeLocked").addEventListener("click", () => InviteManager.goToStaking());
    
    // Ê®°ÊÄÅÊ°ÜÂÖ≥Èó≠‰∫ã‰ª∂
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("modal-overlay") || 
          e.target.classList.contains("token-selector-modal") ||
          e.target.classList.contains("lp-reward-activate-modal")) {
        e.target.style.display = "none";
      }
    });
    
    // Ê∑ªÂä†ÊµÅÂä®ÊÄß‰∫ã‰ª∂
    const debouncedCfxInput = Utils.debounce(() => LiquidityModule.handleCfxInput(), 300);
    const debouncedLomInput = Utils.debounce(() => LiquidityModule.handleLomInput(), 300);
    document.getElementById("addCfx").addEventListener("input", debouncedCfxInput);
    document.getElementById("addLom").addEventListener("input", debouncedLomInput);
    document.getElementById("cfxMaxBtn").addEventListener("click", () => LiquidityModule.setMaxCfx());
    document.getElementById("lomMaxBtn").addEventListener("click", () => LiquidityModule.setMaxLom());
    document.getElementById("cancelAddBtn").addEventListener("click", () => document.getElementById("addModal").style.display = "none");
    document.getElementById("confirmAddBtn").addEventListener("click", () => LiquidityModule.addLiquidity());
    
    // ÁßªÈô§ÊµÅÂä®ÊÄß‰∫ã‰ª∂
    document.getElementById("removeSlider").addEventListener("input", (e) => LiquidityModule.updateRemoveEstimate(e.target.value));
    document.querySelectorAll('.percentage-option').forEach(btn => {
      btn.addEventListener('click', (e) => this.handlePercentageOption(e));
    });
    document.getElementById("cancelRemoveBtn").addEventListener("click", () => document.getElementById("removeModal").style.display = "none");
    document.getElementById("confirmRemoveBtn").addEventListener("click", () => LiquidityModule.removeLiquidity());
    
    // ‰ΩôÈ¢ùÁÇπÂáª‰∫ã‰ª∂
    document.getElementById("fromBal").addEventListener("click", () => {
      this.setMaxFromBalance();
    });
    
    // ÈÇÄËØ∑ËæìÂÖ•‰∫ã‰ª∂
    document.getElementById("inviteAddress").addEventListener("input", (e) => {
      const errorText = document.getElementById('inviteErrorText');
      e.target.classList.remove('invite-input-error');
      errorText.classList.remove('show');
    });
  },

  showFooterAndRiskWarning() {
    const riskWarning = document.getElementById('riskWarning');
    const footer = document.getElementById('footerText');
    
    if (riskWarning) riskWarning.style.display = 'block';
    if (footer) footer.style.display = 'block';
  },

  async handleWalletClick() {
    if (account) {
      const confirmMessage = isChinese ? 
        "Á°ÆÂÆöË¶ÅÊñ≠ÂºÄÈí±ÂåÖËøûÊé•ÂêóÔºü" : 
        "Are you sure you want to disconnect wallet?";
      
      if (confirm(confirmMessage)) {
        WalletManager.disconnect();
      }
      return;
    }
    
    document.getElementById("walletBtn").disabled = true;
    
    try {
      const success = await WalletManager.connect();
      if (success) {
        WalletManager.updateUI();
        DataManager.refreshAll();
        LPRewardManager.refreshUserInfo();
      }
    } catch (error) {
      console.error("Èí±ÂåÖËøûÊé•Â§±Ë¥•:", error);
    } finally {
      document.getElementById("walletBtn").disabled = false;
      WalletManager.updateUI();
    }
  },

  setupTabs() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;
        
        tabBtns.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(tabId + 'Tab').classList.add('active');
        
        if (account) {
          DataManager.refreshAll();
          if (tabId === 'lpReward') {
            LPRewardManager.refreshUserInfo();
          }
        }
      });
    });
  },

  handleFromAmountInput() {
    const amount = document.getElementById("fromAmount").value;
    if (amount && amount !== "0") {
      lastInputWasFrom = true;
      SwapModule.updateOutputFromInput();
    } else {
      document.getElementById("toAmount").value = "";
      DataManager.updateSwapButtonState();
      document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
      SwapModule.hideLOMSlippageWarning();
    }
  },

  handlePercentageClick(e) {
    const percent = parseFloat(e.target.dataset.percent);
    
    document.querySelectorAll('.percent-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    SwapModule.handlePercentageClick(percent);
  },

  handleSlippageClick(e) {
    const newSlippage = parseFloat(e.target.dataset.slip);
    
    if (fromToken === 'LOM' && newSlippage < 5) {
      Utils.showNotification(
        isChinese ? 'LOM‰∫§ÊòìÈúÄË¶Å5%‰ª•‰∏äÊªëÁÇπ‰ª•ÈÅøÂÖç‰∫§ÊòìÂ§±Ë¥•' : 
                  'LOM transactions require 5%+ slippage to avoid failure',
        'warning'
      );
    }
    
    slippage = newSlippage;
    document.querySelectorAll('.slippage-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    if (lastInputWasFrom && document.getElementById("fromAmount").value) {
      SwapModule.updateOutputFromInput();
    }
  },

  handlePercentageOption(e) {
    const percent = e.target.dataset.percent;
    document.querySelectorAll('.percentage-option').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    document.getElementById("removeSlider").value = percent;
    document.getElementById("removePercent").textContent = percent + "%";
    LiquidityModule.updateRemoveEstimate(percent);
  },

  openTokenSelector(type) {
    currentTokenSelector = type;
    const modal = document.getElementById("tokenSelectorModal");
    modal.style.display = "flex";
    document.getElementById("tokenSearch").value = "";
    this.populateTokenList();
  },

  async populateTokenList(searchTerm = "") {
    const tokenList = document.getElementById("tokenList");
    tokenList.innerHTML = "";
    
    const filteredTokens = TOKEN_LIST.filter(token => {
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        return token.symbol.toLowerCase().includes(term) || 
               token.name.toLowerCase().includes(term);
      }
      return true;
    });
    
    const fragment = document.createDocumentFragment();
    
    filteredTokens.forEach(token => {
      if ((currentTokenSelector === 'from' && token.symbol === toToken) ||
          (currentTokenSelector === 'to' && token.symbol === fromToken)) {
        return;
      }
      
      const tokenItem = document.createElement("div");
      tokenItem.className = "token-item";
      tokenItem.innerHTML = `
        <div class="token-item-logo" style="background-image: url('${token.logo}')"></div>
        <div class="token-item-info">
          <div class="token-item-symbol">${token.symbol}</div>
          <div class="token-item-name">${token.name}</div>
        </div>
        <div class="token-item-balance" id="selectorBalance-${token.symbol}">0.000000</div>
      `;
      
      tokenItem.addEventListener("click", () => {
        this.selectToken(token);
      });
      
      fragment.appendChild(tokenItem);
    });
    
    tokenList.appendChild(fragment);
    
    // ÂºÇÊ≠•Êõ¥Êñ∞‰ΩôÈ¢ù
    setTimeout(() => {
      if (account) {
        filteredTokens.forEach(token => {
          this.updateTokenBalanceInSelector(token.symbol);
        });
      }
    }, 50);
    
    // ËÆæÁΩÆÊêúÁ¥¢‰∫ã‰ª∂
    const searchInput = document.getElementById("tokenSearch");
    const debouncedSearch = Utils.debounce((e) => {
      this.populateTokenList(e.target.value);
    }, 300);
    
    searchInput.removeEventListener('input', this.handleSearchInput);
    this.handleSearchInput = debouncedSearch;
    searchInput.addEventListener('input', this.handleSearchInput);
    
    setTimeout(() => searchInput.focus(), 100);
  },

  handleSearchInput: null,

  async updateTokenBalanceInSelector(symbol) {
    try {
      const token = TokenUtils.getToken(symbol);
      if (!token) return;
      
      let amount = 0;
      
      if (symbol === 'CFX' && provider && account) {
        const cfxBal = await provider.getBalance(account);
        amount = parseFloat(ethers.utils.formatEther(cfxBal));
      } else {
        const contract = TokenUtils.getTokenContract(symbol);
        if (contract && account) {
          const tokenBal = await contract.balanceOf(account);
          amount = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
        }
      }
      
      const formattedBalance = Utils.formatDisplay(amount);
      
      const balanceElement = document.getElementById(`selectorBalance-${symbol}`);
      if (balanceElement) {
        balanceElement.textContent = formattedBalance;
      }
    } catch (error) {
      console.error(`Êõ¥Êñ∞${symbol}‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
    }
  },

  selectToken(token) {
    if (currentTokenSelector === 'from') {
      fromToken = token.symbol;
      document.getElementById("fromTokenSymbol").textContent = token.symbol;
      document.getElementById("fromTokenLogo").style.backgroundImage = `url('${token.logo}')`;
    } else if (currentTokenSelector === 'to') {
      toToken = token.symbol;
      document.getElementById("toTokenSymbol").textContent = token.symbol;
      document.getElementById("toTokenLogo").style.backgroundImage = `url('${token.logo}')`;
    }
    
    document.getElementById("tokenSelectorModal").style.display = "none";
    DataManager.updateAllBalances();
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    
    DataManager.updateSwapButtonState();
    document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
    
    SwapModule.hideLOMSlippageWarning();
  },

  async setMaxFromBalance() {
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    let balance = parseFloat(document.getElementById("fromBal").textContent);
    
    if (balance > 0) {
      let amount;
      
      if (fromToken === 'CFX') {
        amount = Math.max(0, balance - 0.1);
      } else {
        amount = balance * 0.9;
      }
      
      if (amount > 0) {
        document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
        lastInputWasFrom = true;
        await SwapModule.updateOutputFromInput();
      }
    }
  },

  toggleLanguage() {
    isChinese = !isChinese;
    document.getElementById("langBtn").innerText = isChinese ? "EN" : "ZN";
    this.updateAllTexts();
    InviteManager.updateInviteTexts();
    this.updateLPRewardTexts();
  },

  updateAllTexts() {
    const walletBtn = document.getElementById("walletBtn");
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      walletBtn.textContent = displayAddress;
      walletBtn.classList.add('connected');
    } else {
      walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      walletBtn.classList.remove('connected');
    }
    
    document.querySelector('[data-tab="swap"]').textContent = isChinese ? "ÂÖëÊç¢" : "Swap";
    document.querySelector('[data-tab="liquidity"]').textContent = isChinese ? "ÊµÅÂä®ÊÄß" : "Liquidity";
    document.querySelector('[data-tab="lpReward"]').textContent = isChinese ? "LPÂ•ñÂä±" : "LP Reward";
    
    const swapBtn = document.getElementById("swapBtn");
    if (!account) {
      swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      swapBtn.disabled = false;
    } else if (document.getElementById("fromAmount").value && document.getElementById("fromAmount").value !== "0") {
      swapBtn.textContent = isChinese ? "Á´ãÂç≥ÂÖëÊç¢" : "Swap Now";
      swapBtn.disabled = false;
    } else {
      swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
      swapBtn.disabled = true;
    }
    
    document.getElementById("addBtn").textContent = isChinese ? "Ê∑ªÂä†ÊµÅÂä®ÊÄß" : "Add Liquidity";
    document.getElementById("removeBtn").textContent = isChinese ? "ÁßªÈô§ÊµÅÂä®ÊÄß" : "Remove Liquidity";
    
    document.getElementById("tokenSelectorTitle").textContent = isChinese ? "ÈÄâÊã©‰ª£Â∏Å" : "Select Token";
    document.getElementById("addTitle").textContent = isChinese ? "Ê∑ªÂä†ÊµÅÂä®ÊÄß" : "Add Liquidity";
    document.getElementById("removeTitle").textContent = isChinese ? "ÁßªÈô§ÊµÅÂä®ÊÄß" : "Remove Liquidity";
    document.getElementById("confirmAddBtn").textContent = isChinese ? "Á°ÆËÆ§Ê∑ªÂä†" : "Confirm Add";
    document.getElementById("confirmRemoveBtn").textContent = isChinese ? "Á°ÆËÆ§ÁßªÈô§" : "Confirm Remove";
    document.getElementById("cancelAddBtn").textContent = isChinese ? "ÂèñÊ∂à" : "Cancel";
    document.getElementById("cancelRemoveBtn").textContent = isChinese ? "ÂèñÊ∂à" : "Cancel";
    
    document.getElementById("riskTitle").textContent = isChinese ? "È£éÈô©ÊèêÁ§∫" : "Risk Warning";
    document.getElementById("riskText").textContent = isChinese ? 
      "Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ" :
      "This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.";
    
    document.getElementById("footerText").textContent = isChinese ? "LOMswap ¬∑ Conflux eSpace" : "LOMswap ¬∑ Conflux eSpace";
  },

  updateLPRewardTexts() {
    if (isChinese) {
      // Âç°ÁâáÊ†áÈ¢ò
      document.querySelector('#lpRewardTab .card-title span:nth-child(2)').textContent = 'LPÊåÅÂ∏ÅÂ•ñÂä±';
      
      // Èù¢ÊùøÊ†áÈ¢ò
      const panelTitles = document.querySelectorAll('.lp-reward-card-title span:nth-child(2)');
      if (panelTitles.length >= 4) {
        panelTitles[0].textContent = 'ÊøÄÊ¥ªÁä∂ÊÄÅ';
        panelTitles[1].textContent = 'LPÊåÅ‰ªì';
        panelTitles[2].textContent = 'ÊåÅÊúâÊó∂Èïø';
        panelTitles[3].textContent = 'Â•ñÂä±ÂÄçÁéá';
      }
      
      // ÁªüËÆ°Ê†áÁ≠æ
      const statLabels = document.querySelectorAll('.lp-reward-stat-label span:nth-child(2)');
      if (statLabels.length >= 4) {
        statLabels[0].textContent = 'ÂæÖÈ¢ÜÂèñÂ•ñÂä±';
        statLabels[1].textContent = 'ÊØèÊó•È¢Ñ‰º∞Êî∂Áõä';
        statLabels[2].textContent = '‰∏ãÊ¨°È¢ÜÂèñÊó∂Èó¥';
        statLabels[3].textContent = 'Êé®ËçêÂ•ñÂä±';
      }
      
      // ÂÄçÁéáÂ§©Êï∞
      document.querySelector('#multiplier30d .lp-reward-multiplier-days').textContent = '30Â§©';
      document.querySelector('#multiplier90d .lp-reward-multiplier-days').textContent = '90Â§©';
      document.querySelector('#multiplier180d .lp-reward-multiplier-days').textContent = '180Â§©';
      document.querySelector('#multiplier360d .lp-reward-multiplier-days').textContent = '360Â§©';
      
      // ÊåâÈíÆÊñáÊú¨
      document.querySelector('#activateBtn span:nth-child(2)').textContent = 'ÊøÄÊ¥ªÂ•ñÂä±';
      document.querySelector('#claimBtn span:nth-child(2)').textContent = 'È¢ÜÂèñÂ•ñÂä±';
      document.querySelector('#claimReferralBtn span:nth-child(2)').textContent = 'È¢ÜÂèñÊé®Ëçê';
      
      // Êé®ËçêÁ≥ªÁªü
      document.querySelector('.lp-reward-referral-title').textContent = 'Êé®ËçêÁ≥ªÁªü';
      document.getElementById('referrerAddress').placeholder = 'ËæìÂÖ•Êé®Ëçê‰∫∫Âú∞ÂùÄ (ÂèØÈÄâ)';
      document.querySelector('.lp-reward-referral-info').textContent = 'ÁªëÂÆöÊé®Ëçê‰∫∫ÂèØ‰∫´ÂèóÈ¢ùÂ§ñ5%Â•ñÂä±Âä†ÊàêÔºåÊé®ËçêÂ•ñÂä±ÈîÅÂÆö30Â§©';
      
      // Â∏ÆÂä©‰ø°ÊÅØ
      document.querySelector('.lp-reward-help-title span:nth-child(2)').textContent = 'ÈáçË¶ÅÊèêÁ§∫';
      const helpItems = document.querySelectorAll('.lp-reward-help-item span:nth-child(2)');
      if (helpItems.length >= 5) {
        helpItems[0].textContent = 'ÊåÅÊúâÊó∂ÈïøË∂äÈïøÔºåÂ•ñÂä±ÂÄçÁéáË∂äÈ´òÔºàÊúÄÈ´ò3ÂÄçÔºâ';
        helpItems[1].textContent = '30Â§©ÂÜÖÂáèÊåÅLPÂ∞ÜÂ§±ÂéªÊé®ËçêËµÑÊ†º';
        helpItems[2].textContent = 'ÂáèÊåÅÊúâ50%ÊÉ©ÁΩöÔºåÂçïÊ¨°ÊúÄÂ§öÂáèÊåÅ30%';
        helpItems[3].textContent = 'ÂáèÊåÅÂêéÈúÄÁ≠âÂæÖ24Â∞èÊó∂ÂÜ∑Âç¥';
        helpItems[4].textContent = 'ÊØè7Â§©ÂèØÈ¢ÜÂèñ‰∏ÄÊ¨°Â•ñÂä±';
      }
      
      // ÂºπÁ™óÊñáÊú¨
      document.getElementById('lpRewardActivateTitle').textContent = 'ÊøÄÊ¥ªLPÂ•ñÂä±';
      document.getElementById('lpRewardActivateMessage').textContent = 'ËØ∑Á°ÆËÆ§ÊøÄÊ¥ª‰ø°ÊÅØÔºåÊøÄÊ¥ªÂêéÂç≥ÂèØÂºÄÂßãËµöÂèñLPÊåÅÂ∏ÅÂ•ñÂä±';
      document.querySelector('#lpRewardActivateCancelBtn').textContent = 'ÂèñÊ∂à';
      document.querySelector('#lpRewardActivateConfirmBtn').textContent = 'Á°ÆËÆ§ÊøÄÊ¥ª';
      
    } else {
      // Ëã±ÊñáÁøªËØë
      document.querySelector('#lpRewardTab .card-title span:nth-child(2)').textContent = 'LP Holding Reward';
      
      const panelTitles = document.querySelectorAll('.lp-reward-card-title span:nth-child(2)');
      if (panelTitles.length >= 4) {
        panelTitles[0].textContent = 'Activation Status';
        panelTitles[1].textContent = 'LP Balance';
        panelTitles[2].textContent = 'Days Held';
        panelTitles[3].textContent = 'Reward Multiplier';
      }
      
      const statLabels = document.querySelectorAll('.lp-reward-stat-label span:nth-child(2)');
      if (statLabels.length >= 4) {
        statLabels[0].textContent = 'Pending Reward';
        statLabels[1].textContent = 'Daily Estimate';
        statLabels[2].textContent = 'Next Claim Time';
        statLabels[3].textContent = 'Referral Reward';
      }
      
      document.querySelector('#multiplier30d .lp-reward-multiplier-days').textContent = '30 Days';
      document.querySelector('#multiplier90d .lp-reward-multiplier-days').textContent = '90 Days';
      document.querySelector('#multiplier180d .lp-reward-multiplier-days').textContent = '180 Days';
      document.querySelector('#multiplier360d .lp-reward-multiplier-days').textContent = '360 Days';
      
      document.querySelector('#activateBtn span:nth-child(2)').textContent = 'Activate';
      document.querySelector('#claimBtn span:nth-child(2)').textContent = 'Claim Reward';
      document.querySelector('#claimReferralBtn span:nth-child(2)').textContent = 'Claim Referral';
      
      document.querySelector('.lp-reward-referral-title').textContent = 'Referral System';
      document.getElementById('referrerAddress').placeholder = 'Enter referrer address (optional)';
      document.querySelector('.lp-reward-referral-info').textContent = 'Bind a referrer to enjoy extra 5% reward bonus, referral rewards locked for 30 days';
      
      document.querySelector('.lp-reward-help-title span:nth-child(2)').textContent = 'Important Notes';
      const helpItems = document.querySelectorAll('.lp-reward-help-item span:nth-child(2)');
      if (helpItems.length >= 5) {
        helpItems[0].textContent = 'Longer holding period = higher reward multiplier (up to 3x)';
        helpItems[1].textContent = 'LP reduction within 30 days loses referral eligibility';
        helpItems[2].textContent = '50% penalty for reduction, max 30% per reduction';
        helpItems[3].textContent = '24-hour cooldown after reduction';
        helpItems[4].textContent = 'Can claim rewards every 7 days';
      }
      
      document.getElementById('lpRewardActivateTitle').textContent = 'Activate LP Reward';
      document.getElementById('lpRewardActivateMessage').textContent = 'Please confirm activation details to start earning LP holding rewards';
      document.querySelector('#lpRewardActivateCancelBtn').textContent = 'Cancel';
      document.querySelector('#lpRewardActivateConfirmBtn').textContent = 'Confirm Activation';
    }
  },

  openAddModal() {
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    document.getElementById("addModal").style.display = "flex";
    document.getElementById("addCfx").value = "";
    document.getElementById("addLom").value = "";
    document.getElementById("confirmAddBtn").disabled = true;
    
    if (currentRatio > 0) {
      const ratioFormatted = Utils.formatDisplay(currentRatio);
      document.getElementById("addRatio").textContent = `1 CFX = ${ratioFormatted} LOM`;
    }
  },

  openRemoveModal() {
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    document.getElementById("removeModal").style.display = "flex";
    LiquidityModule.updateRemoveEstimate(100);
  },

  setupFocusEffects() {
    const fromInput = document.getElementById("fromAmount");
    const toInput = document.getElementById("toAmount");
    const fromWrapper = document.getElementById("fromTokenWrapper");
    const toWrapper = document.getElementById("toTokenWrapper");
    
    fromInput.addEventListener('focus', () => {
      fromWrapper.classList.add('focused');
    });
    
    fromInput.addEventListener('blur', () => {
      fromWrapper.classList.remove('focused');
    });
    
    toInput.addEventListener('focus', () => {
      toWrapper.classList.add('focused');
    });
    
    toInput.addEventListener('blur', () => {
      toWrapper.classList.remove('focused');
    });
  }
};

// ==================== ÂàùÂßãÂåñÂ∫îÁî® ====================
document.addEventListener('DOMContentLoaded', function() {
  UIManager.init();
  
  if (window.ethereum) {
    window.ethereum.on('accountsChanged', (accounts) => {
      if (accounts.length === 0) {
        WalletManager.disconnect();
      } else {
        account = accounts[0];
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        WalletManager.initContracts();
        WalletManager.restoreInviteAddress();
        WalletManager.updateUI();
        DataManager.refreshAll();
        LPRewardManager.refreshUserInfo();
        if (!refreshInterval) {
          refreshInterval = setInterval(() => {
            DataManager.refreshAll();
            if (document.getElementById('lpRewardTab').classList.contains('active')) {
              LPRewardManager.refreshUserInfo();
            }
          }, 10000);
        }
      }
    });
    
    window.ethereum.on('chainChanged', () => {
      location.reload();
    });
    
    window.ethereum.on('disconnect', () => {
      WalletManager.disconnect();
    });
  }
});
</script>       
</body>
</html>
