<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap</title>
  
  <!-- æ”¶è—å›¾æ ‡å’Œç¤¾äº¤åª’ä½“æ ‡ç­¾ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <!-- Open Graph æ ‡ç­¾ï¼Œç”¨äºç¤¾äº¤åª’ä½“åˆ†äº« -->
  <meta property="og:title" content="LOMswap - Conflux å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€">
  <meta property="og:description" content="åœ¨ Conflux eSpace ä¸Šäº¤æ˜“ LOM ä»£å¸">
  <meta property="og:image" content="https://i.imgur.com/HddyTrv.jpeg">
  <meta property="og:url" content="https://lom-dex.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- å®‰å…¨ç­–ç•¥ (ä¼˜åŒ–ç‰ˆæœ¬) -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self' https:;
                 script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https://i.imgur.com data:;
                 connect-src 'self' https://*.confluxrpc.com wss: blob:;
                 font-src 'self' data:;
                 frame-src 'none';
                 object-src 'none';">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== åŸºç¡€æ ·å¼ ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== é¡¹ç›®ä»‹ç»å¼¹çª— ========== */
    .project-intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .project-intro-overlay.show {
      display: flex;
    }
    
    .project-intro-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
      position: relative;
      animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .project-intro-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .project-intro-logo {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 3px solid var(--accent-yellow);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    }
    
    .project-intro-title {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 10px;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-subtitle {
      font-size: 18px;
      color: var(--accent-yellow);
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .project-intro-slogan {
      font-size: 14px;
      color: var(--text-secondary);
      font-style: italic;
    }
    
    .project-intro-content {
      margin-bottom: 25px;
    }
    
    .project-intro-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 215, 0, 0.2);
    }
    
    .project-intro-section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      color: var(--accent-yellow);
      font-size: 18px;
      font-weight: 700;
    }
    
    .project-intro-section-icon {
      font-size: 24px;
    }
    
    .project-intro-section-content {
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 15px;
    }
    
    .project-intro-section-content ul {
      padding-left: 20px;
      margin-top: 10px;
    }
    
    .project-intro-section-content li {
      margin-bottom: 8px;
      position: relative;
    }
    
    .project-intro-section-content li:before {
      content: "âœ“";
      color: var(--success);
      font-weight: bold;
      position: absolute;
      left: -20px;
    }
    
    .project-intro-features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 20px 0;
    }
    
    .project-intro-feature {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-feature-icon {
      font-size: 20px;
      margin-bottom: 8px;
      display: block;
    }
    
    .project-intro-feature-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .project-intro-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }
    
    .project-intro-close-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: var(--accent-yellow);
      transform: rotate(90deg);
    }
    
    .project-intro-footer {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .project-intro-footer-text {
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.5;
    }
    
    /* ========== å¤´éƒ¨æ ·å¼ä¼˜åŒ– ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
      position: relative;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-container:hover {
      transform: translateY(-2px);
    }
    
    .logo-img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .wallet-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      width: auto;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
      max-width: 220px;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 0;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
     #walletBtn {
      min-width: 110px !important;
      max-width: 110px !important;
      width: 110px !important;
   }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      max-width: 40px;
      max-height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ========== æ ‡ç­¾é¡µæ ·å¼ ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== å¡ç‰‡æ ·å¼ ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    /* ========== äº¤æ˜“ç•Œé¢æ ·å¼ ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      position: relative;
      margin-bottom: 6px;
    }
    
    .token-input-wrapper.focused {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      position: relative;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
      transform: translateY(-4px);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
       margin-bottom: -4px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
      transform: translateY(-1px);
    }
    
    .token-logo {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      margin-bottom: 12px;
      justify-content: flex-end;
    }
    
    .percent-btn {
      flex: none;
      width: 40px;
      padding: 6px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      text-align: right;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
      padding: 0;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }

    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: -6px 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
  background: transparent; /* é€æ˜èƒŒæ™¯ */
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  color: var(--text-secondary); /* æ”¹ä¸ºæ¬¡è¦æ–‡å­—é¢œè‰² */
  z-index: 2;
}
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4);
    }
    
    .swap-arrow-btn:active {
      transform: rotate(180deg) scale(0.95);
    }
    
    /* ========== äº¤æ˜“è¯¦æƒ… ========== */
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
      font-size: 12px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .detail-value.positive {
      color: var(--success);
    }
    
    .detail-value.negative {
      color: var(--warning);
    }
    
    /* ========== æ»‘ç‚¹æ§åˆ¶ ========== */
    .slippage-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }
    
    .slippage-options {
      display: flex;
      gap: 4px;
    }
    
    .slippage-btn {
      padding: 4px 8px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 35px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    /* ========== ä¸»æ“ä½œæŒ‰é’® ========== */
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:active {
      transform: translateY(0);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========== æµåŠ¨æ€§é¡µé¢æ ·å¼ ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stat-value-large {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stat-value-large.positive {
      color: var(--accent-yellow);
    }
    
    .position-actions {
      display: flex;
      gap: 8px;
    }
    
    .position-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    /* ========== è´¨æŠ¼å¡ç‰‡ ========== */
    .stake-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .stake-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--accent-yellow);
      margin-bottom: 8px;
    }
    
    .stake-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      line-height: 1.4;
    }
    
    .stake-apr {
      font-size: 28px;
      font-weight: bold;
      color: var(--text-primary);
      margin-bottom: 16px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* ========== é‚€è¯·ç³»ç»Ÿ - ä¼˜åŒ– ========== */
    .invite-section {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      margin: 12px 0;
    }
    
    .invite-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .invite-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    .invite-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .invite-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 16px;
      line-height: 1.4;
      text-align: center;
    }
    
    .invite-input-container {
      position: relative;
      margin-bottom: 12px;
    }
    
    .invite-input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
      transition: all 0.3s ease;
    }
    
    .invite-input:focus {
      border-color: var(--accent-yellow);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1);
    }
    
    .invite-input::placeholder {
      color: var(--text-muted);
    }
    
    .invite-input-error {
      border-color: var(--accent-red) !important;
      background: rgba(255, 71, 87, 0.05) !important;
    }
    
    .invite-error-text {
      color: var(--accent-red);
      font-size: 11px;
      margin-top: 4px;
      display: none;
    }
    
    .invite-error-text.show {
      display: block;
    }
    
    .invite-benefits {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .benefit-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .benefit-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .benefit-item {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }
    
    .benefit-item:last-child {
      margin-bottom: 0;
    }
    
    .benefit-icon {
      color: var(--success);
      font-size: 10px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .invite-note {
      font-size: 11px;
      color: var(--text-secondary);
      text-align: center;
      margin-top: 10px;
      line-height: 1.4;
      padding: 8px;
      background: rgba(255, 215, 0, 0.05);
      border-radius: 6px;
      border: 1px dashed rgba(255, 215, 0, 0.3);
    }
    
    .invite-note-icon {
      color: var(--accent-yellow);
      font-size: 12px;
      margin-right: 4px;
    }
    
    .invite-locked {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid var(--success);
      margin: 12px 0;
      animation: fadeIn 0.5s ease;
    }
    
    .invite-locked-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .invite-locked-text {
      font-size: 14px;
      color: var(--success);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .locked-icon {
      font-size: 16px;
    }
    
    .invite-address-container {
      background: rgba(46, 160, 67, 0.15);
      border-radius: 10px;
      padding: 12px;
      margin: 12px 0;
      text-align: center;
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .invite-address-label {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    
    .invite-address {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      word-break: break-all;
      padding: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .invite-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    
    .invite-action-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .unlock-btn {
      background: rgba(255, 215, 0, 0.1);
      color: var(--accent-yellow);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .stake-btn {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .invite-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    /* ========== è´¨æŠ¼æŒ‰é’®æ ·å¼ ========== */
    .stake-lp-button {
      background: var(--gradient-yellow);
      color: #0f172a;
      font-weight: 700;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 12px;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .stake-lp-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.4);
    }
    
    .stake-lp-button:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========== æ¨¡æ€æ¡†æ ·å¼ ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .modal-input-group {
      margin-bottom: 12px;
    }
    
    .modal-input-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .modal-input:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    /* ========== ä»£å¸é€‰æ‹©å™¨ ========== */
    .token-selector-modal {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .token-selector-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .token-search {
      width: 100%;
      padding: 10px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 12px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .token-search:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-search:hover {
      border-color: var(--accent-yellow);
    }
    
    .token-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .token-item:hover {
      background: rgba(26, 115, 232, 0.1);
      transform: translateX(4px);
    }
    
    .token-item-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease;
    }
    
    .token-item:hover .token-item-logo {
      transform: scale(1.1);
    }
    
    .token-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .token-item-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.2s ease;
    }
    
    .token-item:hover .token-item-symbol {
      color: var(--accent-yellow);
    }
    
    .token-item-name {
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-item-balance {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    
    /* ========== äº¤æ˜“çŠ¶æ€æç¤º ========== */
    .transaction-status {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--gradient-primary);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(26, 115, 232, 0.4);
      z-index: 3000;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 90%;
      text-align: center;
    }
    
    .transaction-status.show {
      transform: translateX(-50%) translateY(0);
    }
    
    .transaction-status.success {
      background: var(--gradient-green);
    }
    
    .transaction-status.error {
      background: var(--gradient-red);
    }
    
    /* ========== é£é™©æç¤ºå’Œé¡µè„š ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 11px;
      color: var(--text-primary);
      line-height: 1.5;
      position: relative;
      overflow: hidden;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 12px;
      opacity: 0.7;
    }
    
    /* ========== åŠ¨ç”» ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== åŠ è½½åŠ¨ç”» ========== */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    .loading-spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }
    
    .loading-spinner.white {
      border-color: rgba(255, 255, 255, 0.3);
      border-top-color: white;
    }
    
    /* ========== å“åº”å¼è°ƒæ•´ ========== */
    @media (max-width: 480px) {
      .app {
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 14px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 44px;
        height: 44px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .header-buttons {
        min-width: 150px;
        max-width: 180px;
      }
      
      #walletBtn {
        min-width: 120px;
        max-width: 140px;
        padding: 8px 12px;
        font-size: 12px;
        height: 36px;
      }
      
      #langBtn {
        width: 36px;
        height: 36px;
        min-width: 36px;
        min-height: 36px;
        max-width: 36px;
        max-height: 36px;
        font-size: 12px;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .modal-card {
        padding: 16px;
      }
      
      .transaction-status {
        bottom: 60px;
      }
      
      .invite-actions {
        flex-direction: column;
      }
      
      .invite-action-btn {
        width: 100%;
      }
      
      .project-intro-card {
        padding: 20px;
      }
      
      .project-intro-title {
        font-size: 24px;
      }
      
      .project-intro-features {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 380px) {
      .logo-text {
        font-size: 16px;
      }
      
      .logo-img {
        width: 36px;
        height: 36px;
      }
      
      .header-buttons {
        min-width: 130px;
        max-width: 150px;
      }
      
      #walletBtn {
        min-width: 100px;
        max-width: 120px;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      #langBtn {
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        max-width: 32px;
        max-height: 32px;
      }
    }
    
    /* ========== ç§»é™¤æµåŠ¨æ€§å¼¹çª— ========== */
    .remove-liquidity-modal .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .remove-percentage {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: var(--text-primary);
      margin: 8px 0;
    }
    
    .percentage-slider {
      width: 100%;
      margin: 16px 0;
      -webkit-appearance: none;
      height: 6px;
      background: rgba(26, 115, 232, 0.1);
      border-radius: 3px;
      outline: none;
    }
    
    .percentage-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
    }
    
    .percentage-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    
    .percentage-option {
      padding: 8px;
      text-align: center;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-option:hover {
      border-color: var(--primary-blue);
    }
    
    .percentage-option.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .remove-estimate {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .remove-estimate-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .remove-estimate-amounts {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .remove-estimate-amount {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .token-amount-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 15px;
    }
    
    /* ========== ç®€å•ç¡®è®¤å¯¹è¯æ¡† ========== */
    .simple-confirm-modal .modal-card {
      max-width: 350px;
    }
    
    .confirm-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .confirm-icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
    }
    
    .confirm-action {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .confirm-amounts {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 16px 0;
    }
    
    .confirm-amount-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .confirm-amount-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .confirm-amount-text {
      font-size: 20px;
      font-weight: bold;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .confirm-details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    
    .confirm-detail-item {
      text-align: left;
      padding: 8px;
      background: rgba(26, 115, 232, 0.05);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .confirm-detail-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .confirm-detail-value {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .confirm-actions-simple {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .confirm-action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }
    
    .confirm-action-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .confirm-action-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    .confirm-action-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    .confirm-action-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* ========== äº¤æ˜“çŠ¶æ€æç¤º ========== */
    .tx-status-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 4000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .tx-status-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      max-width: 350px;
      text-align: center;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .tx-status-icon {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tx-status-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .tx-status-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .tx-status-done-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
    }
    
    .tx-status-done-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    /* ========== é”™è¯¯æç¤ºæ¡† ========== */
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 10px 14px;
      margin: 10px 0;
      font-size: 12px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .error-icon {
      display: inline-block;
      margin-right: 6px;
    }
    
    /* ========== é‚€è¯·ç¡®è®¤å¯¹è¯æ¡† ========== */
    .invite-confirm-modal .modal-card {
      max-width: 380px;
      text-align: center;
    }
    
    .invite-confirm-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--accent-yellow);
    }
    
    .invite-confirm-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 12px;
      color: var(--text-primary);
    }
    
    .invite-confirm-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .invite-confirm-details {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin: 20px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
      text-align: left;
    }
    
    .invite-confirm-detail {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .invite-confirm-detail:last-child {
      border-bottom: none;
    }
    
    .invite-confirm-label {
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .invite-confirm-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .invite-confirm-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .invite-confirm-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
    }
    
    .invite-confirm-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .invite-confirm-btn.confirm {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .invite-confirm-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
  </style>
</head>
<body>
  <!-- é¡¹ç›®ä»‹ç»å¼¹çª— -->
  <div class="project-intro-overlay" id="projectIntroOverlay">
    <div class="project-intro-card">
      <button class="project-intro-close-btn" id="projectIntroCloseBtn">Ã—</button>
      
      <div class="project-intro-header">
        <div class="project-intro-logo"></div>
        <h1 class="project-intro-title">é¾™è„‰ LOM</h1>
        <div class="project-intro-subtitle">Conflux.ç”Ÿæ€æ ¸å¿ƒèµ„äº§</div>
        <div class="project-intro-slogan">å…±è¯†åˆ›é€ ä»·å€¼</div>
      </div>
      
      <div class="project-intro-content">
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">ğŸ‰</span>
            <span>å…³äºé¾™è„‰LOM</span>
          </div>
          <div class="project-intro-section-content">
               <p> é¾™è„‰LOMçµæ„Ÿæºè‡ªä¸­å›½ä¼ ç»Ÿæ–‡åŒ–ä¸­çš„"é¾™è„‰"æ¦‚å¿µï¼Œè±¡å¾ç€è´¢å¯Œã€ç¹è£å’Œèƒ½é‡çš„æµåŠ¨.æ˜¯æ·±åº¦èµ‹èƒ½ä¸­å›½å”¯ä¸€åˆè§„å…¬é“¾â€”â€”æ ‘å›¾ï¼ˆConfluxï¼‰çš„ç”Ÿæ€æ ¸å¿ƒèµ„äº§ï¼Œæ›´æ˜¯é“¾æ¥å…¬é“¾ä»·å€¼ã€ç”¨æˆ·æ”¶ç›Šä¸ç”Ÿæ€ç¹è£çš„å…³é”®çº½å¸¦ï¼Œä¾æ‰˜å…¬é“¾ä¼˜åŠ¿æ„å»ºä¸“å±ä»·å€¼é—­ç¯ï¼Œä¸ºå‚ä¸è€…å¸¦æ¥ç¡®å®šæ€§å›æŠ¥ã€‚<p>
 
     <p>ä½œä¸ºæ ‘å›¾å…¬é“¾çš„èµ‹èƒ½è½½ä½“ï¼ŒLOMæ·±åº¦ç»‘å®šå…¬é“¾æ ¸å¿ƒä¼˜åŠ¿ï¼šè¿™æ¡ç”±æ¸…åå›¢é˜Ÿæ‰“é€ çš„â€œconfluxæ•°å­—é¾™è„‰â€ï¼Œä»¥åˆè§„ä¸ºæ ¹ï¼Œä¸²è”40å›½èŠ‚ç‚¹ä¸â€œä¸€å¸¦ä¸€è·¯â€è·¨å¢ƒåœºæ™¯ï¼Œæ›´å…¼å®¹ä»¥å¤ªåŠç”Ÿæ€ã€‚ä»RWAèµ„äº§ä¸Šé“¾åˆ°ç¨³å®šå¸ç»“ç®—ï¼Œå®ƒæ­£ä»¥è‡ªä¸»å¯æ§çš„æŠ€æœ¯åº•æ°”ï¼Œæ‰¿æ¥å…¨çƒWeb3.0çˆ†å‘æµªæ½®ï¼Œè®©ä¸­å›½å…¬é“¾åŠ›é‡è´¯é€šæ•°å­—æœªæ¥ã€‚15000TPSè¶…é«˜æ€§èƒ½ã€26ç§’æé€Ÿç¡®è®¤çš„æŠ€æœ¯åº•åº§ï¼Œä»¥åŠ5000+å…¨çƒèŠ‚ç‚¹ã€2500ä¸‡ç”¨æˆ·çš„æˆç†Ÿç”Ÿæ€ï¼Œè®©æ¯ä¸€ä»½LOMè´¨æŠ¼éƒ½èƒ½ä¾æ‰˜å…¬é“¾åˆè§„èµ„è´¨ä¸çœŸå®åº”ç”¨åœºæ™¯ï¼Œå®ç°ä»·å€¼é”šå®šä¸ç¨³æ­¥å¢é•¿ã€‚<p>
 
   <p>å…¶æ ¸å¿ƒä»·å€¼èšç„¦é”å®šè´¨æŠ¼+äºŒä»£å¥–åŠ±çš„ç”Ÿæ€æ¿€åŠ±æœºåˆ¶ï¼Œç²¾å‡†åŒ¹é…æ ‘å›¾å…¬é“¾å‘å±•éœ€æ±‚ï¼šç”¨æˆ·é€šè¿‡é”å®šLOMå‚ä¸è´¨æŠ¼ï¼Œä¸ä»…èƒ½æ·±åº¦äº«å—æ ‘å›¾å…¬é“¾ç”Ÿæ€æ‰©å¼ ã€æŠ€æœ¯å‡çº§å¸¦æ¥çš„é•¿æœŸè´¨æŠ¼æ”¶ç›Šï¼Œæ›´èƒ½ä¾æ‰˜â€œèµ‹èƒ½å…¬é“¾â€çš„æ ¸å¿ƒå®šä½ï¼Œé€šè¿‡é‚€è¯·åˆ†äº«è§£é”ä¸°åšäºŒä»£å¥–åŠ±ï¼Œè®©æ”¶ç›Šéšç”Ÿæ€è¾å°„æŒç»­æ”¾å¤§ã€‚<p>è¿™ç§æ¨¡å¼æ—¢ä¸ºæ ‘å›¾å…¬é“¾æ³¨å…¥ç¨³å®šçš„ç”Ÿæ€åŠ¨åŠ›ï¼Œä¹Ÿè®©ç”¨æˆ·æˆä¸ºå…¬é“¾å‘å±•çš„ç›´æ¥å—ç›Šè€…ï¼Œå®ç°â€œè´¨æŠ¼äº«çº¢åˆ©ï¼Œåˆ†äº«èµšå¥–åŠ±â€çš„åŒé‡ä»·å€¼ã€‚<p>
  
            <ul>
              <li><strong>æ€»ä¾›åº”é‡</strong>ï¼š88888888æšï¼ˆæ°¸ä¸å¢å‘ï¼‰</li>
              <li><strong>åº•å±‚æŠ€æœ¯</strong>ï¼šåŸºäºConflux eSpaceæ™ºèƒ½åˆçº¦</li>
              <li><strong>æ²»ç†æ¨¡å¼</strong>ï¼šå®Œå…¨å»ä¸­å¿ƒåŒ–ï¼Œç¤¾åŒºé©±åŠ¨</li>
              <li><strong>ç»æµæ¨¡å‹</strong>ï¼šé€šç¼©æœºåˆ¶ + æµåŠ¨æ€§æ¿€åŠ±</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-features">
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">âš¡</span>
            <div class="project-intro-feature-text">æ€»é‡ç¨€ç¼º</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">ğŸ›¡ï¸</span>
            <div class="project-intro-feature-text">å»ä¸­å¿ƒåŒ–</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">ğŸ“ˆ</span>
            <div class="project-intro-feature-text">é«˜æ”¶ç›Šç‡</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">ğŸŒ</span>
            <div class="project-intro-feature-text">å…¨çƒäº¤æ˜“</div>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">ğŸ¯</span>
            <span>æ ¸å¿ƒä»·å€¼</span>
          </div>
          <div class="project-intro-section-content">
            <ul>
              <li><strong>ä»·å€¼å­˜å‚¨</strong>ï¼šæ·±åº¦ç»‘å®šå…¬é“¾ä»·å€¼ç¡®ä¿ä»·å€¼å¢é•¿</li>
              <li><strong>æµåŠ¨æ€§æ ¸å¿ƒ</strong>ï¼šä½œä¸ºDEXäº¤æ˜“å¯¹çš„åŸºå‡†èµ„äº§</li>
              <li><strong>æ²»ç†æƒç›Š</strong>ï¼šæŒæœ‰è€…å…±åŒå‚ä¸ç”Ÿæ€æ²»ç†å†³ç­–</li>
              <li><strong>æ”¶ç›Šç”Ÿæˆ</strong>ï¼šé€šè¿‡è´¨æŠ¼å’ŒæµåŠ¨æ€§æŒ–çŸ¿è·å¾—æ”¶ç›Š</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">ğŸš€</span>
            <span>LOMswapåŠŸèƒ½</span>
          </div>
          <div class="project-intro-section-content">
            <p>åœ¨LOMswapä¸Šï¼Œæ‚¨å¯ä»¥ï¼š</p>
            <ul>
              <li><strong>å…‘æ¢äº¤æ˜“</strong>ï¼šåœ¨CFX-LOM-USDC-USDT0-AxCNHä¹‹é—´å¿«é€Ÿå…‘æ¢</li>
              <li><strong>æä¾›æµåŠ¨æ€§</strong>ï¼šæ·»åŠ CFX-LOMæµåŠ¨æ€§èµšå–æ‰‹ç»­è´¹</li>
              <li><strong>è´¨æŠ¼æŒ–çŸ¿</strong>ï¼šè´¨æŠ¼é”ä»“LPä»£å¸è·å¾—é«˜è¾¾45.8%å¹´åŒ–æ”¶ç›Š</li>
              <li><strong>é‚€è¯·å¥–åŠ±</strong>ï¼šé‚€è¯·å¥½å‹å‚ä¸è´¨æŠ¼è·å¾—äºŒçº§é¢å¤–æ”¶ç›ŠåŠ æˆ</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="project-intro-footer">
        <div class="project-intro-footer-text">
          ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿å·²å®‰è£…TPæˆ–web3é’±åŒ…ï¼Œå¹¶åˆ‡æ¢åˆ°Conflux eSpaceç½‘ç»œï¼ˆChainID: 1030ï¼‰
        </div>
      </div>
    </div>
  </div>

  <!-- åŸæœ‰åº”ç”¨ç•Œé¢ -->
  <div class="app">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <div class="logo-container" id="logoContainer">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">è¿æ¥é’±åŒ…</button>
      </div>
    </div>

    <!-- æ ‡ç­¾é¡µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">å…‘æ¢</button>
        <button class="tab-btn" data-tab="liquidity">æµåŠ¨æ€§</button>
      </div>
    </div>

    <!-- å…‘æ¢é¡µé¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- è¾“å…¥ä»£å¸ -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- äº¤æ¢ç®­å¤´ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">ğŸ”ƒ</button>
          </div>

          <!-- è¾“å‡ºä»£å¸ -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- é”™è¯¯æç¤ºæ¡† -->
          <div class="error-box" id="swapErrorBox">
            <span class="error-icon">âš ï¸</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- äº¤æ˜“è¯¦æƒ… -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">æ»‘ç‚¹å®¹å·®</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
                <button class="slippage-btn" data-slip="10">10%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">æœ€ä½æ”¶åˆ°</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">è·¯ç”±</span>
              <span class="detail-value" id="routeInfo">CFX â†’ LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼å½±å“</span>
              <span class="detail-value positive" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- äº¤æ˜“æŒ‰é’® -->
          <button class="main-action-btn" id="swapBtn">è¿æ¥é’±åŒ…</button>
        </div>
      </div>
    </div>
    
    <!-- æµåŠ¨æ€§é¡µé¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">ğŸ’§</span>
          <span id="poolInfoTitle">CFX-LOM æ± </span>
        </div>

        <div class="liquidity-summary">
          <!-- æ± å­ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small" id="cfxReserveLabel">CFX å‚¨å¤‡</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small" id="lomReserveLabel">LOM å‚¨å¤‡</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- æˆ‘çš„æµåŠ¨æ± è¯¦æƒ… -->
          <div class="user-position" style="background: var(--gradient-card); border-radius: 12px; padding: 16px; margin-top: 16px; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);" id="myPositionTitle">æˆ‘çš„æµåŠ¨æ± </div>
              <div style="font-size: 12px; color: var(--text-secondary);" id="positionValue">$0.00</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myCfxLabel">æˆ‘çš„CFX</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userCfx">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLomLabel">æˆ‘çš„LOM</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userLom">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLpLabel">æˆ‘çš„LPä»£å¸</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);" id="userLp">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myShareLabel">æ± å­ä»½é¢</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--success);" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">æ·»åŠ æµåŠ¨æ€§</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ç§»é™¤æµåŠ¨æ€§</button>
          </div>
        </div>
        </div>
        <!-- è´¨æŠ¼å†œåœº - ä¼˜åŒ–ç‰ˆæœ¬ -->
        <div class="stake-card">
          <div class="stake-title">è´¨æŠ¼LPèµšå–æ”¶ç›Š</div>
          <div class="stake-description">
            å°†æ‚¨çš„LPä»£å¸è´¨æŠ¼åˆ°å†œåœºä¸­ï¼Œèµšå–é¢å¤–çš„å¥–åŠ±ä»£å¸ã€‚å¹´åŒ–æ”¶ç›Šç‡é«˜è¾¾ï¼š
          </div>
          <div class="stake-apr">45.8% APY</div>
          
          <!-- é‚€è¯·ç³»ç»Ÿ -->
          <div id="inviteSection">
            <!-- æœªç»‘å®šé‚€è¯·åœ°å€ -->
            <div class="invite-section" id="inviteInputSection">
              <div class="invite-header">
                <span class="invite-icon">ğŸ”—</span>
                <span class="invite-title" id="inviteTitle">ç»‘å®šé‚€è¯·åœ°å€</span>
              </div>
              
              <div class="invite-subtitle" id="inviteSubtitle">
                ç»‘å®šé‚€è¯·äººåœ°å€åå³å¯äº«å—è´¨æŠ¼æ”¶ç›Šï¼Œå¹¶è·å¾—é¢å¤–çš„å¥–åŠ±
              </div>
              
              <div class="invite-input-container">
                <input type="text" class="invite-input" id="inviteAddress" 
                       placeholder="è¯·è¾“å…¥é‚€è¯·äººé’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)" 
                       pattern="^0x[a-fA-F0-9]{40}$">
                <div class="invite-error-text" id="inviteErrorText">
                  è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)
                </div>
              </div>
              
              <div class="invite-benefits">
                <div class="benefit-title">
                  <span>ğŸ</span>
                  <span>ç»‘å®šé‚€è¯·åœ°å€çš„å¥½å¤„</span>
                </div>
                <ul class="benefit-list">
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>è§£é”è´¨æŠ¼åŠŸèƒ½ï¼Œå¼€å§‹èµšå–æ”¶ç›Š</span>
                  </li>
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>äº«å—é«˜è¾¾45.8%çš„å¹´åŒ–æ”¶ç›Šç‡</span>
                  </li>
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>é‚€è¯·äººå’Œè¢«é‚€è¯·äººéƒ½å¯è·å¾—é¢å¤–å¥–åŠ±</span>
                  </li>
                </ul>
              </div>
              
              <button class="stake-lp-button" id="bindInviteBtn">
                <span>ğŸ”—</span>
                <span id="bindBtnText">ç»‘å®šé‚€è¯·åœ°å€</span>
              </button>
              
              <div class="invite-note">
                <span class="invite-note-icon">ğŸ’¡</span>
                <span id="inviteNoteText">å¿…é¡»ç»‘å®šæœ‰æ•ˆçš„é‚€è¯·åœ°å€æ‰èƒ½è¿›è¡Œè´¨æŠ¼ï¼Œç»‘å®šåæ— æ³•æ›´æ”¹</span>
              </div>
            </div>
            
            <!-- å·²ç»‘å®šé‚€è¯·åœ°å€ -->
            <div class="invite-locked" id="inviteLockedSection" style="display:none">
              <div class="invite-locked-header">
                <div class="invite-locked-text">
                  <span class="locked-icon">âœ…</span>
                  <span id="lockedTitle">é‚€è¯·åœ°å€å·²ç»‘å®š</span>
                </div>
              </div>
              
              <div class="invite-subtitle" id="lockedSubtitle">
                æ‚¨å·²æˆåŠŸç»‘å®šé‚€è¯·åœ°å€ï¼Œç°åœ¨å¯ä»¥å¼€å§‹è´¨æŠ¼èµšå–æ”¶ç›Šäº†
              </div>
              
              <div class="invite-address-container">
                <div class="invite-address-label">
                  <span>ğŸ‘¤</span>
                  <span>é‚€è¯·äººåœ°å€ï¼š</span>
                </div>
                <div class="invite-address" id="lockedInviteAddress"></div>
              </div>
              
              <div class="invite-actions">
                <button class="invite-action-btn unlock-btn" id="unlockInviteBtn">
                  <span>ğŸ”„</span>
                  <span id="unlockBtnText">æ›´æ¢åœ°å€</span>
                </button>
                <button class="invite-action-btn stake-btn" id="goToStakeLocked">
                  <span>ğŸš€</span>
                  <span id="stakeBtnText">å¼€å§‹è´¨æŠ¼</span>
                </button>
              </div>
              
              <div class="invite-note">
                <span class="invite-note-icon">ğŸ“</span>
                <span id="lockedNoteText">ç‚¹å‡»"å¼€å§‹è´¨æŠ¼"è·³è½¬åˆ°è´¨æŠ¼é¡µé¢ï¼Œç‚¹å‡»"æ›´æ¢åœ°å€"å¯é‡æ–°ç»‘å®šé‚€è¯·äºº</span>
              </div>
            </div>
          </div>
        </div>
      </div>
   

    <!-- é£é™©æç¤º - ä¸¤ä¸ªé¡µé¢å…±ç”¨ -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>âš ï¸</span>
        <span id="riskTitle">é£é™©æç¤º</span>
      </div>
      <div id="riskText">
        æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚
      </div>
    </div>

    <!-- é¡µè„š - ä¸¤ä¸ªé¡µé¢å…±ç”¨ -->
    <div class="footer" id="footerText">LOMswap Â· Conflux eSpace</div>
  </div>

  <!-- ä»£å¸é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
  <div class="token-selector-modal" id="tokenSelectorModal">
    <div class="token-selector-card">
      <h3 class="modal-title" id="tokenSelectorTitle">é€‰æ‹©ä»£å¸</h3>
      <input type="text" class="token-search" id="tokenSearch" placeholder="æœç´¢ä»£å¸åç§°æˆ–åœ°å€">
      <div class="token-list" id="tokenList">
        <!-- ä»£å¸åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- æ·»åŠ æµåŠ¨æ€§æ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="addModal">
    <div class="modal-card">
      <h3 class="modal-title" id="addTitle">æ·»åŠ æµåŠ¨æ€§</h3>
      
      <div class="modal-input-group">
        <label class="modal-input-label">CFX æ•°é‡</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addCfx" placeholder="0" step="any" min="0">
          <button class="btn" id="cfxMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ä½™é¢: <span id="addCfxBal">0</span> CFX
        </div>
      </div>
      
      <div style="text-align: center; font-size: 20px; color: var(--text-primary); margin: 12px 0;">+</div>
      
      <div class="modal-input-group">
        <label class="modal-input-label">LOM æ•°é‡</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addLom" placeholder="0" step="any" min="0">
          <button class="btn" id="lomMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ä½™é¢: <span id="addLomBal">0</span> LOM
        </div>
      </div>
      
      <div style="background: rgba(26, 115, 232, 0.1); border-radius: 10px; padding: 10px; margin: 12px 0; text-align: center;">
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">æ¯”ä¾‹</div>
        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); word-break: break-all;" id="addRatio">1 CFX = 0 LOM</div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelAddBtn">å–æ¶ˆ</button>
        <button class="modal-btn confirm" id="confirmAddBtn" disabled>ç¡®è®¤æ·»åŠ </button>
      </div>
    </div>
  </div>

  <!-- ç§»é™¤æµåŠ¨æ€§æ¨¡æ€æ¡† -->
  <div class="modal-overlay remove-liquidity-modal" id="removeModal">
    <div class="modal-card">
      <h3 class="modal-title" id="removeTitle">ç§»é™¤æµåŠ¨æ€§</h3>
      
      <div class="modal-content">
        <div class="remove-percentage">
          <span id="removePercent">100%</span>
        </div>
        
        <input type="range" min="0" max="100" value="100" step="1" class="percentage-slider" id="removeSlider">
        
        <div class="percentage-options">
          <div class="percentage-option" data-percent="25">25%</div>
          <div class="percentage-option" data-percent="50">50%</div>
          <div class="percentage-option" data-percent="75">75%</div>
          <div class="percentage-option active" data-percent="100">100%</div>
        </div>
        
        <div class="remove-estimate">
          <div class="remove-estimate-title">é¢„è®¡è·å¾—</div>
          <div class="remove-estimate-amounts">
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstCfx">0</span> CFX
            </div>
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstLom">0</span> LOM
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn cancel" id="cancelRemoveBtn">å–æ¶ˆ</button>
          <button class="modal-btn confirm" id="confirmRemoveBtn" style="background: var(--gradient-red);">ç¡®è®¤ç§»é™¤</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ç®€å•äº¤æ˜“ç¡®è®¤æ¨¡æ€æ¡† -->
  <div class="modal-overlay simple-confirm-modal" id="simpleConfirmModal">
    <div class="modal-card">
      <div class="confirm-summary">
        <div class="confirm-icon" id="simpleConfirmIcon">ğŸ”„</div>
        <div class="confirm-action" id="simpleConfirmAction">å…‘æ¢ç¡®è®¤</div>
        <div class="confirm-amounts" id="simpleConfirmAmounts">
          <!-- é‡‘é¢ä¿¡æ¯ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="confirm-details-grid" id="simpleConfirmDetails">
          <!-- è¯¦ç»†ä¿¡æ¯ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
      <div class="confirm-actions-simple">
        <button class="confirm-action-btn cancel" id="simpleCancelBtn">å–æ¶ˆ</button>
        <button class="confirm-action-btn confirm" id="simpleConfirmBtn">ç¡®è®¤äº¤æ˜“</button>
      </div>
    </div>
  </div>

  <!-- äº¤æ˜“çŠ¶æ€æç¤º -->
  <div class="tx-status-overlay" id="txStatusOverlay">
    <div class="tx-status-card">
      <div class="tx-status-icon" id="txStatusIcon">
        <div class="loading-spinner white"></div>
      </div>
      <div class="tx-status-title" id="txStatusTitle">äº¤æ˜“å¤„ç†ä¸­</div>
      <div class="tx-status-message" id="txStatusMessage">è¯·ç­‰å¾…åŒºå—é“¾ç¡®è®¤...</div>
      <button class="tx-status-done-btn" id="txStatusDoneBtn" style="display:none;">å®Œæˆ</button>
    </div>
  </div>

  <!-- é‚€è¯·ç¡®è®¤å¯¹è¯æ¡† -->
  <div class="modal-overlay invite-confirm-modal" id="inviteConfirmModal">
    <div class="modal-card">
      <div class="invite-confirm-icon" id="inviteConfirmIcon">ğŸ”—</div>
      <div class="invite-confirm-title" id="inviteConfirmTitle">ç¡®è®¤ç»‘å®šé‚€è¯·åœ°å€</div>
      <div class="invite-confirm-message" id="inviteConfirmMessage">
        è¯·ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼Œç»‘å®šåé‚€è¯·åœ°å€å°†æ— æ³•æ›´æ”¹ã€‚
      </div>
      
      <div class="invite-confirm-details">
        <div class="invite-confirm-detail">
          <span class="invite-confirm-label">æ‚¨çš„é’±åŒ…åœ°å€</span>
          <span class="invite-confirm-value" id="confirmMyAddress"></span>
        </div>
        <div class="invite-confirm-detail">
          <span class="invite-confirm-label">é‚€è¯·äººåœ°å€</span>
          <span class="invite-confirm-value" id="confirmInviteAddress"></span>
        </div>
        <div class="invite-confirm-detail">
          <span class="invite-confirm-label">é¢„è®¡å¹´åŒ–æ”¶ç›Š</span>
          <span class="invite-confirm-value">45.8% APY</span>
        </div>
        <div class="invite-confirm-detail">
          <span class="invite-confirm-label">è´¨æŠ¼å¥–åŠ±</span>
          <span class="invite-confirm-value">é¢å¤–å¥–åŠ±ä»£å¸</span>
        </div>
      </div>
      
      <div class="invite-confirm-actions">
        <button class="invite-confirm-btn cancel" id="inviteConfirmCancelBtn">å–æ¶ˆ</button>
        <button class="invite-confirm-btn confirm" id="inviteConfirmBtn">ç¡®è®¤ç»‘å®š</button>
      </div>
    </div>
  </div>
   <script>
     'use strict';

// ==================== é¡¹ç›®ä»‹ç»å¼¹çª—åŠŸèƒ½ ====================
document.addEventListener('DOMContentLoaded', function() {
  const logoContainer = document.getElementById('logoContainer');
  const projectIntroOverlay = document.getElementById('projectIntroOverlay');
  const projectIntroCloseBtn = document.getElementById('projectIntroCloseBtn');
  
  // ç‚¹å‡»Logoæ˜¾ç¤ºé¡¹ç›®ä»‹ç»å¼¹çª—
  logoContainer.addEventListener('click', function() {
    projectIntroOverlay.classList.add('show');
  });
  
  // ç‚¹å‡»å…³é—­æŒ‰é’®å…³é—­å¼¹çª—
  projectIntroCloseBtn.addEventListener('click', function() {
    projectIntroOverlay.classList.remove('show');
  });
  
  // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
  projectIntroOverlay.addEventListener('click', function(e) {
    if (e.target === projectIntroOverlay) {
      projectIntroOverlay.classList.remove('show');
    }
  });
  
  // æŒ‰ESCé”®å…³é—­
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && projectIntroOverlay.classList.contains('show')) {
      projectIntroOverlay.classList.remove('show');
    }
  });
});

// ==================== ç»Ÿä¸€é…ç½® ====================
const APP_CONFIG = {
  CONTRACTS: {
    ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
    LOM: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3",
    WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
    PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85", // CFX-LOMæ± 
    USDC: "0x6963efed0ab40f6c3d7bda44a05dcf1437c44372",
    AXCNH: "0x70BFD7F7eADF9b9827541272589A6B2Bb760aE2E",
    USDT0: "0xaf37e8b6c9ed7f6318979f56fc287d76c30847ff",
    CNHT0: "0xDEd1660192d4d82e7c0B628ba556861EdBB5CAda",
    AXCNH_USDT0_PAIR: "0x50b095DF7a8f856C6fA07fF89bcBC2dF8491A8df"
  },
  TOKEN_LOGOS: {
    CFX: "https://i.imgur.com/70cXbUI.jpeg",
    LOM: "https://i.imgur.com/HddyTrv.jpeg",
    USDC: "https://i.imgur.com/9UDXcUF.jpeg",
    AXCNH: "https://i.imgur.com/x8317um.jpeg",
    USDT0: "https://i.imgur.com/KgnTsn1.jpeg",
    CNHT0: "https://i.imgur.com/zObg9RY.jpeg"
  },
  STAKING_URL: "https://stake.fatsale.org/#/cfx/0x90117C51DD5e17C4A306fea71B0f260Df057F6e3",
  CHAIN_ID: 1030 // Conflux eSpace
};

// ==================== åº”ç”¨çŠ¶æ€ ====================
let provider, signer, account, router, pair, lom, usdc, axcnh, usdt0, cnht0, axcnhUsdt0Pair;
let slippage = 0.1;
let isChinese = true;
let currentRatio = 0;
let fromToken = "CFX";
let toToken = "LOM";
let refreshInterval;
let currentTokenSelector = null;
let transactionLock = false;
let currentReserves = { cfx: 0, lom: 0 };
let lastInputWasFrom = true;
let inviteAddress = localStorage.getItem('lomswap_invite_address') || '';
let walletInviteMap = JSON.parse(localStorage.getItem('lomswap_wallet_invite_map') || '{}');

// ==================== æ ¸å¿ƒä»£å¸åˆ—è¡¨ ====================
const TOKEN_LIST = [
  {
    symbol: "CFX",
    name: "Conflux",
    address: APP_CONFIG.CONTRACTS.WCFX,
    logo: APP_CONFIG.TOKEN_LOGOS.CFX,
    decimals: 18,
    isNative: true
  },
  {
    symbol: "LOM",
    name: "Longmai",
    address: APP_CONFIG.CONTRACTS.LOM,
    logo: APP_CONFIG.TOKEN_LOGOS.LOM,
    decimals: 18
  },
  {
    symbol: "USDC",
    name: "USD Coin",
    address: APP_CONFIG.CONTRACTS.USDC,
    logo: APP_CONFIG.TOKEN_LOGOS.USDC,
    decimals: 18
  },
  {
    symbol: "AXCNH",
    name: "AxCNH",
    address: APP_CONFIG.CONTRACTS.AXCNH,
    logo: APP_CONFIG.TOKEN_LOGOS.AXCNH,
    decimals: 6
  },
  {
    symbol: "USDT0",
    name: "Tether USD (Test)",
    address: APP_CONFIG.CONTRACTS.USDT0,
    logo: APP_CONFIG.TOKEN_LOGOS.USDT0,
    decimals: 6
  },
  {
    symbol: "CNHT0",
    name: "CNH Token (Test)",
    address: APP_CONFIG.CONTRACTS.CNHT0,
    logo: APP_CONFIG.TOKEN_LOGOS.CNHT0,
    decimals: 6
  }
];

// ==================== åˆçº¦ ABI ====================
const ROUTER_ABI = [
  "function getAmountsOut(uint amountIn, address[] path) view returns (uint[] memory amounts)",
  "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) payable",
  "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function addLiquidityETH(address token, uint amountTokenDesired, uint amountTokenMin, uint amountETHMin, address to, uint deadline) payable returns (uint amountToken, uint amountETH, uint liquidity)",
  "function removeLiquidityETHSupportingFeeOnTransferTokens(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountETH)",
  "function removeLiquidityETH(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountToken, uint amountETH)"
];

const ERC20_ABI = [
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function totalSupply() view returns (uint256)"
];

const PAIR_ABI = [
  "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function token0() view returns (address)",
  "function token1() view returns (address)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)"
];

// ==================== å·¥å…·æ¨¡å— ====================
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  simpleFormat(value) {
    if (!value && value !== 0) return '0.000000';
    
    const num = parseFloat(value);
    if (isNaN(num)) return '0.000000';
    
    const truncated = Math.floor(num * 1000000) / 1000000;
    
    const parts = truncated.toString().split('.');
    let integerPart = parts[0];
    let decimalPart = parts[1] || '';
    
    if (decimalPart.length < 6) {
      decimalPart = decimalPart.padEnd(6, '0');
    } else if (decimalPart.length > 6) {
      decimalPart = decimalPart.substring(0, 6);
    }
    
    return integerPart + '.' + decimalPart;
  },

  removeTrailingZeros(str) {
    if (!str.includes('.')) return str;
    
    let result = str.replace(/0+$/, '');
    if (result.endsWith('.')) {
      result = result.slice(0, -1);
    }
    return result;
  },

  formatDisplay(value) {
    const formatted = this.simpleFormat(value);
    return this.removeTrailingZeros(formatted);
  },

  formatAddress(address) {
    if (!address) return '';
    return address.slice(0, 4) + '...' + address.slice(-6);
  },

  isValidAddress(address) {
    return /^0x[a-fA-F0-9]{40}$/.test(address);
  },

  showError(message) {
    const errorBox = document.getElementById('swapErrorBox');
    const errorText = document.getElementById('swapErrorText');
    errorText.textContent = message;
    errorBox.classList.add('show');
    
    setTimeout(() => {
      errorBox.classList.remove('show');
    }, 5000);
  },

  showNotification(message, type = 'info') {
    const status = document.getElementById('txStatusOverlay');
    const icon = document.getElementById('txStatusIcon');
    const title = document.getElementById('txStatusTitle');
    const msg = document.getElementById('txStatusMessage');
    const doneBtn = document.getElementById('txStatusDoneBtn');
    
    const statusConfig = {
      info: { 
        icon: '<div class="loading-spinner white"></div>', 
        title: isChinese ? 'å¤„ç†ä¸­' : 'Processing' 
      },
      success: { 
        icon: 'âœ…', 
        title: isChinese ? 'æ“ä½œæˆåŠŸ' : 'Success' 
      },
      error: { 
        icon: 'âŒ', 
        title: isChinese ? 'æ“ä½œå¤±è´¥' : 'Failed' 
      },
      warning: { 
        icon: 'âš ï¸', 
        title: isChinese ? 'æç¤º' : 'Notice' 
      }
    };
    
    const config = statusConfig[type] || statusConfig.info;
    icon.innerHTML = config.icon;
    title.textContent = config.title;
    msg.textContent = message;
    
    if (type === 'success' || type === 'error' || type === 'warning') {
      doneBtn.style.display = 'block';
    } else {
      doneBtn.style.display = 'none';
    }
    
    status.style.display = 'flex';
  },

  hideNotification() {
    document.getElementById('txStatusOverlay').style.display = 'none';
    document.querySelectorAll('button').forEach(btn => {
      btn.disabled = false;
    });
  },

  getErrorMessage(error) {
    const message = error.message || error.toString();
    
    const errorMap = {
      'user rejected': isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user',
      'INSUFFICIENT_OUTPUT_AMOUNT': isChinese ? 'è¾“å‡ºæ•°é‡ä¸è¶³ï¼Œè¯·æé«˜æ»‘ç‚¹å®¹å·®' : 'Insufficient output amount, increase slippage',
      'INSUFFICIENT_INPUT_AMOUNT': isChinese ? 'è¾“å…¥æ•°é‡ä¸è¶³' : 'Insufficient input amount',
      'insufficient funds': isChinese ? 'ä½™é¢ä¸è¶³' : 'Insufficient balance',
      'allowance': isChinese ? 'è¯·å…ˆæˆæƒä»£å¸' : 'Please approve token first',
      'deadline': isChinese ? 'äº¤æ˜“è¶…æ—¶ï¼Œè¯·é‡è¯•' : 'Transaction expired, please try again',
      'Not enough liquidity': isChinese ? 'æµåŠ¨æ€§ä¸è¶³' : 'Insufficient liquidity',
      'execution reverted': isChinese ? 'äº¤æ˜“æ‰§è¡Œå¤±è´¥' : 'Transaction execution failed',
      'reverted': isChinese ? 'äº¤æ˜“å¤±è´¥' : 'Transaction failed',
      'invalid decimal value': isChinese ? 'æ•°é‡æ ¼å¼é”™è¯¯' : 'Invalid amount format',
      'underflow': isChinese ? 'æ•°é‡å¤ªå°' : 'Amount too small'
    };
    
    for (const [key, value] of Object.entries(errorMap)) {
      if (message.toLowerCase().includes(key.toLowerCase())) {
        return value;
      }
    }
    
    return isChinese ? 'äº¤æ˜“å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Transaction failed, please try again';
  },

  async confirmDialog(message) {
    return new Promise((resolve) => {
      Utils.showNotification(message, 'warning');
      
      const doneBtn = document.getElementById('txStatusDoneBtn');
      const oldClick = doneBtn.onclick;
      
      doneBtn.onclick = () => {
        Utils.hideNotification();
        doneBtn.onclick = oldClick;
        resolve(true);
      };
      
      const cancelBtn = document.createElement('button');
      cancelBtn.className = 'confirm-action-btn cancel';
      cancelBtn.textContent = isChinese ? 'å–æ¶ˆ' : 'Cancel';
      cancelBtn.style.marginTop = '10px';
      cancelBtn.style.width = '100%';
      
      cancelBtn.onclick = () => {
        Utils.hideNotification();
        doneBtn.onclick = oldClick;
        cancelBtn.remove();
        resolve(false);
      };
      
      const card = document.querySelector('.tx-status-card');
      if (!card.querySelector('.confirm-action-btn.cancel')) {
        card.appendChild(cancelBtn);
      }
    });
  }
};

// ==================== ä»£å¸å·¥å…·æ¨¡å— ====================
const TokenUtils = {
  getToken(symbol) {
    return TOKEN_LIST.find(t => t.symbol === symbol);
  },

  getTokenDecimals(symbol) {
    const token = this.getToken(symbol);
    return token ? token.decimals : 18;
  },

  getTokenContract(symbol) {
    const tokenContracts = {
      "LOM": lom,
      "USDC": usdc,
      "AXCNH": axcnh,
      "USDT0": usdt0,
      "CNHT0": cnht0
    };
    return tokenContracts[symbol] || null;
  },

  formatTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      const formatted = ethers.utils.formatUnits(amount, decimals);
      return Utils.formatDisplay(formatted);
    } catch {
      return '0.000000';
    }
  },

  parseTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      return ethers.utils.parseUnits(amount.toString(), decimals);
    } catch {
      return ethers.BigNumber.from(0);
    }
  }
};

// ==================== æ»‘ç‚¹ç®¡ç†å™¨ ====================
const SlippageManager = {
  calculateRequiredSlippage(fromToken, currentSlippage) {
    return fromToken === 'LOM' ? Math.max(currentSlippage, 5) : currentSlippage;
  },

  calculateMinAmount(amount, slippagePercent) {
    if (!amount || isNaN(amount)) return '0';
    const amountNum = parseFloat(amount);
    const minAmount = amountNum * (1 - slippagePercent / 100);
    return Utils.formatDisplay(minAmount);
  },

  calculateMinAmountBigNumber(amountBN, slippagePercent, decimals) {
    const multiplier = Math.floor(1000 - slippagePercent * 10);
    return amountBN.mul(multiplier).div(1000);
  }
};

// ==================== äº¤æ˜“ç®¡ç†å™¨ ====================
const TransactionManager = {
  async executeTransaction(operation) {
    if (transactionLock) {
      Utils.showError(isChinese ? 'å·²æœ‰äº¤æ˜“åœ¨å¤„ç†ä¸­' : 'Transaction already in progress');
      return false;
    }
    
    if (!account) {
      Utils.showError(isChinese ? 'è¯·å…ˆè¿æ¥é’±åŒ…' : 'Please connect wallet first');
      return false;
    }
    
    transactionLock = true;
    
    try {
      // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
      const confirmed = await ConfirmDialog.show(operation);
      if (!confirmed) {
        transactionLock = false;
        return false;
      }
      
      // æ‰§è¡Œäº¤æ˜“
      Utils.showNotification(operation.processingMessage, 'info');
      await operation.execute();
      
      // äº¤æ˜“æˆåŠŸ
      Utils.showNotification(operation.successMessage, 'success');
      await DataManager.refreshAll();
      return true;
      
    } catch (error) {
      console.error('äº¤æ˜“å¤±è´¥:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
      return false;
    } finally {
      transactionLock = false;
    }
  },

  async checkAndApprove(tokenContract, spenderAddress, amount) {
    if (!tokenContract || !account) return true;
    
    try {
      const allowance = await tokenContract.allowance(account, spenderAddress);
      if (allowance.lt(amount)) {
        Utils.showNotification(isChinese ? 'æˆæƒä»£å¸ä¸­...' : 'Approving token...', 'info');
        const approveTx = await tokenContract.approve(spenderAddress, ethers.constants.MaxUint256);
        await approveTx.wait();
      }
      return true;
    } catch (error) {
      console.error('æˆæƒå¤±è´¥:', error);
      throw new Error('approval');
    }
  }
};

// ==================== ç¡®è®¤å¯¹è¯æ¡†ç®¡ç†å™¨ ====================
const ConfirmDialog = {
  async show(operation) {
    return new Promise((resolve) => {
      const modal = document.getElementById('simpleConfirmModal');
      const icon = document.getElementById('simpleConfirmIcon');
      const action = document.getElementById('simpleConfirmAction');
      const amountsDiv = document.getElementById('simpleConfirmAmounts');
      const detailsDiv = document.getElementById('simpleConfirmDetails');
      
      // è®¾ç½®å†…å®¹
      icon.textContent = operation.icon;
      action.textContent = operation.title;
      
      // è®¾ç½®é‡‘é¢æ˜¾ç¤º
      amountsDiv.innerHTML = this.generateAmountsHTML(operation);
      
      // è®¾ç½®è¯¦æƒ…æ˜¾ç¤º
      detailsDiv.innerHTML = this.generateDetailsHTML(operation);
      
      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      modal.style.display = "flex";
      
      // è®¾ç½®æŒ‰é’®äº‹ä»¶
      const cancelBtn = document.getElementById('simpleCancelBtn');
      const confirmBtn = document.getElementById('simpleConfirmBtn');
      
      const cleanup = () => {
        cancelBtn.removeEventListener('click', onCancel);
        confirmBtn.removeEventListener('click', onConfirm);
        modal.style.display = 'none';
        if (operation.confirmBtnStyle) {
          confirmBtn.style.background = '';
        }
      };
      
      const onCancel = () => {
        cleanup();
        resolve(false);
      };
      
      const onConfirm = () => {
        cleanup();
        resolve(true);
      };
      
      cancelBtn.addEventListener('click', onCancel);
      confirmBtn.addEventListener('click', onConfirm);
      
      // è®¾ç½®ç¡®è®¤æŒ‰é’®æ ·å¼
      if (operation.confirmBtnStyle) {
        confirmBtn.style.background = operation.confirmBtnStyle;
      }
    });
  },

  generateAmountsHTML(operation) {
    if (operation.type === 'swap') {
      const fromTokenData = TokenUtils.getToken(operation.fromToken);
      const toTokenData = TokenUtils.getToken(operation.toToken);
      
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${fromTokenData?.logo || ''}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.fromAmount)} ${operation.fromToken}</div>
        </div>
        <div style="font-size: 20px; color: var(--text-secondary);">â†“</div>
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${toTokenData?.logo || ''}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.toAmount)} ${operation.toToken}</div>
        </div>
      `;
    } else if (operation.type === 'addLiquidity') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.CFX}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.cfxAmount)} CFX</div>
        </div>
        <div style="font-size: 20px; color: var(--text-secondary);">+</div>
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.lomAmount)} LOM</div>
        </div>
      `;
    } else if (operation.type === 'removeLiquidity') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.CFX}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.cfxEst)} CFX</div>
        </div>
        <div style="font-size: 20px; color: var(--text-secondary);">+</div>
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">${Utils.formatDisplay(operation.lomEst)} LOM</div>
        </div>
      `;
    }
    return '';
  },

  generateDetailsHTML(operation) {
    if (operation.type === 'swap') {
      const price = parseFloat(operation.toAmount) / parseFloat(operation.fromAmount);
      const priceFormatted = Utils.formatDisplay(price);
      const requiredSlippage = SlippageManager.calculateRequiredSlippage(operation.fromToken, operation.slippage);
      const minReceived = SlippageManager.calculateMinAmount(operation.toAmount, requiredSlippage);
      
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'æ±‡ç‡' : 'Rate'}</div>
          <div class="confirm-detail-value">1 ${operation.fromToken} = ${priceFormatted} ${operation.toToken}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'æ»‘ç‚¹' : 'Slippage'}</div>
          <div class="confirm-detail-value">${requiredSlippage}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'æœ€ä½æ”¶åˆ°' : 'Min Received'}</div>
          <div class="confirm-detail-value">${minReceived} ${operation.toToken}</div>
        </div>
      `;
    } else if (operation.type === 'addLiquidity') {
      const ratio = currentRatio > 0 ? currentRatio : (parseFloat(operation.lomAmount) / parseFloat(operation.cfxAmount));
      const ratioFormatted = Utils.formatDisplay(ratio);
      
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ä»·æ ¼æ¯”ä¾‹' : 'Price Ratio'}</div>
          <div class="confirm-detail-value">1 CFX = ${ratioFormatted} LOM</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'æ»‘ç‚¹' : 'Slippage'}</div>
          <div class="confirm-detail-value">${operation.slippage}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'é¢„è®¡LP' : 'Estimated LP'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(parseFloat(operation.cfxAmount) * 0.5)}</div>
        </div>
      `;
    } else if (operation.type === 'removeLiquidity') {
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'ç§»é™¤æ¯”ä¾‹' : 'Remove %'}</div>
          <div class="confirm-detail-value">${operation.percent}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'æ»‘ç‚¹' : 'Slippage'}</div>
          <div class="confirm-detail-value">${operation.slippage}%</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'é¢„è®¡è·å¾—' : 'Est. Receive'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(operation.cfxEst)} CFX</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'é¢„è®¡è·å¾—' : 'Est. Receive'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(operation.lomEst)} LOM</div>
        </div>
      `;
    }
    return '';
  }
};

// ==================== é‚€è¯·ç®¡ç†å™¨ ====================
const InviteManager = {
  async bindInviteAddress() {
    const inviteInput = document.getElementById('inviteAddress');
    const address = inviteInput.value.trim();
    const errorText = document.getElementById('inviteErrorText');
    
    inviteInput.classList.remove('invite-input-error');
    errorText.classList.remove('show');
    
    if (!Utils.isValidAddress(address)) {
      inviteInput.classList.add('invite-input-error');
      errorText.classList.add('show');
      Utils.showError(isChinese ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€' : 'Please enter a valid wallet address');
      return;
    }
    
    if (address.toLowerCase() === account?.toLowerCase()) {
      Utils.showError(isChinese ? 'ä¸èƒ½ç»‘å®šè‡ªå·±çš„åœ°å€ä½œä¸ºé‚€è¯·åœ°å€' : 'Cannot bind your own address as invite address');
      return;
    }
    
    const confirmed = await this.showConfirmDialog(address);
    if (!confirmed) {
      return;
    }
    
    inviteAddress = address;
    localStorage.setItem('lomswap_invite_address', inviteAddress);
    this.saveInviteAddressForWallet();
    this.updateInviteUI();
    
    Utils.showNotification(
      isChinese ? 'é‚€è¯·åœ°å€ç»‘å®šæˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹è´¨æŠ¼äº†' : 'Invite address bound successfully! You can now start staking.',
      'success'
    );
  },

  async unbindInviteAddress() {
    const confirmed = await Utils.confirmDialog(
      isChinese ? 'ç¡®è®¤æ›´æ¢é‚€è¯·åœ°å€å—ï¼Ÿæ›´æ¢åéœ€è¦é‡æ–°ç»‘å®šæ‰èƒ½è¿›è¡Œè´¨æŠ¼ã€‚' : 
                 'Confirm to change invite address? You need to bind again for staking.'
    );
    
    if (!confirmed) return;
    
    inviteAddress = '';
    localStorage.removeItem('lomswap_invite_address');
    
    if (account) {
      delete walletInviteMap[account.toLowerCase()];
      localStorage.setItem('lomswap_wallet_invite_map', JSON.stringify(walletInviteMap));
    }
    
    this.updateInviteUI();
    
    Utils.showNotification(
      isChinese ? 'é‚€è¯·åœ°å€å·²è§£ç»‘' : 'Invite address unbound',
      'success'
    );
  },

  async goToStaking() {
    if (!account) {
      Utils.showError(isChinese ? 'è¯·å…ˆè¿æ¥é’±åŒ…' : 'Please connect wallet first');
      return;
    }
    
    if (!inviteAddress) {
      Utils.showNotification(
        isChinese ? 'è¯·å…ˆç»‘å®šé‚€è¯·åœ°å€æ‰èƒ½è¿›è¡Œè´¨æŠ¼' : 'Please bind invite address first to stake',
        'warning'
      );
      return;
    }
    
    const stakeUrl = `${APP_CONFIG.STAKING_URL}?invitor=${inviteAddress}`;
    window.open(stakeUrl, '_blank');
  },

  async showConfirmDialog(address) {
    return new Promise((resolve) => {
      const modal = document.getElementById('inviteConfirmModal');
      const myAddress = document.getElementById('confirmMyAddress');
      const inviteAddressElement = document.getElementById('confirmInviteAddress');
      const title = document.getElementById('inviteConfirmTitle');
      const message = document.getElementById('inviteConfirmMessage');
      const icon = document.getElementById('inviteConfirmIcon');
      
      title.textContent = isChinese ? 'ç¡®è®¤ç»‘å®šé‚€è¯·åœ°å€' : 'Confirm Invite Address Binding';
      message.textContent = isChinese ? 
        'è¯·ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼Œç»‘å®šåé‚€è¯·åœ°å€å°†æ— æ³•æ›´æ”¹ã€‚' : 
        'Please confirm the following information. The invite address cannot be changed after binding.';
      icon.textContent = 'ğŸ”—';
      
      myAddress.textContent = Utils.formatAddress(account);
      inviteAddressElement.textContent = Utils.formatAddress(address);
      
      modal.style.display = "flex";
      
      const cancelBtn = document.getElementById('inviteConfirmCancelBtn');
      const confirmBtn = document.getElementById('inviteConfirmBtn');
      
      const cleanup = () => {
        cancelBtn.removeEventListener('click', onCancel);
        confirmBtn.removeEventListener('click', onConfirm);
        modal.style.display = 'none';
      };
      
      const onCancel = () => {
        cleanup();
        resolve(false);
      };
      
      const onConfirm = () => {
        cleanup();
        resolve(true);
      };
      
      cancelBtn.addEventListener('click', onCancel);
      confirmBtn.addEventListener('click', onConfirm);
    });
  },

  updateInviteUI() {
    const inputSection = document.getElementById('inviteInputSection');
    const lockedSection = document.getElementById('inviteLockedSection');
    const lockedAddress = document.getElementById('lockedInviteAddress');
    
    this.updateInviteTexts();
    
    if (inviteAddress) {
      inputSection.style.display = 'none';
      lockedSection.style.display = 'block';
      lockedAddress.textContent = Utils.formatAddress(inviteAddress);
    } else {
      inputSection.style.display = 'block';
      lockedSection.style.display = 'none';
    }
  },

  updateInviteTexts() {
    if (isChinese) {
      document.getElementById('inviteTitle').textContent = 'ç»‘å®šé‚€è¯·åœ°å€';
      document.getElementById('inviteSubtitle').textContent = 'ç»‘å®šé‚€è¯·äººåœ°å€åå³å¯äº«å—è´¨æŠ¼æ”¶ç›Šï¼Œå‚ä¸åˆ†äº«å¯è·å¾—15%æ”¶ç›ŠåŠ æˆ';
      document.getElementById('inviteNoteText').textContent = 'å¿…é¡»ç»‘å®šæœ‰æ•ˆçš„é‚€è¯·åœ°å€æ‰èƒ½è¿›è¡Œè´¨æŠ¼';
      document.getElementById('bindBtnText').textContent = 'ç»‘å®šé‚€è¯·åœ°å€';
      document.getElementById('inviteAddress').placeholder = 'è¯·è¾“å…¥é‚€è¯·äººé’±åŒ…åœ°å€æ‰èƒ½è¿›å…¥LPè´¨æŠ¼ ';
      document.getElementById('inviteErrorText').textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)';
      
      document.getElementById('lockedTitle').textContent = 'é‚€è¯·åœ°å€å·²ç»‘å®š';
      document.getElementById('lockedSubtitle').textContent = 'æ‚¨å·²æˆåŠŸç»‘å®šé‚€è¯·åœ°å€ï¼Œç°åœ¨å¯ä»¥å¼€å§‹è´¨æŠ¼èµšå–æ”¶ç›Šäº†';
      document.getElementById('lockedNoteText').textContent = 'ç‚¹å‡»"å¼€å§‹è´¨æŠ¼"è·³è½¬åˆ°è´¨æŠ¼é¡µé¢ï¼Œç‚¹å‡»"æ›´æ¢åœ°å€"å¯é‡æ–°ç»‘å®šé‚€è¯·äºº';
      document.getElementById('unlockBtnText').textContent = 'æ›´æ¢åœ°å€';
      document.getElementById('stakeBtnText').textContent = 'è¿›å…¥è´¨æŠ¼æ± ';
      
      document.querySelector('.benefit-title span:nth-child(2)').textContent = 'ç»‘å®šé‚€è¯·åœ°å€çš„å¥½å¤„';
      document.querySelectorAll('.benefit-item')[0].querySelector('span:nth-child(2)').textContent = 'è§£é”è´¨æŠ¼åŠŸèƒ½ï¼Œå¼€å§‹èµšå–æ”¶ç›Š';
      document.querySelectorAll('.benefit-item')[1].querySelector('span:nth-child(2)').textContent = 'äº«å—é«˜è¾¾45.8%çš„å¹´åŒ–æ”¶ç›Šç‡';
      document.querySelectorAll('.benefit-item')[2].querySelector('span:nth-child(2)').textContent = 'é‚€è¯·äººå’Œè¢«é‚€è¯·äººéƒ½å¯è·å¾—é¢å¤–å¥–åŠ±';
    } else {
      document.getElementById('inviteTitle').textContent = 'Bind Invite Address';
      document.getElementById('inviteSubtitle').textContent = 'Bind an invite address to enjoy staking rewards and additional benefits';
      document.getElementById('inviteNoteText').textContent = 'A valid invite address is required for staking. Cannot be changed after binding.';
      document.getElementById('bindBtnText').textContent = 'Bind Invite Address';
      document.getElementById('inviteAddress').placeholder = 'Enter inviter wallet address (0x prefix, 42 chars)';
      document.getElementById('inviteErrorText').textContent = 'Please enter a valid wallet address (0x prefix, 42 chars)';
      
      document.getElementById('lockedTitle').textContent = 'Invite Address Bound';
      document.getElementById('lockedSubtitle').textContent = 'You have successfully bound an invite address and can now start staking';
      document.getElementById('lockedNoteText').textContent = 'Click "Start Staking" to go to the staking page, or "Change Address" to rebind';
      document.getElementById('unlockBtnText').textContent = 'Change Address';
      document.getElementById('stakeBtnText').textContent = 'Start Staking';
      
      document.querySelector('.benefit-title span:nth-child(2)').textContent = 'Benefits of Binding Invite Address';
      document.querySelectorAll('.benefit-item')[0].querySelector('span:nth-child(2)').textContent = 'Unlock staking function to start earning rewards';
      document.querySelectorAll('.benefit-item')[1].querySelector('span:nth-child(2)').textContent = 'Enjoy up to 45.8% APY';
      document.querySelectorAll('.benefit-item')[2].querySelector('span:nth-child(2)').textContent = 'Both inviter and invitee get additional rewards';
    }
  },

  saveInviteAddressForWallet() {
    if (account && inviteAddress) {
      walletInviteMap[account.toLowerCase()] = inviteAddress;
      localStorage.setItem('lomswap_wallet_invite_map', JSON.stringify(walletInviteMap));
    }
  }
};

// ==================== é’±åŒ…ç®¡ç†å™¨ ====================
const WalletManager = {
  async connect() {
    try {
      if (!window.ethereum) {
        Utils.showError(isChinese ? 
          "è¯·å®‰è£…TPæˆ–web3é’±åŒ…" : 
          "Please install TP or WEB3 wallet");
        return false;
      }
      
      const walletBtn = document.getElementById('walletBtn');
      walletBtn.textContent = isChinese ? 'è¿æ¥ä¸­...' : 'Connecting...';
      walletBtn.classList.add('connecting');
      
      const accounts = await window.ethereum.request({
        method: 'eth_requestAccounts'
      });
      
      if (!accounts || accounts.length === 0) {
        throw new Error(isChinese ? 'ç”¨æˆ·æ‹’ç»è¿æ¥' : 'User rejected connection');
      }
      
      account = accounts[0];
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      
      await this.checkNetwork();
      this.initContracts();
      this.restoreInviteAddress();
      this.updateUI();
      
      if (refreshInterval) {
        clearInterval(refreshInterval);
      }
      refreshInterval = setInterval(() => DataManager.refreshAll(), 10000);
      
      Utils.showNotification(
        isChinese ? 'é’±åŒ…è¿æ¥æˆåŠŸ' : 'Wallet connected successfully',
        'success'
      );
      
      return true;
    } catch (error) {
      console.error("é’±åŒ…è¿æ¥å¤±è´¥:", error);
      Utils.showError(
        isChinese ? `è¿æ¥å¤±è´¥: ${error.message}` : `Connection failed: ${error.message}`
      );
      return false;
    } finally {
      this.updateUI();
    }
  },

  async checkNetwork() {
    const network = await provider.getNetwork();
    if (network.chainId !== APP_CONFIG.CHAIN_ID) {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x' + APP_CONFIG.CHAIN_ID.toString(16) }]
        });
      } catch (error) {
        if (error.code === 4902) {
          Utils.showError(isChinese ? 'è¯·æ·»åŠ Conflux eSpaceç½‘ç»œ' : 'Please add Conflux eSpace network');
        } else {
          Utils.showError(isChinese ? 'è¯·åˆ‡æ¢åˆ°Conflux eSpaceç½‘ç»œ' : 'Please switch to Conflux eSpace network');
        }
        throw error;
      }
    }
  },

  initContracts() {
    router = new ethers.Contract(APP_CONFIG.CONTRACTS.ROUTER, ROUTER_ABI, signer);
    pair = new ethers.Contract(APP_CONFIG.CONTRACTS.PAIR, PAIR_ABI, signer);
    lom = new ethers.Contract(APP_CONFIG.CONTRACTS.LOM, ERC20_ABI, signer);
    usdc = new ethers.Contract(APP_CONFIG.CONTRACTS.USDC, ERC20_ABI, signer);
    axcnh = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH, ERC20_ABI, signer);
    usdt0 = new ethers.Contract(APP_CONFIG.CONTRACTS.USDT0, ERC20_ABI, signer);
    cnht0 = new ethers.Contract(APP_CONFIG.CONTRACTS.CNHT0, ERC20_ABI, signer);
    axcnhUsdt0Pair = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH_USDT0_PAIR, PAIR_ABI, signer);
  },

  restoreInviteAddress() {
    if (account && walletInviteMap[account.toLowerCase()]) {
      inviteAddress = walletInviteMap[account.toLowerCase()];
      InviteManager.updateInviteUI();
    } else {
      inviteAddress = '';
      InviteManager.updateInviteUI();
    }
  },

  updateUI() {
    const walletBtn = document.getElementById("walletBtn");
    const swapBtn = document.getElementById("swapBtn");
    
    walletBtn.classList.remove('connecting');
    
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      walletBtn.textContent = displayAddress;
      walletBtn.classList.add('connected');
      swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
      swapBtn.disabled = false;
    } else {
      walletBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
      walletBtn.classList.remove('connected');
      swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
      swapBtn.disabled = false;
    }
  },

  disconnect() {
    account = null;
    provider = null;
    signer = null;
    router = null;
    pair = null;
    lom = null;
    usdc = null;
    axcnh = null;
    usdt0 = null;
    cnht0 = null;
    axcnhUsdt0Pair = null;
    
    if (refreshInterval) {
      clearInterval(refreshInterval);
      refreshInterval = null;
    }
    
    this.updateUI();
    DataManager.resetAllData();
    
    Utils.showNotification(
      isChinese ? "é’±åŒ…å·²æ–­å¼€è¿æ¥" : "Wallet disconnected",
      'success'
    );
  }
};

// ==================== æ•°æ®ç®¡ç†å™¨ ====================
const DataManager = {
  async refreshAll() {
    if (!account) return;
    
    try {
      await this.updateAllBalances();
      await this.updatePoolInfo();
      this.updateSwapButtonState();
    } catch (error) {
      console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
    }
  },

  async updateAllBalances() {
    if (!account) return;
    
    try {
      // è·å–æ‰€æœ‰ä»£å¸ä½™é¢
      const balancePromises = TOKEN_LIST.map(async (token) => {
        try {
          let balance = 0;
          
          if (token.symbol === 'CFX' && provider) {
            const cfxBal = await provider.getBalance(account);
            balance = parseFloat(ethers.utils.formatEther(cfxBal));
          } else {
            const contract = TokenUtils.getTokenContract(token.symbol);
            if (contract) {
              const tokenBal = await contract.balanceOf(account);
              balance = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
            }
          }
          
          return { symbol: token.symbol, balance };
        } catch (error) {
          console.error(`è·å– ${token.symbol} ä½™é¢å¤±è´¥:`, error);
          return { symbol: token.symbol, balance: 0 };
        }
      });
      
      const balances = await Promise.all(balancePromises);
      
      // æ›´æ–°UIæ˜¾ç¤º
      balances.forEach(({ symbol, balance }) => {
        this.updateBalanceUI(symbol, balance);
      });
      
      // æ›´æ–°æµåŠ¨æ€§é¡µé¢çš„ä½™é¢æ˜¾ç¤º
      if (lom && provider) {
        const cfxBal = balances.find(b => b.symbol === 'CFX')?.balance || 0;
        const lomBal = balances.find(b => b.symbol === 'LOM')?.balance || 0;
        
        document.getElementById("addCfxBal").textContent = Utils.formatDisplay(cfxBal);
        document.getElementById("addLomBal").textContent = Utils.formatDisplay(lomBal);
      }
      
      // æ£€æŸ¥æ˜¯å¦æœ‰LPä»£å¸
      if (pair) {
        const lpBal = await pair.balanceOf(account);
        const lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
        document.getElementById("removeBtn").disabled = lpBal.isZero();
      }
      
    } catch (error) {
      console.error("æ›´æ–°ä½™é¢å¤±è´¥:", error);
    }
  },

  updateBalanceUI(symbol, balance) {
    const formattedBalance = Utils.formatDisplay(balance);
    
    // æ›´æ–°å…‘æ¢é¡µé¢çš„ä½™é¢æ˜¾ç¤º
    if (symbol === fromToken) {
      const fromBalEl = document.getElementById('fromBal');
      if (fromBalEl) fromBalEl.textContent = formattedBalance;
    }
    
    if (symbol === toToken) {
      const toBalEl = document.getElementById('toBal');
      if (toBalEl) toBalEl.textContent = formattedBalance;
    }
    
    // æ›´æ–°ä»£å¸é€‰æ‹©å™¨çš„ä½™é¢æ˜¾ç¤º
    const selectorBalanceEl = document.getElementById(`selectorBalance-${symbol}`);
    if (selectorBalanceEl) {
      selectorBalanceEl.textContent = formattedBalance;
    }
  },

  async updatePoolInfo() {
    try {
      if (!pair || !account) return;
      
      const [r0, r1] = await pair.getReserves();
      const t0 = await pair.token0();
      const totalSupply = await pair.totalSupply();
      
      const reserveCfx = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r0 : r1;
      const reserveLom = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r1 : r0;
      
      const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
      const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
      
      currentReserves.cfx = cfxReserve;
      currentReserves.lom = lomReserve;
      
      const price = lomReserve / cfxReserve;
      currentRatio = price;
      
      const priceFormatted = Utils.formatDisplay(price);
      const priceText = isChinese ? 
        `${priceFormatted} LOM` : 
        `${priceFormatted} LOM`;
      document.getElementById("price").textContent = `1 CFX = ${priceText}`;
      document.getElementById("addRatio").textContent = `1 CFX = ${priceFormatted} LOM`;

      const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
      
      let lpAmt = 0;
      let share = 0;
      let userCfx = 0;
      let userLom = 0;
      
      const lpBal = await pair.balanceOf(account);
      lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
      
      if (totalSupplyNum > 0 && lpAmt > 0) {
        share = (lpAmt / totalSupplyNum) * 100;
        userCfx = cfxReserve * (share / 100);
        userLom = lomReserve * (share / 100);
      }
      
      const cfxReserveEl = document.getElementById("cfxReserve");
      const lomReserveEl = document.getElementById("lomReserve");
      
      if (cfxReserveEl) cfxReserveEl.textContent = cfxReserve.toFixed(2);
      if (lomReserveEl) lomReserveEl.textContent = lomReserve.toFixed(2);
      
      const userCfxEl = document.getElementById("userCfx");
      const userLomEl = document.getElementById("userLom");
      const userLpEl = document.getElementById("userLp");
      const userPoolShareEl = document.getElementById("userPoolShare");
      
      if (userCfxEl) userCfxEl.textContent = userCfx.toFixed(2);
      if (userLomEl) userLomEl.textContent = userLom.toFixed(2);
      if (userLpEl) userLpEl.textContent = lpAmt.toFixed(2);
      if (userPoolShareEl) userPoolShareEl.textContent = share.toFixed(4) + "%";
      
      const poolTitle = isChinese ? 
        `CFX-LOMæµåŠ¨æ± ` :
        `CFX-LOM Pool`;
      
      const poolInfoTitleEl = document.getElementById("poolInfoTitle");
      if (poolInfoTitleEl) poolInfoTitleEl.textContent = poolTitle;
      
      const removeBtn = document.getElementById("removeBtn");
      if (removeBtn) {
        removeBtn.disabled = lpAmt <= 0;
      }
      
    } catch (error) {
      console.error("æ›´æ–°æ± å­ä¿¡æ¯å¤±è´¥:", error);
    }
  },

  updateSwapButtonState() {
    const swapBtn = document.getElementById("swapBtn");
    const fromAmount = document.getElementById("fromAmount").value;
    
    if (!account) {
      swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
      swapBtn.disabled = false;
      return;
    }
    
    if (!fromAmount || fromAmount === "0" || fromAmount === "") {
      swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
      swapBtn.disabled = true;
      return;
    }
    
    swapBtn.textContent = isChinese ? "ç«‹å³å…‘æ¢" : "Swap Now";
    swapBtn.disabled = false;
  },

  resetAllData() {
    const elements = {
      'fromBal': '0.000000',
      'toBal': '0.000000',
      'addCfxBal': '0.000000',
      'addLomBal': '0.000000',
      'price': '1 CFX = 0.000000 LOM',
      'minReceived': '0.000000 LOM'
    };
    
    Object.keys(elements).forEach(id => {
      const element = document.getElementById(id);
      if (element) element.textContent = elements[id];
    });
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    document.getElementById("removeBtn").disabled = true;
  }
};

// ==================== å…‘æ¢æ¨¡å— ====================
const SwapModule = {
  async executeSwap() {
    const fromAmount = document.getElementById('fromAmount').value;
    const toAmount = document.getElementById('toAmount').value;
    
    if (!fromAmount || fromAmount === '0') {
      Utils.showError(isChinese ? "è¯·è¾“å…¥å…‘æ¢æ•°é‡" : "Please enter swap amount");
      return;
    }
    
    const requiredSlippage = SlippageManager.calculateRequiredSlippage(fromToken, slippage);
    
    const operation = {
      type: 'swap',
      icon: 'ğŸ”„',
      title: isChinese ? 'å…‘æ¢ç¡®è®¤' : 'Swap Confirmation',
      fromToken,
      toToken,
      fromAmount: parseFloat(fromAmount),
      toAmount: parseFloat(toAmount),
      slippage: requiredSlippage,
      processingMessage: isChinese ? 'å¤„ç†å…‘æ¢ä¸­...' : 'Processing swap...',
      successMessage: isChinese ? `å…‘æ¢æˆåŠŸï¼è·å¾— ${Utils.formatDisplay(toAmount)} ${toToken}` : 
                                 `Swap successful! Received ${Utils.formatDisplay(toAmount)} ${toToken}`,
      execute: async () => {
        await this.processSwap(fromAmount, toAmount, requiredSlippage);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async processSwap(fromAmount, toAmount, requiredSlippage) {
    const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
    const toDecimals = TokenUtils.getTokenDecimals(toToken);
    
    const amountIn = TokenUtils.parseTokenAmount(fromAmount, fromToken);
    const path = this.getSwapPath();
    
    if (!router) {
      throw new Error('è·¯ç”±å™¨åˆçº¦æœªåˆå§‹åŒ–');
    }
    
    const amounts = await router.getAmountsOut(amountIn, path);
    const minOut = SlippageManager.calculateMinAmountBigNumber(
      amounts[amounts.length - 1], 
      requiredSlippage, 
      toDecimals
    );
    
    const deadline = Math.floor(Date.now() / 1000) + 1200;
    
    let tx;
    
    if (fromToken === "CFX") {
      tx = await router.swapExactETHForTokensSupportingFeeOnTransferTokens(
        minOut, path, account, deadline, 
        { value: amountIn }
      );
    } else if (toToken === "CFX") {
      const tokenContract = TokenUtils.getTokenContract(fromToken);
      if (!tokenContract) throw new Error('ä»£å¸åˆçº¦æœªæ‰¾åˆ°');
      
      await TransactionManager.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
      
      tx = await router.swapExactTokensForETHSupportingFeeOnTransferTokens(
        amountIn, minOut, path, account, deadline
      );
    } else {
      const tokenContract = TokenUtils.getTokenContract(fromToken);
      if (!tokenContract) throw new Error('ä»£å¸åˆçº¦æœªæ‰¾åˆ°');
      
      await TransactionManager.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
      
      tx = await router.swapExactTokensForTokensSupportingFeeOnTransferTokens(
        amountIn, minOut, path, account, deadline
      );
    }
    
    await tx.wait();
    document.getElementById('fromAmount').value = '';
    document.getElementById('toAmount').value = '';
  },

  getSwapPath() {
    let path = [];
    
    // 1. é¦–å…ˆå¤„ç†ç›´æ¥äº¤æ˜“å¯¹ AxCNH â†” USDT0
    if ((fromToken === 'AXCNH' && toToken === 'USDT0') || 
        (fromToken === 'USDT0' && toToken === 'AXCNH')) {
      
      if (fromToken === 'AXCNH') {
        path.push(APP_CONFIG.CONTRACTS.AXCNH);
        path.push(APP_CONFIG.CONTRACTS.USDT0);
      } else {
        path.push(APP_CONFIG.CONTRACTS.USDT0);
        path.push(APP_CONFIG.CONTRACTS.AXCNH);
      }
      return path;
    }
    
    // 2. å¤„ç†æ¶‰åŠCFXçš„äº¤æ˜“
    if (fromToken === 'CFX') {
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    } else if (toToken === 'CFX') {
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      path.push(APP_CONFIG.CONTRACTS.WCFX);
    } else {
      // 3. å…¶ä»–ä»£å¸ä¹‹é—´çš„äº¤æ˜“ï¼ˆé€šè¿‡CFXä¸­è½¬ï¼‰
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    }
    
    return path;
  },

  async updateOutputFromInput() {
    const amount = document.getElementById('fromAmount').value;
    
    if (!amount || amount === '0' || amount === '' || !router) {
      document.getElementById('toAmount').value = "";
      document.getElementById('minReceived').textContent = `0 ${toToken}`;
      DataManager.updateSwapButtonState();
      return;
    }
    
    try {
      const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
      const toDecimals = TokenUtils.getTokenDecimals(toToken);
      
      const amountIn = TokenUtils.parseTokenAmount(amount, fromToken);
      const path = this.getSwapPath();
      
      const amounts = await router.getAmountsOut(amountIn, path);
      const out = TokenUtils.formatTokenAmount(amounts[amounts.length - 1], toToken);
      
      document.getElementById('toAmount').value = out;
      
      const requiredSlippage = SlippageManager.calculateRequiredSlippage(fromToken, slippage);
      const minOut = SlippageManager.calculateMinAmountBigNumber(
        amounts[amounts.length - 1], 
        requiredSlippage, 
        toDecimals
      );
      
      const minOutFormatted = TokenUtils.formatTokenAmount(minOut, toToken);
      document.getElementById('minReceived').textContent = 
        `${minOutFormatted} ${toToken}`;
      
      const price = parseFloat(out) / parseFloat(amount);
      const priceFormatted = Utils.formatDisplay(price);
      document.getElementById('price').textContent = 
        `1 ${fromToken} = ${priceFormatted} ${toToken}`;
      
      if (fromToken === 'LOM' && slippage < 5) {
        this.showLOMSlippageWarning();
      } else {
        this.hideLOMSlippageWarning();
      }
      
      DataManager.updateSwapButtonState();
      
    } catch (error) {
      console.error('è®¡ç®—è¾“å‡ºå¤±è´¥:', error);
      document.getElementById('toAmount').value = "";
      document.getElementById('swapBtn').textContent = isChinese ? 'è®¡ç®—å¤±è´¥' : 'Calculation Failed';
      document.getElementById('swapBtn').disabled = true;
    }
  },

  showLOMSlippageWarning() {
    const existingWarning = document.querySelector('.lom-slippage-warning');
    if (existingWarning) return;
    
    const warningElement = document.createElement('div');
    warningElement.className = 'error-box lom-slippage-warning';
    warningElement.innerHTML = `
      <span class="error-icon">âš ï¸</span>
      <span>LOMäº¤æ˜“éœ€è¦5%ä»¥ä¸Šæ»‘ç‚¹ä»¥é¿å…äº¤æ˜“å¤±è´¥</span>
    `;
    
    const swapDetails = document.querySelector('.swap-details');
    if (swapDetails) {
      swapDetails.parentNode.insertBefore(warningElement, swapDetails);
    }
  },

  hideLOMSlippageWarning() {
    const existingWarning = document.querySelector('.lom-slippage-warning');
    if (existingWarning) {
      existingWarning.remove();
    }
  },

  reverseTokens() {
    const tempToken = fromToken;
    fromToken = toToken;
    toToken = tempToken;
    
    document.getElementById("fromTokenSymbol").textContent = fromToken;
    document.getElementById("toTokenSymbol").textContent = toToken;
    
    const fromTokenData = TokenUtils.getToken(fromToken);
    const toTokenData = TokenUtils.getToken(toToken);
    
    if (fromTokenData) {
      document.getElementById("fromTokenLogo").style.backgroundImage = `url('${fromTokenData.logo}')`;
    }
    
    if (toTokenData) {
      document.getElementById("toTokenLogo").style.backgroundImage = `url('${toTokenData.logo}')`;
    }
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    
    DataManager.updateAllBalances();
    DataManager.updateSwapButtonState();
    document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
    
    lastInputWasFrom = true;
    this.hideLOMSlippageWarning();
  },

  handlePercentageClick(percent) {
    if (!account) {
      Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
      return;
    }
    
    let balance = parseFloat(document.getElementById("fromBal").textContent);
    
    if (balance > 0) {
      let amount;
      
      if (percent === 1) {
        if (fromToken === 'CFX') {
          amount = Math.max(0, balance - 0.1);
        } else {
          amount = balance * 0.9;
        }
      } else {
        amount = balance * percent;
      }
      
      if (amount > 0) {
        document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
        lastInputWasFrom = true;
        this.updateOutputFromInput();
      }
    }
  }
};

// ==================== æµåŠ¨æ€§æ¨¡å— ====================
const LiquidityModule = {
  async addLiquidity() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    
    if (!cfxAmount || !lomAmount || parseFloat(cfxAmount) <= 0 || parseFloat(lomAmount) <= 0) {
      Utils.showError(isChinese ? "è¯·è¾“å…¥æœ‰æ•ˆæ•°é‡" : "Please enter valid amounts");
      return;
    }
    
    const operation = {
      type: 'addLiquidity',
      icon: 'ğŸ’§',
      title: isChinese ? 'æ·»åŠ æµåŠ¨æ€§' : 'Add Liquidity',
      cfxAmount: parseFloat(cfxAmount),
      lomAmount: parseFloat(lomAmount),
      slippage: slippage,
      processingMessage: isChinese ? 'æ·»åŠ æµåŠ¨æ€§ä¸­...' : 'Adding liquidity...',
      successMessage: isChinese ? 'æ·»åŠ æµåŠ¨æ€§æˆåŠŸï¼' : 'Liquidity added successfully!',
      execute: async () => {
        await this.executeAddLiquidity(cfxAmount, lomAmount);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async executeAddLiquidity(cfxAmount, lomAmount) {
    const amountCfx = TokenUtils.parseTokenAmount(cfxAmount, 'CFX');
    const amountLom = TokenUtils.parseTokenAmount(lomAmount, 'LOM');
    
    if (!lom || !router) {
      throw new Error('åˆçº¦æœªåˆå§‹åŒ–');
    }
    
    await TransactionManager.checkAndApprove(lom, APP_CONFIG.CONTRACTS.ROUTER, amountLom);
    
    const minCfx = SlippageManager.calculateMinAmountBigNumber(amountCfx, slippage, 18);
    const minLom = SlippageManager.calculateMinAmountBigNumber(amountLom, slippage, 18);
    const deadline = Math.floor(Date.now() / 1000) + 1800;
    
    const tx = await router.addLiquidityETH(
      APP_CONFIG.CONTRACTS.LOM,
      amountLom,
      minLom,
      minCfx,
      account,
      deadline,
      { value: amountCfx }
    );
    
    await tx.wait();
    document.getElementById("addModal").style.display = "none";
    document.getElementById("addCfx").value = "";
    document.getElementById("addLom").value = "";
  },

  async removeLiquidity() {
    const percent = document.getElementById("removeSlider").value;
    const cfxEst = document.getElementById("removeEstCfx").textContent;
    const lomEst = document.getElementById("removeEstLom").textContent;
    
    const operation = {
      type: 'removeLiquidity',
      icon: 'ğŸ”¥',
      title: isChinese ? 'ç§»é™¤æµåŠ¨æ€§' : 'Remove Liquidity',
      cfxEst: parseFloat(cfxEst),
      lomEst: parseFloat(lomEst),
      percent: parseFloat(percent),
      slippage: slippage,
      processingMessage: isChinese ? 'ç§»é™¤æµåŠ¨æ€§ä¸­...' : 'Removing liquidity...',
      successMessage: isChinese ? `ç§»é™¤æµåŠ¨æ€§æˆåŠŸï¼è·å¾— ${cfxEst} CFX å’Œ ${lomEst} LOM` : 
                                 `Success! Received ${cfxEst} CFX and ${lomEst} LOM`,
      confirmBtnStyle: 'var(--gradient-red)',
      execute: async () => {
        await this.executeRemoveLiquidity(percent);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async executeRemoveLiquidity(percent) {
    if (!pair || !router) {
      throw new Error('åˆçº¦æœªåˆå§‹åŒ–');
    }
    
    const lpBal = await pair.balanceOf(account);
    const liquidity = lpBal.mul(percent).div(100);
    
    if (liquidity.isZero()) {
      throw new Error(isChinese ? 'æ²¡æœ‰æµåŠ¨æ€§å¯ç§»é™¤' : 'No liquidity to remove');
    }
    
    await TransactionManager.checkAndApprove(pair, APP_CONFIG.CONTRACTS.ROUTER, liquidity);
    
    const deadline = Math.floor(Date.now() / 1000) + 1800;
    
    const tx = await router.removeLiquidityETH(
      APP_CONFIG.CONTRACTS.LOM, 
      liquidity, 
      0,
      0,
      account, 
      deadline
    );
    
    await tx.wait();
    document.getElementById("removeModal").style.display = "none";
  },

  async updateRemoveEstimate(percent) {
    try {
      if (!account || !pair) return;
      
      document.getElementById("removePercent").textContent = percent + "%";
      
      const lpBal = await pair.balanceOf(account);
      const liquidity = lpBal.mul(percent).div(100);
      
      if (liquidity.isZero()) {
        document.getElementById("removeEstCfx").textContent = "0.000000";
        document.getElementById("removeEstLom").textContent = "0.000000";
        return;
      }
      
      const total = await pair.totalSupply();
      const { cfx: rCfx, lom: rLom } = currentReserves;
      
      const cfxReserve = TokenUtils.parseTokenAmount(rCfx.toString(), 'CFX');
      const lomReserve = TokenUtils.parseTokenAmount(rLom.toString(), 'LOM');
      
      const cfxOut = cfxReserve.mul(liquidity).div(total);
      const lomOut = lomReserve.mul(liquidity).div(total);
      
      const cfxOutFormatted = TokenUtils.formatTokenAmount(cfxOut, 'CFX');
      const lomOutFormatted = TokenUtils.formatTokenAmount(lomOut, 'LOM');
      
      document.getElementById("removeEstCfx").textContent = cfxOutFormatted;
      document.getElementById("removeEstLom").textContent = lomOutFormatted;
      
    } catch (error) {
      console.error("æ›´æ–°ç§»é™¤ä¼°ç®—å¤±è´¥:", error);
      document.getElementById("removeEstCfx").textContent = "0.000000";
      document.getElementById("removeEstLom").textContent = "0.000000";
    }
  },

  handleCfxInput() {
    const cfxAmount = document.getElementById("addCfx").value;
    
    if (!cfxAmount || cfxAmount === "" || parseFloat(cfxAmount) <= 0) {
      document.getElementById("addLom").value = "";
      document.getElementById("confirmAddBtn").disabled = true;
      return;
    }
    
    if (currentRatio > 0) {
      const cfxNum = parseFloat(cfxAmount);
      const lomAmount = cfxNum * currentRatio;
      document.getElementById("addLom").value = Utils.formatDisplay(lomAmount);
    }
    
    this.updateAddButtonState();
  },

  handleLomInput() {
    const lomAmount = document.getElementById("addLom").value;
    
    if (!lomAmount || lomAmount === "" || parseFloat(lomAmount) <= 0) {
      document.getElementById("addCfx").value = "";
      document.getElementById("confirmAddBtn").disabled = true;
      return;
    }
    
    if (currentRatio > 0) {
      const lomNum = parseFloat(lomAmount);
      const cfxAmount = lomNum / currentRatio;
      document.getElementById("addCfx").value = Utils.formatDisplay(cfxAmount);
    }
    
    this.updateAddButtonState();
  },

  updateAddButtonState() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    const cfxBalance = parseFloat(document.getElementById("addCfxBal").textContent);
    const lomBalance = parseFloat(document.getElementById("addLomBal").textContent);
    const confirmButton = document.getElementById("confirmAddBtn");
    
    if (!cfxAmount || !lomAmount || cfxAmount === "" || lomAmount === "") {
      confirmButton.disabled = true;
      return;
    }
    
    const cfxNum = parseFloat(cfxAmount);
    const lomNum = parseFloat(lomAmount);
    
    if (isNaN(cfxNum) || isNaN(lomNum) || cfxNum <= 0 || lomNum <= 0) {
      confirmButton.disabled = true;
      return;
    }
    
    if (cfxNum > cfxBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    if (lomNum > lomBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    const remainingCfx = cfxBalance - cfxNum;
    if (remainingCfx < 0.01) {
      confirmButton.disabled = true;
      return;
    }
    
    confirmButton.disabled = false;
  },

  async setMaxCfx() {
    const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
    if (cfxBal <= 0) {
      Utils.showError(isChinese ? "CFXä½™é¢ä¸è¶³" : "Insufficient CFX balance");
      return;
    }
    
    const maxCfx = Math.max(0, cfxBal - 0.1);
    document.getElementById("addCfx").value = Utils.formatDisplay(maxCfx);
    
    if (currentRatio > 0) {
      const requiredLom = maxCfx * currentRatio;
      const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
      
      if (requiredLom <= lomBal) {
        document.getElementById("addLom").value = Utils.formatDisplay(requiredLom);
      } else {
        const adjustedCfx = lomBal / currentRatio;
        document.getElementById("addCfx").value = Utils.formatDisplay(Math.min(adjustedCfx, maxCfx));
        document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
      }
    }
    
    this.updateAddButtonState();
  },

  async setMaxLom() {
    const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
    if (lomBal <= 0) {
      Utils.showError(isChinese ? "LOMä½™é¢ä¸è¶³" : "Insufficient LOM balance");
      return;
    }
    
    document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
    
    if (currentRatio > 0) {
      const requiredCfx = lomBal / currentRatio;
      const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
      const availableCfx = Math.max(0, cfxBal - 0.1);
      
      if (requiredCfx <= availableCfx) {
        document.getElementById("addCfx").value = Utils.formatDisplay(requiredCfx);
      } else {
        const adjustedLom = availableCfx * currentRatio;
        document.getElementById("addLom").value = Utils.formatDisplay(Math.min(adjustedLom, lomBal));
        document.getElementById("addCfx").value = Utils.formatDisplay(availableCfx);
      }
    }
    
    this.updateAddButtonState();
  }
};<!-- åœ¨åŸæœ‰çš„æµåŠ¨æ€§é¡µé¢ä»£ç åé¢æ·»åŠ ä»¥ä¸‹å†…å®¹ -->

<!-- LPå¥–åŠ±ç³»ç»Ÿæ¨¡æ€æ¡† -->
<div class="modal-overlay" id="rewardModal">
  <div class="modal-card" style="max-width: 500px;">
    <h3 class="modal-title">ğŸ† LPå¥–åŠ±ç³»ç»Ÿ</h3>
    
    <div class="card" style="margin-bottom: 16px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));">
      <div style="text-align: center; margin-bottom: 16px;">
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">æ€»å¥–åŠ±æ± </div>
        <div style="font-size: 24px; font-weight: bold; color: var(--accent-yellow);" id="totalRewardPool">25,555,555 LOM</div>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
        <div style="text-align: center;">
          <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">æ¯æ—¥é‡Šæ”¾</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);" id="dailyReward">70,987 LOM</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">å·²å‘æ”¾</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--success);" id="distributedRewards">0 LOM</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">æ€»è´¨æŠ¼LP</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);" id="totalStakedLP">0</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">æ‚¨çš„è´¨æŠ¼</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--accent-yellow);" id="myStakedLP">0</div>
        </div>
      </div>
    </div>
    
    <!-- å®æ—¶å¥–åŠ±è®¡ç®—å™¨ -->
    <div class="card" style="margin-bottom: 16px;">
      <div class="card-title">
        <span class="card-title-icon">âš¡</span>
        <span>å®æ—¶å¥–åŠ±è®¡ç®—</span>
      </div>
      
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <div>
          <div style="font-size: 12px; color: var(--text-secondary);">æ¯ç§’æ”¶ç›Š</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--success);" id="rewardPerSecond">0 LOM</div>
        </div>
        <div style="text-align: right;">
          <div style="font-size: 12px; color: var(--text-secondary);">å¹´åŒ–æ”¶ç›Šç‡</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--accent-yellow);" id="rewardAPR">0%</div>
        </div>
      </div>
      
      <div class="reward-counter" style="background: var(--gradient-card); border-radius: 12px; padding: 16px; text-align: center; margin-top: 12px;">
        <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">ç´¯è®¡å¾…é¢†å–å¥–åŠ±</div>
        <div style="font-size: 28px; font-weight: bold; color: var(--accent-yellow);" id="pendingRewards">0.000000 LOM</div>
        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
          æ¯ç§’å¢åŠ : <span id="rewardPerSecondDisplay">0.000000</span> LOM
        </div>
      </div>
    </div>
    
    <!-- é˜¶æ¢¯å¥–åŠ±ç³»ç»Ÿ -->
    <div class="card" style="margin-bottom: 16px;">
      <div class="card-title">
        <span class="card-title-icon">ğŸ…</span>
        <span>é˜¶æ¢¯å¥–åŠ±</span>
      </div>
      
      <div class="tier-rewards-container" id="tierRewardsContainer">
        <!-- é˜¶æ¢¯å¥–åŠ±å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
    
    <!-- è´¨æŠ¼è®°å½• -->
    <div class="card" style="margin-bottom: 16px;">
      <div class="card-title">
        <span class="card-title-icon">ğŸ“Š</span>
        <span>è´¨æŠ¼è®°å½•</span>
      </div>
      
      <div class="stake-history-container" id="stakeHistoryContainer" style="max-height: 200px; overflow-y: auto;">
        <!-- è´¨æŠ¼è®°å½•å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button class="modal-btn cancel" id="closeRewardModal">å…³é—­</button>
      <button class="modal-btn confirm" id="stakeLPBtn" style="background: var(--gradient-yellow); color: #0f172a;">
        <span>ğŸ’§</span>
        <span>è´¨æŠ¼LP</span>
      </button>
      <button class="modal-btn confirm" id="claimRewardBtn" disabled style="flex: 2;">
        <span>ğŸ’°</span>
        <span>é¢†å–å¥–åŠ±</span>
      </button>
    </div>
  </div>
</div>

<!-- è´¨æŠ¼LPæ¨¡æ€æ¡† -->
<div class="modal-overlay" id="stakeLPModal">
  <div class="modal-card">
    <h3 class="modal-title">è´¨æŠ¼LPä»£å¸</h3>
    
    <div class="modal-input-group">
      <label class="modal-input-label">LPä»£å¸æ•°é‡</label>
      <div style="display: flex; gap: 8px;">
        <input type="number" class="modal-input" id="stakeLPAmount" placeholder="0" step="any" min="0">
        <button class="btn" id="stakeLPMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
      </div>
      <div style="display: flex; justify-content: space-between; margin-top: 4px;">
        <div style="font-size: 11px; color: var(--text-secondary);">
          ä½™é¢: <span id="lpBalance">0</span> LP
        </div>
        <div style="font-size: 11px; color: var(--text-secondary);">
          å·²è´¨æŠ¼: <span id="alreadyStakedLP">0</span> LP
        </div>
      </div>
    </div>
    
    <div style="background: rgba(26, 115, 232, 0.1); border-radius: 10px; padding: 12px; margin: 16px 0; text-align: center;">
      <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">é¢„ä¼°å¹´åŒ–æ”¶ç›Š</div>
      <div style="font-size: 18px; font-weight: bold; color: var(--accent-yellow);" id="estimatedAPR">45.8%</div>
    </div>
    
    <div class="modal-actions">
      <button class="modal-btn cancel" id="cancelStakeBtn">å–æ¶ˆ</button>
      <button class="modal-btn confirm" id="confirmStakeBtn" disabled>ç¡®è®¤è´¨æŠ¼</button>
    </div>
  </div>
</div>

<!-- é¢†å–å¥–åŠ±ç¡®è®¤æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="claimRewardModal">
  <div class="modal-card" style="text-align: center;">
    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ’°</div>
    <div style="font-size: 20px; font-weight: bold; margin-bottom: 8px;" id="claimTitle">é¢†å–å¥–åŠ±</div>
    
    <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1)); border-radius: 12px; padding: 20px; margin: 20px 0;">
      <div style="font-size: 32px; font-weight: bold; color: var(--accent-yellow);" id="claimAmount">0.000000 LOM</div>
      <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">å¯é¢†å–å¥–åŠ±</div>
    </div>
    
    <div style="text-align: left; margin: 20px 0;">
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
        <span style="color: var(--text-secondary);">åŸºç¡€å¥–åŠ±</span>
        <span style="font-weight: 600; color: var(--text-primary);" id="baseRewardAmount">0 LOM</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
        <span style="color: var(--text-secondary);">é˜¶æ¢¯åŠ æˆ</span>
        <span style="font-weight: 600; color: var(--success);" id="tierBonusAmount">0 LOM</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0;">
        <span style="color: var(--text-secondary);">æ€»è®¡</span>
        <span style="font-weight: 600; color: var(--accent-yellow);" id="totalClaimAmount">0 LOM</span>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="modal-btn cancel" id="cancelClaimBtn">å–æ¶ˆ</button>
      <button class="modal-btn confirm" id="confirmClaimBtn">ç¡®è®¤é¢†å–</button>
    </div>
  </div>
</div>

<style>
  /* æ–°å¢çš„å¥–åŠ±ç³»ç»Ÿæ ·å¼ */
  .tier-reward-item {
    background: var(--gradient-card);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 8px;
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
  }
  
  .tier-reward-item.active {
    border-color: var(--accent-yellow);
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
  }
  
  .tier-reward-item.locked {
    opacity: 0.7;
  }
  
  .tier-reward-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }
  
  .tier-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }
  
  .tier-icon {
    font-size: 16px;
  }
  
  .tier-status {
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: 600;
  }
  
  .tier-status.available {
    background: rgba(46, 160, 67, 0.2);
    color: var(--success);
  }
  
  .tier-status.locked {
    background: rgba(255, 107, 107, 0.2);
    color: var(--warning);
  }
  
  .tier-status.claimed {
    background: rgba(138, 43, 226, 0.2);
    color: var(--accent-purple);
  }
  
  .tier-progress {
    margin-top: 8px;
  }
  
  .tier-progress-info {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }
  
  .tier-progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
  }
  
  .tier-progress-fill {
    height: 100%;
    background: var(--gradient-yellow);
    border-radius: 3px;
    transition: width 0.3s ease;
  }
  
  .tier-reward-amount {
    font-size: 14px;
    font-weight: 600;
    color: var(--accent-yellow);
    margin-top: 8px;
    text-align: right;
  }
  
  .stake-history-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: rgba(26, 115, 232, 0.05);
    border-radius: 8px;
    margin-bottom: 6px;
    border: 1px solid var(--border-color);
  }
  
  .stake-history-time {
    font-size: 12px;
    color: var(--text-secondary);
  }
  
  .stake-history-amount {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }
  
  .stake-history-duration {
    font-size: 11px;
    color: var(--accent-yellow);
    margin-top: 2px;
  }
  
  .reward-counter {
    position: relative;
  }
  
  .reward-counter::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 215, 0, 0.1) 50%, 
      transparent 100%);
    animation: shine 2s infinite;
    pointer-events: none;
  }
  
  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .countdown-timer {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    color: var(--accent-yellow);
    background: rgba(255, 215, 0, 0.1);
    padding: 4px 8px;
    border-radius: 6px;
    margin-left: 8px;
  }
  
  .reward-stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin: 16px 0;
  }
  
  .reward-stat-item {
    background: rgba(26, 115, 232, 0.05);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
    border: 1px solid var(--border-color);
  }
  
  .reward-stat-label {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }
  
  .reward-stat-value {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
  }
  
  .reward-stat-value.highlight {
    color: var(--accent-yellow);
  }
</style>

<script>
// ==================== å¥–åŠ±ç³»ç»Ÿé…ç½® ====================
const REWARD_CONFIG = {
  CONTRACT: "0x...", // å¥–åŠ±åˆçº¦åœ°å€ï¼ˆéœ€è¦éƒ¨ç½²åå¡«å†™ï¼‰
  TOTAL_REWARDS: 25555555,
  DURATION_DAYS: 360,
  TIERS: [
    { days: 30, multiplier: 1.1, name: "é’é“œ", icon: "ğŸ¥‰" },
    { days: 90, multiplier: 1.3, name: "ç™½é“¶", icon: "ğŸ¥ˆ" },
    { days: 180, multiplier: 1.6, name: "é»„é‡‘", icon: "ğŸ¥‡" },
    { days: 360, multiplier: 2.0, name: "é’»çŸ³", icon: "ğŸ’" }
  ]
};

// ==================== å¥–åŠ±ç³»ç»ŸçŠ¶æ€ ====================
let rewardContract = null;
let rewardInterval = null;
let userStakeInfo = null;
let userTiers = [];
let realTimeReward = 0;
let rewardUpdateTime = Date.now();

// ==================== å¥–åŠ±åˆçº¦ABI ====================
const REWARD_ABI = [
  // åŸºç¡€å‡½æ•°
  "function stake(uint256 amount) external",
  "function unstake(uint256 amount) external",
  "function claimReward() external",
  "function claimTierReward(uint256 tierIndex) external",
  
  // è§†å›¾å‡½æ•°
  "function getUserInfo(address user) external view returns (uint256 lpAmount, uint256 pendingRewards, uint256 lastUpdateTime, uint256[] memory stakeTimes, uint256[] memory stakeAmounts)",
  "function getTierStatus(address user) external view returns (uint256[] memory durations, uint256[] memory startTimes, bool[] memory claimed, bool[] memory available)",
  "function calculateRewards(address user) external view returns (uint256 pending, uint256[] memory tierRewards)",
  "function totalStakedLP() external view returns (uint256)",
  "function totalDistributedRewards() external view returns (uint256)",
  "function rewardBalance() external view returns (uint256)",
  "function dailyReward() external view returns (uint256)",
  "function accRewardPerShare() external view returns (uint256)",
  
  // äº‹ä»¶
  "event Staked(address indexed user, uint256 amount)",
  "event Unstaked(address indexed user, uint256 amount)",
  "event RewardClaimed(address indexed user, uint256 amount)",
  "event TierRewardClaimed(address indexed user, uint256 tier, uint256 amount)"
];

// ==================== å¥–åŠ±ç³»ç»Ÿç®¡ç†å™¨ ====================
const RewardManager = {
  async init() {
    if (account && REWARD_CONFIG.CONTRACT !== "0x...") {
      rewardContract = new ethers.Contract(REWARD_CONFIG.CONTRACT, REWARD_ABI, signer);
      await this.loadRewardData();
      this.startRewardCounter();
    }
  },

  async loadRewardData() {
    try {
      if (!rewardContract || !account) return;
      
      // åŠ è½½ç”¨æˆ·è´¨æŠ¼ä¿¡æ¯
      const userInfo = await rewardContract.getUserInfo(account);
      userStakeInfo = {
        lpAmount: parseFloat(ethers.utils.formatUnits(userInfo.lpAmount, 18)),
        pendingRewards: parseFloat(ethers.utils.formatUnits(userInfo.pendingRewards, 18)),
        lastUpdateTime: userInfo.lastUpdateTime.toNumber(),
        stakeTimes: userInfo.stakeTimes.map(t => t.toNumber()),
        stakeAmounts: userInfo.stakeAmounts.map(a => parseFloat(ethers.utils.formatUnits(a, 18)))
      };
      
      // åŠ è½½é˜¶æ¢¯çŠ¶æ€
      const tierStatus = await rewardContract.getTierStatus(account);
      userTiers = REWARD_CONFIG.TIERS.map((tier, index) => ({
        ...tier,
        startTime: tierStatus.startTimes[index]?.toNumber() || 0,
        claimed: tierStatus.claimed[index] || false,
        available: tierStatus.available[index] || false,
        duration: tierStatus.durations[index]?.toNumber() || (tier.days * 86400)
      }));
      
      // åŠ è½½æ€»è§ˆæ•°æ®
      const [
        totalStaked,
        distributedRewards,
        rewardBal,
        dailyRewardAmt,
        accReward
      ] = await Promise.all([
        rewardContract.totalStakedLP(),
        rewardContract.totalDistributedRewards(),
        rewardContract.rewardBalance(),
        rewardContract.dailyReward(),
        rewardContract.accRewardPerShare()
      ]);
      
      this.updateRewardUI({
        totalStakedLP: parseFloat(ethers.utils.formatUnits(totalStaked, 18)),
        distributedRewards: parseFloat(ethers.utils.formatUnits(distributedRewards, 18)),
        rewardBalance: parseFloat(ethers.utils.formatUnits(rewardBal, 18)),
        dailyReward: parseFloat(ethers.utils.formatUnits(dailyRewardAmt, 18)),
        accRewardPerShare: parseFloat(ethers.utils.formatUnits(accReward, 12))
      });
      
    } catch (error) {
      console.error("åŠ è½½å¥–åŠ±æ•°æ®å¤±è´¥:", error);
    }
  },

  updateRewardUI(data) {
    // æ›´æ–°æ€»è§ˆæ•°æ®
    if (data.totalStakedLP !== undefined) {
      document.getElementById('totalStakedLP').textContent = 
        Utils.formatDisplay(data.totalStakedLP);
    }
    
    if (data.distributedRewards !== undefined) {
      document.getElementById('distributedRewards').textContent = 
        Utils.formatDisplay(data.distributedRewards) + ' LOM';
    }
    
    if (userStakeInfo) {
      document.getElementById('myStakedLP').textContent = 
        Utils.formatDisplay(userStakeInfo.lpAmount);
      
      // è®¡ç®—å®æ—¶å¥–åŠ±
      this.calculateRealTimeReward();
    }
  },

  calculateRealTimeReward() {
    if (!userStakeInfo || !rewardContract) return;
    
    // æ¯ç§’å¥–åŠ± = (æ¯æ—¥å¥–åŠ± / 86400) * (ç”¨æˆ·LP / æ€»LP)
    const dailyReward = parseFloat(document.getElementById('dailyReward').textContent.replace(/[^0-9.]/g, ''));
    const totalStaked = parseFloat(document.getElementById('totalStakedLP').textContent.replace(/[^0-9.]/g, ''));
    
    if (dailyReward > 0 && totalStaked > 0 && userStakeInfo.lpAmount > 0) {
      const rewardPerSecond = (dailyReward / 86400) * (userStakeInfo.lpAmount / totalStaked);
      realTimeReward = rewardPerSecond;
      
      document.getElementById('rewardPerSecond').textContent = 
        Utils.formatDisplay(rewardPerSecond * 86400 * 365) + ' LOM/å¹´';
      
      document.getElementById('rewardPerSecondDisplay').textContent = 
        Utils.formatDisplay(rewardPerSecond);
      
      // è®¡ç®—å¹´åŒ–æ”¶ç›Šç‡
      const totalValue = userStakeInfo.lpAmount * 2; // å‡è®¾LPä»·å€¼ç­‰äºä¸¤ä¸ªä»£å¸çš„æ€»å’Œ
      const yearlyReward = rewardPerSecond * 86400 * 365;
      const apr = totalValue > 0 ? (yearlyReward / totalValue) * 100 : 0;
      
      document.getElementById('rewardAPR').textContent = 
        apr.toFixed(2) + '%';
    }
  },

  startRewardCounter() {
    if (rewardInterval) clearInterval(rewardInterval);
    
    rewardInterval = setInterval(() => {
      if (realTimeReward > 0 && userStakeInfo) {
        const now = Date.now();
        const secondsPassed = (now - rewardUpdateTime) / 1000;
        rewardUpdateTime = now;
        
        userStakeInfo.pendingRewards += realTimeReward * secondsPassed;
        
        document.getElementById('pendingRewards').textContent = 
          Utils.formatDisplay(userStakeInfo.pendingRewards) + ' LOM';
        
        // æ›´æ–°é˜¶æ¢¯å¥–åŠ±æ˜¾ç¤º
        this.updateTierRewardsDisplay();
      }
    }, 1000);
  },

  async openRewardModal() {
    if (!account) {
      Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
      return;
    }
    
    if (!rewardContract) {
      await this.init();
    }
    
    document.getElementById('rewardModal').style.display = 'flex';
    await this.loadRewardData();
    this.updateStakeHistory();
    this.updateTierRewardsDisplay();
  },

  updateTierRewardsDisplay() {
    const container = document.getElementById('tierRewardsContainer');
    container.innerHTML = '';
    
    userTiers.forEach((tier, index) => {
      const tierElement = document.createElement('div');
      tierElement.className = `tier-reward-item ${tier.available ? 'active' : 'locked'}`;
      
      // è®¡ç®—è¿›åº¦
      const now = Math.floor(Date.now() / 1000);
      const elapsed = tier.startTime > 0 ? now - tier.startTime : 0;
      const progress = tier.startTime > 0 ? 
        Math.min(100, (elapsed / tier.duration) * 100) : 0;
      
      // è®¡ç®—é¢„ä¼°å¥–åŠ±
      const baseReward = userStakeInfo?.pendingRewards || 0;
      const tierReward = baseReward * (tier.multiplier - 1);
      
      tierElement.innerHTML = `
        <div class="tier-reward-header">
          <div class="tier-title">
            <span class="tier-icon">${tier.icon}</span>
            <span>${tier.name}å¥–åŠ± (${tier.days}å¤©)</span>
          </div>
          <div class="tier-status ${tier.claimed ? 'claimed' : tier.available ? 'available' : 'locked'}">
            ${tier.claimed ? 'å·²é¢†å–' : tier.available ? 'å¯é¢†å–' : 'è¿›è¡Œä¸­'}
          </div>
        </div>
        
        <div class="tier-progress">
          <div class="tier-progress-info">
            <span>æŒæœ‰æ—¶é—´</span>
            <span>${Math.floor(elapsed / 86400)}/${tier.days}å¤©</span>
          </div>
          <div class="tier-progress-bar">
            <div class="tier-progress-fill" style="width: ${progress}%"></div>
          </div>
        </div>
        
        ${!tier.claimed ? `
          <div class="tier-reward-amount">
            é¢å¤–å¥–åŠ±: ${Utils.formatDisplay(tierReward)} LOM
            ${tier.available ? '<button class="claim-tier-btn" data-tier="' + index + '" style="margin-left: 8px; padding: 4px 8px; background: var(--accent-yellow); color: #0f172a; border: none; border-radius: 4px; font-size: 11px; cursor: pointer;">é¢†å–</button>' : ''}
          </div>
        ` : ''}
      `;
      
      container.appendChild(tierElement);
    });
    
    // æ·»åŠ é¢†å–æŒ‰é’®äº‹ä»¶
    container.querySelectorAll('.claim-tier-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const tierIndex = parseInt(e.target.dataset.tier);
        await this.claimTierReward(tierIndex);
      });
    });
  },

  updateStakeHistory() {
    const container = document.getElementById('stakeHistoryContainer');
    container.innerHTML = '';
    
    if (!userStakeInfo || userStakeInfo.stakeTimes.length === 0) {
      container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">æš‚æ— è´¨æŠ¼è®°å½•</div>';
      return;
    }
    
    userStakeInfo.stakeTimes.forEach((time, index) => {
      const amount = userStakeInfo.stakeAmounts[index];
      const now = Math.floor(Date.now() / 1000);
      const elapsed = now - time;
      const days = Math.floor(elapsed / 86400);
      
      const item = document.createElement('div');
      item.className = 'stake-history-item';
      item.innerHTML = `
        <div>
          <div class="stake-history-time">${new Date(time * 1000).toLocaleDateString()}</div>
          <div class="stake-history-duration">å·²æŒæœ‰ ${days} å¤©</div>
        </div>
        <div class="stake-history-amount">${Utils.formatDisplay(amount)} LP</div>
      `;
      
      container.appendChild(item);
    });
  },

  async openStakeModal() {
    if (!account) {
      Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
      return;
    }
    
    // è·å–LPä½™é¢
    const lpBalance = await pair.balanceOf(account);
    const lpBalanceFormatted = parseFloat(ethers.utils.formatUnits(lpBalance, 18));
    
    document.getElementById('lpBalance').textContent = Utils.formatDisplay(lpBalanceFormatted);
    document.getElementById('alreadyStakedLP').textContent = 
      userStakeInfo ? Utils.formatDisplay(userStakeInfo.lpAmount) : '0';
    
    document.getElementById('stakeLPModal').style.display = 'flex';
    document.getElementById('stakeLPAmount').value = '';
    document.getElementById('confirmStakeBtn').disabled = true;
  },

  async stakeLP() {
    const amount = document.getElementById('stakeLPAmount').value;
    if (!amount || parseFloat(amount) <= 0) {
      Utils.showError(isChinese ? "è¯·è¾“å…¥æœ‰æ•ˆæ•°é‡" : "Please enter valid amount");
      return;
    }
    
    const amountBN = TokenUtils.parseTokenAmount(amount, 'LP');
    
    try {
      Utils.showNotification(isChinese ? "è´¨æŠ¼å¤„ç†ä¸­..." : "Processing stake...", "info");
      
      // å…ˆæˆæƒ
      await TransactionManager.checkAndApprove(pair, REWARD_CONFIG.CONTRACT, amountBN);
      
      // ç„¶åè´¨æŠ¼
      const tx = await rewardContract.stake(amountBN);
      await tx.wait();
      
      Utils.showNotification(isChinese ? "è´¨æŠ¼æˆåŠŸï¼" : "Staked successfully!", "success");
      
      // åˆ·æ–°æ•°æ®
      await this.loadRewardData();
      this.updateStakeHistory();
      this.updateTierRewardsDisplay();
      
      document.getElementById('stakeLPModal').style.display = 'none';
      
    } catch (error) {
      console.error("è´¨æŠ¼å¤±è´¥:", error);
      Utils.showNotification(Utils.getErrorMessage(error), "error");
    }
  },

  async claimAllRewards() {
    try {
      Utils.showNotification(isChinese ? "é¢†å–å¥–åŠ±ä¸­..." : "Claiming rewards...", "info");
      
      const tx = await rewardContract.claimReward();
      await tx.wait();
      
      Utils.showNotification(isChinese ? "å¥–åŠ±é¢†å–æˆåŠŸï¼" : "Rewards claimed successfully!", "success");
      
      // åˆ·æ–°æ•°æ®
      await this.loadRewardData();
      this.updateTierRewardsDisplay();
      
    } catch (error) {
      console.error("é¢†å–å¥–åŠ±å¤±è´¥:", error);
      Utils.showNotification(Utils.getErrorMessage(error), "error");
    }
  },

  async claimTierReward(tierIndex) {
    try {
      Utils.showNotification(isChinese ? "é¢†å–é˜¶æ¢¯å¥–åŠ±ä¸­..." : "Claiming tier reward...", "info");
      
      const tx = await rewardContract.claimTierReward(tierIndex);
      await tx.wait();
      
      Utils.showNotification(isChinese ? "é˜¶æ¢¯å¥–åŠ±é¢†å–æˆåŠŸï¼" : "Tier reward claimed successfully!", "success");
      
      // åˆ·æ–°æ•°æ®
      await this.loadRewardData();
      this.updateTierRewardsDisplay();
      
    } catch (error) {
      console.error("é¢†å–é˜¶æ¢¯å¥–åŠ±å¤±è´¥:", error);
      Utils.showNotification(Utils.getErrorMessage(error), "error");
    }
  },

  async openClaimModal() {
    if (!userStakeInfo || userStakeInfo.pendingRewards <= 0) {
      Utils.showError(isChinese ? "æš‚æ— å¥–åŠ±å¯é¢†å–" : "No rewards to claim");
      return;
    }
    
    // è®¡ç®—å¯é¢†å–çš„é˜¶æ¢¯å¥–åŠ±
    let tierBonus = 0;
    userTiers.forEach((tier, index) => {
      if (tier.available && !tier.claimed) {
        tierBonus += userStakeInfo.pendingRewards * (tier.multiplier - 1);
      }
    });
    
    const totalClaim = userStakeInfo.pendingRewards + tierBonus;
    
    document.getElementById('claimAmount').textContent = 
      Utils.formatDisplay(totalClaim) + ' LOM';
    document.getElementById('baseRewardAmount').textContent = 
      Utils.formatDisplay(userStakeInfo.pendingRewards) + ' LOM';
    document.getElementById('tierBonusAmount').textContent = 
      Utils.formatDisplay(tierBonus) + ' LOM';
    document.getElementById('totalClaimAmount').textContent = 
      Utils.formatDisplay(totalClaim) + ' LOM';
    
    document.getElementById('claimRewardModal').style.display = 'flex';
  }
};



// ==================== ç•Œé¢ç®¡ç†å™¨ ====================
const UIManager = {
  init() {
    this.setupEventListeners();
    this.setupTabs();
    this.updateAllTexts();
    this.setupFocusEffects();
    
    document.getElementById('txStatusDoneBtn').addEventListener('click', () => {
      Utils.hideNotification();
    });
    
    InviteManager.updateInviteUI();
    this.showFooterAndRiskWarning();
  },

  setupEventListeners() {
    // é’±åŒ…å’Œè¯­è¨€æŒ‰é’®
    document.getElementById("walletBtn").addEventListener("click", () => this.handleWalletClick());
    document.getElementById("langBtn").addEventListener("click", () => this.toggleLanguage());
    
    // å…‘æ¢é¡µé¢äº‹ä»¶
    const debouncedFromInput = Utils.debounce(() => this.handleFromAmountInput(), 300);
    document.getElementById("fromAmount").addEventListener("input", debouncedFromInput);
    
    document.getElementById("reverse").addEventListener("click", () => SwapModule.reverseTokens());
    document.getElementById("swapBtn").addEventListener("click", async () => {
      if (!account) {
        await this.handleWalletClick();
      } else {
        await SwapModule.executeSwap();
      }
    });
    
    // ç™¾åˆ†æ¯”æŒ‰é’®
    document.querySelectorAll('.percent-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.handlePercentageClick(e));
    });
    
    // æ»‘ç‚¹æŒ‰é’®
    document.querySelectorAll('.slippage-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.handleSlippageClick(e));
    });
    
    // ä»£å¸é€‰æ‹©å™¨
    document.getElementById("fromTokenSelector").addEventListener("click", () => this.openTokenSelector('from'));
    document.getElementById("toTokenSelector").addEventListener("click", () => this.openTokenSelector('to'));
    
    // æµåŠ¨æ€§é¡µé¢äº‹ä»¶
    document.getElementById("addBtn").addEventListener("click", () => this.openAddModal());
    document.getElementById("removeBtn").addEventListener("click", () => this.openRemoveModal());
    
    // é‚€è¯·ç³»ç»Ÿäº‹ä»¶
    document.getElementById("bindInviteBtn").addEventListener("click", () => InviteManager.bindInviteAddress());
    document.getElementById("unlockInviteBtn").addEventListener("click", () => InviteManager.unbindInviteAddress());
    document.getElementById("goToStakeLocked").addEventListener("click", () => InviteManager.goToStaking());
    
    // æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("modal-overlay") || 
          e.target.classList.contains("token-selector-modal")) {
        e.target.style.display = "none";
      }
    });
    
    // æ·»åŠ æµåŠ¨æ€§äº‹ä»¶
    const debouncedCfxInput = Utils.debounce(() => LiquidityModule.handleCfxInput(), 300);
    const debouncedLomInput = Utils.debounce(() => LiquidityModule.handleLomInput(), 300);
    document.getElementById("addCfx").addEventListener("input", debouncedCfxInput);
    document.getElementById("addLom").addEventListener("input", debouncedLomInput);
    document.getElementById("cfxMaxBtn").addEventListener("click", () => LiquidityModule.setMaxCfx());
    document.getElementById("lomMaxBtn").addEventListener("click", () => LiquidityModule.setMaxLom());
    document.getElementById("cancelAddBtn").addEventListener("click", () => document.getElementById("addModal").style.display = "none");
    document.getElementById("confirmAddBtn").addEventListener("click", () => LiquidityModule.addLiquidity());
    
    // ç§»é™¤æµåŠ¨æ€§äº‹ä»¶
    document.getElementById("removeSlider").addEventListener("input", (e) => LiquidityModule.updateRemoveEstimate(e.target.value));
    document.querySelectorAll('.percentage-option').forEach(btn => {
      btn.addEventListener('click', (e) => this.handlePercentageOption(e));
    });
    document.getElementById("cancelRemoveBtn").addEventListener("click", () => document.getElementById("removeModal").style.display = "none");
    document.getElementById("confirmRemoveBtn").addEventListener("click", () => LiquidityModule.removeLiquidity());
    
    // ä½™é¢ç‚¹å‡»äº‹ä»¶
    document.getElementById("fromBal").addEventListener("click", () => {
      this.setMaxFromBalance();
    });
    
    // é‚€è¯·è¾“å…¥äº‹ä»¶
    document.getElementById("inviteAddress").addEventListener("input", (e) => {
      const errorText = document.getElementById('inviteErrorText');
      e.target.classList.remove('invite-input-error');
      errorText.classList.remove('show');
    });
  },

  showFooterAndRiskWarning() {
    const riskWarning = document.getElementById('riskWarning');
    const footer = document.getElementById('footerText');
    
    if (riskWarning) riskWarning.style.display = 'block';
    if (footer) footer.style.display = 'block';
  },

  async handleWalletClick() {
    if (account) {
      const confirmMessage = isChinese ? 
        "ç¡®å®šè¦æ–­å¼€é’±åŒ…è¿æ¥å—ï¼Ÿ" : 
        "Are you sure you want to disconnect wallet?";
      
      if (confirm(confirmMessage)) {
        WalletManager.disconnect();
      }
      return;
    }
    
    document.getElementById("walletBtn").disabled = true;
    
    try {
      const success = await WalletManager.connect();
      if (success) {
        WalletManager.updateUI();
        DataManager.refreshAll();
      }
    } catch (error) {
      console.error("é’±åŒ…è¿æ¥å¤±è´¥:", error);
    } finally {
      document.getElementById("walletBtn").disabled = false;
      WalletManager.updateUI();
    }
  },

  setupTabs() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;
        
        tabBtns.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(tabId + 'Tab').classList.add('active');
        
        if (account) {
          DataManager.refreshAll();
        }
      });
    });
  },

  handleFromAmountInput() {
    const amount = document.getElementById("fromAmount").value;
    if (amount && amount !== "0") {
      lastInputWasFrom = true;
      SwapModule.updateOutputFromInput();
    } else {
      document.getElementById("toAmount").value = "";
      DataManager.updateSwapButtonState();
      document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
      SwapModule.hideLOMSlippageWarning();
    }
  },

  handlePercentageClick(e) {
    const percent = parseFloat(e.target.dataset.percent);
    
    document.querySelectorAll('.percent-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    SwapModule.handlePercentageClick(percent);
  },

  handleSlippageClick(e) {
    const newSlippage = parseFloat(e.target.dataset.slip);
    
    if (fromToken === 'LOM' && newSlippage < 5) {
      Utils.showNotification(
        isChinese ? 'LOMäº¤æ˜“éœ€è¦5%ä»¥ä¸Šæ»‘ç‚¹ä»¥é¿å…äº¤æ˜“å¤±è´¥' : 
                  'LOM transactions require 5%+ slippage to avoid failure',
        'warning'
      );
    }
    
    slippage = newSlippage;
    document.querySelectorAll('.slippage-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    if (lastInputWasFrom && document.getElementById("fromAmount").value) {
      SwapModule.updateOutputFromInput();
    }
  },

  handlePercentageOption(e) {
    const percent = e.target.dataset.percent;
    document.querySelectorAll('.percentage-option').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    document.getElementById("removeSlider").value = percent;
    document.getElementById("removePercent").textContent = percent + "%";
    LiquidityModule.updateRemoveEstimate(percent);
  },

  openTokenSelector(type) {
    currentTokenSelector = type;
    const modal = document.getElementById("tokenSelectorModal");
    modal.style.display = "flex";
    document.getElementById("tokenSearch").value = "";
    this.populateTokenList();
  },

  async populateTokenList(searchTerm = "") {
    const tokenList = document.getElementById("tokenList");
    tokenList.innerHTML = "";
    
    const filteredTokens = TOKEN_LIST.filter(token => {
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        return token.symbol.toLowerCase().includes(term) || 
               token.name.toLowerCase().includes(term);
      }
      return true;
    });
    
    const fragment = document.createDocumentFragment();
    
    filteredTokens.forEach(token => {
      if ((currentTokenSelector === 'from' && token.symbol === toToken) ||
          (currentTokenSelector === 'to' && token.symbol === fromToken)) {
        return;
      }
      
      const tokenItem = document.createElement("div");
      tokenItem.className = "token-item";
      tokenItem.innerHTML = `
        <div class="token-item-logo" style="background-image: url('${token.logo}')"></div>
        <div class="token-item-info">
          <div class="token-item-symbol">${token.symbol}</div>
          <div class="token-item-name">${token.name}</div>
        </div>
        <div class="token-item-balance" id="selectorBalance-${token.symbol}">0.000000</div>
      `;
      
      tokenItem.addEventListener("click", () => {
        this.selectToken(token);
      });
      
      fragment.appendChild(tokenItem);
    });
    
    tokenList.appendChild(fragment);
    
    // å¼‚æ­¥æ›´æ–°ä½™é¢
    setTimeout(() => {
      if (account) {
        filteredTokens.forEach(token => {
          this.updateTokenBalanceInSelector(token.symbol);
        });
      }
    }, 50);
    
    // è®¾ç½®æœç´¢äº‹ä»¶
    const searchInput = document.getElementById("tokenSearch");
    const debouncedSearch = Utils.debounce((e) => {
      this.populateTokenList(e.target.value);
    }, 300);
    
    searchInput.removeEventListener('input', this.handleSearchInput);
    this.handleSearchInput = debouncedSearch;
    searchInput.addEventListener('input', this.handleSearchInput);
    
    setTimeout(() => searchInput.focus(), 100);
  },

  handleSearchInput: null,

  async updateTokenBalanceInSelector(symbol) {
    try {
      const token = TokenUtils.getToken(symbol);
      if (!token) return;
      
      let amount = 0;
      
      if (symbol === 'CFX' && provider && account) {
        const cfxBal = await provider.getBalance(account);
        amount = parseFloat(ethers.utils.formatEther(cfxBal));
      } else {
        const contract = TokenUtils.getTokenContract(symbol);
        if (contract && account) {
          const tokenBal = await contract.balanceOf(account);
          amount = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
        }
      }
      
      const formattedBalance = Utils.formatDisplay(amount);
      
      const balanceElement = document.getElementById(`selectorBalance-${symbol}`);
      if (balanceElement) {
        balanceElement.textContent = formattedBalance;
      }
    } catch (error) {
      console.error(`æ›´æ–°${symbol}ä½™é¢å¤±è´¥:`, error);
    }
  },

  selectToken(token) {
    if (currentTokenSelector === 'from') {
      fromToken = token.symbol;
      document.getElementById("fromTokenSymbol").textContent = token.symbol;
      document.getElementById("fromTokenLogo").style.backgroundImage = `url('${token.logo}')`;
    } else if (currentTokenSelector === 'to') {
      toToken = token.symbol;
      document.getElementById("toTokenSymbol").textContent = token.symbol;
      document.getElementById("toTokenLogo").style.backgroundImage = `url('${token.logo}')`;
    }
    
    document.getElementById("tokenSelectorModal").style.display = "none";
    DataManager.updateAllBalances();
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    
    DataManager.updateSwapButtonState();
    document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
    
    SwapModule.hideLOMSlippageWarning();
  },

  async setMaxFromBalance() {
    if (!account) {
      Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
      return;
    }
    
    let balance = parseFloat(document.getElementById("fromBal").textContent);
    
    if (balance > 0) {
      let amount;
      
      if (fromToken === 'CFX') {
        amount = Math.max(0, balance - 0.1);
      } else {
        amount = balance * 0.9;
      }
      
      if (amount > 0) {
        document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
        lastInputWasFrom = true;
        await SwapModule.updateOutputFromInput();
      }
    }
  },

  toggleLanguage() {
    isChinese = !isChinese;
    document.getElementById("langBtn").innerText = isChinese ? "EN" : "ZN";
    this.updateAllTexts();
    InviteManager.updateInviteTexts();
  },

  updateAllTexts() {
    const walletBtn = document.getElementById("walletBtn");
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      walletBtn.textContent = displayAddress;
      walletBtn.classList.add('connected');
    } else {
      walletBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
      walletBtn.classList.remove('connected');
    }
    
    document.querySelector('[data-tab="swap"]').textContent = isChinese ? "å…‘æ¢" : "Swap";
    document.querySelector('[data-tab="liquidity"]').textContent = isChinese ? "æµåŠ¨æ€§" : "Liquidity";
    
    const swapBtn = document.getElementById("swapBtn");
    if (!account) {
      swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
      swapBtn.disabled = false;
    } else if (document.getElementById("fromAmount").value && document.getElementById("fromAmount").value !== "0") {
      swapBtn.textContent = isChinese ? "ç«‹å³å…‘æ¢" : "Swap Now";
      swapBtn.disabled = false;
    } else {
      swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
      swapBtn.disabled = true;
    }
    
    document.getElementById("addBtn").textContent = isChinese ? "æ·»åŠ æµåŠ¨æ€§" : "Add Liquidity";
    document.getElementById("removeBtn").textContent = isChinese ? "ç§»é™¤æµåŠ¨æ€§" : "Remove Liquidity";
    
    document.getElementById("tokenSelectorTitle").textContent = isChinese ? "é€‰æ‹©ä»£å¸" : "Select Token";
    document.getElementById("addTitle").textContent = isChinese ? "æ·»åŠ æµåŠ¨æ€§" : "Add Liquidity";
    document.getElementById("removeTitle").textContent = isChinese ? "ç§»é™¤æµåŠ¨æ€§" : "Remove Liquidity";
    document.getElementById("confirmAddBtn").textContent = isChinese ? "ç¡®è®¤æ·»åŠ " : "Confirm Add";
    document.getElementById("confirmRemoveBtn").textContent = isChinese ? "ç¡®è®¤ç§»é™¤" : "Confirm Remove";
    document.getElementById("cancelAddBtn").textContent = isChinese ? "å–æ¶ˆ" : "Cancel";
    document.getElementById("cancelRemoveBtn").textContent = isChinese ? "å–æ¶ˆ" : "Cancel";
    
    document.getElementById("riskTitle").textContent = isChinese ? "é£é™©æç¤º" : "Risk Warning";
    document.getElementById("riskText").textContent = isChinese ? 
      "æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚" :
      "This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.";
    
    document.getElementById("footerText").textContent = isChinese ? "LOMswap Â· Conflux eSpace" : "LOMswap Â· Conflux eSpace";
  },

  openAddModal() {
    if (!account) {
      Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
      return;
    }
    
    document.getElementById("addModal").style.display = "flex";
    document.getElementById("addCfx").value = "";
    document.getElementById("addLom").value = "";
    document.getElementById("confirmAddBtn").disabled = true;
    
    if (currentRatio > 0) {
      const ratioFormatted = Utils.formatDisplay(currentRatio);
      document.getElementById("addRatio").textContent = `1 CFX = ${ratioFormatted} LOM`;
    }
  },

  openRemoveModal() {
    if (!account) {
      Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
      return;
    }
    
    document.getElementById("removeModal").style.display = "flex";
    LiquidityModule.updateRemoveEstimate(100);
  },

  setupFocusEffects() {
    const fromInput = document.getElementById("fromAmount");
    const toInput = document.getElementById("toAmount");
    const fromWrapper = document.getElementById("fromTokenWrapper");
    const toWrapper = document.getElementById("toTokenWrapper");
    
    fromInput.addEventListener('focus', () => {
      fromWrapper.classList.add('focused');
    });
    
    fromInput.addEventListener('blur', () => {
      fromWrapper.classList.remove('focused');
    });
    
    toInput.addEventListener('focus', () => {
      toWrapper.classList.add('focused');
    });
    
    toInput.addEventListener('blur', () => {
      toWrapper.classList.remove('focused');
    });
  }
};

     // ==================== åˆå§‹åŒ–å¥–åŠ±ç³»ç»Ÿ ====================
// åœ¨åŸæœ‰çš„åˆå§‹åŒ–ä»£ç ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹

// åœ¨æµåŠ¨æ€§é¡µé¢æ·»åŠ å¥–åŠ±ç³»ç»Ÿå…¥å£æŒ‰é’®
function addRewardSystemButton() {
  const liquidityCard = document.querySelector('#liquidityTab .card');
  if (liquidityCard) {
    const rewardButton = document.createElement('button');
    rewardButton.className = 'stake-lp-button';
    rewardButton.id = 'openRewardSystemBtn';
    rewardButton.innerHTML = `
      <span>ğŸ†</span>
      <span>LPå¥–åŠ±ç³»ç»Ÿ</span>
      <span class="countdown-timer" id="rewardCountdown" style="display: none;"></span>
    `;
    rewardButton.style.marginTop = '12px';
    rewardButton.style.background = 'var(--gradient-green)';
    
    liquidityCard.appendChild(rewardButton);
    
    // æ·»åŠ äº‹ä»¶ç›‘å¬
    rewardButton.addEventListener('click', () => {
      RewardManager.openRewardModal();
    });
  }
}

// ==================== äº‹ä»¶ç›‘å¬å™¨è®¾ç½® ====================
function setupRewardSystemListeners() {
  // å¥–åŠ±æ¨¡æ€æ¡†æŒ‰é’®
  document.getElementById('closeRewardModal')?.addEventListener('click', () => {
    document.getElementById('rewardModal').style.display = 'none';
  });
  
  document.getElementById('stakeLPBtn')?.addEventListener('click', () => {
    RewardManager.openStakeModal();
  });
  
  document.getElementById('claimRewardBtn')?.addEventListener('click', () => {
    RewardManager.openClaimModal();
  });
  
  // è´¨æŠ¼æ¨¡æ€æ¡†
  document.getElementById('cancelStakeBtn')?.addEventListener('click', () => {
    document.getElementById('stakeLPModal').style.display = 'none';
  });
  
  document.getElementById('stakeLPMaxBtn')?.addEventListener('click', async () => {
    const lpBalance = parseFloat(document.getElementById('lpBalance').textContent);
    if (lpBalance > 0) {
      document.getElementById('stakeLPAmount').value = Utils.formatDisplay(lpBalance);
      document.getElementById('confirmStakeBtn').disabled = false;
    }
  });
  
  document.getElementById('stakeLPAmount')?.addEventListener('input', (e) => {
    const amount = parseFloat(e.target.value);
    const lpBalance = parseFloat(document.getElementById('lpBalance').textContent);
    document.getElementById('confirmStakeBtn').disabled = !amount || amount <= 0 || amount > lpBalance;
  });
  
  document.getElementById('confirmStakeBtn')?.addEventListener('click', () => {
    RewardManager.stakeLP();
  });
  
  // é¢†å–å¥–åŠ±æ¨¡æ€æ¡†
  document.getElementById('cancelClaimBtn')?.addEventListener('click', () => {
    document.getElementById('claimRewardModal').style.display = 'none';
  });
  
  document.getElementById('confirmClaimBtn')?.addEventListener('click', () => {
    RewardManager.claimAllRewards();
    document.getElementById('claimRewardModal').style.display = 'none';
  });
  
  // é’±åŒ…è¿æ¥æ—¶åˆå§‹åŒ–å¥–åŠ±ç³»ç»Ÿ
  const originalConnect = WalletManager.connect;
  WalletManager.connect = async function() {
    const result = await originalConnect.apply(this, arguments);
    if (result) {
      addRewardSystemButton();
      await RewardManager.init();
    }
    return result;
  };
}

document.addEventListener('DOMContentLoaded', function() {
  // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿å…¶ä»–å…ƒç´ å·²åŠ è½½
  setTimeout(() => {
    addRewardSystemButton();
    setupRewardSystemListeners();
    
    // å¦‚æœå·²ç»è¿æ¥äº†é’±åŒ…ï¼Œåˆå§‹åŒ–å¥–åŠ±ç³»ç»Ÿ
    if (account) {
      RewardManager.init();
    }
  }, 1000);
});

// ==================== åˆå§‹åŒ–åº”ç”¨ ====================
document.addEventListener('DOMContentLoaded', function() {
  UIManager.init();
  
  if (window.ethereum) {
    window.ethereum.on('accountsChanged', (accounts) => {
      if (accounts.length === 0) {
        WalletManager.disconnect();
      } else {
        account = accounts[0];
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        WalletManager.initContracts();
        WalletManager.restoreInviteAddress();
        WalletManager.updateUI();
        DataManager.refreshAll();
        if (!refreshInterval) {
          refreshInterval = setInterval(() => DataManager.refreshAll(), 10000);
        }
      }
    });
    
    window.ethereum.on('chainChanged', () => {
      location.reload();
    });
    
    window.ethereum.on('disconnect', () => {
      WalletManager.disconnect();
    });
  }
});
</script>       
</body>
</html>
