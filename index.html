<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap</title>
  
  <!-- æ”¶è—å›¾æ ‡å’Œç¤¾äº¤åª’ä½“æ ‡ç­¾ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <!-- Open Graph æ ‡ç­¾ï¼Œç”¨äºç¤¾äº¤åª’ä½“åˆ†äº« -->
  <meta property="og:title" content="LOMswap - Conflux å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€">
  <meta property="og:description" content="åœ¨ Conflux eSpace ä¸Šäº¤æ˜“ LOM ä»£å¸">
  <meta property="og:image" content="https://i.imgur.com/HddyTrv.jpeg">
  <meta property="og:url" content="https://lom-dex.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- å®‰å…¨ç­–ç•¥ (ä¼˜åŒ–ç‰ˆæœ¬) -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self' https:;
                 script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https://i.imgur.com data:;
                 connect-src 'self' https://*.confluxrpc.com wss: blob:;
                 font-src 'self' data:;
                 frame-src 'none';
                 object-src 'none';">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== åŸºç¡€æ ·å¼ ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --bronze: #cd7f32;
      --silver: #c0c0c0;
      --gold: #ffd700;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== é¡¹ç›®ä»‹ç»å¼¹çª— ========== */
    .project-intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .project-intro-overlay.show {
      display: flex;
    }
    
    .project-intro-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
      position: relative;
      animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .project-intro-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .project-intro-logo {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 3px solid var(--accent-yellow);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    }
    
    .project-intro-title {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 10px;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }
    
    .project-intro-close-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: var(--accent-yellow);
      transform: rotate(90deg);
    }
    
    /* ========== å¤´éƒ¨æ ·å¼ä¼˜åŒ– ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
      position: relative;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-container:hover {
      transform: translateY(-2px);
    }
    
    .logo-img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .wallet-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      width: auto;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
      max-width: 220px;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 0;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
     #walletBtn {
      min-width: 110px !important;
      max-width: 110px !important;
      width: 110px !important;
   }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      max-width: 40px;
      max-height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ========== æ ‡ç­¾é¡µæ ·å¼ ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== å¡ç‰‡æ ·å¼ ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    /* ========== äº¤æ˜“ç•Œé¢æ ·å¼ ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      position: relative;
      margin-bottom: 6px;
    }
    
    .token-input-wrapper.focused {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      position: relative;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
      transform: translateY(-4px);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
       margin-bottom: -4px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
      transform: translateY(-1px);
    }
    
    .token-logo {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      margin-bottom: 12px;
      justify-content: flex-end;
    }
    
    .percent-btn {
      flex: none;
      width: 40px;
      padding: 6px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      text-align: right;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
      padding: 0;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }

    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: -6px 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
  background: transparent; /* é€æ˜èƒŒæ™¯ */
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  color: var(--text-secondary); /* æ”¹ä¸ºæ¬¡è¦æ–‡å­—é¢œè‰² */
  z-index: 2;
}
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4);
    }
    
    .swap-arrow-btn:active {
      transform: rotate(180deg) scale(0.95);
    }
    
    /* ========== äº¤æ˜“è¯¦æƒ… ========== */
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
      font-size: 12px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .detail-value.positive {
      color: var(--success);
    }
    
    .detail-value.negative {
      color: var(--warning);
    }
    
    /* ========== æ»‘ç‚¹æ§åˆ¶ ========== */
    .slippage-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }
    
    .slippage-options {
      display: flex;
      gap: 4px;
    }
    
    .slippage-btn {
      padding: 4px 8px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 35px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    /* ========== ä¸»æ“ä½œæŒ‰é’® ========== */
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:active {
      transform: translateY(0);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========== æµåŠ¨æ€§é¡µé¢æ ·å¼ ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stat-value-large {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stat-value-large.positive {
      color: var(--accent-yellow);
    }
    
    .position-actions {
      display: flex;
      gap: 8px;
    }
    
    .position-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    /* ========== è´¨æŠ¼å¡ç‰‡ - æ–°å¢æ ·å¼ ========== */
    .stake-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .stake-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--accent-yellow);
      margin-bottom: 8px;
    }
    
    .stake-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      line-height: 1.4;
    }
    
    .stake-info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 16px 0;
    }
    
    .stake-info-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }
    
    .stake-info-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stake-info-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stake-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    
    .stake-action-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .stake-activate-btn {
      background: rgba(46, 160, 67, 0.1);
      color: var(--success);
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .stake-sync-btn {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .stake-claim-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .stake-checkin-btn {
      background: rgba(138, 43, 226, 0.1);
      color: var(--accent-purple);
      border: 1px solid rgba(138, 43, 226, 0.3);
    }
    
    .stake-action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .stake-action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* ========== ç”¨æˆ·å¥–åŠ±ä¿¡æ¯ ========== */
    .user-rewards-card {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
    }
    
    .user-rewards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .user-rewards-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .user-level {
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .level-bronze {
      background: rgba(205, 127, 50, 0.2);
      color: var(--bronze);
      border: 1px solid rgba(205, 127, 50, 0.4);
    }
    
    .level-silver {
      background: rgba(192, 192, 192, 0.2);
      color: var(--silver);
      border: 1px solid rgba(192, 192, 192, 0.4);
    }
    
    .level-gold {
      background: rgba(255, 215, 0, 0.2);
      color: var(--gold);
      border: 1px solid rgba(255, 215, 0, 0.4);
    }
    
    .rewards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .reward-item {
      background: rgba(26, 115, 232, 0.05);
      border-radius: 8px;
      padding: 8px;
    }
    
    .reward-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .reward-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* ========== æ¨¡æ€æ¡†æ ·å¼ ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .modal-input-group {
      margin-bottom: 12px;
    }
    
    .modal-input-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .modal-input:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    /* ========== ä»£å¸é€‰æ‹©å™¨ ========== */
    .token-selector-modal {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .token-selector-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .token-search {
      width: 100%;
      padding: 10px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 12px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .token-search:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-search:hover {
      border-color: var(--accent-yellow);
    }
    
    .token-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .token-item:hover {
      background: rgba(26, 115, 232, 0.1);
      transform: translateX(4px);
    }
    
    .token-item-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease;
    }
    
    .token-item:hover .token-item-logo {
      transform: scale(1.1);
    }
    
    .token-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .token-item-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.2s ease;
    }
    
    .token-item:hover .token-item-symbol {
      color: var(--accent-yellow);
    }
    
    .token-item-name {
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-item-balance {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    
    /* ========== äº¤æ˜“çŠ¶æ€æç¤º ========== */
    .transaction-status {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--gradient-primary);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(26, 115, 232, 0.4);
      z-index: 3000;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 90%;
      text-align: center;
    }
    
    .transaction-status.show {
      transform: translateX(-50%) translateY(0);
    }
    
    .transaction-status.success {
      background: var(--gradient-green);
    }
    
    .transaction-status.error {
      background: var(--gradient-red);
    }
    
    /* ========== é£é™©æç¤ºå’Œé¡µè„š ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 11px;
      color: var(--text-primary);
      line-height: 1.5;
      position: relative;
      overflow: hidden;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 12px;
      opacity: 0.7;
    }
    
    /* ========== åŠ¨ç”» ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== åŠ è½½åŠ¨ç”» ========== */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    .loading-spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }
    
    .loading-spinner.white {
      border-color: rgba(255, 255, 255, 0.3);
      border-top-color: white;
    }
    
    /* ========== å“åº”å¼è°ƒæ•´ ========== */
    @media (max-width: 480px) {
      .app {
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 14px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 44px;
        height: 44px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .header-buttons {
        min-width: 150px;
        max-width: 180px;
      }
      
      #walletBtn {
        min-width: 120px;
        max-width: 140px;
        padding: 8px 12px;
        font-size: 12px;
        height: 36px;
      }
      
      #langBtn {
        width: 36px;
        height: 36px;
        min-width: 36px;
        min-height: 36px;
        max-width: 36px;
        max-height: 36px;
        font-size: 12px;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .modal-card {
        padding: 16px;
      }
      
      .transaction-status {
        bottom: 60px;
      }
      
      .stake-actions {
        flex-direction: column;
      }
      
      .stake-action-btn {
        width: 100%;
      }
      
      .project-intro-card {
        padding: 20px;
      }
      
      .project-intro-title {
        font-size: 24px;
      }
      
      .stake-info-grid {
        grid-template-columns: 1fr;
      }
      
      .rewards-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 380px) {
      .logo-text {
        font-size: 16px;
      }
      
      .logo-img {
        width: 36px;
        height: 36px;
      }
      
      .header-buttons {
        min-width: 130px;
        max-width: 150px;
      }
      
      #walletBtn {
        min-width: 100px;
        max-width: 120px;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      #langBtn {
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        max-width: 32px;
        max-height: 32px;
      }
    }
    
    /* ========== ç§»é™¤æµåŠ¨æ€§å¼¹çª— ========== */
    .remove-liquidity-modal .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .remove-percentage {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: var(--text-primary);
      margin: 8px 0;
    }
    
    .percentage-slider {
      width: 100%;
      margin: 16px 0;
      -webkit-appearance: none;
      height: 6px;
      background: rgba(26, 115, 232, 0.1);
      border-radius: 3px;
      outline: none;
    }
    
    .percentage-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
    }
    
    .percentage-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    
    .percentage-option {
      padding: 8px;
      text-align: center;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-option:hover {
      border-color: var(--primary-blue);
    }
    
    .percentage-option.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .remove-estimate {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .remove-estimate-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .remove-estimate-amounts {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .remove-estimate-amount {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .token-amount-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 15px;
    }
    
    /* ========== ç®€å•ç¡®è®¤å¯¹è¯æ¡† ========== */
    .simple-confirm-modal .modal-card {
      max-width: 350px;
    }
    
    .confirm-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .confirm-icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
    }
    
    .confirm-action {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .confirm-amounts {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 16px 0;
    }
    
    .confirm-amount-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .confirm-amount-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .confirm-amount-text {
      font-size: 20px;
      font-weight: bold;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .confirm-details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    
    .confirm-detail-item {
      text-align: left;
      padding: 8px;
      background: rgba(26, 115, 232, 0.05);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .confirm-detail-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .confirm-detail-value {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .confirm-actions-simple {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .confirm-action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }
    
    .confirm-action-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .confirm-action-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    .confirm-action-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    .confirm-action-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* ========== äº¤æ˜“çŠ¶æ€æç¤º ========== */
    .tx-status-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 4000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .tx-status-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      max-width: 350px;
      text-align: center;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .tx-status-icon {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tx-status-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .tx-status-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .tx-status-done-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
    }
    
    .tx-status-done-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    /* ========== é”™è¯¯æç¤ºæ¡† ========== */
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 10px 14px;
      margin: 10px 0;
      font-size: 12px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .error-icon {
      display: inline-block;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <!-- é¡¹ç›®ä»‹ç»å¼¹çª— -->
  <div class="project-intro-overlay" id="projectIntroOverlay">
    <div class="project-intro-card">
      <button class="project-intro-close-btn" id="projectIntroCloseBtn">Ã—</button>
      
      <div class="project-intro-header">
        <div class="project-intro-logo"></div>
        <h1 class="project-intro-title">é¾™è„‰ LOM</h1>
        <div class="project-intro-subtitle">Conflux.ç”Ÿæ€æ ¸å¿ƒèµ„äº§</div>
        <div class="project-intro-slogan">å…±è¯†åˆ›é€ ä»·å€¼</div>
      </div>
      
      <div class="project-intro-content">
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">ğŸ‰</span>
            <span>å…³äºé¾™è„‰LOM</span>
          </div>
          <div class="project-intro-section-content">
               <p> é¾™è„‰LOMçµæ„Ÿæºè‡ªä¸­å›½ä¼ ç»Ÿæ–‡åŒ–ä¸­çš„"é¾™è„‰"æ¦‚å¿µï¼Œè±¡å¾ç€è´¢å¯Œã€ç¹è£å’Œèƒ½é‡çš„æµåŠ¨.æ˜¯æ·±åº¦èµ‹èƒ½ä¸­å›½å”¯ä¸€åˆè§„å…¬é“¾â€”â€”æ ‘å›¾ï¼ˆConfluxï¼‰çš„ç”Ÿæ€æ ¸å¿ƒèµ„äº§ï¼Œæ›´æ˜¯é“¾æ¥å…¬é“¾ä»·å€¼ã€ç”¨æˆ·æ”¶ç›Šä¸ç”Ÿæ€ç¹è£çš„å…³é”®çº½å¸¦ï¼Œä¾æ‰˜å…¬é“¾ä¼˜åŠ¿æ„å»ºä¸“å±ä»·å€¼é—­ç¯ï¼Œä¸ºå‚ä¸è€…å¸¦æ¥ç¡®å®šæ€§å›æŠ¥ã€‚<p>
 
     <p>ä½œä¸ºæ ‘å›¾å…¬é“¾çš„èµ‹èƒ½è½½ä½“ï¼ŒLOMæ·±åº¦ç»‘å®šå…¬é“¾æ ¸å¿ƒä¼˜åŠ¿ï¼šè¿™æ¡ç”±æ¸…åå›¢é˜Ÿæ‰“é€ çš„"confluxæ•°å­—é¾™è„‰"ï¼Œä»¥åˆè§„ä¸ºæ ¹ï¼Œä¸²è”40å›½èŠ‚ç‚¹ä¸"ä¸€å¸¦ä¸€è·¯"è·¨å¢ƒåœºæ™¯ï¼Œæ›´å…¼å®¹ä»¥å¤ªåŠç”Ÿæ€ã€‚ä»RWAèµ„äº§ä¸Šé“¾åˆ°ç¨³å®šå¸ç»“ç®—ï¼Œå®ƒæ­£ä»¥è‡ªä¸»å¯æ§çš„æŠ€æœ¯åº•æ°”ï¼Œæ‰¿æ¥å…¨çƒWeb3.0çˆ†å‘æµªæ½®ï¼Œè®©ä¸­å›½å…¬é“¾åŠ›é‡è´¯é€šæ•°å­—æœªæ¥ã€‚15000TPSè¶…é«˜æ€§èƒ½ã€26ç§’æé€Ÿç¡®è®¤çš„æŠ€æœ¯åº•åº§ï¼Œä»¥åŠ5000+å…¨çƒèŠ‚ç‚¹ã€2500ä¸‡ç”¨æˆ·çš„æˆç†Ÿç”Ÿæ€ï¼Œè®©æ¯ä¸€ä»½LOMè´¨æŠ¼éƒ½èƒ½ä¾æ‰˜å…¬é“¾åˆè§„èµ„è´¨ä¸çœŸå®åº”ç”¨åœºæ™¯ï¼Œå®ç°ä»·å€¼é”šå®šä¸ç¨³æ­¥å¢é•¿ã€‚<p>
 
   <p>å…¶æ ¸å¿ƒä»·å€¼èšç„¦é”å®šè´¨æŠ¼+äºŒä»£å¥–åŠ±çš„ç”Ÿæ€æ¿€åŠ±æœºåˆ¶ï¼Œç²¾å‡†åŒ¹é…æ ‘å›¾å…¬é“¾å‘å±•éœ€æ±‚ï¼šç”¨æˆ·é€šè¿‡é”å®šLOMå‚ä¸è´¨æŠ¼ï¼Œä¸ä»…èƒ½æ·±åº¦äº«å—æ ‘å›¾å…¬é“¾ç”Ÿæ€æ‰©å¼ ã€æŠ€æœ¯å‡çº§å¸¦æ¥çš„é•¿æœŸè´¨æŠ¼æ”¶ç›Šï¼Œæ›´èƒ½ä¾æ‰˜"èµ‹èƒ½å…¬é“¾"çš„æ ¸å¿ƒå®šä½ï¼Œé€šè¿‡é‚€è¯·åˆ†äº«è§£é”ä¸°åšäºŒä»£å¥–åŠ±ï¼Œè®©æ”¶ç›Šéšç”Ÿæ€è¾å°„æŒç»­æ”¾å¤§ã€‚<p>è¿™ç§æ¨¡å¼æ—¢ä¸ºæ ‘å›¾å…¬é“¾æ³¨å…¥ç¨³å®šçš„ç”Ÿæ€åŠ¨åŠ›ï¼Œä¹Ÿè®©ç”¨æˆ·æˆä¸ºå…¬é“¾å‘å±•çš„ç›´æ¥å—ç›Šè€…ï¼Œå®ç°"è´¨æŠ¼äº«çº¢åˆ©ï¼Œåˆ†äº«èµšå¥–åŠ±"çš„åŒé‡ä»·å€¼ã€‚<p>
  
            <ul>
              <li><strong>æ€»ä¾›åº”é‡</strong>ï¼š88888888æšï¼ˆæ°¸ä¸å¢å‘ï¼‰</li>
              <li><strong>åº•å±‚æŠ€æœ¯</strong>ï¼šåŸºäºConflux eSpaceæ™ºèƒ½åˆçº¦</li>
              <li><strong>æ²»ç†æ¨¡å¼</strong>ï¼šå®Œå…¨å»ä¸­å¿ƒåŒ–ï¼Œç¤¾åŒºé©±åŠ¨</li>
              <li><strong>ç»æµæ¨¡å‹</strong>ï¼šé€šç¼©æœºåˆ¶ + æµåŠ¨æ€§æ¿€åŠ±</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-features">
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">âš¡</span>
            <div class="project-intro-feature-text">æ€»é‡ç¨€ç¼º</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">ğŸ›¡ï¸</span>
            <div class="project-intro-feature-text">å»ä¸­å¿ƒåŒ–</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">ğŸ“ˆ</span>
            <div class="project-intro-feature-text">é«˜æ”¶ç›Šç‡</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">ğŸŒ</span>
            <div class="project-intro-feature-text">å…¨çƒäº¤æ˜“</div>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">ğŸ¯</span>
            <span>æ ¸å¿ƒä»·å€¼</span>
          </div>
          <div class="project-intro-section-content">
            <ul>
              <li><strong>ä»·å€¼å­˜å‚¨</strong>ï¼šæ·±åº¦ç»‘å®šå…¬é“¾ä»·å€¼ç¡®ä¿ä»·å€¼å¢é•¿</li>
              <li><strong>æµåŠ¨æ€§æ ¸å¿ƒ</strong>ï¼šä½œä¸ºDEXäº¤æ˜“å¯¹çš„åŸºå‡†èµ„äº§</li>
              <li><strong>æ²»ç†æƒç›Š</strong>ï¼šæŒæœ‰è€…å…±åŒå‚ä¸ç”Ÿæ€æ²»ç†å†³ç­–</li>
              <li><strong>æ”¶ç›Šç”Ÿæˆ</strong>ï¼šé€šè¿‡è´¨æŠ¼å’ŒæµåŠ¨æ€§æŒ–çŸ¿è·å¾—æ”¶ç›Š</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">ğŸš€</span>
            <span>LOMswapåŠŸèƒ½</span>
          </div>
          <div class="project-intro-section-content">
            <p>åœ¨LOMswapä¸Šï¼Œæ‚¨å¯ä»¥ï¼š</p>
            <ul>
              <li><strong>å…‘æ¢äº¤æ˜“</strong>ï¼šåœ¨CFX-LOM-USDC-USDT0-AxCNHä¹‹é—´å¿«é€Ÿå…‘æ¢</li>
              <li><strong>æä¾›æµåŠ¨æ€§</strong>ï¼šæ·»åŠ CFX-LOMæµåŠ¨æ€§èµšå–æ‰‹ç»­è´¹</li>
              <li><strong>LPè´¨æŠ¼æŒ–çŸ¿</strong>ï¼šè´¨æŠ¼LPä»£å¸è·å¾—LOMå¥–åŠ±</li>
              <li><strong>æ¯æ—¥ç­¾åˆ°</strong>ï¼šæ¯æ—¥ç­¾åˆ°è·å¾—é¢å¤–å¥–åŠ±</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="project-intro-footer">
        <div class="project-intro-footer-text">
          ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿å·²å®‰è£…TPæˆ–web3é’±åŒ…ï¼Œå¹¶åˆ‡æ¢åˆ°Conflux eSpaceç½‘ç»œï¼ˆChainID: 1030ï¼‰
        </div>
      </div>
    </div>
  </div>

  <!-- åŸæœ‰åº”ç”¨ç•Œé¢ -->
  <div class="app">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <div class="logo-container" id="logoContainer">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">è¿æ¥é’±åŒ…</button>
      </div>
    </div>

    <!-- æ ‡ç­¾é¡µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">å…‘æ¢</button>
        <button class="tab-btn" data-tab="liquidity">æµåŠ¨æ€§</button>
        <button class="tab-btn" data-tab="farm">LPæŒ–çŸ¿</button>
      </div>
    </div>

    <!-- å…‘æ¢é¡µé¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- è¾“å…¥ä»£å¸ -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- äº¤æ¢ç®­å¤´ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">ğŸ”ƒ</button>
          </div>

          <!-- è¾“å‡ºä»£å¸ -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- é”™è¯¯æç¤ºæ¡† -->
          <div class="error-box" id="swapErrorBox">
            <span class="error-icon">âš ï¸</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- äº¤æ˜“è¯¦æƒ… -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">æ»‘ç‚¹å®¹å·®</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
                <button class="slippage-btn" data-slip="10">10%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">æœ€ä½æ”¶åˆ°</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">è·¯ç”±</span>
              <span class="detail-value" id="routeInfo">CFX â†’ LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼å½±å“</span>
              <span class="detail-value positive" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- äº¤æ˜“æŒ‰é’® -->
          <button class="main-action-btn" id="swapBtn">è¿æ¥é’±åŒ…</button>
        </div>
      </div>
    </div>
    
    <!-- æµåŠ¨æ€§é¡µé¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">ğŸ’§</span>
          <span id="poolInfoTitle">CFX-LOM æ± </span>
        </div>

        <div class="liquidity-summary">
          <!-- æ± å­ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small" id="cfxReserveLabel">CFX å‚¨å¤‡</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small" id="lomReserveLabel">LOM å‚¨å¤‡</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- æˆ‘çš„æµåŠ¨æ± è¯¦æƒ… -->
          <div class="user-position" style="background: var(--gradient-card); border-radius: 12px; padding: 16px; margin-top: 16px; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);" id="myPositionTitle">æˆ‘çš„æµåŠ¨æ± </div>
              <div style="font-size: 12px; color: var(--text-secondary);" id="positionValue">$0.00</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myCfxLabel">æˆ‘çš„CFX</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userCfx">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLomLabel">æˆ‘çš„LOM</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userLom">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLpLabel">æˆ‘çš„LPä»£å¸</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);" id="userLp">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myShareLabel">æ± å­ä»½é¢</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--success);" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">æ·»åŠ æµåŠ¨æ€§</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ç§»é™¤æµåŠ¨æ€§</button>
          </div>
        </div>
      </div>
    </div>

    <!-- LPæŒ–çŸ¿é¡µé¢ -->
    <div class="tab-content" id="farmTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">ğŸšœ</span>
          <span>LPæŒ–çŸ¿å†œåœº</span>
        </div>

        <!-- å†œåœºä¿¡æ¯ -->
        <div class="stake-card">
          <div class="stake-title">LOMå¥–åŠ±å†œåœº</div>
          <div class="stake-description">
            è´¨æŠ¼æ‚¨çš„CFX-LOM LPä»£å¸ï¼Œèµšå–LOMå¥–åŠ±ã€‚æ€»å¥–åŠ±æ± ï¼š25,555,555 LOM
          </div>
          
          <!-- å¥–åŠ±æ± çŠ¶æ€ -->
          <div class="pool-status" style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 16px; margin: 16px 0; border: 1px solid var(--border-color);">
            <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; text-align: center;">å¥–åŠ±æ± çŠ¶æ€</div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">æ€»å­˜æ¬¾</div>
                <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);" id="totalDeposited">0 LOM</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">å·²åˆ†å‘</div>
                <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);" id="totalDistributed">0 LOM</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">å‰©ä½™</div>
                <div style="font-size: 14px; font-weight: 700; color: var(--accent-yellow);" id="remainingLOM">0 LOM</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">çŠ¶æ€</div>
                <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);" id="farmingStatus">æœªæ¿€æ´»</div>
              </div>
            </div>
          </div>

          <!-- ç”¨æˆ·ä¿¡æ¯ -->
          <div class="user-rewards-card" id="userRewardsCard" style="display: none;">
            <div class="user-rewards-header">
              <div class="user-rewards-title">æˆ‘çš„å†œåœº</div>
              <div class="user-level" id="userLevel">BRONZE</div>
            </div>
            
            <div class="rewards-grid">
              <div class="reward-item">
                <div class="reward-label">LPä½™é¢</div>
                <div class="reward-value" id="userLPBalance">0</div>
              </div>
              <div class="reward-item">
                <div class="reward-label">å¾…é¢†å–å¥–åŠ±</div>
                <div class="reward-value" id="pendingRewards">0 LOM</div>
              </div>
              <div class="reward-item">
                <div class="reward-label">æ´»åŠ¨åˆ†æ•°</div>
                <div class="reward-value" id="activityScore">0</div>
              </div>
              <div class="reward-item">
                <div class="reward-label">è¿ç»­å¤©æ•°</div>
                <div class="reward-value" id="consecutiveDays">0</div>
              </div>
              <div class="reward-item">
                <div class="reward-label">ä»Šæ—¥å·²å¾—</div>
                <div class="reward-value" id="dailyEarned">0 LOM</div>
              </div>
              <div class="reward-item">
                <div class="reward-label">ä»Šæ—¥å‰©ä½™</div>
                <div class="reward-value" id="dailyLeft">3000 LOM</div>
              </div>
            </div>
            
            <!-- é¢„ä¼°å¥–åŠ± -->
            <div style="background: rgba(26, 115, 232, 0.1); border-radius: 12px; padding: 12px; margin: 12px 0; border: 1px solid var(--border-color);">
              <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; text-align: center;">ä¸‹æ¬¡åŒæ­¥é¢„ä¼°å¥–åŠ±</div>
              <div style="display: flex; justify-content: space-around; align-items: center;">
                <div style="text-align: center;">
                  <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">å®‰å…¨é¢„ä¼°</div>
                  <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);" id="safeEstimate">0 LOM</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">ä¹è§‚é¢„ä¼°</div>
                  <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);" id="optimisticEstimate">0 LOM</div>
                </div>
              </div>
            </div>
            
            <div class="stake-actions">
              <button class="stake-action-btn stake-sync-btn" id="syncBtn" disabled>
                <span id="syncIcon">ğŸ”„</span>
                <span id="syncText">åŒæ­¥å¥–åŠ±</span>
                <span id="syncTimer" style="margin-left: auto; font-size: 11px;"></span>
              </button>
              <button class="stake-action-btn stake-claim-btn" id="claimBtn" disabled>
                <span>ğŸ’°</span>
                <span>é¢†å–LOMå¥–åŠ±</span>
              </button>
              <button class="stake-action-btn stake-checkin-btn" id="checkinBtn" disabled>
                <span>ğŸ“…</span>
                <span>æ¯æ—¥ç­¾åˆ°</span>
              </button>
            </div>
          </div>
          
          <!-- æ¿€æ´»è´¦æˆ· -->
          <div class="stake-actions" id="activateSection">
            <div class="stake-description" style="margin-bottom: 12px;">
              æ‚¨éœ€è¦å…ˆæ¿€æ´»è´¦æˆ·æ‰èƒ½å¼€å§‹æŒ–çŸ¿ã€‚è¯·ç¡®ä¿æ‚¨æŒæœ‰CFX-LOM LPä»£å¸ã€‚
            </div>
            <button class="stake-action-btn stake-activate-btn" id="activateBtn">
              <span>âœ…</span>
              <span>æ¿€æ´»è´¦æˆ·</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- é£é™©æç¤º -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>âš ï¸</span>
        <span id="riskTitle">é£é™©æç¤º</span>
      </div>
      <div id="riskText">
        æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚
      </div>
    </div>

    <!-- é¡µè„š -->
    <div class="footer" id="footerText">LOMswap Â· Conflux eSpace</div>
  </div>

  <!-- ä»£å¸é€‰æ‹©å™¨æ¨¡æ€æ¡† -->
  <div class="token-selector-modal" id="tokenSelectorModal">
    <div class="token-selector-card">
      <h3 class="modal-title" id="tokenSelectorTitle">é€‰æ‹©ä»£å¸</h3>
      <input type="text" class="token-search" id="tokenSearch" placeholder="æœç´¢ä»£å¸åç§°æˆ–åœ°å€">
      <div class="token-list" id="tokenList">
        <!-- ä»£å¸åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- æ·»åŠ æµåŠ¨æ€§æ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="addModal">
    <div class="modal-card">
      <h3 class="modal-title" id="addTitle">æ·»åŠ æµåŠ¨æ€§</h3>
      
      <div class="modal-input-group">
        <label class="modal-input-label">CFX æ•°é‡</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addCfx" placeholder="0" step="any" min="0">
          <button class="btn" id="cfxMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ä½™é¢: <span id="addCfxBal">0</span> CFX
        </div>
      </div>
      
      <div style="text-align: center; font-size: 20px; color: var(--text-primary); margin: 12px 0;">+</div>
      
      <div class="modal-input-group">
        <label class="modal-input-label">LOM æ•°é‡</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addLom" placeholder="0" step="any" min="0">
          <button class="btn" id="lomMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ä½™é¢: <span id="addLomBal">0</span> LOM
        </div>
      </div>
      
      <div style="background: rgba(26, 115, 232, 0.1); border-radius: 10px; padding: 10px; margin: 12px 0; text-align: center;">
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">æ¯”ä¾‹</div>
        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); word-break: break-all;" id="addRatio">1 CFX = 0 LOM</div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelAddBtn">å–æ¶ˆ</button>
        <button class="modal-btn confirm" id="confirmAddBtn" disabled>ç¡®è®¤æ·»åŠ </button>
      </div>
    </div>
  </div>

  <!-- ç§»é™¤æµåŠ¨æ€§æ¨¡æ€æ¡† -->
  <div class="modal-overlay remove-liquidity-modal" id="removeModal">
    <div class="modal-card">
      <h3 class="modal-title" id="removeTitle">ç§»é™¤æµåŠ¨æ€§</h3>
      
      <div class="modal-content">
        <div class="remove-percentage">
          <span id="removePercent">100%</span>
        </div>
        
        <input type="range" min="0" max="100" value="100" step="1" class="percentage-slider" id="removeSlider">
        
        <div class="percentage-options">
          <div class="percentage-option" data-percent="25">25%</div>
          <div class="percentage-option" data-percent="50">50%</div>
          <div class="percentage-option" data-percent="75">75%</div>
          <div class="percentage-option active" data-percent="100">100%</div>
        </div>
        
        <div class="remove-estimate">
          <div class="remove-estimate-title">é¢„è®¡è·å¾—</div>
          <div class="remove-estimate-amounts">
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstCfx">0</span> CFX
            </div>
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstLom">0</span> LOM
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn cancel" id="cancelRemoveBtn">å–æ¶ˆ</button>
          <button class="modal-btn confirm" id="confirmRemoveBtn" style="background: var(--gradient-red);">ç¡®è®¤ç§»é™¤</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ç®€å•äº¤æ˜“ç¡®è®¤æ¨¡æ€æ¡† -->
  <div class="modal-overlay simple-confirm-modal" id="simpleConfirmModal">
    <div class="modal-card">
      <div class="confirm-summary">
        <div class="confirm-icon" id="simpleConfirmIcon">ğŸ”„</div>
        <div class="confirm-action" id="simpleConfirmAction">å…‘æ¢ç¡®è®¤</div>
        <div class="confirm-amounts" id="simpleConfirmAmounts">
          <!-- é‡‘é¢ä¿¡æ¯ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="confirm-details-grid" id="simpleConfirmDetails">
          <!-- è¯¦ç»†ä¿¡æ¯ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
      <div class="confirm-actions-simple">
        <button class="confirm-action-btn cancel" id="simpleCancelBtn">å–æ¶ˆ</button>
        <button class="confirm-action-btn confirm" id="simpleConfirmBtn">ç¡®è®¤äº¤æ˜“</button>
      </div>
    </div>
  </div>

  <!-- äº¤æ˜“çŠ¶æ€æç¤º -->
  <div class="tx-status-overlay" id="txStatusOverlay">
    <div class="tx-status-card">
      <div class="tx-status-icon" id="txStatusIcon">
        <div class="loading-spinner white"></div>
      </div>
      <div class="tx-status-title" id="txStatusTitle">äº¤æ˜“å¤„ç†ä¸­</div>
      <div class="tx-status-message" id="txStatusMessage">è¯·ç­‰å¾…åŒºå—é“¾ç¡®è®¤...</div>
      <button class="tx-status-done-btn" id="txStatusDoneBtn" style="display:none;">å®Œæˆ</button>
    </div>
  </div>

  <!-- å†œåœºç¡®è®¤å¯¹è¯æ¡† -->
  <div class="modal-overlay simple-confirm-modal" id="farmConfirmModal">
    <div class="modal-card">
      <div class="confirm-summary">
        <div class="confirm-icon" id="farmConfirmIcon">ğŸšœ</div>
        <div class="confirm-action" id="farmConfirmAction">å†œåœºæ“ä½œç¡®è®¤</div>
        <div class="confirm-amounts" id="farmConfirmAmounts">
          <!-- é‡‘é¢ä¿¡æ¯ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="confirm-details-grid" id="farmConfirmDetails">
          <!-- è¯¦ç»†ä¿¡æ¯ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
      <div class="confirm-actions-simple">
        <button class="confirm-action-btn cancel" id="farmCancelBtn">å–æ¶ˆ</button>
        <button class="confirm-action-btn confirm" id="farmConfirmBtn">ç¡®è®¤æ“ä½œ</button>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // ==================== é¡¹ç›®ä»‹ç»å¼¹çª—åŠŸèƒ½ ====================
    document.addEventListener('DOMContentLoaded', function() {
      const logoContainer = document.getElementById('logoContainer');
      const projectIntroOverlay = document.getElementById('projectIntroOverlay');
      const projectIntroCloseBtn = document.getElementById('projectIntroCloseBtn');
      
      // ç‚¹å‡»Logoæ˜¾ç¤ºé¡¹ç›®ä»‹ç»å¼¹çª—
      logoContainer.addEventListener('click', function() {
        projectIntroOverlay.classList.add('show');
      });
      
      // ç‚¹å‡»å…³é—­æŒ‰é’®å…³é—­å¼¹çª—
      projectIntroCloseBtn.addEventListener('click', function() {
        projectIntroOverlay.classList.remove('show');
      });
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      projectIntroOverlay.addEventListener('click', function(e) {
        if (e.target === projectIntroOverlay) {
          projectIntroOverlay.classList.remove('show');
        }
      });
      
      // æŒ‰ESCé”®å…³é—­
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && projectIntroOverlay.classList.contains('show')) {
          projectIntroOverlay.classList.remove('show');
        }
      });
    });

    // ==================== ç»Ÿä¸€é…ç½® ====================
    const APP_CONFIG = {
      CONTRACTS: {
        // è·¯ç”±å’Œäº¤æ˜“ç›¸å…³
        ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
        LOM: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3",
        WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
        PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85", // CFX-LOMæ± 
        USDC: "0x6963efed0ab40f6c3d7bda44a05dcf1437c44372",
        AXCNH: "0x70BFD7F7eADF9b9827541272589A6B2Bb760aE2E",
        USDT0: "0xaf37e8b6c9ed7f6318979f56fc287d76c30847ff",
        CNHT0: "0xDEd1660192d4d82e7c0B628ba556861EdBB5CAda",
        AXCNH_USDT0_PAIR: "0x50b095DF7a8f856C6fA07fF89bcBC2dF8491A8df",
        
        // LPå¥–åŠ±å†œåœºåˆçº¦
        LP_REWARD_FARM: "0xD1a50fB7DbDE52a180Ab6Dc83a6969869259D32a"
      },
      TOKEN_LOGOS: {
        CFX: "https://i.imgur.com/70cXbUI.jpeg",
        LOM: "https://i.imgur.com/HddyTrv.jpeg",
        USDC: "https://i.imgur.com/9UDXcUF.jpeg",
        AXCNH: "https://i.imgur.com/x8317um.jpeg",
        USDT0: "https://i.imgur.com/KgnTsn1.jpeg",
        CNHT0: "https://i.imgur.com/zObg9RY.jpeg"
      },
      CHAIN_ID: 1030 // Conflux eSpace
    };

    // ==================== LPå¥–åŠ±å†œåœº ABI ====================
    const LP_REWARD_FARM_ABI = [
      // ç”¨æˆ·åŠŸèƒ½
      "function activate()",
      "function sync() returns (uint256 totalReward)",
      "function dailyCheckIn()",
      "function claimLOMRewards()",
      
      // æŸ¥è¯¢åŠŸèƒ½
      "function getPoolInfo() view returns (uint256 totalUsers, uint256 lomDeposited, uint256 lomDistributed, uint256 lomRemaining, uint256 currentDailyRate, uint256 currentDailyLimit, bool isActive, bool isPaused)",
      "function getUserInfo(address userAddr) view returns (uint256 currentBalance, uint256 pendingLOMRewards, uint256 activityScore, string memory level, uint256 consecutiveDays, uint256 nextSyncAvailable, uint256 dailyLOMLeft, bool canCheckInToday)",
      "function getPendingRewardsEstimate(address userAddr) view returns (uint256 safeRewards, uint256 optimisticRewards, bool estimateValid)",
      
      // çŠ¶æ€å˜é‡
      "function farmingActive() view returns (bool)",
      "function totalLOMDeposited() view returns (uint256)",
      "function totalLOMDistributed() view returns (uint256)",
      "function remainingLOM() view returns (uint256)"
    ];

    // ==================== å…¶ä»–åˆçº¦ABI ====================
    const ROUTER_ABI = [
      "function getAmountsOut(uint amountIn, address[] path) view returns (uint[] memory amounts)",
      "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) payable",
      "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
      "function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
      "function addLiquidityETH(address token, uint amountTokenDesired, uint amountTokenMin, uint amountETHMin, address to, uint deadline) payable returns (uint amountToken, uint amountETH, uint liquidity)",
      "function removeLiquidityETHSupportingFeeOnTransferTokens(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountETH)",
      "function removeLiquidityETH(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountToken, uint amountETH)"
    ];

    const ERC20_ABI = [
      "function approve(address spender, uint256 amount) returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)",
      "function balanceOf(address owner) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function totalSupply() view returns (uint256)"
    ];

    const PAIR_ABI = [
      "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address owner) view returns (uint256)",
      "function token0() view returns (address)",
      "function token1() view returns (address)",
      "function approve(address spender, uint256 amount) returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)"
    ];

    // ==================== åº”ç”¨çŠ¶æ€ ====================
    let provider, signer, account, router, pair, lom, usdc, axcnh, usdt0, cnht0, axcnhUsdt0Pair, lpRewardFarm;
    let slippage = 0.1;
    let isChinese = true;
    let currentRatio = 0;
    let fromToken = "CFX";
    let toToken = "LOM";
    let refreshInterval;
    let farmRefreshInterval;
    let currentTokenSelector = null;
    let transactionLock = false;
    let currentReserves = { cfx: 0, lom: 0 };
    let lastInputWasFrom = true;

    // ==================== æ ¸å¿ƒä»£å¸åˆ—è¡¨ ====================
    const TOKEN_LIST = [
      {
        symbol: "CFX",
        name: "Conflux",
        address: APP_CONFIG.CONTRACTS.WCFX,
        logo: APP_CONFIG.TOKEN_LOGOS.CFX,
        decimals: 18,
        isNative: true
      },
      {
        symbol: "LOM",
        name: "Longmai",
        address: APP_CONFIG.CONTRACTS.LOM,
        logo: APP_CONFIG.TOKEN_LOGOS.LOM,
        decimals: 18
      },
      {
        symbol: "USDC",
        name: "USD Coin",
        address: APP_CONFIG.CONTRACTS.USDC,
        logo: APP_CONFIG.TOKEN_LOGOS.USDC,
        decimals: 18
      },
      {
        symbol: "AXCNH",
        name: "AxCNH",
        address: APP_CONFIG.CONTRACTS.AXCNH,
        logo: APP_CONFIG.TOKEN_LOGOS.AXCNH,
        decimals: 6
      },
      {
        symbol: "USDT0",
        name: "Tether USD (Test)",
        address: APP_CONFIG.CONTRACTS.USDT0,
        logo: APP_CONFIG.TOKEN_LOGOS.USDT0,
        decimals: 6
      },
      {
        symbol: "CNHT0",
        name: "CNH Token (Test)",
        address: APP_CONFIG.CONTRACTS.CNHT0,
        logo: APP_CONFIG.TOKEN_LOGOS.CNHT0,
        decimals: 6
      }
    ];

    // ==================== å·¥å…·æ¨¡å— ====================
    const Utils = {
      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      },

      simpleFormat(value) {
        if (!value && value !== 0) return '0.000000';
        
        const num = parseFloat(value);
        if (isNaN(num)) return '0.000000';
        
        const truncated = Math.floor(num * 1000000) / 1000000;
        
        const parts = truncated.toString().split('.');
        let integerPart = parts[0];
        let decimalPart = parts[1] || '';
        
        if (decimalPart.length < 6) {
          decimalPart = decimalPart.padEnd(6, '0');
        } else if (decimalPart.length > 6) {
          decimalPart = decimalPart.substring(0, 6);
        }
        
        return integerPart + '.' + decimalPart;
      },

      removeTrailingZeros(str) {
        if (!str.includes('.')) return str;
        
        let result = str.replace(/0+$/, '');
        if (result.endsWith('.')) {
          result = result.slice(0, -1);
        }
        return result;
      },

      formatDisplay(value) {
        const formatted = this.simpleFormat(value);
        return this.removeTrailingZeros(formatted);
      },

      formatAddress(address) {
        if (!address) return '';
        return address.slice(0, 4) + '...' + address.slice(-6);
      },

      showError(message) {
        const errorBox = document.getElementById('swapErrorBox');
        const errorText = document.getElementById('swapErrorText');
        errorText.textContent = message;
        errorBox.classList.add('show');
        
        setTimeout(() => {
          errorBox.classList.remove('show');
        }, 5000);
      },

      showNotification(message, type = 'info') {
        const status = document.getElementById('txStatusOverlay');
        const icon = document.getElementById('txStatusIcon');
        const title = document.getElementById('txStatusTitle');
        const msg = document.getElementById('txStatusMessage');
        const doneBtn = document.getElementById('txStatusDoneBtn');
        
        const statusConfig = {
          info: { 
            icon: '<div class="loading-spinner white"></div>', 
            title: isChinese ? 'å¤„ç†ä¸­' : 'Processing' 
          },
          success: { 
            icon: 'âœ…', 
            title: isChinese ? 'æ“ä½œæˆåŠŸ' : 'Success' 
          },
          error: { 
            icon: 'âŒ', 
            title: isChinese ? 'æ“ä½œå¤±è´¥' : 'Failed' 
          },
          warning: { 
            icon: 'âš ï¸', 
            title: isChinese ? 'æç¤º' : 'Notice' 
          }
        };
        
        const config = statusConfig[type] || statusConfig.info;
        icon.innerHTML = config.icon;
        title.textContent = config.title;
        msg.textContent = message;
        
        if (type === 'success' || type === 'error' || type === 'warning') {
          doneBtn.style.display = 'block';
        } else {
          doneBtn.style.display = 'none';
        }
        
        status.style.display = 'flex';
      },

      hideNotification() {
        document.getElementById('txStatusOverlay').style.display = 'none';
        document.querySelectorAll('button').forEach(btn => {
          btn.disabled = false;
        });
      },

      getErrorMessage(error) {
        const message = error.message || error.toString();
        
        const errorMap = {
          'user rejected': isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user',
          'INSUFFICIENT_OUTPUT_AMOUNT': isChinese ? 'è¾“å‡ºæ•°é‡ä¸è¶³ï¼Œè¯·æé«˜æ»‘ç‚¹å®¹å·®' : 'Insufficient output amount, increase slippage',
          'INSUFFICIENT_INPUT_AMOUNT': isChinese ? 'è¾“å…¥æ•°é‡ä¸è¶³' : 'Insufficient input amount',
          'insufficient funds': isChinese ? 'ä½™é¢ä¸è¶³' : 'Insufficient balance',
          'allowance': isChinese ? 'è¯·å…ˆæˆæƒä»£å¸' : 'Please approve token first',
          'deadline': isChinese ? 'äº¤æ˜“è¶…æ—¶ï¼Œè¯·é‡è¯•' : 'Transaction expired, please try again',
          'Not enough liquidity': isChinese ? 'æµåŠ¨æ€§ä¸è¶³' : 'Insufficient liquidity',
          'execution reverted': isChinese ? 'äº¤æ˜“æ‰§è¡Œå¤±è´¥' : 'Transaction execution failed',
          'reverted': isChinese ? 'äº¤æ˜“å¤±è´¥' : 'Transaction failed'
        };
        
        for (const [key, value] of Object.entries(errorMap)) {
          if (message.toLowerCase().includes(key.toLowerCase())) {
            return value;
          }
        }
        
        return isChinese ? 'äº¤æ˜“å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Transaction failed, please try again';
      },

      formatNumber(num) {
        if (num >= 1000000) {
          return (num / 1000000).toFixed(2) + 'M';
        } else if (num >= 1000) {
          return (num / 1000).toFixed(2) + 'K';
        } else {
          return this.formatDisplay(num);
        }
      },

      formatTime(seconds) {
        if (seconds <= 0) return isChinese ? 'éšæ—¶' : 'Now';
        
        if (seconds < 60) {
          return isChinese ? `${Math.ceil(seconds)}ç§’å` : `in ${Math.ceil(seconds)}s`;
        } else if (seconds < 3600) {
          return isChinese ? `${Math.ceil(seconds / 60)}åˆ†é’Ÿå` : `in ${Math.ceil(seconds / 60)}min`;
        } else if (seconds < 86400) {
          return isChinese ? `${Math.ceil(seconds / 3600)}å°æ—¶å` : `in ${Math.ceil(seconds / 3600)}h`;
        } else {
          return isChinese ? `${Math.ceil(seconds / 86400)}å¤©å` : `in ${Math.ceil(seconds / 86400)}d`;
        }
      }
    };

    // ==================== ä»£å¸å·¥å…·æ¨¡å— ====================
    const TokenUtils = {
      getToken(symbol) {
        return TOKEN_LIST.find(t => t.symbol === symbol);
      },

      getTokenDecimals(symbol) {
        const token = this.getToken(symbol);
        return token ? token.decimals : 18;
      },

      getTokenContract(symbol) {
        const tokenContracts = {
          "LOM": lom,
          "USDC": usdc,
          "AXCNH": axcnh,
          "USDT0": usdt0,
          "CNHT0": cnht0
        };
        return tokenContracts[symbol] || null;
      },

      formatTokenAmount(amount, symbol) {
        const decimals = this.getTokenDecimals(symbol);
        try {
          const formatted = ethers.utils.formatUnits(amount, decimals);
          return Utils.formatDisplay(formatted);
        } catch {
          return '0.000000';
        }
      },

      parseTokenAmount(amount, symbol) {
        const decimals = this.getTokenDecimals(symbol);
        try {
          return ethers.utils.parseUnits(amount.toString(), decimals);
        } catch {
          return ethers.BigNumber.from(0);
        }
      }
    };

    // ==================== é’±åŒ…ç®¡ç†å™¨ ====================
    const WalletManager = {
      async connect() {
        try {
          if (!window.ethereum) {
            Utils.showError(isChinese ? 
              "è¯·å®‰è£…TPæˆ–web3é’±åŒ…" : 
              "Please install TP or WEB3 wallet");
            return false;
          }
          
          const walletBtn = document.getElementById('walletBtn');
          walletBtn.textContent = isChinese ? 'è¿æ¥ä¸­...' : 'Connecting...';
          walletBtn.classList.add('connecting');
          
          const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
          });
          
          if (!accounts || accounts.length === 0) {
            throw new Error(isChinese ? 'ç”¨æˆ·æ‹’ç»è¿æ¥' : 'User rejected connection');
          }
          
          account = accounts[0];
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          
          await this.checkNetwork();
          this.initContracts();
          this.updateUI();
          
          if (refreshInterval) {
            clearInterval(refreshInterval);
          }
          refreshInterval = setInterval(() => DataManager.refreshAll(), 10000);
          
          if (farmRefreshInterval) {
            clearInterval(farmRefreshInterval);
          }
          farmRefreshInterval = setInterval(() => FarmManager.refreshFarmData(), 15000);
          
          Utils.showNotification(
            isChinese ? 'é’±åŒ…è¿æ¥æˆåŠŸ' : 'Wallet connected successfully',
            'success'
          );
          
          return true;
        } catch (error) {
          console.error("é’±åŒ…è¿æ¥å¤±è´¥:", error);
          Utils.showError(
            isChinese ? `è¿æ¥å¤±è´¥: ${error.message}` : `Connection failed: ${error.message}`
          );
          return false;
        } finally {
          this.updateUI();
        }
      },

      async checkNetwork() {
        const network = await provider.getNetwork();
        if (network.chainId !== APP_CONFIG.CHAIN_ID) {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x' + APP_CONFIG.CHAIN_ID.toString(16) }]
            });
          } catch (error) {
            if (error.code === 4902) {
              Utils.showError(isChinese ? 'è¯·æ·»åŠ Conflux eSpaceç½‘ç»œ' : 'Please add Conflux eSpace network');
            } else {
              Utils.showError(isChinese ? 'è¯·åˆ‡æ¢åˆ°Conflux eSpaceç½‘ç»œ' : 'Please switch to Conflux eSpace network');
            }
            throw error;
          }
        }
      },

      initContracts() {
        router = new ethers.Contract(APP_CONFIG.CONTRACTS.ROUTER, ROUTER_ABI, signer);
        pair = new ethers.Contract(APP_CONFIG.CONTRACTS.PAIR, PAIR_ABI, signer);
        lom = new ethers.Contract(APP_CONFIG.CONTRACTS.LOM, ERC20_ABI, signer);
        usdc = new ethers.Contract(APP_CONFIG.CONTRACTS.USDC, ERC20_ABI, signer);
        axcnh = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH, ERC20_ABI, signer);
        usdt0 = new ethers.Contract(APP_CONFIG.CONTRACTS.USDT0, ERC20_ABI, signer);
        cnht0 = new ethers.Contract(APP_CONFIG.CONTRACTS.CNHT0, ERC20_ABI, signer);
        axcnhUsdt0Pair = new ethers.Contract(APP_CONFIG.CONTRACTS.AXCNH_USDT0_PAIR, PAIR_ABI, signer);
        lpRewardFarm = new ethers.Contract(APP_CONFIG.CONTRACTS.LP_REWARD_FARM, LP_REWARD_FARM_ABI, signer);
      },

      updateUI() {
        const walletBtn = document.getElementById("walletBtn");
        const swapBtn = document.getElementById("swapBtn");
        
        walletBtn.classList.remove('connecting');
        
        if (account) {
          const displayAddress = Utils.formatAddress(account);
          walletBtn.textContent = displayAddress;
          walletBtn.classList.add('connected');
          swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
          swapBtn.disabled = false;
        } else {
          walletBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          walletBtn.classList.remove('connected');
          swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          swapBtn.disabled = false;
        }
      },

      disconnect() {
        account = null;
        provider = null;
        signer = null;
        router = null;
        pair = null;
        lom = null;
        usdc = null;
        axcnh = null;
        usdt0 = null;
        cnht0 = null;
        axcnhUsdt0Pair = null;
        lpRewardFarm = null;
        
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
        
        if (farmRefreshInterval) {
          clearInterval(farmRefreshInterval);
          farmRefreshInterval = null;
        }
        
        this.updateUI();
        DataManager.resetAllData();
        FarmManager.resetUI();
        
        Utils.showNotification(
          isChinese ? "é’±åŒ…å·²æ–­å¼€è¿æ¥" : "Wallet disconnected",
          'success'
        );
      }
    };

    // ==================== æ•°æ®ç®¡ç†å™¨ ====================
    const DataManager = {
      async refreshAll() {
        if (!account) return;
        
        try {
          await this.updateAllBalances();
          await this.updatePoolInfo();
          this.updateSwapButtonState();
          await FarmManager.refreshFarmData();
        } catch (error) {
          console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
        }
      },

      async updateAllBalances() {
        if (!account) return;
        
        try {
          // è·å–æ‰€æœ‰ä»£å¸ä½™é¢
          const balancePromises = TOKEN_LIST.map(async (token) => {
            try {
              let balance = 0;
              
              if (token.symbol === 'CFX' && provider) {
                const cfxBal = await provider.getBalance(account);
                balance = parseFloat(ethers.utils.formatEther(cfxBal));
              } else {
                const contract = TokenUtils.getTokenContract(token.symbol);
                if (contract) {
                  const tokenBal = await contract.balanceOf(account);
                  balance = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
                }
              }
              
              return { symbol: token.symbol, balance };
            } catch (error) {
              console.error(`è·å– ${token.symbol} ä½™é¢å¤±è´¥:`, error);
              return { symbol: token.symbol, balance: 0 };
            }
          });
          
          const balances = await Promise.all(balancePromises);
          
          // æ›´æ–°UIæ˜¾ç¤º
          balances.forEach(({ symbol, balance }) => {
            this.updateBalanceUI(symbol, balance);
          });
          
          // æ›´æ–°æµåŠ¨æ€§é¡µé¢çš„ä½™é¢æ˜¾ç¤º
          if (lom && provider) {
            const cfxBal = balances.find(b => b.symbol === 'CFX')?.balance || 0;
            const lomBal = balances.find(b => b.symbol === 'LOM')?.balance || 0;
            
            document.getElementById("addCfxBal").textContent = Utils.formatDisplay(cfxBal);
            document.getElementById("addLomBal").textContent = Utils.formatDisplay(lomBal);
          }
          
          // æ£€æŸ¥æ˜¯å¦æœ‰LPä»£å¸
          if (pair) {
            const lpBal = await pair.balanceOf(account);
            const lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
            document.getElementById("removeBtn").disabled = lpBal.isZero();
          }
          
        } catch (error) {
          console.error("æ›´æ–°ä½™é¢å¤±è´¥:", error);
        }
      },

      updateBalanceUI(symbol, balance) {
        const formattedBalance = Utils.formatDisplay(balance);
        
        // æ›´æ–°å…‘æ¢é¡µé¢çš„ä½™é¢æ˜¾ç¤º
        if (symbol === fromToken) {
          const fromBalEl = document.getElementById('fromBal');
          if (fromBalEl) fromBalEl.textContent = formattedBalance;
        }
        
        if (symbol === toToken) {
          const toBalEl = document.getElementById('toBal');
          if (toBalEl) toBalEl.textContent = formattedBalance;
        }
        
        // æ›´æ–°ä»£å¸é€‰æ‹©å™¨çš„ä½™é¢æ˜¾ç¤º
        const selectorBalanceEl = document.getElementById(`selectorBalance-${symbol}`);
        if (selectorBalanceEl) {
          selectorBalanceEl.textContent = formattedBalance;
        }
      },

      async updatePoolInfo() {
        try {
          if (!pair || !account) return;
          
          const [r0, r1] = await pair.getReserves();
          const t0 = await pair.token0();
          const totalSupply = await pair.totalSupply();
          
          const reserveCfx = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r0 : r1;
          const reserveLom = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r1 : r0;
          
          const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
          const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
          
          currentReserves.cfx = cfxReserve;
          currentReserves.lom = lomReserve;
          
          const price = lomReserve / cfxReserve;
          currentRatio = price;
          
          const priceFormatted = Utils.formatDisplay(price);
          const priceText = isChinese ? 
            `${priceFormatted} LOM` : 
            `${priceFormatted} LOM`;
          document.getElementById("price").textContent = `1 CFX = ${priceText}`;
          document.getElementById("addRatio").textContent = `1 CFX = ${priceFormatted} LOM`;

          const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
          
          let lpAmt = 0;
          let share = 0;
          let userCfx = 0;
          let userLom = 0;
          
          const lpBal = await pair.balanceOf(account);
          lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
          
          if (totalSupplyNum > 0 && lpAmt > 0) {
            share = (lpAmt / totalSupplyNum) * 100;
            userCfx = cfxReserve * (share / 100);
            userLom = lomReserve * (share / 100);
          }
          
          const cfxReserveEl = document.getElementById("cfxReserve");
          const lomReserveEl = document.getElementById("lomReserve");
          
          if (cfxReserveEl) cfxReserveEl.textContent = cfxReserve.toFixed(2);
          if (lomReserveEl) lomReserveEl.textContent = lomReserve.toFixed(2);
          
          const userCfxEl = document.getElementById("userCfx");
          const userLomEl = document.getElementById("userLom");
          const userLpEl = document.getElementById("userLp");
          const userPoolShareEl = document.getElementById("userPoolShare");
          
          if (userCfxEl) userCfxEl.textContent = userCfx.toFixed(2);
          if (userLomEl) userLomEl.textContent = userLom.toFixed(2);
          if (userLpEl) userLpEl.textContent = lpAmt.toFixed(2);
          if (userPoolShareEl) userPoolShareEl.textContent = share.toFixed(4) + "%";
          
          const poolTitle = isChinese ? 
            `CFX-LOMæµåŠ¨æ± ` :
            `CFX-LOM Pool`;
          
          const poolInfoTitleEl = document.getElementById("poolInfoTitle");
          if (poolInfoTitleEl) poolInfoTitleEl.textContent = poolTitle;
          
          const removeBtn = document.getElementById("removeBtn");
          if (removeBtn) {
            removeBtn.disabled = lpAmt <= 0;
          }
          
        } catch (error) {
          console.error("æ›´æ–°æ± å­ä¿¡æ¯å¤±è´¥:", error);
        }
      },

      updateSwapButtonState() {
        const swapBtn = document.getElementById("swapBtn");
        const fromAmount = document.getElementById("fromAmount").value;
        
        if (!account) {
          swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          swapBtn.disabled = false;
          return;
        }
        
        if (!fromAmount || fromAmount === "0" || fromAmount === "") {
          swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
          swapBtn.disabled = true;
          return;
        }
        
        swapBtn.textContent = isChinese ? "ç«‹å³å…‘æ¢" : "Swap Now";
        swapBtn.disabled = false;
      },

      resetAllData() {
        const elements = {
          'fromBal': '0.000000',
          'toBal': '0.000000',
          'addCfxBal': '0.000000',
          'addLomBal': '0.000000',
          'price': '1 CFX = 0.000000 LOM',
          'minReceived': '0.000000 LOM'
        };
        
        Object.keys(elements).forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = elements[id];
        });
        
        document.getElementById("fromAmount").value = "";
        document.getElementById("toAmount").value = "";
        document.getElementById("removeBtn").disabled = true;
      }
    };

    // ==================== å…‘æ¢æ¨¡å— ====================
    const SwapModule = {
      async executeSwap() {
        const fromAmount = document.getElementById('fromAmount').value;
        const toAmount = document.getElementById('toAmount').value;
        
        if (!fromAmount || fromAmount === '0') {
          Utils.showError(isChinese ? "è¯·è¾“å…¥å…‘æ¢æ•°é‡" : "Please enter swap amount");
          return;
        }
        
        const requiredSlippage = fromToken === 'LOM' ? 5 : slippage;
        
        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        const confirmed = await this.showConfirmDialog(fromAmount, toAmount, requiredSlippage);
        if (!confirmed) return;
        
        try {
          Utils.showNotification(isChinese ? 'å¤„ç†å…‘æ¢ä¸­...' : 'Processing swap...', 'info');
          
          const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
          const toDecimals = TokenUtils.getTokenDecimals(toToken);
          
          const amountIn = TokenUtils.parseTokenAmount(fromAmount, fromToken);
          const path = this.getSwapPath();
          
          if (!router) {
            throw new Error('è·¯ç”±å™¨åˆçº¦æœªåˆå§‹åŒ–');
          }
          
          const amounts = await router.getAmountsOut(amountIn, path);
          const minOut = amounts[amounts.length - 1].mul(1000 - requiredSlippage * 10).div(1000);
          
          const deadline = Math.floor(Date.now() / 1000) + 1200;
          
          let tx;
          
          if (fromToken === "CFX") {
            tx = await router.swapExactETHForTokensSupportingFeeOnTransferTokens(
              minOut, path, account, deadline, 
              { value: amountIn }
            );
          } else if (toToken === "CFX") {
            const tokenContract = TokenUtils.getTokenContract(fromToken);
            if (!tokenContract) throw new Error('ä»£å¸åˆçº¦æœªæ‰¾åˆ°');
            
            await this.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
            
            tx = await router.swapExactTokensForETHSupportingFeeOnTransferTokens(
              amountIn, minOut, path, account, deadline
            );
          } else {
            const tokenContract = TokenUtils.getTokenContract(fromToken);
            if (!tokenContract) throw new Error('ä»£å¸åˆçº¦æœªæ‰¾åˆ°');
            
            await this.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
            
            tx = await router.swapExactTokensForTokensSupportingFeeOnTransferTokens(
              amountIn, minOut, path, account, deadline
            );
          }
          
          await tx.wait();
          
          document.getElementById('fromAmount').value = '';
          document.getElementById('toAmount').value = '';
          
          Utils.showNotification(
            isChinese ? `å…‘æ¢æˆåŠŸï¼è·å¾— ${Utils.formatDisplay(toAmount)} ${toToken}` : 
                       `Swap successful! Received ${Utils.formatDisplay(toAmount)} ${toToken}`,
            'success'
          );
          
          await DataManager.refreshAll();
          
        } catch (error) {
          console.error('å…‘æ¢å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        }
      },

      async showConfirmDialog(fromAmount, toAmount, requiredSlippage) {
        return new Promise((resolve) => {
          const modal = document.getElementById('simpleConfirmModal');
          const icon = document.getElementById('simpleConfirmIcon');
          const action = document.getElementById('simpleConfirmAction');
          const amountsDiv = document.getElementById('simpleConfirmAmounts');
          const detailsDiv = document.getElementById('simpleConfirmDetails');
          
          const fromTokenData = TokenUtils.getToken(fromToken);
          const toTokenData = TokenUtils.getToken(toToken);
          
          // è®¾ç½®å†…å®¹
          icon.textContent = 'ğŸ”„';
          action.textContent = isChinese ? 'å…‘æ¢ç¡®è®¤' : 'Swap Confirmation';
          
          // è®¾ç½®é‡‘é¢æ˜¾ç¤º
          amountsDiv.innerHTML = `
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${fromTokenData?.logo || ''}')"></div>
              <div class="confirm-amount-text">${Utils.formatDisplay(fromAmount)} ${fromToken}</div>
            </div>
            <div style="font-size: 20px; color: var(--text-secondary);">â†“</div>
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${toTokenData?.logo || ''}')"></div>
              <div class="confirm-amount-text">${Utils.formatDisplay(toAmount)} ${toToken}</div>
            </div>
          `;
          
          // è®¾ç½®è¯¦æƒ…æ˜¾ç¤º
          const price = parseFloat(toAmount) / parseFloat(fromAmount);
          const priceFormatted = Utils.formatDisplay(price);
          const minOut = parseFloat(toAmount) * (1 - requiredSlippage / 100);
          const minOutFormatted = Utils.formatDisplay(minOut);
          
          detailsDiv.innerHTML = `
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æ±‡ç‡' : 'Rate'}</div>
              <div class="confirm-detail-value">1 ${fromToken} = ${priceFormatted} ${toToken}</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æ»‘ç‚¹' : 'Slippage'}</div>
              <div class="confirm-detail-value">${requiredSlippage}%</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æœ€ä½æ”¶åˆ°' : 'Min Received'}</div>
              <div class="confirm-detail-value">${minOutFormatted} ${toToken}</div>
            </div>
          `;
          
          // æ˜¾ç¤ºæ¨¡æ€æ¡†
          modal.style.display = "flex";
          
          // è®¾ç½®æŒ‰é’®äº‹ä»¶
          const cancelBtn = document.getElementById('simpleCancelBtn');
          const confirmBtn = document.getElementById('simpleConfirmBtn');
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            confirmBtn.removeEventListener('click', onConfirm);
            modal.style.display = 'none';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onConfirm = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          confirmBtn.addEventListener('click', onConfirm);
        });
      },

      async checkAndApprove(tokenContract, spenderAddress, amount) {
        if (!tokenContract || !account) return true;
        
        try {
          const allowance = await tokenContract.allowance(account, spenderAddress);
          if (allowance.lt(amount)) {
            Utils.showNotification(isChinese ? 'æˆæƒä»£å¸ä¸­...' : 'Approving token...', 'info');
            const approveTx = await tokenContract.approve(spenderAddress, ethers.constants.MaxUint256);
            await approveTx.wait();
          }
          return true;
        } catch (error) {
          console.error('æˆæƒå¤±è´¥:', error);
          throw new Error('approval');
        }
      },

      getSwapPath() {
        let path = [];
        
        // 1. é¦–å…ˆå¤„ç†ç›´æ¥äº¤æ˜“å¯¹ AxCNH â†” USDT0
        if ((fromToken === 'AXCNH' && toToken === 'USDT0') || 
            (fromToken === 'USDT0' && toToken === 'AXCNH')) {
          
          if (fromToken === 'AXCNH') {
            path.push(APP_CONFIG.CONTRACTS.AXCNH);
            path.push(APP_CONFIG.CONTRACTS.USDT0);
          } else {
            path.push(APP_CONFIG.CONTRACTS.USDT0);
            path.push(APP_CONFIG.CONTRACTS.AXCNH);
          }
          return path;
        }
        
        // 2. å¤„ç†æ¶‰åŠCFXçš„äº¤æ˜“
        if (fromToken === 'CFX') {
          path.push(APP_CONFIG.CONTRACTS.WCFX);
          if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
          else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
          else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
          else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
          else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
        } else if (toToken === 'CFX') {
          if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
          else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
          else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
          else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
          else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
          path.push(APP_CONFIG.CONTRACTS.WCFX);
        } else {
          // 3. å…¶ä»–ä»£å¸ä¹‹é—´çš„äº¤æ˜“ï¼ˆé€šè¿‡CFXä¸­è½¬ï¼‰
          if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
          else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
          else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
          else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
          else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
          
          path.push(APP_CONFIG.CONTRACTS.WCFX);
          
          if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
          else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
          else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
          else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
          else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
        }
        
        return path;
      },

      async updateOutputFromInput() {
        const amount = document.getElementById('fromAmount').value;
        
        if (!amount || amount === '0' || amount === '' || !router) {
          document.getElementById('toAmount').value = "";
          document.getElementById('minReceived').textContent = `0 ${toToken}`;
          DataManager.updateSwapButtonState();
          return;
        }
        
        try {
          const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
          const toDecimals = TokenUtils.getTokenDecimals(toToken);
          
          const amountIn = TokenUtils.parseTokenAmount(amount, fromToken);
          const path = this.getSwapPath();
          
          const amounts = await router.getAmountsOut(amountIn, path);
          const out = TokenUtils.formatTokenAmount(amounts[amounts.length - 1], toToken);
          
          document.getElementById('toAmount').value = out;
          
          const requiredSlippage = fromToken === 'LOM' ? 5 : slippage;
          const minOut = amounts[amounts.length - 1].mul(1000 - requiredSlippage * 10).div(1000);
          
          const minOutFormatted = TokenUtils.formatTokenAmount(minOut, toToken);
          document.getElementById('minReceived').textContent = 
            `${minOutFormatted} ${toToken}`;
          
          const price = parseFloat(out) / parseFloat(amount);
          const priceFormatted = Utils.formatDisplay(price);
          document.getElementById('price').textContent = 
            `1 ${fromToken} = ${priceFormatted} ${toToken}`;
          
          DataManager.updateSwapButtonState();
          
        } catch (error) {
          console.error('è®¡ç®—è¾“å‡ºå¤±è´¥:', error);
          document.getElementById('toAmount').value = "";
          document.getElementById('swapBtn').textContent = isChinese ? 'è®¡ç®—å¤±è´¥' : 'Calculation Failed';
          document.getElementById('swapBtn').disabled = true;
        }
      },

      reverseTokens() {
        const tempToken = fromToken;
        fromToken = toToken;
        toToken = tempToken;
        
        document.getElementById("fromTokenSymbol").textContent = fromToken;
        document.getElementById("toTokenSymbol").textContent = toToken;
        
        const fromTokenData = TokenUtils.getToken(fromToken);
        const toTokenData = TokenUtils.getToken(toToken);
        
        if (fromTokenData) {
          document.getElementById("fromTokenLogo").style.backgroundImage = `url('${fromTokenData.logo}')`;
        }
        
        if (toTokenData) {
          document.getElementById("toTokenLogo").style.backgroundImage = `url('${toTokenData.logo}')`;
        }
        
        document.getElementById("fromAmount").value = "";
        document.getElementById("toAmount").value = "";
        
        DataManager.updateAllBalances();
        DataManager.updateSwapButtonState();
        document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
        document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
        
        lastInputWasFrom = true;
      }
    };

    // ==================== æµåŠ¨æ€§æ¨¡å— ====================
    const LiquidityModule = {
      async addLiquidity() {
        const cfxAmount = document.getElementById("addCfx").value;
        const lomAmount = document.getElementById("addLom").value;
        
        if (!cfxAmount || !lomAmount || parseFloat(cfxAmount) <= 0 || parseFloat(lomAmount) <= 0) {
          Utils.showError(isChinese ? "è¯·è¾“å…¥æœ‰æ•ˆæ•°é‡" : "Please enter valid amounts");
          return;
        }
        
        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        const confirmed = await this.showAddConfirmDialog(cfxAmount, lomAmount);
        if (!confirmed) return;
        
        try {
          Utils.showNotification(isChinese ? 'æ·»åŠ æµåŠ¨æ€§ä¸­...' : 'Adding liquidity...', 'info');
          
          const amountCfx = TokenUtils.parseTokenAmount(cfxAmount, 'CFX');
          const amountLom = TokenUtils.parseTokenAmount(lomAmount, 'LOM');
          
          if (!lom || !router) {
            throw new Error('åˆçº¦æœªåˆå§‹åŒ–');
          }
          
          await SwapModule.checkAndApprove(lom, APP_CONFIG.CONTRACTS.ROUTER, amountLom);
          
          const minCfx = amountCfx.mul(1000 - slippage * 10).div(1000);
          const minLom = amountLom.mul(1000 - slippage * 10).div(1000);
          const deadline = Math.floor(Date.now() / 1000) + 1800;
          
          const tx = await router.addLiquidityETH(
            APP_CONFIG.CONTRACTS.LOM,
            amountLom,
            minLom,
            minCfx,
            account,
            deadline,
            { value: amountCfx }
          );
          
          await tx.wait();
          document.getElementById("addModal").style.display = "none";
          document.getElementById("addCfx").value = "";
          document.getElementById("addLom").value = "";
          
          Utils.showNotification(isChinese ? 'æ·»åŠ æµåŠ¨æ€§æˆåŠŸï¼' : 'Liquidity added successfully!', 'success');
          await DataManager.refreshAll();
          
        } catch (error) {
          console.error('æ·»åŠ æµåŠ¨æ€§å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        }
      },

      async showAddConfirmDialog(cfxAmount, lomAmount) {
        return new Promise((resolve) => {
          const modal = document.getElementById('farmConfirmModal');
          const icon = document.getElementById('farmConfirmIcon');
          const action = document.getElementById('farmConfirmAction');
          const amountsDiv = document.getElementById('farmConfirmAmounts');
          const detailsDiv = document.getElementById('farmConfirmDetails');
          
          // è®¾ç½®å†…å®¹
          icon.textContent = 'ğŸ’§';
          action.textContent = isChinese ? 'æ·»åŠ æµåŠ¨æ€§' : 'Add Liquidity';
          
          // è®¾ç½®é‡‘é¢æ˜¾ç¤º
          amountsDiv.innerHTML = `
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.CFX}')"></div>
              <div class="confirm-amount-text">${Utils.formatDisplay(cfxAmount)} CFX</div>
            </div>
            <div style="font-size: 20px; color: var(--text-secondary);">+</div>
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
              <div class="confirm-amount-text">${Utils.formatDisplay(lomAmount)} LOM</div>
            </div>
          `;
          
          // è®¾ç½®è¯¦æƒ…æ˜¾ç¤º
          const ratio = currentRatio > 0 ? currentRatio : (parseFloat(lomAmount) / parseFloat(cfxAmount));
          const ratioFormatted = Utils.formatDisplay(ratio);
          const estimatedLP = (parseFloat(cfxAmount) * 0.5).toFixed(6);
          
          detailsDiv.innerHTML = `
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'ä»·æ ¼æ¯”ä¾‹' : 'Price Ratio'}</div>
              <div class="confirm-detail-value">1 CFX = ${ratioFormatted} LOM</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æ»‘ç‚¹' : 'Slippage'}</div>
              <div class="confirm-detail-value">${slippage}%</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'é¢„è®¡LP' : 'Estimated LP'}</div>
              <div class="confirm-detail-value">${estimatedLP}</div>
            </div>
          `;
          
          // æ˜¾ç¤ºæ¨¡æ€æ¡†
          modal.style.display = "flex";
          
          // è®¾ç½®æŒ‰é’®äº‹ä»¶
          const cancelBtn = document.getElementById('farmCancelBtn');
          const confirmBtn = document.getElementById('farmConfirmBtn');
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            confirmBtn.removeEventListener('click', onConfirm);
            modal.style.display = 'none';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onConfirm = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          confirmBtn.addEventListener('click', onConfirm);
        });
      },

      async removeLiquidity() {
        const percent = document.getElementById("removeSlider").value;
        const cfxEst = document.getElementById("removeEstCfx").textContent;
        const lomEst = document.getElementById("removeEstLom").textContent;
        
        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        const confirmed = await this.showRemoveConfirmDialog(percent, cfxEst, lomEst);
        if (!confirmed) return;
        
        try {
          Utils.showNotification(isChinese ? 'ç§»é™¤æµåŠ¨æ€§ä¸­...' : 'Removing liquidity...', 'info');
          
          if (!pair || !router) {
            throw new Error('åˆçº¦æœªåˆå§‹åŒ–');
          }
          
          const lpBal = await pair.balanceOf(account);
          const liquidity = lpBal.mul(percent).div(100);
          
          if (liquidity.isZero()) {
            throw new Error(isChinese ? 'æ²¡æœ‰æµåŠ¨æ€§å¯ç§»é™¤' : 'No liquidity to remove');
          }
          
          await SwapModule.checkAndApprove(pair, APP_CONFIG.CONTRACTS.ROUTER, liquidity);
          
          const deadline = Math.floor(Date.now() / 1000) + 1800;
          
          const tx = await router.removeLiquidityETH(
            APP_CONFIG.CONTRACTS.LOM, 
            liquidity, 
            0,
            0,
            account, 
            deadline
          );
          
          await tx.wait();
          document.getElementById("removeModal").style.display = "none";
          
          Utils.showNotification(
            isChinese ? `ç§»é™¤æµåŠ¨æ€§æˆåŠŸï¼è·å¾— ${cfxEst} CFX å’Œ ${lomEst} LOM` : 
                       `Success! Received ${cfxEst} CFX and ${lomEst} LOM`,
            'success'
          );
          
          await DataManager.refreshAll();
          
        } catch (error) {
          console.error('ç§»é™¤æµåŠ¨æ€§å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        }
      },

      async showRemoveConfirmDialog(percent, cfxEst, lomEst) {
        return new Promise((resolve) => {
          const modal = document.getElementById('farmConfirmModal');
          const icon = document.getElementById('farmConfirmIcon');
          const action = document.getElementById('farmConfirmAction');
          const amountsDiv = document.getElementById('farmConfirmAmounts');
          const detailsDiv = document.getElementById('farmConfirmDetails');
          
          // è®¾ç½®å†…å®¹
          icon.textContent = 'ğŸ”¥';
          action.textContent = isChinese ? 'ç§»é™¤æµåŠ¨æ€§' : 'Remove Liquidity';
          
          // è®¾ç½®é‡‘é¢æ˜¾ç¤º
          amountsDiv.innerHTML = `
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.CFX}')"></div>
              <div class="confirm-amount-text">${cfxEst} CFX</div>
            </div>
            <div style="font-size: 20px; color: var(--text-secondary);">+</div>
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
              <div class="confirm-amount-text">${lomEst} LOM</div>
            </div>
          `;
          
          // è®¾ç½®è¯¦æƒ…æ˜¾ç¤º
          detailsDiv.innerHTML = `
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'ç§»é™¤æ¯”ä¾‹' : 'Remove %'}</div>
              <div class="confirm-detail-value">${percent}%</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æ»‘ç‚¹' : 'Slippage'}</div>
              <div class="confirm-detail-value">${slippage}%</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'é¢„è®¡è·å¾—' : 'Est. Receive'}</div>
              <div class="confirm-detail-value">${cfxEst} CFX</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'é¢„è®¡è·å¾—' : 'Est. Receive'}</div>
              <div class="confirm-detail-value">${lomEst} LOM</div>
            </div>
          `;
          
          // æ˜¾ç¤ºæ¨¡æ€æ¡†
          modal.style.display = "flex";
          
          // è®¾ç½®æŒ‰é’®äº‹ä»¶
          const cancelBtn = document.getElementById('farmCancelBtn');
          const confirmBtn = document.getElementById('farmConfirmBtn');
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            confirmBtn.removeEventListener('click', onConfirm);
            modal.style.display = 'none';
            confirmBtn.style.background = '';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onConfirm = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          confirmBtn.addEventListener('click', onConfirm);
          
          // è®¾ç½®ç¡®è®¤æŒ‰é’®æ ·å¼
          confirmBtn.style.background = 'var(--gradient-red)';
        });
      },

      async updateRemoveEstimate(percent) {
        try {
          if (!account || !pair) return;
          
          document.getElementById("removePercent").textContent = percent + "%";
          
          const lpBal = await pair.balanceOf(account);
          const liquidity = lpBal.mul(percent).div(100);
          
          if (liquidity.isZero()) {
            document.getElementById("removeEstCfx").textContent = "0.000000";
            document.getElementById("removeEstLom").textContent = "0.000000";
            return;
          }
          
          const total = await pair.totalSupply();
          const { cfx: rCfx, lom: rLom } = currentReserves;
          
          const cfxReserve = TokenUtils.parseTokenAmount(rCfx.toString(), 'CFX');
          const lomReserve = TokenUtils.parseTokenAmount(rLom.toString(), 'LOM');
          
          const cfxOut = cfxReserve.mul(liquidity).div(total);
          const lomOut = lomReserve.mul(liquidity).div(total);
          
          const cfxOutFormatted = TokenUtils.formatTokenAmount(cfxOut, 'CFX');
          const lomOutFormatted = TokenUtils.formatTokenAmount(lomOut, 'LOM');
          
          document.getElementById("removeEstCfx").textContent = cfxOutFormatted;
          document.getElementById("removeEstLom").textContent = lomOutFormatted;
          
        } catch (error) {
          console.error("æ›´æ–°ç§»é™¤ä¼°ç®—å¤±è´¥:", error);
          document.getElementById("removeEstCfx").textContent = "0.000000";
          document.getElementById("removeEstLom").textContent = "0.000000";
        }
      },

      handleCfxInput() {
        const cfxAmount = document.getElementById("addCfx").value;
        
        if (!cfxAmount || cfxAmount === "" || parseFloat(cfxAmount) <= 0) {
          document.getElementById("addLom").value = "";
          document.getElementById("confirmAddBtn").disabled = true;
          return;
        }
        
        if (currentRatio > 0) {
          const cfxNum = parseFloat(cfxAmount);
          const lomAmount = cfxNum * currentRatio;
          document.getElementById("addLom").value = Utils.formatDisplay(lomAmount);
        }
        
        this.updateAddButtonState();
      },

      handleLomInput() {
        const lomAmount = document.getElementById("addLom").value;
        
        if (!lomAmount || lomAmount === "" || parseFloat(lomAmount) <= 0) {
          document.getElementById("addCfx").value = "";
          document.getElementById("confirmAddBtn").disabled = true;
          return;
        }
        
        if (currentRatio > 0) {
          const lomNum = parseFloat(lomAmount);
          const cfxAmount = lomNum / currentRatio;
          document.getElementById("addCfx").value = Utils.formatDisplay(cfxAmount);
        }
        
        this.updateAddButtonState();
      },

      updateAddButtonState() {
        const cfxAmount = document.getElementById("addCfx").value;
        const lomAmount = document.getElementById("addLom").value;
        const cfxBalance = parseFloat(document.getElementById("addCfxBal").textContent);
        const lomBalance = parseFloat(document.getElementById("addLomBal").textContent);
        const confirmButton = document.getElementById("confirmAddBtn");
        
        if (!cfxAmount || !lomAmount || cfxAmount === "" || lomAmount === "") {
          confirmButton.disabled = true;
          return;
        }
        
        const cfxNum = parseFloat(cfxAmount);
        const lomNum = parseFloat(lomAmount);
        
        if (isNaN(cfxNum) || isNaN(lomNum) || cfxNum <= 0 || lomNum <= 0) {
          confirmButton.disabled = true;
          return;
        }
        
        if (cfxNum > cfxBalance) {
          confirmButton.disabled = true;
          return;
        }
        
        if (lomNum > lomBalance) {
          confirmButton.disabled = true;
          return;
        }
        
        const remainingCfx = cfxBalance - cfxNum;
        if (remainingCfx < 0.01) {
          confirmButton.disabled = true;
          return;
        }
        
        confirmButton.disabled = false;
      },

      async setMaxCfx() {
        const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
        if (cfxBal <= 0) {
          Utils.showError(isChinese ? "CFXä½™é¢ä¸è¶³" : "Insufficient CFX balance");
          return;
        }
        
        const maxCfx = Math.max(0, cfxBal - 0.1);
        document.getElementById("addCfx").value = Utils.formatDisplay(maxCfx);
        
        if (currentRatio > 0) {
          const requiredLom = maxCfx * currentRatio;
          const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
          
          if (requiredLom <= lomBal) {
            document.getElementById("addLom").value = Utils.formatDisplay(requiredLom);
          } else {
            const adjustedCfx = lomBal / currentRatio;
            document.getElementById("addCfx").value = Utils.formatDisplay(Math.min(adjustedCfx, maxCfx));
            document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
          }
        }
        
        this.updateAddButtonState();
      },

      async setMaxLom() {
        const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
        if (lomBal <= 0) {
          Utils.showError(isChinese ? "LOMä½™é¢ä¸è¶³" : "Insufficient LOM balance");
          return;
        }
        
        document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
        
        if (currentRatio > 0) {
          const requiredCfx = lomBal / currentRatio;
          const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
          const availableCfx = Math.max(0, cfxBal - 0.1);
          
          if (requiredCfx <= availableCfx) {
            document.getElementById("addCfx").value = Utils.formatDisplay(requiredCfx);
          } else {
            const adjustedLom = availableCfx * currentRatio;
            document.getElementById("addLom").value = Utils.formatDisplay(Math.min(adjustedLom, lomBal));
            document.getElementById("addCfx").value = Utils.formatDisplay(availableCfx);
          }
        }
        
        this.updateAddButtonState();
      }
    };

    // ==================== LPå¥–åŠ±å†œåœºç®¡ç†å™¨ ====================
    const FarmManager = {
      async refreshFarmData() {
        if (!account || !lpRewardFarm) return;
        
        try {
          // è·å–å†œåœºä¿¡æ¯
          const poolInfo = await lpRewardFarm.getPoolInfo();
          this.updateFarmInfo(poolInfo);
          
          // è·å–ç”¨æˆ·ä¿¡æ¯
          const userInfo = await lpRewardFarm.getUserInfo(account);
          this.updateUserInfo(userInfo);
          
          // è·å–å¾…é¢†å–å¥–åŠ±ä¼°ç®—
          await this.updatePendingRewards();
          
          // æ›´æ–°åŒæ­¥è®¡æ—¶å™¨
          this.updateSyncTimer(userInfo);
          
        } catch (error) {
          console.error('è·å–å†œåœºæ•°æ®å¤±è´¥:', error);
        }
      },

      updateFarmInfo(poolInfo) {
        document.getElementById('totalDeposited').textContent = 
          Utils.formatNumber(parseFloat(ethers.utils.formatUnits(poolInfo.lomDeposited, 18))) + ' LOM';
        document.getElementById('totalDistributed').textContent = 
          Utils.formatNumber(parseFloat(ethers.utils.formatUnits(poolInfo.lomDistributed, 18))) + ' LOM';
        document.getElementById('remainingLOM').textContent = 
          Utils.formatNumber(parseFloat(ethers.utils.formatUnits(poolInfo.lomRemaining, 18))) + ' LOM';
        
        const status = poolInfo.isActive ? 
          (poolInfo.isPaused ? 'å·²æš‚åœ' : 'è¿è¡Œä¸­') : 
          'æœªæ¿€æ´»';
        document.getElementById('farmingStatus').textContent = status;
        document.getElementById('farmingStatus').style.color = poolInfo.isActive && !poolInfo.isPaused ? 
          'var(--success)' : 'var(--warning)';
      },

      updateUserInfo(userInfo) {
        const userRewardsCard = document.getElementById('userRewardsCard');
        const activateSection = document.getElementById('activateSection');
        
        if (userInfo.currentBalance > 0) {
          // ç”¨æˆ·å·²æ¿€æ´»
          userRewardsCard.style.display = 'block';
          activateSection.style.display = 'none';
          
          // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
          document.getElementById('userLPBalance').textContent = 
            Utils.formatNumber(parseFloat(ethers.utils.formatUnits(userInfo.currentBalance, 18)));
          document.getElementById('pendingRewards').textContent = 
            Utils.formatNumber(parseFloat(ethers.utils.formatUnits(userInfo.pendingLOMRewards, 18))) + ' LOM';
          document.getElementById('activityScore').textContent = userInfo.activityScore.toString();
          document.getElementById('consecutiveDays').textContent = userInfo.consecutiveDays.toString();
          
          // è®¡ç®—ä»Šæ—¥å·²å¾—å’Œå‰©ä½™
          const dailyEarned = parseFloat(ethers.utils.formatUnits(userInfo.dailyLOMLeft, 18)) < 3000 ? 
            (3000 - parseFloat(ethers.utils.formatUnits(userInfo.dailyLOMLeft, 18))) : 0;
          document.getElementById('dailyEarned').textContent = 
            Utils.formatNumber(dailyEarned) + ' LOM';
          document.getElementById('dailyLeft').textContent = 
            Utils.formatNumber(parseFloat(ethers.utils.formatUnits(userInfo.dailyLOMLeft, 18))) + ' LOM';
          
          // æ›´æ–°ç­‰çº§
          const levelEl = document.getElementById('userLevel');
          levelEl.textContent = userInfo.level;
          levelEl.className = `user-level level-${userInfo.level.toLowerCase()}`;
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          this.updateButtonStates(userInfo);
          
        } else {
          // ç”¨æˆ·æœªæ¿€æ´»
          userRewardsCard.style.display = 'none';
          activateSection.style.display = 'block';
          
          // æ£€æŸ¥æ˜¯å¦æœ‰LPä»£å¸ä½™é¢
          if (pair) {
            const lpBalance = await pair.balanceOf(account);
            const activateBtn = document.getElementById('activateBtn');
            activateBtn.disabled = lpBalance.isZero();
          }
        }
      },

      async updatePendingRewards() {
        if (!account || !lpRewardFarm) return;
        
        try {
          const estimate = await lpRewardFarm.getPendingRewardsEstimate(account);
          
          document.getElementById('safeEstimate').textContent = 
            Utils.formatNumber(parseFloat(ethers.utils.formatUnits(estimate.safeRewards, 18))) + ' LOM';
          document.getElementById('optimisticEstimate').textContent = 
            Utils.formatNumber(parseFloat(ethers.utils.formatUnits(estimate.optimisticRewards, 18))) + ' LOM';
            
        } catch (error) {
          console.error('è·å–å¥–åŠ±é¢„ä¼°å¤±è´¥:', error);
        }
      },

      updateButtonStates(userInfo) {
        const syncBtn = document.getElementById('syncBtn');
        const claimBtn = document.getElementById('claimBtn');
        const checkinBtn = document.getElementById('checkinBtn');
        
        // åŒæ­¥æŒ‰é’®çŠ¶æ€
        if (userInfo.nextSyncAvailable > 0) {
          syncBtn.disabled = true;
          const syncIcon = document.getElementById('syncIcon');
          const syncText = document.getElementById('syncText');
          const syncTimer = document.getElementById('syncTimer');
          
          syncIcon.style.display = 'none';
          syncText.textContent = 'ç­‰å¾…åŒæ­¥';
          syncTimer.textContent = Utils.formatTime(userInfo.nextSyncAvailable);
        } else {
          syncBtn.disabled = false;
          const syncIcon = document.getElementById('syncIcon');
          const syncText = document.getElementById('syncText');
          const syncTimer = document.getElementById('syncTimer');
          
          syncIcon.style.display = 'inline';
          syncText.textContent = 'åŒæ­¥å¥–åŠ±';
          syncTimer.textContent = '';
        }
        
        // é¢†å–æŒ‰é’®çŠ¶æ€
        claimBtn.disabled = userInfo.pendingLOMRewards.isZero();
        
        // ç­¾åˆ°æŒ‰é’®çŠ¶æ€
        checkinBtn.disabled = !userInfo.canCheckInToday;
      },

      updateSyncTimer(userInfo) {
        const syncTimer = document.getElementById('syncTimer');
        if (syncTimer.textContent && syncTimer.textContent !== 'éšæ—¶') {
          // è¿™é‡Œå¯ä»¥æ·»åŠ å®æ—¶å€’è®¡æ—¶é€»è¾‘
          // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ä¾èµ–å®šæœŸåˆ·æ–°
        }
      },

      async activateAccount() {
        try {
          // æ£€æŸ¥LPä½™é¢
          const lpBalance = await pair.balanceOf(account);
          if (lpBalance.isZero()) {
            Utils.showError(isChinese ? "æ‚¨æ²¡æœ‰LPä»£å¸ä½™é¢" : "You have no LP token balance");
            return;
          }
          
          // ç¡®è®¤å¯¹è¯æ¡†
          const confirmed = await this.showConfirmDialog(
            'activate',
            'æ¿€æ´»è´¦æˆ·',
            'ç¡®è®¤æ¿€æ´»è´¦æˆ·ï¼Ÿ',
            'æ¿€æ´»åå³å¯å¼€å§‹èµšå–LOMå¥–åŠ±'
          );
          
          if (!confirmed) return;
          
          // æ‰§è¡Œæ¿€æ´»
          const activateBtn = document.getElementById('activateBtn');
          this.showLoading(activateBtn, 'æ¿€æ´»ä¸­...');
          
          const tx = await lpRewardFarm.activate();
          await tx.wait();
          
          Utils.showNotification(isChinese ? 'è´¦æˆ·æ¿€æ´»æˆåŠŸï¼' : 'Account activated successfully!', 'success');
          await this.refreshFarmData();
          
        } catch (error) {
          console.error('æ¿€æ´»è´¦æˆ·å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        } finally {
          const activateBtn = document.getElementById('activateBtn');
          this.hideLoading(activateBtn, '<span>âœ…</span><span>æ¿€æ´»è´¦æˆ·</span>');
        }
      },

      async syncRewards() {
        try {
          // è·å–é¢„ä¼°å¥–åŠ±
          const estimate = await lpRewardFarm.getPendingRewardsEstimate(account);
          
          // ç¡®è®¤å¯¹è¯æ¡†
          const confirmed = await this.showConfirmDialog(
            'sync',
            'åŒæ­¥å¥–åŠ±',
            'ç¡®è®¤åŒæ­¥å¥–åŠ±ï¼Ÿ',
            `é¢„ä¼°å¯è·å¾—: ${Utils.formatNumber(parseFloat(ethers.utils.formatUnits(estimate.optimisticRewards, 18)))} LOM`
          );
          
          if (!confirmed) return;
          
          // æ‰§è¡ŒåŒæ­¥
          const syncBtn = document.getElementById('syncBtn');
          this.showLoading(syncBtn, 'åŒæ­¥ä¸­...');
          
          const tx = await lpRewardFarm.sync();
          await tx.wait();
          
          Utils.showNotification(isChinese ? 'å¥–åŠ±åŒæ­¥æˆåŠŸï¼' : 'Rewards synced successfully!', 'success');
          await this.refreshFarmData();
          
        } catch (error) {
          console.error('åŒæ­¥å¥–åŠ±å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        } finally {
          const syncBtn = document.getElementById('syncBtn');
          this.hideLoading(syncBtn, '<span>ğŸ”„</span><span>åŒæ­¥å¥–åŠ±</span>');
        }
      },

      async claimRewards() {
        try {
          // è·å–å¾…é¢†å–å¥–åŠ±
          const userInfo = await lpRewardFarm.getUserInfo(account);
          const pendingRewards = userInfo.pendingLOMRewards;
          
          if (pendingRewards.isZero()) {
            Utils.showError(isChinese ? "æ²¡æœ‰å¯é¢†å–çš„å¥–åŠ±" : "No rewards to claim");
            return;
          }
          
          // ç¡®è®¤å¯¹è¯æ¡†
          const confirmed = await this.showConfirmDialog(
            'claim',
            'é¢†å–å¥–åŠ±',
            'ç¡®è®¤é¢†å–LOMå¥–åŠ±ï¼Ÿ',
            `é¢†å–é‡‘é¢: ${Utils.formatNumber(parseFloat(ethers.utils.formatUnits(pendingRewards, 18)))} LOM`
          );
          
          if (!confirmed) return;
          
          // æ‰§è¡Œé¢†å–
          const claimBtn = document.getElementById('claimBtn');
          this.showLoading(claimBtn, 'é¢†å–ä¸­...');
          
          const tx = await lpRewardFarm.claimLOMRewards();
          await tx.wait();
          
          Utils.showNotification(
            isChinese ? `æˆåŠŸé¢†å– ${Utils.formatNumber(parseFloat(ethers.utils.formatUnits(pendingRewards, 18)))} LOM` : 
                       `Successfully claimed ${Utils.formatNumber(parseFloat(ethers.utils.formatUnits(pendingRewards, 18)))} LOM`,
            'success'
          );
          await this.refreshFarmData();
          
        } catch (error) {
          console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        } finally {
          const claimBtn = document.getElementById('claimBtn');
          this.hideLoading(claimBtn, '<span>ğŸ’°</span><span>é¢†å–LOMå¥–åŠ±</span>');
        }
      },

      async dailyCheckIn() {
        try {
          // è·å–ç”¨æˆ·ä¿¡æ¯
          const userInfo = await lpRewardFarm.getUserInfo(account);
          
          // ç¡®è®¤å¯¹è¯æ¡†
          const confirmed = await this.showConfirmDialog(
            'checkin',
            'æ¯æ—¥ç­¾åˆ°',
            'ç¡®è®¤æ¯æ—¥ç­¾åˆ°ï¼Ÿ',
            `å½“å‰è¿ç»­ç­¾åˆ°å¤©æ•°: ${userInfo.consecutiveDays}`
          );
          
          if (!confirmed) return;
          
          // æ‰§è¡Œç­¾åˆ°
          const checkinBtn = document.getElementById('checkinBtn');
          this.showLoading(checkinBtn, 'ç­¾åˆ°ä¸­...');
          
          const tx = await lpRewardFarm.dailyCheckIn();
          await tx.wait();
          
          Utils.showNotification(isChinese ? 'ç­¾åˆ°æˆåŠŸï¼' : 'Check-in successful!', 'success');
          await this.refreshFarmData();
          
        } catch (error) {
          console.error('ç­¾åˆ°å¤±è´¥:', error);
          Utils.showNotification(Utils.getErrorMessage(error), 'error');
        } finally {
          const checkinBtn = document.getElementById('checkinBtn');
          this.hideLoading(checkinBtn, '<span>ğŸ“…</span><span>æ¯æ—¥ç­¾åˆ°</span>');
        }
      },

      async showConfirmDialog(type, title, action, description) {
        return new Promise((resolve) => {
          const modal = document.getElementById('farmConfirmModal');
          const icon = document.getElementById('farmConfirmIcon');
          const actionEl = document.getElementById('farmConfirmAction');
          const amountsDiv = document.getElementById('farmConfirmAmounts');
          const detailsDiv = document.getElementById('farmConfirmDetails');
          
          const iconMap = {
            activate: 'âœ…',
            sync: 'ğŸ”„',
            claim: 'ğŸ’°',
            checkin: 'ğŸ“…'
          };
          
          const titleMap = {
            activate: isChinese ? 'æ¿€æ´»è´¦æˆ·ç¡®è®¤' : 'Activate Account Confirmation',
            sync: isChinese ? 'åŒæ­¥å¥–åŠ±ç¡®è®¤' : 'Sync Rewards Confirmation',
            claim: isChinese ? 'é¢†å–å¥–åŠ±ç¡®è®¤' : 'Claim Rewards Confirmation',
            checkin: isChinese ? 'æ¯æ—¥ç­¾åˆ°ç¡®è®¤' : 'Daily Check-in Confirmation'
          };
          
          // è®¾ç½®å†…å®¹
          icon.textContent = iconMap[type] || 'â“';
          actionEl.textContent = titleMap[type] || title;
          
          // è®¾ç½®é‡‘é¢æ˜¾ç¤º
          amountsDiv.innerHTML = `
            <div class="confirm-amount-row">
              <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
              <div class="confirm-amount-text">${action}</div>
            </div>
          `;
          
          // è®¾ç½®è¯¦æƒ…æ˜¾ç¤º
          detailsDiv.innerHTML = `
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æ“ä½œç±»å‹' : 'Action Type'}</div>
              <div class="confirm-detail-value">${title}</div>
            </div>
            <div class="confirm-detail-item">
              <div class="confirm-detail-label">${isChinese ? 'æè¿°' : 'Description'}</div>
              <div class="confirm-detail-value">${description}</div>
            </div>
          `;
          
          // æ˜¾ç¤ºæ¨¡æ€æ¡†
          modal.style.display = "flex";
          
          // è®¾ç½®æŒ‰é’®äº‹ä»¶
          const cancelBtn = document.getElementById('farmCancelBtn');
          const confirmBtn = document.getElementById('farmConfirmBtn');
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            confirmBtn.removeEventListener('click', onConfirm);
            modal.style.display = 'none';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onConfirm = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          confirmBtn.addEventListener('click', onConfirm);
        });
      },

      showLoading(button, text) {
        button.disabled = true;
        button.innerHTML = `<span class="loading-spinner small"></span><span>${text}</span>`;
      },

      hideLoading(button, html) {
        button.disabled = false;
        button.innerHTML = html;
      },

      resetUI() {
        // é‡ç½®å†œåœºUI
        document.getElementById('totalDeposited').textContent = '0 LOM';
        document.getElementById('totalDistributed').textContent = '0 LOM';
        document.getElementById('remainingLOM').textContent = '0 LOM';
        document.getElementById('farmingStatus').textContent = 'æœªæ¿€æ´»';
        document.getElementById('farmingStatus').style.color = '';
        
        // éšè—ç”¨æˆ·ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ¿€æ´»éƒ¨åˆ†
        document.getElementById('userRewardsCard').style.display = 'none';
        document.getElementById('activateSection').style.display = 'block';
        
        // é‡ç½®æ¿€æ´»æŒ‰é’®
        const activateBtn = document.getElementById('activateBtn');
        activateBtn.disabled = false;
        activateBtn.innerHTML = '<span>âœ…</span><span>æ¿€æ´»è´¦æˆ·</span>';
      }
    };

    // ==================== ç•Œé¢ç®¡ç†å™¨ ====================
    const UIManager = {
      init() {
        this.setupEventListeners();
        this.setupTabs();
        this.updateAllTexts();
        this.setupFocusEffects();
        
        document.getElementById('txStatusDoneBtn').addEventListener('click', () => {
          Utils.hideNotification();
        });
      },

      setupEventListeners() {
        // é’±åŒ…å’Œè¯­è¨€æŒ‰é’®
        document.getElementById("walletBtn").addEventListener("click", () => this.handleWalletClick());
        document.getElementById("langBtn").addEventListener("click", () => this.toggleLanguage());
        
        // å…‘æ¢é¡µé¢äº‹ä»¶
        const debouncedFromInput = Utils.debounce(() => this.handleFromAmountInput(), 300);
        document.getElementById("fromAmount").addEventListener("input", debouncedFromInput);
        
        document.getElementById("reverse").addEventListener("click", () => SwapModule.reverseTokens());
        document.getElementById("swapBtn").addEventListener("click", async () => {
          if (!account) {
            await this.handleWalletClick();
          } else {
            await SwapModule.executeSwap();
          }
        });
        
        // ç™¾åˆ†æ¯”æŒ‰é’®
        document.querySelectorAll('.percent-btn').forEach(btn => {
          btn.addEventListener('click', (e) => this.handlePercentageClick(e));
        });
        
        // æ»‘ç‚¹æŒ‰é’®
        document.querySelectorAll('.slippage-btn').forEach(btn => {
          btn.addEventListener('click', (e) => this.handleSlippageClick(e));
        });
        
        // ä»£å¸é€‰æ‹©å™¨
        document.getElementById("fromTokenSelector").addEventListener("click", () => this.openTokenSelector('from'));
        document.getElementById("toTokenSelector").addEventListener("click", () => this.openTokenSelector('to'));
        
        // æµåŠ¨æ€§é¡µé¢äº‹ä»¶
        document.getElementById("addBtn").addEventListener("click", () => this.openAddModal());
        document.getElementById("removeBtn").addEventListener("click", () => this.openRemoveModal());
        
        // å†œåœºé¡µé¢äº‹ä»¶
        document.getElementById("activateBtn").addEventListener("click", () => FarmManager.activateAccount());
        document.getElementById("syncBtn").addEventListener("click", () => FarmManager.syncRewards());
        document.getElementById("claimBtn").addEventListener("click", () => FarmManager.claimRewards());
        document.getElementById("checkinBtn").addEventListener("click", () => FarmManager.dailyCheckIn());
        
        // æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
        document.addEventListener("click", (e) => {
          if (e.target.classList.contains("modal-overlay") || 
              e.target.classList.contains("token-selector-modal")) {
            e.target.style.display = "none";
          }
        });
        
        // æ·»åŠ æµåŠ¨æ€§äº‹ä»¶
        const debouncedCfxInput = Utils.debounce(() => LiquidityModule.handleCfxInput(), 300);
        const debouncedLomInput = Utils.debounce(() => LiquidityModule.handleLomInput(), 300);
        document.getElementById("addCfx").addEventListener("input", debouncedCfxInput);
        document.getElementById("addLom").addEventListener("input", debouncedLomInput);
        document.getElementById("cfxMaxBtn").addEventListener("click", () => LiquidityModule.setMaxCfx());
        document.getElementById("lomMaxBtn").addEventListener("click", () => LiquidityModule.setMaxLom());
        document.getElementById("cancelAddBtn").addEventListener("click", () => document.getElementById("addModal").style.display = "none");
        document.getElementById("confirmAddBtn").addEventListener("click", () => LiquidityModule.addLiquidity());
        
        // ç§»é™¤æµåŠ¨æ€§äº‹ä»¶
        document.getElementById("removeSlider").addEventListener("input", (e) => LiquidityModule.updateRemoveEstimate(e.target.value));
        document.querySelectorAll('.percentage-option').forEach(btn => {
          btn.addEventListener('click', (e) => this.handlePercentageOption(e));
        });
        document.getElementById("cancelRemoveBtn").addEventListener("click", () => document.getElementById("removeModal").style.display = "none");
        document.getElementById("confirmRemoveBtn").addEventListener("click", () => LiquidityModule.removeLiquidity());
        
        // ä½™é¢ç‚¹å‡»äº‹ä»¶
        document.getElementById("fromBal").addEventListener("click", () => {
          this.setMaxFromBalance();
        });
      },

      async handleWalletClick() {
        if (account) {
          const confirmMessage = isChinese ? 
            "ç¡®å®šè¦æ–­å¼€é’±åŒ…è¿æ¥å—ï¼Ÿ" : 
            "Are you sure you want to disconnect wallet?";
          
          if (confirm(confirmMessage)) {
            WalletManager.disconnect();
          }
          return;
        }
        
        document.getElementById("walletBtn").disabled = true;
        
        try {
          const success = await WalletManager.connect();
          if (success) {
            WalletManager.updateUI();
            DataManager.refreshAll();
            FarmManager.refreshFarmData();
          }
        } catch (error) {
          console.error("é’±åŒ…è¿æ¥å¤±è´¥:", error);
        } finally {
          document.getElementById("walletBtn").disabled = false;
          WalletManager.updateUI();
        }
      },

      setupTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const tabId = btn.dataset.tab;
            
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            if (account) {
              DataManager.refreshAll();
              if (tabId === 'farm') {
                FarmManager.refreshFarmData();
              }
            }
          });
        });
      },

      handleFromAmountInput() {
        const amount = document.getElementById("fromAmount").value;
        if (amount && amount !== "0") {
          lastInputWasFrom = true;
          SwapModule.updateOutputFromInput();
        } else {
          document.getElementById("toAmount").value = "";
          DataManager.updateSwapButtonState();
          document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
        }
      },

      handlePercentageClick(e) {
        const percent = parseFloat(e.target.dataset.percent);
        
        document.querySelectorAll('.percent-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        
        if (!account) {
          Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
          return;
        }
        
        let balance = parseFloat(document.getElementById("fromBal").textContent);
        
        if (balance > 0) {
          let amount;
          
          if (percent === 1) {
            if (fromToken === 'CFX') {
              amount = Math.max(0, balance - 0.1);
            } else {
              amount = balance * 0.9;
            }
          } else {
            amount = balance * percent;
          }
          
          if (amount > 0) {
            document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
            lastInputWasFrom = true;
            SwapModule.updateOutputFromInput();
          }
        }
      },

      handleSlippageClick(e) {
        const newSlippage = parseFloat(e.target.dataset.slip);
        
        slippage = newSlippage;
        document.querySelectorAll('.slippage-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        
        if (lastInputWasFrom && document.getElementById("fromAmount").value) {
          SwapModule.updateOutputFromInput();
        }
      },

      handlePercentageOption(e) {
        const percent = e.target.dataset.percent;
        document.querySelectorAll('.percentage-option').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        document.getElementById("removeSlider").value = percent;
        document.getElementById("removePercent").textContent = percent + "%";
        LiquidityModule.updateRemoveEstimate(percent);
      },

      openTokenSelector(type) {
        currentTokenSelector = type;
        const modal = document.getElementById("tokenSelectorModal");
        modal.style.display = "flex";
        document.getElementById("tokenSearch").value = "";
        this.populateTokenList();
      },

      async populateTokenList(searchTerm = "") {
        const tokenList = document.getElementById("tokenList");
        tokenList.innerHTML = "";
        
        const filteredTokens = TOKEN_LIST.filter(token => {
          if (searchTerm) {
            const term = searchTerm.toLowerCase();
            return token.symbol.toLowerCase().includes(term) || 
                   token.name.toLowerCase().includes(term);
          }
          return true;
        });
        
        const fragment = document.createDocumentFragment();
        
        filteredTokens.forEach(token => {
          if ((currentTokenSelector === 'from' && token.symbol === toToken) ||
              (currentTokenSelector === 'to' && token.symbol === fromToken)) {
            return;
          }
          
          const tokenItem = document.createElement("div");
          tokenItem.className = "token-item";
          tokenItem.innerHTML = `
            <div class="token-item-logo" style="background-image: url('${token.logo}')"></div>
            <div class="token-item-info">
              <div class="token-item-symbol">${token.symbol}</div>
              <div class="token-item-name">${token.name}</div>
            </div>
            <div class="token-item-balance" id="selectorBalance-${token.symbol}">0.000000</div>
          `;
          
          tokenItem.addEventListener("click", () => {
            this.selectToken(token);
          });
          
          fragment.appendChild(tokenItem);
        });
        
        tokenList.appendChild(fragment);
        
        // å¼‚æ­¥æ›´æ–°ä½™é¢
        setTimeout(() => {
          if (account) {
            filteredTokens.forEach(token => {
              this.updateTokenBalanceInSelector(token.symbol);
            });
          }
        }, 50);
        
        // è®¾ç½®æœç´¢äº‹ä»¶
        const searchInput = document.getElementById("tokenSearch");
        searchInput.addEventListener('input', Utils.debounce((e) => {
          this.populateTokenList(e.target.value);
        }, 300));
        
        setTimeout(() => searchInput.focus(), 100);
      },

      async updateTokenBalanceInSelector(symbol) {
        try {
          const token = TokenUtils.getToken(symbol);
          if (!token) return;
          
          let amount = 0;
          
          if (symbol === 'CFX' && provider && account) {
            const cfxBal = await provider.getBalance(account);
            amount = parseFloat(ethers.utils.formatEther(cfxBal));
          } else {
            const contract = TokenUtils.getTokenContract(symbol);
            if (contract && account) {
              const tokenBal = await contract.balanceOf(account);
              amount = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
            }
          }
          
          const formattedBalance = Utils.formatDisplay(amount);
          
          const balanceElement = document.getElementById(`selectorBalance-${symbol}`);
          if (balanceElement) {
            balanceElement.textContent = formattedBalance;
          }
        } catch (error) {
          console.error(`æ›´æ–°${symbol}ä½™é¢å¤±è´¥:`, error);
        }
      },

      selectToken(token) {
        if (currentTokenSelector === 'from') {
          fromToken = token.symbol;
          document.getElementById("fromTokenSymbol").textContent = token.symbol;
          document.getElementById("fromTokenLogo").style.backgroundImage = `url('${token.logo}')`;
        } else if (currentTokenSelector === 'to') {
          toToken = token.symbol;
          document.getElementById("toTokenSymbol").textContent = token.symbol;
          document.getElementById("toTokenLogo").style.backgroundImage = `url('${token.logo}')`;
        }
        
        document.getElementById("tokenSelectorModal").style.display = "none";
        DataManager.updateAllBalances();
        
        document.getElementById("fromAmount").value = "";
        document.getElementById("toAmount").value = "";
        
        DataManager.updateSwapButtonState();
        document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
        document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
      },

      async setMaxFromBalance() {
        if (!account) {
          Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
          return;
        }
        
        let balance = parseFloat(document.getElementById("fromBal").textContent);
        
        if (balance > 0) {
          let amount;
          
          if (fromToken === 'CFX') {
            amount = Math.max(0, balance - 0.1);
          } else {
            amount = balance * 0.9;
          }
          
          if (amount > 0) {
            document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
            lastInputWasFrom = true;
            await SwapModule.updateOutputFromInput();
          }
        }
      },

      toggleLanguage() {
        isChinese = !isChinese;
        document.getElementById("langBtn").innerText = isChinese ? "EN" : "ZN";
        this.updateAllTexts();
      },

      updateAllTexts() {
        const walletBtn = document.getElementById("walletBtn");
        if (account) {
          const displayAddress = Utils.formatAddress(account);
          walletBtn.textContent = displayAddress;
          walletBtn.classList.add('connected');
        } else {
          walletBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          walletBtn.classList.remove('connected');
        }
        
        document.querySelector('[data-tab="swap"]').textContent = isChinese ? "å…‘æ¢" : "Swap";
        document.querySelector('[data-tab="liquidity"]').textContent = isChinese ? "æµåŠ¨æ€§" : "Liquidity";
        document.querySelector('[data-tab="farm"]').textContent = isChinese ? "LPæŒ–çŸ¿" : "LP Farm";
        
        const swapBtn = document.getElementById("swapBtn");
        if (!account) {
          swapBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          swapBtn.disabled = false;
        } else if (document.getElementById("fromAmount").value && document.getElementById("fromAmount").value !== "0") {
          swapBtn.textContent = isChinese ? "ç«‹å³å…‘æ¢" : "Swap Now";
          swapBtn.disabled = false;
        } else {
          swapBtn.textContent = isChinese ? "è¯·è¾“å…¥æ•°é‡" : "Enter Amount";
          swapBtn.disabled = true;
        }
        
        document.getElementById("addBtn").textContent = isChinese ? "æ·»åŠ æµåŠ¨æ€§" : "Add Liquidity";
        document.getElementById("removeBtn").textContent = isChinese ? "ç§»é™¤æµåŠ¨æ€§" : "Remove Liquidity";
        
        document.getElementById("tokenSelectorTitle").textContent = isChinese ? "é€‰æ‹©ä»£å¸" : "Select Token";
        document.getElementById("addTitle").textContent = isChinese ? "æ·»åŠ æµåŠ¨æ€§" : "Add Liquidity";
        document.getElementById("removeTitle").textContent = isChinese ? "ç§»é™¤æµåŠ¨æ€§" : "Remove Liquidity";
        document.getElementById("confirmAddBtn").textContent = isChinese ? "ç¡®è®¤æ·»åŠ " : "Confirm Add";
        document.getElementById("confirmRemoveBtn").textContent = isChinese ? "ç¡®è®¤ç§»é™¤" : "Confirm Remove";
        document.getElementById("cancelAddBtn").textContent = isChinese ? "å–æ¶ˆ" : "Cancel";
        document.getElementById("cancelRemoveBtn").textContent = isChinese ? "å–æ¶ˆ" : "Cancel";
        
        // å†œåœºé¡µé¢æ–‡æœ¬
        document.querySelector('.card-title span:last-child').textContent = isChinese ? "LPæŒ–çŸ¿å†œåœº" : "LP Mining Farm";
        document.querySelector('.stake-title').textContent = isChinese ? "LOMå¥–åŠ±å†œåœº" : "LOM Reward Farm";
        document.querySelector('.stake-description').textContent = isChinese ? 
          "è´¨æŠ¼æ‚¨çš„CFX-LOM LPä»£å¸ï¼Œèµšå–LOMå¥–åŠ±ã€‚æ€»å¥–åŠ±æ± ï¼š25,555,555 LOM" : 
          "Stake your CFX-LOM LP tokens to earn LOM rewards. Total reward pool: 25,555,555 LOM";
        
        document.getElementById('activateBtn').innerHTML = '<span>âœ…</span><span>' + (isChinese ? 'æ¿€æ´»è´¦æˆ·' : 'Activate Account') + '</span>';
        
        const syncBtn = document.getElementById('syncBtn');
        const syncText = document.getElementById('syncText');
        if (syncText) {
          syncText.textContent = isChinese ? 'åŒæ­¥å¥–åŠ±' : 'Sync Rewards';
        }
        
        document.getElementById('claimBtn').innerHTML = '<span>ğŸ’°</span><span>' + (isChinese ? 'é¢†å–LOMå¥–åŠ±' : 'Claim LOM Rewards') + '</span>';
        document.getElementById('checkinBtn').innerHTML = '<span>ğŸ“…</span><span>' + (isChinese ? 'æ¯æ—¥ç­¾åˆ°' : 'Daily Check-in') + '</span>';
        
        document.getElementById("riskTitle").textContent = isChinese ? "é£é™©æç¤º" : "Risk Warning";
        document.getElementById("riskText").textContent = isChinese ? 
          "æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚" :
          "This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.";
        
        document.getElementById("footerText").textContent = isChinese ? "LOMswap Â· Conflux eSpace" : "LOMswap Â· Conflux eSpace";
      },

      openAddModal() {
        if (!account) {
          Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
          return;
        }
        
        document.getElementById("addModal").style.display = "flex";
        document.getElementById("addCfx").value = "";
        document.getElementById("addLom").value = "";
        document.getElementById("confirmAddBtn").disabled = true;
        
        if (currentRatio > 0) {
          const ratioFormatted = Utils.formatDisplay(currentRatio);
          document.getElementById("addRatio").textContent = `1 CFX = ${ratioFormatted} LOM`;
        }
      },

      openRemoveModal() {
        if (!account) {
          Utils.showError(isChinese ? "è¯·å…ˆè¿æ¥é’±åŒ…" : "Please connect wallet first");
          return;
        }
        
        document.getElementById("removeModal").style.display = "flex";
        LiquidityModule.updateRemoveEstimate(100);
      },

      setupFocusEffects() {
        const fromInput = document.getElementById("fromAmount");
        const toInput = document.getElementById("toAmount");
        const fromWrapper = document.getElementById("fromTokenWrapper");
        const toWrapper = document.getElementById("toTokenWrapper");
        
        fromInput.addEventListener('focus', () => {
          fromWrapper.classList.add('focused');
        });
        
        fromInput.addEventListener('blur', () => {
          fromWrapper.classList.remove('focused');
        });
        
        toInput.addEventListener('focus', () => {
          toWrapper.classList.add('focused');
        });
        
        toInput.addEventListener('blur', () => {
          toWrapper.classList.remove('focused');
        });
      }
    };

    // ==================== åˆå§‹åŒ–åº”ç”¨ ====================
    document.addEventListener('DOMContentLoaded', function() {
      UIManager.init();
      
      if (window.ethereum) {
        window.ethereum.on('accountsChanged', (accounts) => {
          if (accounts.length === 0) {
            WalletManager.disconnect();
          } else {
            account = accounts[0];
            provider = new ethers.providers.Web3Provider(window.ethereum);
            signer = provider.getSigner();
            WalletManager.initContracts();
            WalletManager.updateUI();
            DataManager.refreshAll();
            FarmManager.refreshFarmData();
            if (!refreshInterval) {
              refreshInterval = setInterval(() => DataManager.refreshAll(), 10000);
            }
            if (!farmRefreshInterval) {
              farmRefreshInterval = setInterval(() => FarmManager.refreshFarmData(), 15000);
            }
          }
        });
        
        window.ethereum.on('chainChanged', () => {
          location.reload();
        });
        
        window.ethereum.on('disconnect', () => {
          WalletManager.disconnect();
        });
      }
    });
  </script>       
</body>
</html>
