<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap</title>
  
  <!-- Êî∂ËóèÂõæÊ†áÂíåÁ§æ‰∫§Â™í‰ΩìÊ†áÁ≠æ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <!-- Open Graph Ê†áÁ≠æ -->
  <meta property="og:title" content="LOMswap - Conflux Âéª‰∏≠ÂøÉÂåñ‰∫§ÊòìÊâÄ">
  <meta property="og:description" content="Âú® Conflux eSpace ‰∏ä‰∫§Êòì LOM ‰ª£Â∏Å">
  <meta property="og:image" content="https://i.imgur.com/HddyTrv.jpeg">
  <meta property="og:url" content="https://lom-dex.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- ÂÆâÂÖ®Á≠ñÁï• -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self' https:;
                 script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https://i.imgur.com data:;
                 connect-src 'self' https://*.confluxrpc.com wss: blob:;
                 font-src 'self' data:;
                 frame-src 'none';
                 object-src 'none';">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== Âü∫Á°ÄÊ†∑Âºè ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 500px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== È°πÁõÆ‰ªãÁªçÂºπÁ™ó ========== */
    .project-intro-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .project-intro-overlay.show {
      display: flex;
    }
    
    .project-intro-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.2);
      position: relative;
      animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .project-intro-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .project-intro-logo {
      width: 100px;
      height: 100px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 3px solid var(--accent-yellow);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
    }
    
    .project-intro-title {
      font-size: 32px;
      font-weight: 900;
      margin-bottom: 10px;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-subtitle {
      font-size: 18px;
      color: var(--accent-yellow);
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .project-intro-slogan {
      font-size: 14px;
      color: var(--text-secondary);
      font-style: italic;
    }
    
    .project-intro-content {
      margin-bottom: 25px;
    }
    
    .project-intro-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 215, 0, 0.2);
    }
    
    .project-intro-section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      color: var(--accent-yellow);
      font-size: 18px;
      font-weight: 700;
    }
    
    .project-intro-section-icon {
      font-size: 24px;
    }
    
    .project-intro-section-content {
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 15px;
    }
    
    .project-intro-section-content ul {
      padding-left: 20px;
      margin-top: 10px;
    }
    
    .project-intro-section-content li {
      margin-bottom: 8px;
      position: relative;
    }
    
    .project-intro-section-content li:before {
      content: "‚úì";
      color: var(--success);
      font-weight: bold;
      position: absolute;
      left: -20px;
    }
    
    .project-intro-features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 20px 0;
    }
    
    .project-intro-feature {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .project-intro-feature-icon {
      font-size: 20px;
      margin-bottom: 8px;
      display: block;
    }
    
    .project-intro-feature-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .project-intro-close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }
    
    .project-intro-close-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: var(--accent-yellow);
      transform: rotate(90deg);
    }
    
    .project-intro-footer {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .project-intro-footer-text {
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.5;
    }
    
    /* ========== Â§¥ÈÉ®Ê†∑Âºè‰ºòÂåñ ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
      position: relative;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-container:hover {
      transform: translateY(-2px);
    }
    
    .logo-img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .wallet-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      width: auto;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
      max-width: 220px;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 0;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    #walletBtn {
      min-width: 110px !important;
      max-width: 110px !important;
      width: 110px !important;
   }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      max-width: 40px;
      max-height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ========== Ê†áÁ≠æÈ°µÊ†∑Âºè ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== Âç°ÁâáÊ†∑Âºè ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    /* ========== ‰∫§ÊòìÁïåÈù¢Ê†∑Âºè ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      position: relative;
      margin-bottom: 6px;
    }
    
    .token-input-wrapper.focused {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      position: relative;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
      transform: translateY(-4px);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
       margin-bottom: -4px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
      transform: translateY(-1px);
    }
    
    .token-logo {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 10px;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      margin-bottom: 12px;
      justify-content: flex-end;
    }
    
    .percent-btn {
      flex: none;
      width: 40px;
      padding: 6px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      text-align: right;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
      padding: 0;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }

    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: -6px 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
  background: transparent;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  color: var(--text-secondary);
  z-index: 2;
}
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4);
    }
    
    .swap-arrow-btn:active {
      transform: rotate(180deg) scale(0.95);
    }
    
    /* ========== ‰∫§ÊòìËØ¶ÊÉÖ ========== */
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 12px 16px;
      margin: 16px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
      font-size: 12px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .detail-value.positive {
      color: var(--success);
    }
    
    .detail-value.negative {
      color: var(--warning);
    }
    
    /* ========== ÊªëÁÇπÊéßÂà∂ ========== */
    .slippage-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }
    
    .slippage-options {
      display: flex;
      gap: 4px;
    }
    
    .slippage-btn {
      padding: 4px 8px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 35px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    /* ========== ‰∏ªÊìç‰ΩúÊåâÈíÆ ========== */
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:active {
      transform: translateY(0);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ========== ÊµÅÂä®ÊÄßÈ°µÈù¢Ê†∑Âºè ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stat-value-large {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .stat-value-large.positive {
      color: var(--accent-yellow);
    }
    
    .position-actions {
      display: flex;
      gap: 8px;
    }
    
    .position-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    /* ========== LPÊåñÁüøÈ°µÈù¢Ê†∑Âºè‰ºòÂåñ ========== */
    .farm-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    /* ÂèåÊéíÁªüËÆ°ÁΩëÊ†º - ‰ºòÂåñÁâà */
    .farm-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .farm-stat-card {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.08), rgba(26, 115, 232, 0.08));
      border-radius: 10px;
      padding: 10px 8px;
      border: 1px solid rgba(255, 215, 0, 0.2);
      text-align: center;
      transition: all 0.3s ease;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .farm-stat-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(255, 215, 0, 0.1);
    }
    
    .farm-stat-label {
      font-size: 9px;
      color: var(--text-secondary);
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      white-space: nowrap;
      font-weight: 600;
    }
    
    .farm-stat-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-yellow);
      line-height: 1.2;
    }
    
    .farm-stat-desc {
      font-size: 8px;
      color: var(--text-muted);
      opacity: 0.8;
      margin-top: 2px;
    }
    
    /* Áî®Êà∑‰ø°ÊÅØÂç°Áâá‰ºòÂåñ - Êõ¥Á¥ßÂáë */
    .farm-user-info {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      padding: 14px;
      border: 1px solid var(--border-color);
      margin-bottom: 8px;
    }
    
    .user-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(26, 115, 232, 0.15));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      border: 2px solid var(--accent-yellow);
      flex-shrink: 0;
    }
    
    .user-status {
      flex: 1;
      min-width: 0;
    }
    
    .user-name {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .user-level {
      font-size: 10px;
      color: var(--accent-yellow);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Êî∂ÁõäÈ¢Ñ‰º∞ÁΩëÊ†º - Êõ¥Á¥ßÂáë */
    .estimates-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px;
      margin-bottom: 10px;
    }
    
    .estimate-card {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 6px;
      padding: 8px 6px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .estimate-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .estimate-label {
      font-size: 8px;
      color: var(--text-secondary);
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .estimate-value {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .estimate-value.success {
      color: var(--success);
    }
    
    .estimate-value.warning {
      color: var(--accent-yellow);
    }
    
    .estimate-sub {
      font-size: 7px;
      color: var(--text-muted);
      margin-top: 1px;
      opacity: 0.8;
    }
    
    /* Áî®Êà∑ÁªüËÆ°ÁΩëÊ†º - ÂèåÊéíÊõ¥Á¥ßÂáë */
    .user-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px;
      margin-bottom: 10px;
    }
    
    .user-stat-item {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 6px;
      padding: 8px 6px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .user-stat-label {
      font-size: 8px;
      color: var(--text-secondary);
      margin-bottom: 3px;
      white-space: nowrap;
    }
    
    .user-stat-value {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
    }
    
    .user-stat-value.highlight {
      color: var(--accent-yellow);
    }
    
    .user-stat-value.success {
      color: var(--success);
    }
    
    .user-stat-value.warning {
      color: var(--accent-yellow);
    }
    
    /* ÂêåÊ≠•Êó∂Èó¥ÊòæÁ§∫ - Êõ¥Á¥ßÂáë */
    .countdown-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(26, 115, 232, 0.1));
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      text-align: center;
      margin: 10px 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .countdown-value {
      color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .countdown-label {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    /* ÊåâÈíÆÁªÑÂ∏ÉÂ±Ä‰ºòÂåñ - ‰∏çÂÜçÂú®Â∫ïÈÉ®ÔºåÊîπ‰∏∫Âú®ÂÜÖÂÆπÂå∫Âüü */
    .farm-actions {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      margin-top: 8px;
    }
    
    .farm-action-btn {
      height: 36px;
      padding: 0 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      white-space: nowrap;
      min-width: 0;
    }
    
    .farm-action-btn.primary {
      background: var(--gradient-primary);
      color: white;
      grid-column: span 4;
      height: 40px;
      font-size: 13px;
    }
    
    .farm-action-btn.secondary {
      background: rgba(26, 115, 232, 0.15);
      color: var(--primary-blue);
      border: 1px solid rgba(26, 115, 232, 0.3);
    }
    
    .farm-action-btn.success {
      background: rgba(46, 160, 67, 0.15);
      color: var(--success);
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .farm-action-btn.warning {
      background: rgba(255, 215, 0, 0.15);
      color: var(--accent-yellow);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .farm-action-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .farm-action-btn:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }
    
    .farm-btn-icon {
      font-size: 12px;
      flex-shrink: 0;
    }
    
    .farm-btn-text {
      flex: 1;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-size: 10px;
    }
    
    /* Êìç‰ΩúÁä∂ÊÄÅÊèêÁ§∫ */
    .action-status {
      font-size: 9px;
      padding: 6px;
      border-radius: 4px;
      margin-top: 6px;
      text-align: center;
      display: none;
    }
    
    .action-status.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .action-status.error {
      background: rgba(255, 71, 87, 0.1);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.2);
    }
    
    .action-status.success {
      background: rgba(46, 160, 67, 0.1);
      color: var(--success);
      border: 1px solid rgba(46, 160, 67, 0.2);
    }
    
    .action-status.info {
      background: rgba(255, 215, 0, 0.1);
      color: var(--accent-yellow);
      border: 1px solid rgba(255, 215, 0, 0.2);
    }
    
    /* Áä∂ÊÄÅÊåáÁ§∫Âô® */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      padding: 1px 4px;
      border-radius: 8px;
      font-size: 8px;
      font-weight: 600;
      margin-left: 4px;
    }
    
    .status-active {
      background: rgba(46, 160, 67, 0.15);
      color: var(--success);
    }
    
    .status-inactive {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
    }
    
    .status-waiting {
      background: rgba(255, 215, 0, 0.15);
      color: var(--accent-yellow);
    }
    
    /* Êó∂Èó¥ÊòæÁ§∫‰ºòÂåñ */
    .time-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      background: rgba(255, 215, 0, 0.1);
      padding: 2px 4px;
      border-radius: 3px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      color: var(--accent-yellow);
    }
    
    /* ========== Ê®°ÊÄÅÊ°ÜÊ†∑Âºè ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .modal-input-group {
      margin-bottom: 12px;
    }
    
    .modal-input-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .modal-input:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    /* ========== ‰ª£Â∏ÅÈÄâÊã©Âô® ========== */
    .token-selector-modal {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .token-selector-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .token-search {
      width: 100%;
      padding: 10px 14px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 12px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .token-search:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    .token-search:hover {
      border-color: var(--accent-yellow);
    }
    
    .token-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .token-item:hover {
      background: rgba(26, 115, 232, 0.1);
      transform: translateX(4px);
    }
    
    .token-item-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease;
    }
    
    .token-item:hover .token-item-logo {
      transform: scale(1.1);
    }
    
    .token-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .token-item-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: color 0.2s ease;
    }
    
    .token-item:hover .token-item-symbol {
      color: var(--accent-yellow);
    }
    
    .token-item-name {
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-item-balance {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    
    /* ========== ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ ========== */
    .transaction-status {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--gradient-primary);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(26, 115, 232, 0.4);
      z-index: 3000;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 90%;
      text-align: center;
    }
    
    .transaction-status.show {
      transform: translateX(-50%) translateY(0);
    }
    
    .transaction-status.success {
      background: var(--gradient-green);
    }
    
    .transaction-status.error {
      background: var(--gradient-red);
    }
    
    /* ========== È£éÈô©ÊèêÁ§∫ÂíåÈ°µËÑö ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 11px;
      color: var(--text-primary);
      line-height: 1.5;
      position: relative;
      overflow: hidden;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 12px;
      opacity: 0.7;
    }
    
    /* ========== Âä®Áîª ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== Âä†ËΩΩÂä®Áîª ========== */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    .loading-spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }
    
    .loading-spinner.white {
      border-color: rgba(255, 255, 255, 0.3);
      border-top-color: white;
    }
    
    /* ========== ÁßªÈô§ÊµÅÂä®ÊÄßÂºπÁ™ó ========== */
    .remove-liquidity-modal .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .remove-percentage {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: var(--text-primary);
      margin: 8px 0;
    }
    
    .percentage-slider {
      width: 100%;
      margin: 16px 0;
      -webkit-appearance: none;
      height: 6px;
      background: rgba(26, 115, 232, 0.1);
      border-radius: 3px;
      outline: none;
    }
    
    .percentage-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);
    }
    
    .percentage-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    
    .percentage-option {
      padding: 8px;
      text-align: center;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-option:hover {
      border-color: var(--primary-blue);
    }
    
    .percentage-option.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .remove-estimate {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .remove-estimate-title {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .remove-estimate-amounts {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .remove-estimate-amount {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .token-amount-display {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 15px;
    }
    
    /* ========== ÁÆÄÂçïÁ°ÆËÆ§ÂØπËØùÊ°Ü ========== */
    .simple-confirm-modal .modal-card {
      max-width: 350px;
    }
    
    .confirm-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .confirm-icon {
      font-size: 48px;
      margin-bottom: 12px;
      display: block;
    }
    
    .confirm-action {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .confirm-amounts {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 16px 0;
    }
    
    .confirm-amount-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .confirm-amount-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .confirm-amount-text {
      font-size: 20px;
      font-weight: bold;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .confirm-details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    
    .confirm-detail-item {
      text-align: left;
      padding: 8px;
      background: rgba(26, 115, 232, 0.05);
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .confirm-detail-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .confirm-detail-value {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .confirm-actions-simple {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .confirm-action-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }
    
    .confirm-action-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .confirm-action-btn.confirm {
      background: var(--gradient-primary);
      color: white;
    }
    
    .confirm-action-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    .confirm-action-btn.cancel:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* ========== ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ ========== */
    .tx-status-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 4000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .tx-status-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      max-width: 350px;
      text-align: center;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .tx-status-icon {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .tx-status-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .tx-status-message {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .tx-status-done-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
    }
    
    .tx-status-done-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }
    
    /* ========== ÈîôËØØÊèêÁ§∫Ê°Ü ========== */
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 10px 14px;
      margin: 10px 0;
      font-size: 12px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .error-icon {
      display: inline-block;
      margin-right: 6px;
    }
    
    /* ========== Á≠âÁ∫ßÂæΩÁ´†Ê†∑Âºè ========== */
    .level-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .level-bronze {
      background: linear-gradient(135deg, #CD7F32, #8B4513);
      color: white;
    }
    
    .level-silver {
      background: linear-gradient(135deg, #C0C0C0, #808080);
      color: white;
    }
    
    .level-gold {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
    }
    
    /* ========== ÂìçÂ∫îÂºèË∞ÉÊï¥ ========== */
    @media (max-width: 480px) {
      .app {
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 14px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 44px;
        height: 44px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .header-buttons {
        min-width: 150px;
        max-width: 180px;
      }
      
      #walletBtn {
        min-width: 120px;
        max-width: 140px;
        padding: 8px 12px;
        font-size: 12px;
        height: 36px;
      }
      
      #langBtn {
        width: 36px;
        height: 36px;
        min-width: 36px;
        min-height: 36px;
        max-width: 36px;
        max-height: 36px;
        font-size: 12px;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .modal-card {
        padding: 16px;
      }
      
      .transaction-status {
        bottom: 60px;
      }
      
      .farm-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .user-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .estimates-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .farm-actions {
        grid-template-columns: repeat(4, 1fr);
        gap: 4px;
      }
      
      .farm-action-btn {
        height: 34px;
        font-size: 10px;
        padding: 0 6px;
      }
      
      .farm-action-btn.primary {
        height: 38px;
        font-size: 12px;
      }
      
      .farm-btn-text {
        font-size: 9px;
      }
      
      .farm-stat-card {
        padding: 8px 6px;
        min-height: 45px;
      }
      
      .farm-stat-label {
        font-size: 8px;
      }
      
      .farm-stat-value {
        font-size: 12px;
      }
      
      .project-intro-card {
        padding: 20px;
      }
      
      .project-intro-title {
        font-size: 24px;
      }
      
      .project-intro-features {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 380px) {
      .logo-text {
        font-size: 16px;
      }
      
      .logo-img {
        width: 36px;
        height: 36px;
      }
      
      .header-buttons {
        min-width: 130px;
        max-width: 150px;
      }
      
      #walletBtn {
        min-width: 100px;
        max-width: 120px;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      #langBtn {
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        max-width: 32px;
        max-height: 32px;
      }
      
      .farm-action-btn {
        height: 32px;
        font-size: 9px;
      }
      
      .farm-action-btn.primary {
        height: 36px;
        font-size: 11px;
      }
    }
    
    @media (max-width: 350px) {
      .farm-actions {
        grid-template-columns: repeat(2, 1fr);
        gap: 4px;
      }
      
      .farm-action-btn.primary {
        grid-column: span 2;
      }
      
      .farm-stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- È°πÁõÆ‰ªãÁªçÂºπÁ™ó -->
  <div class="project-intro-overlay" id="projectIntroOverlay">
    <div class="project-intro-card">
      <button class="project-intro-close-btn" id="projectIntroCloseBtn">√ó</button>
      
      <div class="project-intro-header">
        <div class="project-intro-logo"></div>
        <h1 class="project-intro-title">ÈæôËÑâ LOM</h1>
        <div class="project-intro-subtitle">Conflux.ÁîüÊÄÅÊ†∏ÂøÉËµÑ‰∫ß</div>
        <div class="project-intro-slogan">ÂÖ±ËØÜÂàõÈÄ†‰ª∑ÂÄº</div>
      </div>
      
      <div class="project-intro-content">
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üêâ</span>
            <span>ÂÖ≥‰∫éÈæôËÑâLOM</span>
          </div>
          <div class="project-intro-section-content">
               <p> ÈæôËÑâLOMÁÅµÊÑüÊ∫êËá™‰∏≠ÂõΩ‰º†ÁªüÊñáÂåñ‰∏≠ÁöÑ"ÈæôËÑâ"Ê¶ÇÂøµÔºåË±°ÂæÅÁùÄË¥¢ÂØå„ÄÅÁπÅËç£ÂíåËÉΩÈáèÁöÑÊµÅÂä®.ÊòØÊ∑±Â∫¶ËµãËÉΩ‰∏≠ÂõΩÂîØ‰∏ÄÂêàËßÑÂÖ¨Èìæ‚Äî‚ÄîÊ†ëÂõæÔºàConfluxÔºâÁöÑÁîüÊÄÅÊ†∏ÂøÉËµÑ‰∫ßÔºåÊõ¥ÊòØÈìæÊé•ÂÖ¨Èìæ‰ª∑ÂÄº„ÄÅÁî®Êà∑Êî∂Áõä‰∏éÁîüÊÄÅÁπÅËç£ÁöÑÂÖ≥ÈîÆÁ∫ΩÂ∏¶Ôºå‰æùÊâòÂÖ¨Èìæ‰ºòÂäøÊûÑÂª∫‰∏ìÂ±û‰ª∑ÂÄºÈó≠ÁéØÔºå‰∏∫ÂèÇ‰∏éËÄÖÂ∏¶Êù•Á°ÆÂÆöÊÄßÂõûÊä•„ÄÇ<p>
 
     <p>‰Ωú‰∏∫Ê†ëÂõæÂÖ¨ÈìæÁöÑËµãËÉΩËΩΩ‰ΩìÔºåLOMÊ∑±Â∫¶ÁªëÂÆöÂÖ¨ÈìæÊ†∏ÂøÉ‰ºòÂäøÔºöËøôÊù°Áî±Ê∏ÖÂçéÂõ¢ÈòüÊâìÈÄ†ÁöÑ"confluxÊï∞Â≠óÈæôËÑâ"Ôºå‰ª•ÂêàËßÑ‰∏∫Ê†πÔºå‰∏≤ËÅî40ÂõΩËäÇÁÇπ‰∏é"‰∏ÄÂ∏¶‰∏ÄË∑Ø"Ë∑®Â¢ÉÂú∫ÊôØÔºåÊõ¥ÂÖºÂÆπ‰ª•Â§™ÂùäÁîüÊÄÅ„ÄÇ‰ªéRWAËµÑ‰∫ß‰∏äÈìæÂà∞Á®≥ÂÆöÂ∏ÅÁªìÁÆóÔºåÂÆÉÊ≠£‰ª•Ëá™‰∏ªÂèØÊéßÁöÑÊäÄÊúØÂ∫ïÊ∞îÔºåÊâøÊé•ÂÖ®ÁêÉWeb3.0ÁàÜÂèëÊµ™ÊΩÆÔºåËÆ©‰∏≠ÂõΩÂÖ¨ÈìæÂäõÈáèË¥ØÈÄöÊï∞Â≠óÊú™Êù•„ÄÇ15000TPSË∂ÖÈ´òÊÄßËÉΩ„ÄÅ26ÁßíÊûÅÈÄüÁ°ÆËÆ§ÁöÑÊäÄÊúØÂ∫ïÂ∫ßÔºå‰ª•Âèä5000+ÂÖ®ÁêÉËäÇÁÇπ„ÄÅ2500‰∏áÁî®Êà∑ÁöÑÊàêÁÜüÁîüÊÄÅÔºåËÆ©ÊØè‰∏Ä‰ªΩLOMË¥®ÊäºÈÉΩËÉΩ‰æùÊâòÂÖ¨ÈìæÂêàËßÑËµÑË¥®‰∏éÁúüÂÆûÂ∫îÁî®Âú∫ÊôØÔºåÂÆûÁé∞‰ª∑ÂÄºÈîöÂÆö‰∏éÁ®≥Ê≠•Â¢ûÈïø„ÄÇ<p>
 
   <p>ÂÖ∂Ê†∏ÂøÉ‰ª∑ÂÄºËÅöÁÑ¶ÈîÅÂÆöË¥®Êäº+‰∫å‰ª£Â•ñÂä±ÁöÑÁîüÊÄÅÊøÄÂä±Êú∫Âà∂ÔºåÁ≤æÂáÜÂåπÈÖçÊ†ëÂõæÂÖ¨ÈìæÂèëÂ±ïÈúÄÊ±ÇÔºöÁî®Êà∑ÈÄöËøáÈîÅÂÆöLOMÂèÇ‰∏éË¥®ÊäºÔºå‰∏ç‰ªÖËÉΩÊ∑±Â∫¶‰∫´ÂèóÊ†ëÂõæÂÖ¨ÈìæÁîüÊÄÅÊâ©Âº†„ÄÅÊäÄÊúØÂçáÁ∫ßÂ∏¶Êù•ÁöÑÈïøÊúüË¥®ÊäºÊî∂ÁõäÔºåÊõ¥ËÉΩ‰æùÊâò"ËµãËÉΩÂÖ¨Èìæ"ÁöÑÊ†∏ÂøÉÂÆö‰ΩçÔºåÈÄöËøáÈÇÄËØ∑ÂàÜ‰∫´Ëß£ÈîÅ‰∏∞Âéö‰∫å‰ª£Â•ñÂä±ÔºåËÆ©Êî∂ÁõäÈöèÁîüÊÄÅËæêÂ∞ÑÊåÅÁª≠ÊîæÂ§ß„ÄÇ<p>ËøôÁßçÊ®°ÂºèÊó¢‰∏∫Ê†ëÂõæÂÖ¨ÈìæÊ≥®ÂÖ•Á®≥ÂÆöÁöÑÁîüÊÄÅÂä®ÂäõÔºå‰πüËÆ©Áî®Êà∑Êàê‰∏∫ÂÖ¨ÈìæÂèëÂ±ïÁöÑÁõ¥Êé•ÂèóÁõäËÄÖÔºåÂÆûÁé∞"Ë¥®Êäº‰∫´Á∫¢Âà©ÔºåÂàÜ‰∫´ËµöÂ•ñÂä±"ÁöÑÂèåÈáç‰ª∑ÂÄº„ÄÇ<p>
  
            <ul>
              <li><strong>ÊÄª‰æõÂ∫îÈáè</strong>Ôºö88888888ÊûöÔºàÊ∞∏‰∏çÂ¢ûÂèëÔºâ</li>
              <li><strong>Â∫ïÂ±ÇÊäÄÊúØ</strong>ÔºöÂü∫‰∫éConflux eSpaceÊô∫ËÉΩÂêàÁ∫¶</li>
              <li><strong>Ê≤ªÁêÜÊ®°Âºè</strong>ÔºöÂÆåÂÖ®Âéª‰∏≠ÂøÉÂåñÔºåÁ§æÂå∫È©±Âä®</li>
              <li><strong>ÁªèÊµéÊ®°Âûã</strong>ÔºöÈÄöÁº©Êú∫Âà∂ + ÊµÅÂä®ÊÄßÊøÄÂä±</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-features">
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">‚ö°</span>
            <div class="project-intro-feature-text">ÊÄªÈáèÁ®ÄÁº∫</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">üõ°Ô∏è</span>
            <div class="project-intro-feature-text">Âéª‰∏≠ÂøÉÂåñ</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">üìà</span>
            <div class="project-intro-feature-text">È´òÊî∂ÁõäÁéá</div>
          </div>
          <div class="project-intro-feature">
            <span class="project-intro-feature-icon">üåê</span>
            <div class="project-intro-feature-text">ÂÖ®ÁêÉ‰∫§Êòì</div>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üéØ</span>
            <span>Ê†∏ÂøÉ‰ª∑ÂÄº</span>
          </div>
          <div class="project-intro-section-content">
            <ul>
              <li><strong>‰ª∑ÂÄºÂ≠òÂÇ®</strong>ÔºöÊ∑±Â∫¶ÁªëÂÆöÂÖ¨Èìæ‰ª∑ÂÄºÁ°Æ‰øù‰ª∑ÂÄºÂ¢ûÈïø</li>
              <li><strong>ÊµÅÂä®ÊÄßÊ†∏ÂøÉ</strong>Ôºö‰Ωú‰∏∫DEX‰∫§ÊòìÂØπÁöÑÂü∫ÂáÜËµÑ‰∫ß</li>
              <li><strong>Ê≤ªÁêÜÊùÉÁõä</strong>ÔºöÊåÅÊúâËÄÖÂÖ±ÂêåÂèÇ‰∏éÁîüÊÄÅÊ≤ªÁêÜÂÜ≥Á≠ñ</li>
              <li><strong>Êî∂ÁõäÁîüÊàê</strong>ÔºöÈÄöËøáË¥®ÊäºÂíåÊµÅÂä®ÊÄßÊåñÁüøËé∑ÂæóÊî∂Áõä</li>
            </ul>
          </div>
        </div>
        
        <div class="project-intro-section">
          <div class="project-intro-section-title">
            <span class="project-intro-section-icon">üöÄ</span>
            <span>LOMswapÂäüËÉΩ</span>
          </div>
          <div class="project-intro-section-content">
            <p>Âú®LOMswap‰∏äÔºåÊÇ®ÂèØ‰ª•Ôºö</p>
            <ul>
              <li><strong>ÂÖëÊç¢‰∫§Êòì</strong>ÔºöÂú®CFX-LOM-USDC-USDT0-AxCNH‰πãÈó¥Âø´ÈÄüÂÖëÊç¢</li>
              <li><strong>Êèê‰æõÊµÅÂä®ÊÄß</strong>ÔºöÊ∑ªÂä†CFX-LOMÊµÅÂä®ÊÄßËµöÂèñÊâãÁª≠Ë¥π</li>
              <li><strong>LPË¥®ÊäºÊåñÁüø</strong>ÔºöË¥®ÊäºLP‰ª£Â∏ÅËé∑ÂæóLOMÂ•ñÂä±</li>
              <li><strong>ÊØèÊó•Á≠æÂà∞</strong>ÔºöÊØèÊó•Á≠æÂà∞Ëé∑ÂæóÈ¢ùÂ§ñÂ•ñÂä±</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="project-intro-footer">
        <div class="project-intro-footer-text">
          üí° ÊèêÁ§∫ÔºöËØ∑Á°Æ‰øùÂ∑≤ÂÆâË£ÖTPÊàñweb3Èí±ÂåÖÔºåÂπ∂ÂàáÊç¢Âà∞Conflux eSpaceÁΩëÁªúÔºàChainID: 1030Ôºâ
        </div>
      </div>
    </div>
  </div>

  <!-- ÂéüÊúâÂ∫îÁî®ÁïåÈù¢ -->
  <div class="app">
    <!-- Â§¥ÈÉ® -->
    <div class="header">
      <div class="logo-container" id="logoContainer">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">ËøûÊé•Èí±ÂåÖ</button>
      </div>
    </div>

    <!-- Ê†áÁ≠æÈ°µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">ÂÖëÊç¢</button>
        <button class="tab-btn" data-tab="liquidity">ÊµÅÂä®ÊÄß</button>
        <button class="tab-btn" data-tab="farm">LPÊåñÁüø</button>
      </div>
    </div>

    <!-- ÂÖëÊç¢È°µÈù¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- ËæìÂÖ•‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- ‰∫§Êç¢ÁÆ≠Â§¥ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">üîÉ</button>
          </div>

          <!-- ËæìÂá∫‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- ÈîôËØØÊèêÁ§∫Ê°Ü -->
          <div class="error-box" id="swapErrorBox">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- ‰∫§ÊòìËØ¶ÊÉÖ -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">ÊªëÁÇπÂÆπÂ∑Æ</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
                <button class="slippage-btn" data-slip="10">10%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†º</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ÊúÄ‰ΩéÊî∂Âà∞</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Ë∑ØÁî±</span>
              <span class="detail-value" id="routeInfo">CFX ‚Üí LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†ºÂΩ±Âìç</span>
              <span class="detail-value positive" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- ‰∫§ÊòìÊåâÈíÆ -->
          <button class="main-action-btn" id="swapBtn">ËøûÊé•Èí±ÂåÖ</button>
        </div>
      </div>
    </div>
    
    <!-- ÊµÅÂä®ÊÄßÈ°µÈù¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">üíß</span>
          <span id="poolInfoTitle">CFX-LOM Ê±†</span>
        </div>

        <div class="liquidity-summary">
          <!-- Ê±†Â≠êÁªüËÆ°‰ø°ÊÅØ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small" id="cfxReserveLabel">CFX ÂÇ®Â§á</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small" id="lomReserveLabel">LOM ÂÇ®Â§á</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- ÊàëÁöÑÊµÅÂä®Ê±†ËØ¶ÊÉÖ -->
          <div class="user-position" style="background: var(--gradient-card); border-radius: 12px; padding: 16px; margin-top: 16px; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);" id="myPositionTitle">ÊàëÁöÑÊµÅÂä®Ê±†</div>
              <div style="font-size: 12px; color: var(--text-secondary);" id="positionValue">$0.00</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myCfxLabel">ÊàëÁöÑCFX</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userCfx">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLomLabel">ÊàëÁöÑLOM</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userLom">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLpLabel">ÊàëÁöÑLP‰ª£Â∏Å</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);" id="userLp">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myShareLabel">Ê±†Â≠ê‰ªΩÈ¢ù</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--success);" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">Ê∑ªÂä†ÊµÅÂä®ÊÄß</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ÁßªÈô§ÊµÅÂä®ÊÄß</button>
          </div>
        </div>
      </div>
    </div>

    <!-- LPÊåñÁüøÈ°µÈù¢‰ºòÂåñÁâà -->
    <div class="tab-content" id="farmTab">
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">üöú</span>
          <span id="farmTitle">LPÊåñÁüøÂÜúÂú∫</span>
        </div>

        <div class="farm-panel">
          <!-- ÂÜúÂú∫ÁªüËÆ°ÁΩëÊ†º - ‰ºòÂåñ‰∏∫ÂèåÊéíÁ¥ßÂáëÂ∏ÉÂ±Ä -->
          <div class="farm-stats-grid">
            <div class="farm-stat-card">
              <div class="farm-stat-label">üèÜ ÊÄªÂ•ñÂä±Ê±†</div>
              <div class="farm-stat-value" id="totalRewardPool">--</div>
              <div class="farm-stat-desc">LOMÊÄªË¥®ÊäºÈáè</div>
            </div>
            
            <div class="farm-stat-card">
              <div class="farm-stat-label">üí∞ Â∑≤ÂàÜÂèë</div>
              <div class="farm-stat-value success" id="totalDistributed">--</div>
              <div class="farm-stat-desc">Â∑≤Â•ñÂä±LOMÊï∞Èáè</div>
            </div>
            
            <div class="farm-stat-card">
              <div class="farm-stat-label">‚è≥ Ââ©‰ΩôÂ•ñÂä±</div>
              <div class="farm-stat-value warning" id="remainingRewards">--</div>
              <div class="farm-stat-desc">ÂèØÂàÜÈÖçLOMÊï∞Èáè</div>
            </div>
            
            <div class="farm-stat-card">
              <div class="farm-stat-label">üë• Ê¥ªË∑ÉÁî®Êà∑</div>
              <div class="farm-stat-value" id="totalActiveUsers">--</div>
              <div class="farm-stat-desc">ÂèÇ‰∏éÊåñÁüøÁî®Êà∑Êï∞</div>
            </div>
          </div>

          <!-- Áî®Êà∑‰ø°ÊÅØÂç°Áâá - Êõ¥Á¥ßÂáë -->
          <div class="farm-user-info">
            <div class="user-header">
              <div class="user-avatar" id="userAvatar">üë§</div>
              <div class="user-status">
                <div class="user-name" id="userName">Êú™ËøûÊé•Èí±ÂåÖ</div>
                <div class="user-level" id="userLevel">ËØ∑ËøûÊé•Èí±ÂåÖÊü•ÁúãÊï∞ÊçÆ</div>
              </div>
            </div>
            
            <!-- Êî∂ÁõäÈ¢Ñ‰º∞ÁΩëÊ†º - ÂèåÊéíÁ¥ßÂáë -->
            <div class="estimates-grid">
              <div class="estimate-card">
                <div class="estimate-label">üéÅ Â∑≤Á¥ØÁßØÂ•ñÂä±</div>
                <div class="estimate-value success" id="safeEstimate">--</div>
                <div class="estimate-sub" id="estimateStatus">--</div>
              </div>
              
              <div class="estimate-card">
                <div class="estimate-label">üìà ‰∏ãÊ¨°È¢Ñ‰º∞</div>
                <div class="estimate-value warning" id="optimisticEstimate">--</div>
                <div class="estimate-sub">‰πêËßÇÈ¢Ñ‰º∞</div>
              </div>
            </div>
            
            <!-- Áî®Êà∑ÁªüËÆ°ÁΩëÊ†º - ÂèåÊéíÁ¥ßÂáë -->
            <div class="user-stats-grid">
              <div class="user-stat-item">
                <div class="user-stat-label">üíß LP‰ΩôÈ¢ù</div>
                <div class="user-stat-value highlight" id="lpBalance">--</div>
              </div>
              <div class="user-stat-item">
                <div class="user-stat-label">‚≠ê Ê¥ªÂä®ÂàÜÊï∞</div>
                <div class="user-stat-value" id="activityScore">--</div>
              </div>
              <div class="user-stat-item">
                <div class="user-stat-label">üìÖ ËøûÁª≠Â§©Êï∞</div>
                <div class="user-stat-value" id="consecutiveDays">--</div>
              </div>
              <div class="user-stat-item">
                <div class="user-stat-label">üéØ ÊØèÊó•Ââ©‰Ωô</div>
                <div class="user-stat-value warning" id="dailyLOMLeft">--</div>
              </div>
            </div>
            
            <!-- ÂêåÊ≠•Êó∂Èó¥ÊòæÁ§∫ -->
            <div class="countdown-display">
              <span class="countdown-label">‰∏ãÊ¨°ÂêåÊ≠•:</span>
              <span class="countdown-value" id="nextSyncTime">--</span>
            </div>
            
            <!-- Êìç‰ΩúÁä∂ÊÄÅÊèêÁ§∫ -->
            <div class="action-status" id="actionStatus"></div>
          </div>

          <!-- ÂÜúÂú∫Êìç‰ΩúÊåâÈíÆ - Ë∞ÉÊï¥‰∏∫Á¥ßÂáëÂõõÂàóÂ∏ÉÂ±Ä -->
          <div class="farm-actions">
            <button class="farm-action-btn primary" id="activateBtn">
              <span class="farm-btn-icon">‚úÖ</span>
              <span class="farm-btn-text" id="activateBtnText">ÊøÄÊ¥ªË¥¶Êà∑</span>
            </button>
            
            <button class="farm-action-btn secondary" id="syncBtn" disabled>
              <span class="farm-btn-icon">üîÑ</span>
              <span class="farm-btn-text" id="syncBtnText">ÂêåÊ≠•Â•ñÂä±</span>
            </button>
            
            <button class="farm-action-btn success" id="claimBtn" disabled>
              <span class="farm-btn-icon">üí∞</span>
              <span class="farm-btn-text" id="claimBtnText">È¢ÜÂèñÂ•ñÂä±</span>
            </button>
            
            <button class="farm-action-btn warning" id="checkinBtn" disabled>
              <span class="farm-btn-icon">üìÖ</span>
              <span class="farm-btn-text" id="checkinBtnText">ÊØèÊó•Á≠æÂà∞</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- È£éÈô©ÊèêÁ§∫ -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>‚ö†Ô∏è</span>
        <span id="riskTitle">È£éÈô©ÊèêÁ§∫</span>
      </div>
      <div id="riskText">
        Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ
      </div>
    </div>

    <!-- È°µËÑö -->
    <div class="footer" id="footerText">LOMswap ¬∑ Conflux eSpace</div>
  </div>

  <!-- ‰ª£Â∏ÅÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
  <div class="token-selector-modal" id="tokenSelectorModal">
    <div class="token-selector-card">
      <h3 class="modal-title" id="tokenSelectorTitle">ÈÄâÊã©‰ª£Â∏Å</h3>
      <input type="text" class="token-search" id="tokenSearch" placeholder="ÊêúÁ¥¢‰ª£Â∏ÅÂêçÁß∞ÊàñÂú∞ÂùÄ">
      <div class="token-list" id="tokenList">
        <!-- ‰ª£Â∏ÅÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
      </div>
    </div>
  </div>

  <!-- Ê∑ªÂä†ÊµÅÂä®ÊÄßÊ®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay" id="addModal">
    <div class="modal-card">
      <h3 class="modal-title" id="addTitle">Ê∑ªÂä†ÊµÅÂä®ÊÄß</h3>
      
      <div class="modal-input-group">
        <label class="modal-input-label">CFX Êï∞Èáè</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addCfx" placeholder="0" step="any" min="0">
          <button class="btn" id="cfxMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ‰ΩôÈ¢ù: <span id="addCfxBal">0</span> CFX
        </div>
      </div>
      
      <div style="text-align: center; font-size: 20px; color: var(--text-primary); margin: 12px 0;">+</div>
      
      <div class="modal-input-group">
        <label class="modal-input-label">LOM Êï∞Èáè</label>
        <div style="display: flex; gap: 8px;">
          <input type="number" class="modal-input" id="addLom" placeholder="0" step="any" min="0">
          <button class="btn" id="lomMaxBtn" style="height: auto; padding: 8px 12px; min-width: 50px; font-size: 12px;">MAX</button>
        </div>
        <div style="text-align: right; margin-top: 4px; font-size: 11px; color: var(--text-secondary);">
          ‰ΩôÈ¢ù: <span id="addLomBal">0</span> LOM
        </div>
      </div>
      
      <div style="background: rgba(26, 115, 232, 0.1); border-radius: 10px; padding: 10px; margin: 12px 0; text-align: center;">
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">ÊØî‰æã</div>
        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); word-break: break-all;" id="addRatio">1 CFX = 0 LOM</div>
      </div>
      
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelAddBtn">ÂèñÊ∂à</button>
        <button class="modal-btn confirm" id="confirmAddBtn" disabled>Á°ÆËÆ§Ê∑ªÂä†</button>
      </div>
    </div>
  </div>

  <!-- ÁßªÈô§ÊµÅÂä®ÊÄßÊ®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay remove-liquidity-modal" id="removeModal">
    <div class="modal-card">
      <h3 class="modal-title" id="removeTitle">ÁßªÈô§ÊµÅÂä®ÊÄß</h3>
      
      <div class="modal-content">
        <div class="remove-percentage">
          <span id="removePercent">100%</span>
        </div>
        
        <input type="range" min="0" max="100" value="100" step="1" class="percentage-slider" id="removeSlider">
        
        <div class="percentage-options">
          <div class="percentage-option" data-percent="25">25%</div>
          <div class="percentage-option" data-percent="50">50%</div>
          <div class="percentage-option" data-percent="75">75%</div>
          <div class="percentage-option active" data-percent="100">100%</div>
        </div>
        
        <div class="remove-estimate">
          <div class="remove-estimate-title">È¢ÑËÆ°Ëé∑Âæó</div>
          <div class="remove-estimate-amounts">
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstCfx">0</span> CFX
            </div>
            <div class="remove-estimate-amount">
              <span class="token-amount-display" id="removeEstLom">0</span> LOM
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn cancel" id="cancelRemoveBtn">ÂèñÊ∂à</button>
          <button class="modal-btn confirm" id="confirmRemoveBtn" style="background: var(--gradient-red);">Á°ÆËÆ§ÁßªÈô§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ÁÆÄÂçï‰∫§ÊòìÁ°ÆËÆ§Ê®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay simple-confirm-modal" id="simpleConfirmModal">
    <div class="modal-card">
      <div class="confirm-summary">
        <div class="confirm-icon" id="simpleConfirmIcon">üîÑ</div>
        <div class="confirm-action" id="simpleConfirmAction">ÂÖëÊç¢Á°ÆËÆ§</div>
        <div class="confirm-amounts" id="simpleConfirmAmounts">
          <!-- ÈáëÈ¢ù‰ø°ÊÅØÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div class="confirm-details-grid" id="simpleConfirmDetails">
          <!-- ËØ¶ÁªÜ‰ø°ÊÅØÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
      <div class="confirm-actions-simple">
        <button class="confirm-action-btn cancel" id="simpleCancelBtn">ÂèñÊ∂à</button>
        <button class="confirm-action-btn confirm" id="simpleConfirmBtn">Á°ÆËÆ§‰∫§Êòì</button>
      </div>
    </div>
  </div>

  <!-- ‰∫§ÊòìÁä∂ÊÄÅÊèêÁ§∫ -->
  <div class="tx-status-overlay" id="txStatusOverlay">
    <div class="tx-status-card">
      <div class="tx-status-icon" id="txStatusIcon">
        <div class="loading-spinner white"></div>
      </div>
      <div class="tx-status-title" id="txStatusTitle">‰∫§ÊòìÂ§ÑÁêÜ‰∏≠</div>
      <div class="tx-status-message" id="txStatusMessage">ËØ∑Á≠âÂæÖÂå∫ÂùóÈìæÁ°ÆËÆ§...</div>
      <button class="tx-status-done-btn" id="txStatusDoneBtn" style="display:none;">ÂÆåÊàê</button>
    </div>
  </div>

  <!-- ÂÜúÂú∫Á°ÆËÆ§ÂØπËØùÊ°Ü -->
  <div class="modal-overlay simple-confirm-modal" id="farmConfirmModal">
    <div class="modal-card">
      <div class="confirm-summary">
        <div class="confirm-icon" id="farmConfirmIcon">üöú</div>
        <div class="confirm-action" id="farmConfirmAction">ÂÜúÂú∫Êìç‰ΩúÁ°ÆËÆ§</div>
        <div class="confirm-amounts" id="farmConfirmAmounts">
          <!-- ÈáëÈ¢ù‰ø°ÊÅØÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div class="confirm-details-grid" id="farmConfirmDetails">
          <!-- ËØ¶ÁªÜ‰ø°ÊÅØÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
      <div class="confirm-actions-simple">
        <button class="confirm-action-btn cancel" id="farmCancelBtn">ÂèñÊ∂à</button>
        <button class="confirm-action-btn confirm" id="farmConfirmBtn">Á°ÆËÆ§Êìç‰Ωú</button>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // ==================== È°πÁõÆ‰ªãÁªçÂºπÁ™óÂäüËÉΩ ====================
    document.addEventListener('DOMContentLoaded', function() {
      const logoContainer = document.getElementById('logoContainer');
      const projectIntroOverlay = document.getElementById('projectIntroOverlay');
      const projectIntroCloseBtn = document.getElementById('projectIntroCloseBtn');
      
      // ÁÇπÂáªLogoÊòæÁ§∫È°πÁõÆ‰ªãÁªçÂºπÁ™ó
      logoContainer.addEventListener('click', function() {
        projectIntroOverlay.classList.add('show');
      });
      
      // ÁÇπÂáªÂÖ≥Èó≠ÊåâÈíÆÂÖ≥Èó≠ÂºπÁ™ó
      projectIntroCloseBtn.addEventListener('click', function() {
        projectIntroOverlay.classList.remove('show');
      });
      
      // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
      projectIntroOverlay.addEventListener('click', function(e) {
        if (e.target === projectIntroOverlay) {
          projectIntroOverlay.classList.remove('show');
        }
      });
      
      // ÊåâESCÈîÆÂÖ≥Èó≠
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && projectIntroOverlay.classList.contains('show')) {
          projectIntroOverlay.classList.remove('show');
        }
      });
    });

// ==================== Áªü‰∏ÄÈÖçÁΩÆ ====================
const APP_CONFIG = {
  CONTRACTS: {
    ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
    LOM: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3",
    WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
    PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85",
    USDC: "0x6963efed0ab40f6c3d7bda44a05dcf1437c44372",
    AXCNH: "0x70BFD7F7eADF9b9827541272589A6B2Bb760aE2E",
    USDT0: "0xaf37e8b6c9ed7f6318979f56fc287d76c30847ff",
    CNHT0: "0xDEd1660192d4d82e7c0B628ba556861EdBB5CAda",
    AXCNH_USDT0_PAIR: "0x50b095DF7a8f856C6fA07fF89bcBC2dF8491A8df",
    LP_REWARD_FARM: "0xD1a50fB7DbDE52a180Ab6Dc83a6969869259D32a"
  },
  TOKEN_LOGOS: {
    CFX: "https://i.imgur.com/70cXbUI.jpeg",
    LOM: "https://i.imgur.com/HddyTrv.jpeg",
    USDC: "https://i.imgur.com/9UDXcUF.jpeg",
    AXCNH: "https://i.imgur.com/x8317um.jpeg",
    USDT0: "https://i.imgur.com/KgnTsn1.jpeg",
    CNHT0: "https://i.imgur.com/zObg9RY.jpeg"
  },
  CHAIN_ID: 1030
};

// ==================== LPÂ•ñÂä±ÂÜúÂú∫ ABI ====================
const LP_REWARD_FARM_ABI = [
  // ÊûÑÈÄ†ÂáΩÊï∞
  {"inputs":[{"internalType":"address","name":"_lpToken","type":"address"},{"internalType":"address","name":"_rewardToken","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
  
  // Áî®Êà∑Êìç‰Ωú
  "function activate()",
  "function sync() returns (uint256 totalReward)",
  "function claimLOMRewards()",
  "function dailyCheckIn()",
  
  // ‰ø°ÊÅØÊü•ËØ¢
  "function getPoolInfo() view returns (uint256 totalUsers, uint256 lomDeposited, uint256 lomDistributed, uint256 lomRemaining, uint256 currentDailyRate, uint256 currentDailyLimit, bool isActive, bool isPaused)",
  "function getUserInfo(address userAddr) view returns (uint256 currentBalance, uint256 pendingLOMRewards, uint256 activityScore, string memory level, uint256 consecutiveDays, uint256 nextSyncAvailable, uint256 dailyLOMLeft, bool canCheckInToday)",
  "function getLOMPoolStatus() view returns (uint256 maxSupply, uint256 totalDeposited, uint256 totalDistributed, uint256 remaining, uint256 depositProgress, uint256 distributionProgress, uint256 estimatedDaysLeft, string memory status)",
  "function getPendingRewardsEstimate(address userAddr) view returns (uint256 safeRewards, uint256 optimisticRewards, bool estimateValid)",
  "function getSecurityStatus() view returns (bool isAdminSet, address currentAdmin, uint256 lomContractBalance, uint256 excessLOM)",
  
  // Áî®Êà∑Êï∞ÊçÆ
  "function users(address) view returns (uint256 lastSyncTime, uint256 lastCheckInTime, uint256 firstJoinTime, uint256 lastRewardDay, uint256 activityScore, uint256 consecutiveDays, uint256 totalSyncs, uint8 level, bool isActive)",
  "function userRewards(address) view returns (uint256 accumulatedLOM, uint256 totalLOMEarned, uint256 dailyLOMEarned, uint256 lastRewardDay)",
  
  // Ê±†Â≠ê‰ø°ÊÅØ
  "function totalLOMDeposited() view returns (uint256)",
  "function totalLOMDistributed() view returns (uint256)",
  "function remainingLOM() view returns (uint256)",
  "function totalActiveUsers() view returns (uint256)",
  "function farmingActive() view returns (bool)",
  "function paused() view returns (bool)",
  
  // ÂèÇÊï∞Êü•ËØ¢
  "function DAILY_CHECKIN_BONUS() view returns (uint256)",
  "function LOM_DECIMALS() view returns (uint256)",
  "function MAX_LOM_SUPPLY() view returns (uint256)",
  "function SYNC_ACTIVITY_POINTS() view returns (uint256)",
  "function SYNC_BONUS_RATE() view returns (uint256)",
  "function admin() view returns (address)",
  "function dailyRewardRate() view returns (uint256)",
  "function firstDepositTime() view returns (uint256)",
  "function lpToken() view returns (address)",
  "function maxDailyLOMPerUser() view returns (uint256)",
  "function minSyncInterval() view returns (uint256)",
  "function rewardToken() view returns (address)"
];

// ==================== Â∫îÁî®Áä∂ÊÄÅ ====================
let provider, signer, account, router, pair, lom, usdc, axcnh, usdt0, cnht0, axcnhUsdt0Pair, lpRewardFarm;
let slippage = 0.1;
let isChinese = true;
let currentRatio = 0;
let fromToken = "CFX";
let toToken = "LOM";
let refreshInterval;
let currentTokenSelector = null;
let transactionLock = false;
let currentReserves = { cfx: 0, lom: 0 };
let lastInputWasFrom = true;
let farmRefreshInterval;

// ÂÜúÂú∫Êï∞ÊçÆÁºìÂ≠ò
const farmDataCache = {
  lastUpdate: 0,
  data: null
};

// ==================== Ê†∏ÂøÉ‰ª£Â∏ÅÂàóË°® ====================
const TOKEN_LIST = [
  {
    symbol: "CFX",
    name: "Conflux",
    address: APP_CONFIG.CONTRACTS.WCFX,
    logo: APP_CONFIG.TOKEN_LOGOS.CFX,
    decimals: 18,
    isNative: true
  },
  {
    symbol: "LOM",
    name: "Longmai",
    address: APP_CONFIG.CONTRACTS.LOM,
    logo: APP_CONFIG.TOKEN_LOGOS.LOM,
    decimals: 18
  },
  {
    symbol: "USDC",
    name: "USD Coin",
    address: APP_CONFIG.CONTRACTS.USDC,
    logo: APP_CONFIG.TOKEN_LOGOS.USDC,
    decimals: 18
  },
  {
    symbol: "AXCNH",
    name: "AxCNH",
    address: APP_CONFIG.CONTRACTS.AXCNH,
    logo: APP_CONFIG.TOKEN_LOGOS.AXCNH,
    decimals: 6
  },
  {
    symbol: "USDT0",
    name: "Tether USD (Test)",
    address: APP_CONFIG.CONTRACTS.USDT0,
    logo: APP_CONFIG.TOKEN_LOGOS.USDT0,
    decimals: 6
  },
  {
    symbol: "CNHT0",
    name: "CNH Token (Test)",
    address: APP_CONFIG.CONTRACTS.CNHT0,
    logo: APP_CONFIG.TOKEN_LOGOS.CNHT0,
    decimals: 6
  }
];

// ==================== ÂêàÁ∫¶ ABI ====================
const ROUTER_ABI = [
  "function getAmountsOut(uint amountIn, address[] path) view returns (uint[] memory amounts)",
  "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) payable",
  "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)",
  "function addLiquidityETH(address token, uint amountTokenDesired, uint amountTokenMin, uint amountETHMin, address to, uint deadline) payable returns (uint amountToken, uint amountETH, uint liquidity)",
  "function removeLiquidityETHSupportingFeeOnTransferTokens(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountETH)",
  "function removeLiquidityETH(address token, uint liquidity, uint amountTokenMin, uint amountETHMin, address to, uint deadline) returns (uint amountToken, uint amountETH)"
];

const ERC20_ABI = [
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function decimals() view returns (uint8)",
  "function name() view returns (string)",
  "function symbol() view returns (string)",
  "function totalSupply() view returns (uint256)"
];

const PAIR_ABI = [
  "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
  "function totalSupply() view returns (uint256)",
  "function balanceOf(address owner) view returns (uint256)",
  "function token0() view returns (address)",
  "function token1() view returns (address)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function allowance(address owner, address spender) view returns (uint256)"
];

// ==================== Â∑•ÂÖ∑Ê®°Âùó ====================
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  formatDisplay(value) {
    if (!value && value !== 0) return '0.000000';
    
    const num = parseFloat(value);
    if (isNaN(num)) return '0.000000';
    
    const truncated = Math.floor(num * 1000000) / 1000000;
    
    const parts = truncated.toString().split('.');
    let integerPart = parts[0];
    let decimalPart = parts[1] || '';
    
    if (decimalPart.length < 6) {
      decimalPart = decimalPart.padEnd(6, '0');
    } else if (decimalPart.length > 6) {
      decimalPart = decimalPart.substring(0, 6);
    }
    
    let result = integerPart + '.' + decimalPart;
    
    if (result.includes('.')) {
      result = result.replace(/0+$/, '');
      if (result.endsWith('.')) {
        result = result.slice(0, -1);
      }
    }
    
    return result;
  },

  formatAddress(address) {
    if (!address) return '';
    return address.slice(0, 4) + '...' + address.slice(-6);
  },

  showError(message) {
    const errorBox = document.getElementById('swapErrorBox');
    const errorText = document.getElementById('swapErrorText');
    if (errorBox && errorText) {
      errorText.textContent = message;
      errorBox.classList.add('show');
      
      setTimeout(() => {
        errorBox.classList.remove('show');
      }, 5000);
    }
  },

  showNotification(message, type = 'info') {
    const status = document.getElementById('txStatusOverlay');
    const icon = document.getElementById('txStatusIcon');
    const title = document.getElementById('txStatusTitle');
    const msg = document.getElementById('txStatusMessage');
    const doneBtn = document.getElementById('txStatusDoneBtn');
    
    const statusConfig = {
      info: { 
        icon: '<div class="loading-spinner white"></div>', 
        title: isChinese ? 'Â§ÑÁêÜ‰∏≠' : 'Processing' 
      },
      success: { 
        icon: '‚úÖ', 
        title: isChinese ? 'Êìç‰ΩúÊàêÂäü' : 'Success' 
      },
      error: { 
        icon: '‚ùå', 
        title: isChinese ? 'Êìç‰ΩúÂ§±Ë¥•' : 'Failed' 
      },
      warning: { 
        icon: '‚ö†Ô∏è', 
        title: isChinese ? 'ÊèêÁ§∫' : 'Notice' 
      }
    };
    
    const config = statusConfig[type] || statusConfig.info;
    icon.innerHTML = config.icon;
    title.textContent = config.title;
    msg.textContent = message;
    
    if (type === 'success' || type === 'error' || type === 'warning') {
      doneBtn.style.display = 'block';
    } else {
      doneBtn.style.display = 'none';
    }
    
    status.style.display = 'flex';
  },

  hideNotification() {
    const status = document.getElementById('txStatusOverlay');
    if (status) {
      status.style.display = 'none';
    }
    document.querySelectorAll('button').forEach(btn => {
      if (!btn.id.includes('Cancel') && !btn.id.includes('Done')) {
        btn.disabled = false;
      }
    });
  },

  getErrorMessage(error) {
    const message = error.message || error.toString();
    
    const errorMap = {
      'user rejected': isChinese ? 'Áî®Êà∑ÂèñÊ∂à‰∫Ü‰∫§Êòì' : 'Transaction rejected by user',
      'INSUFFICIENT_OUTPUT_AMOUNT': isChinese ? 'ËæìÂá∫Êï∞Èáè‰∏çË∂≥ÔºåËØ∑ÊèêÈ´òÊªëÁÇπÂÆπÂ∑Æ' : 'Insufficient output amount, increase slippage',
      'INSUFFICIENT_INPUT_AMOUNT': isChinese ? 'ËæìÂÖ•Êï∞Èáè‰∏çË∂≥' : 'Insufficient input amount',
      'insufficient funds': isChinese ? '‰ΩôÈ¢ù‰∏çË∂≥' : 'Insufficient balance',
      'allowance': isChinese ? 'ËØ∑ÂÖàÊéàÊùÉ‰ª£Â∏Å' : 'Please approve token first',
      'deadline': isChinese ? '‰∫§ÊòìË∂ÖÊó∂ÔºåËØ∑ÈáçËØï' : 'Transaction expired, please try again',
      'Not enough liquidity': isChinese ? 'ÊµÅÂä®ÊÄß‰∏çË∂≥' : 'Insufficient liquidity',
      'execution reverted': isChinese ? '‰∫§ÊòìÊâßË°åÂ§±Ë¥•' : 'Transaction execution failed',
      'reverted': isChinese ? '‰∫§ÊòìÂ§±Ë¥•' : 'Transaction failed',
      'invalid decimal value': isChinese ? 'Êï∞ÈáèÊ†ºÂºèÈîôËØØ' : 'Invalid amount format',
      'underflow': isChinese ? 'Êï∞ÈáèÂ§™Â∞è' : 'Amount too small',
      'No LP tokens': isChinese ? 'ÊÇ®Ê≤°ÊúâLP‰ª£Â∏Å' : 'You have no LP tokens',
      'Not active': isChinese ? 'Ë¥¶Êà∑Êú™ÊøÄÊ¥ª' : 'Account not active',
      'Sync too frequent': isChinese ? 'ÂêåÊ≠•Â§™È¢ëÁπÅ' : 'Sync too frequent',
      'Daily limit reached': isChinese ? 'ËææÂà∞ÊØèÊó•‰∏äÈôê' : 'Daily limit reached',
      'Insufficient LOM rewards': isChinese ? 'LOMÂ•ñÂä±‰∏çË∂≥' : 'Insufficient LOM rewards',
      'Transaction failed': isChinese ? '‰∫§ÊòìÂ§±Ë¥•' : 'Transaction failed'
    };
    
    for (const [key, value] of Object.entries(errorMap)) {
      if (message.toLowerCase().includes(key.toLowerCase())) {
        return value;
      }
    }
    
    return isChinese ? '‰∫§ÊòìÂ§±Ë¥•ÔºåËØ∑ÈáçËØï' : 'Transaction failed, please try again';
  },

  formatNumber(num) {
    if (num >= 1000000) {
      return (num / 1000000).toFixed(2) + 'M';
    } else if (num >= 1000) {
      return (num / 1000).toFixed(2) + 'K';
    } else {
      return this.formatDisplay(num);
    }
  },

  formatTime(seconds) {
    if (seconds <= 0) return isChinese ? 'Áé∞Âú®ÂèØÂêåÊ≠•' : 'Ready to sync';
    
    if (seconds < 60) {
      return isChinese ? `${Math.ceil(seconds)}ÁßíÂêé` : `in ${Math.ceil(seconds)}s`;
    } else if (seconds < 3600) {
      return isChinese ? `${Math.ceil(seconds / 60)}ÂàÜÈíüÂêé` : `in ${Math.ceil(seconds / 60)}min`;
    } else if (seconds < 86400) {
      return isChinese ? `${Math.ceil(seconds / 3600)}Â∞èÊó∂Âêé` : `in ${Math.ceil(seconds / 3600)}h`;
    } else {
      return isChinese ? `${Math.ceil(seconds / 86400)}Â§©Âêé` : `in ${Math.ceil(seconds / 86400)}d`;
    }
  },

  formatLevel(level) {
    const levelMap = {
      'BRONZE': isChinese ? 'ÈùíÈìú' : 'Bronze',
      'SILVER': isChinese ? 'ÁôΩÈì∂' : 'Silver',
      'GOLD': isChinese ? 'ÈªÑÈáë' : 'Gold',
      'INACTIVE': isChinese ? 'Êú™ÊøÄÊ¥ª' : 'Inactive',
      '0': isChinese ? 'Êú™ÊøÄÊ¥ª' : 'Inactive',
      '1': isChinese ? 'ÈùíÈìú' : 'Bronze',
      '2': isChinese ? 'ÁôΩÈì∂' : 'Silver',
      '3': isChinese ? 'ÈªÑÈáë' : 'Gold'
    };
    return levelMap[level] || level;
  },

  getLevelIcon(level) {
    const levelIconMap = {
      'BRONZE': 'ü•â',
      'SILVER': 'ü•à',
      'GOLD': 'ü•á',
      'INACTIVE': '‚è≥',
      '0': '‚è≥',
      '1': 'ü•â',
      '2': 'ü•à',
      '3': 'ü•á'
    };
    return levelIconMap[level] || '‚è≥';
  }
};

// ==================== ‰ª£Â∏ÅÂ∑•ÂÖ∑Ê®°Âùó ====================
const TokenUtils = {
  getToken(symbol) {
    return TOKEN_LIST.find(t => t.symbol === symbol);
  },

  getTokenDecimals(symbol) {
    const token = this.getToken(symbol);
    return token ? token.decimals : 18;
  },

  getTokenContract(symbol) {
    const tokenContracts = {
      "LOM": lom,
      "USDC": usdc,
      "AXCNH": axcnh,
      "USDT0": usdt0,
      "CNHT0": cnht0
    };
    return tokenContracts[symbol] || null;
  },

  formatTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      const formatted = ethers.utils.formatUnits(amount, decimals);
      return Utils.formatDisplay(formatted);
    } catch {
      return '0.000000';
    }
  },

  parseTokenAmount(amount, symbol) {
    const decimals = this.getTokenDecimals(symbol);
    try {
      return ethers.utils.parseUnits(amount.toString(), decimals);
    } catch {
      return ethers.BigNumber.from(0);
    }
  }
};

// ==================== LPÂ•ñÂä±ÂÜúÂú∫ÁÆ°ÁêÜÂô® ====================
const FarmManager = {
  async refreshFarmData() {
    if (!account || !lpRewardFarm) {
      console.log('Êú™ËøûÊé•Èí±ÂåÖÔºåÊ∏ÖÁ©∫Êï∞ÊçÆ');
      this.clearUI();
      return;
    }
    
    try {
      console.log('ÂºÄÂßã‰ªéÈìæ‰∏äËé∑ÂèñÂÜúÂú∫Êï∞ÊçÆ...');
      
      // Ê£ÄÊü•ÁºìÂ≠òÔºåÈÅøÂÖçÈ¢ëÁπÅËØ∑Ê±Ç
      const now = Date.now();
      if (farmDataCache.data && now - farmDataCache.lastUpdate < 5000) {
        console.log('‰ΩøÁî®ÁºìÂ≠òÊï∞ÊçÆ');
        this.updateUIFromCache();
        return;
      }
      
      // Âπ∂Ë°åËé∑ÂèñÊâÄÊúâÂøÖË¶ÅÊï∞ÊçÆ
      await Promise.allSettled([
        this.updateFarmInfo(),
        this.updateUserInfo(),
        this.updateRewardEstimates()
      ]);
      
      // Êõ¥Êñ∞ÁºìÂ≠ò
      farmDataCache.lastUpdate = Date.now();
      console.log('ÂÜúÂú∫Êï∞ÊçÆËé∑ÂèñÂÆåÊàê');
      
    } catch (error) {
      console.error('Ëé∑ÂèñÂÜúÂú∫Êï∞ÊçÆÂ§±Ë¥•:', error);
      Utils.showError(isChinese ? 'Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú' : 'Failed to fetch data, check network');
    }
  },

  clearUI() {
    // Ê∏ÖÁ©∫ÂÜúÂú∫ÁªüËÆ°
    document.getElementById('totalRewardPool').textContent = '--';
    document.getElementById('totalDistributed').textContent = '--';
    document.getElementById('remainingRewards').textContent = '--';
    document.getElementById('totalActiveUsers').textContent = '--';
    
    // Ê∏ÖÁ©∫Áî®Êà∑‰ø°ÊÅØ
    document.getElementById('userAvatar').textContent = 'üë§';
    document.getElementById('userName').textContent = isChinese ? 'Êú™ËøûÊé•Èí±ÂåÖ' : 'Wallet Not Connected';
    document.getElementById('userLevel').textContent = isChinese ? 'ËØ∑ËøûÊé•Èí±ÂåÖÊü•ÁúãÊï∞ÊçÆ' : 'Connect wallet to view data';
    
    // Ê∏ÖÁ©∫Êî∂ÁõäÈ¢Ñ‰º∞
    document.getElementById('safeEstimate').textContent = '--';
    document.getElementById('optimisticEstimate').textContent = '--';
    document.getElementById('estimateStatus').textContent = '--';
    
    // Ê∏ÖÁ©∫Áî®Êà∑ÁªüËÆ°
    document.getElementById('lpBalance').textContent = '--';
    document.getElementById('activityScore').textContent = '--';
    document.getElementById('consecutiveDays').textContent = '--';
    document.getElementById('dailyLOMLeft').textContent = '--';
    
    // Ê∏ÖÁ©∫Êó∂Èó¥ÊòæÁ§∫
    document.getElementById('nextSyncTime').textContent = '--';
    
    // Ê∏ÖÁ©∫Áä∂ÊÄÅÊèêÁ§∫
    const actionStatus = document.getElementById('actionStatus');
    if (actionStatus) {
      actionStatus.className = 'action-status';
      actionStatus.textContent = '';
    }
    
    this.disableAllButtons();
  },

  updateUIFromCache() {
    if (!farmDataCache.data) return;
    
    const data = farmDataCache.data;
    
    // Êõ¥Êñ∞ÂÜúÂú∫ÁªüËÆ°
    if (data.farmInfo) {
      document.getElementById('totalRewardPool').textContent = 
        Utils.formatNumber(data.farmInfo.totalRewardPool || 0) + ' LOM';
      document.getElementById('totalDistributed').textContent = 
        Utils.formatNumber(data.farmInfo.totalDistributed || 0) + ' LOM';
      document.getElementById('remainingRewards').textContent = 
        Utils.formatNumber(data.farmInfo.remainingRewards || 0) + ' LOM';
      document.getElementById('totalActiveUsers').textContent = 
        (data.farmInfo.totalActiveUsers || 0).toString();
    }
    
    // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
    if (data.userInfo) {
      this.updateUserUI(data.userInfo);
    }
    
    // Êõ¥Êñ∞Êî∂ÁõäÈ¢Ñ‰º∞
    if (data.estimates) {
      document.getElementById('safeEstimate').textContent = 
        Utils.formatDisplay(data.estimates.safeRewards || 0) + ' LOM';
      document.getElementById('optimisticEstimate').textContent = 
        Utils.formatDisplay(data.estimates.optimisticRewards || 0) + ' LOM';
      document.getElementById('estimateStatus').textContent = 
        data.estimates.estimateValid ? (isChinese ? 'È¢Ñ‰º∞ÊúâÊïà' : 'Valid') : (isChinese ? 'Êó†Ê≥ïÈ¢Ñ‰º∞' : 'Invalid');
    }
  },

  disableAllButtons() {
    document.getElementById('activateBtn').disabled = true;
    document.getElementById('syncBtn').disabled = true;
    document.getElementById('claimBtn').disabled = true;
    document.getElementById('checkinBtn').disabled = true;
  },

  async updateFarmInfo() {
    try {
      console.log('=== Êõ¥Êñ∞ÂÜúÂú∫‰ø°ÊÅØ ===');
      
      if (!lpRewardFarm) {
        console.error('LPÊåñÁüøÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
        return;
      }
      
      // Ëé∑ÂèñÂÜúÂú∫Âü∫Êú¨‰ø°ÊÅØ
      const [
        totalLOMDeposited,
        totalLOMDistributed,
        remainingLOM,
        totalActiveUsers,
        farmingActive,
        paused
      ] = await Promise.all([
        lpRewardFarm.totalLOMDeposited().catch(() => ethers.BigNumber.from(0)),
        lpRewardFarm.totalLOMDistributed().catch(() => ethers.BigNumber.from(0)),
        lpRewardFarm.remainingLOM().catch(() => ethers.BigNumber.from(0)),
        lpRewardFarm.totalActiveUsers().catch(() => ethers.BigNumber.from(0)),
        lpRewardFarm.farmingActive().catch(() => false),
        lpRewardFarm.paused().catch(() => false)
      ]);
      
      // ËΩ¨Êç¢Êï∞ÊçÆÊ†ºÂºè
      const farmInfo = {
        totalRewardPool: parseFloat(ethers.utils.formatUnits(totalLOMDeposited, 18)),
        totalDistributed: parseFloat(ethers.utils.formatUnits(totalLOMDistributed, 18)),
        remainingRewards: parseFloat(ethers.utils.formatUnits(remainingLOM, 18)),
        totalActiveUsers: parseInt(totalActiveUsers.toString()),
        farmingActive: farmingActive,
        paused: paused
      };
      
      // Êõ¥Êñ∞UI
      document.getElementById('totalRewardPool').textContent = 
        Utils.formatNumber(farmInfo.totalRewardPool) + ' LOM';
      document.getElementById('totalDistributed').textContent = 
        Utils.formatNumber(farmInfo.totalDistributed) + ' LOM';
      document.getElementById('remainingRewards').textContent = 
        Utils.formatNumber(farmInfo.remainingRewards) + ' LOM';
      document.getElementById('totalActiveUsers').textContent = 
        farmInfo.totalActiveUsers.toString();
      
      // Êõ¥Êñ∞ÁºìÂ≠ò
      if (!farmDataCache.data) farmDataCache.data = {};
      farmDataCache.data.farmInfo = farmInfo;
      
      console.log('ÂÜúÂú∫‰ø°ÊÅØÊõ¥Êñ∞ÂÆåÊàê:', farmInfo);
      
    } catch (error) {
      console.error('Êõ¥Êñ∞ÂÜúÂú∫‰ø°ÊÅØÂ§±Ë¥•:', error);
    }
  },

  async updateUserInfo() {
    try {
      if (!account || !lpRewardFarm) return;
      
      console.log('=== Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ ===');
      
      // Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
      const userInfo = await lpRewardFarm.getUserInfo(account).catch(() => null);
      
      if (!userInfo) {
        console.warn('Êó†Ê≥ïËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ');
        this.updateUserUI(null);
        return;
      }
      
      // Ëß£ÊûêÁî®Êà∑‰ø°ÊÅØ
      const [
        currentBalance,
        pendingLOMRewards,
        activityScore,
        level,
        consecutiveDays,
        nextSyncAvailable,
        dailyLOMLeft,
        canCheckInToday
      ] = userInfo;
      
      // Ëé∑ÂèñLP‰ΩôÈ¢ù
      let lpBalance = 0;
      try {
        const lpBalanceBN = await pair.balanceOf(account);
        lpBalance = parseFloat(ethers.utils.formatUnits(lpBalanceBN, 18));
      } catch (e) {
        console.error('Ëé∑ÂèñLP‰ΩôÈ¢ùÂ§±Ë¥•:', e);
      }
      
      // Ê†ºÂºèÂåñÊï∞ÊçÆ
      const userData = {
        currentBalance: lpBalance,
        pendingRewards: parseFloat(ethers.utils.formatUnits(pendingLOMRewards, 18)),
        activityScore: parseInt(activityScore.toString()),
        level: level,
        consecutiveDays: parseInt(consecutiveDays.toString()),
        nextSyncAvailable: parseInt(nextSyncAvailable.toString()),
        dailyLOMLeft: parseFloat(ethers.utils.formatUnits(dailyLOMLeft, 18)),
        canCheckInToday: canCheckInToday,
        isActive: level !== "INACTIVE"
      };
      
      // Êõ¥Êñ∞UI
      this.updateUserUI(userData);
      
      // Êõ¥Êñ∞ÁºìÂ≠ò
      if (!farmDataCache.data) farmDataCache.data = {};
      farmDataCache.data.userInfo = userData;
      
      console.log('Áî®Êà∑‰ø°ÊÅØÊõ¥Êñ∞ÂÆåÊàê:', userData);
      
    } catch (error) {
      console.error('Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
      this.updateUserUI(null);
    }
  },

  updateUserUI(userData) {
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    const userLevel = document.getElementById('userLevel');
    
    if (!userData || !userData.isActive) {
      // Êú™ÊøÄÊ¥ªÁä∂ÊÄÅ
      userAvatar.textContent = '‚è≥';
      userName.textContent = isChinese ? 'Êú™ÊøÄÊ¥ªË¥¶Êà∑' : 'Inactive Account';
      userLevel.textContent = isChinese ? 
        'ÈúÄË¶ÅLP‰ª£Â∏ÅÊøÄÊ¥ªË¥¶Êà∑' : 'Need LP tokens to activate account';
      
      document.getElementById('lpBalance').textContent = '--';
      document.getElementById('activityScore').textContent = '--';
      document.getElementById('consecutiveDays').textContent = '--';
      document.getElementById('dailyLOMLeft').textContent = '--';
      document.getElementById('nextSyncTime').textContent = isChinese ? 'Êú™ÊøÄÊ¥ª' : 'Inactive';
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      this.updateButtonStates(false, false, 0, false, 0);
      return;
    }
    
    // Â∑≤ÊøÄÊ¥ªÁä∂ÊÄÅ
    const levelIcon = Utils.getLevelIcon(userData.level);
    const levelDisplay = Utils.formatLevel(userData.level);
    
    userAvatar.textContent = levelIcon;
    userName.textContent = Utils.formatAddress(account);
    userLevel.textContent = `${levelDisplay} ¬∑ ${userData.activityScore}ÂàÜ`;
    
    // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
    document.getElementById('lpBalance').textContent = Utils.formatDisplay(userData.currentBalance);
    document.getElementById('activityScore').textContent = userData.activityScore.toString();
    document.getElementById('consecutiveDays').textContent = userData.consecutiveDays.toString();
    document.getElementById('dailyLOMLeft').textContent = 
      Utils.formatDisplay(userData.dailyLOMLeft) + ' LOM';
    
    // Êõ¥Êñ∞ÂêåÊ≠•Êó∂Èó¥
    const nextSyncTime = userData.nextSyncAvailable;
    document.getElementById('nextSyncTime').textContent = Utils.formatTime(nextSyncTime);
    
    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
    const canSync = nextSyncTime <= 0 && userData.currentBalance > 0;
    this.updateButtonStates(
      true,
      userData.currentBalance > 0,
      canSync,
      userData.canCheckInToday,
      userData.pendingRewards
    );
  },

  async updateRewardEstimates() {
    try {
      if (!account || !lpRewardFarm) return;
      
      // Ëé∑ÂèñÂ•ñÂä±È¢Ñ‰º∞
      const estimate = await lpRewardFarm.getPendingRewardsEstimate(account).catch(() => null);
      
      if (!estimate) {
        console.warn('Êó†Ê≥ïËé∑ÂèñÂ•ñÂä±È¢Ñ‰º∞');
        return;
      }
      
      const [safeRewardsBN, optimisticRewardsBN, estimateValid] = estimate;
      
      const estimates = {
        safeRewards: parseFloat(ethers.utils.formatUnits(safeRewardsBN, 18)),
        optimisticRewards: parseFloat(ethers.utils.formatUnits(optimisticRewardsBN, 18)),
        estimateValid: estimateValid
      };
      
      // Êõ¥Êñ∞UI
      document.getElementById('safeEstimate').textContent = 
        Utils.formatDisplay(estimates.safeRewards) + ' LOM';
      
      document.getElementById('optimisticEstimate').textContent = 
        estimates.estimateValid ? 
        Utils.formatDisplay(estimates.optimisticRewards) + ' LOM' : 
        (isChinese ? 'Êó†Ê≥ïÈ¢Ñ‰º∞' : 'N/A');
      
      document.getElementById('estimateStatus').textContent = 
        estimates.estimateValid ? (isChinese ? 'È¢Ñ‰º∞ÊúâÊïà' : 'Valid') : (isChinese ? 'Êó†Ê≥ïÈ¢Ñ‰º∞' : 'Invalid');
      
      // Êõ¥Êñ∞ÁºìÂ≠ò
      if (!farmDataCache.data) farmDataCache.data = {};
      farmDataCache.data.estimates = estimates;
      
      console.log('Â•ñÂä±È¢Ñ‰º∞Êõ¥Êñ∞ÂÆåÊàê:', estimates);
      
    } catch (error) {
      console.warn('Ëé∑ÂèñÂ•ñÂä±È¢Ñ‰º∞Â§±Ë¥•:', error);
    }
  },

  updateButtonStates(isActive, hasLPBalance, canSync, canCheckIn, pendingRewards) {
    const activateBtn = document.getElementById('activateBtn');
    const syncBtn = document.getElementById('syncBtn');
    const claimBtn = document.getElementById('claimBtn');
    const checkinBtn = document.getElementById('checkinBtn');
    
    if (isActive) {
      // Â∑≤ÊøÄÊ¥ªÁä∂ÊÄÅ
      activateBtn.disabled = true;
      activateBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'Â∑≤ÊøÄÊ¥ª' : 'Activated';
      
      // ÂêåÊ≠•ÊåâÈíÆ
      syncBtn.disabled = !canSync;
      if (canSync) {
        syncBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'ÂêåÊ≠•Â•ñÂä±' : 'Sync Rewards';
      } else {
        // ÊòæÁ§∫Ââ©‰ΩôÊó∂Èó¥
        const nextSyncTime = document.getElementById('nextSyncTime').textContent;
        syncBtn.querySelector('.farm-btn-text').textContent = nextSyncTime;
      }
      
      // È¢ÜÂèñÊåâÈíÆ
      claimBtn.disabled = pendingRewards < 0.000001;
      if (pendingRewards >= 0.000001) {
        const displayAmount = Utils.formatDisplay(pendingRewards);
        claimBtn.querySelector('.farm-btn-text').textContent = isChinese ? 
          `È¢ÜÂèñ ${displayAmount} LOM` : 
          `Claim ${displayAmount} LOM`;
      } else {
        claimBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'ÊöÇÊó†Â•ñÂä±' : 'No Rewards';
      }
      
      // Á≠æÂà∞ÊåâÈíÆ
      checkinBtn.disabled = !canCheckIn;
      checkinBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'ÊØèÊó•Á≠æÂà∞' : 'Daily Check-in';
      
    } else {
      // Êú™ÊøÄÊ¥ªÁä∂ÊÄÅ
      activateBtn.disabled = !hasLPBalance;
      activateBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'ÊøÄÊ¥ªË¥¶Êà∑' : 'Activate Account';
      
      syncBtn.disabled = true;
      syncBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'ÈúÄË¶ÅÂÖàÊøÄÊ¥ª' : 'Need Activation';
      
      claimBtn.disabled = true;
      claimBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'ÊöÇÊó†Â•ñÂä±' : 'No Rewards';
      
      checkinBtn.disabled = true;
      checkinBtn.querySelector('.farm-btn-text').textContent = isChinese ? 'Êú™ÊøÄÊ¥ªË¥¶Êà∑' : 'Inactive Account';
    }
  },

  // Êìç‰ΩúÁä∂ÊÄÅÁÆ°ÁêÜÂô®
  async executeWithValidation(actionType, actionFunction) {
    const statusElement = document.getElementById('actionStatus');
    
    // ÈáçÁΩÆÁä∂ÊÄÅ
    statusElement.className = 'action-status';
    statusElement.textContent = '';
    
    // È™åËØÅÂâçÁΩÆÊù°‰ª∂
    const validation = await this.validateAction(actionType);
    if (!validation.valid) {
      statusElement.className = 'action-status error show';
      statusElement.textContent = validation.message;
      
      // 3ÁßíÂêéËá™Âä®ÈöêËóè
      setTimeout(() => {
        statusElement.classList.remove('show');
      }, 3000);
      return false;
    }
    
    try {
      // ÊâßË°åÊìç‰Ωú
      statusElement.className = 'action-status info show';
      statusElement.textContent = validation.processingMessage;
      
      await actionFunction();
      
      // ÊàêÂäü
      statusElement.className = 'action-status success show';
      statusElement.textContent = validation.successMessage;
      
      // Âà∑Êñ∞Êï∞ÊçÆ
      setTimeout(() => {
        this.refreshFarmData();
        statusElement.classList.remove('show');
      }, 2000);
      
      return true;
      
    } catch (error) {
      console.error(`${actionType}Êìç‰ΩúÂ§±Ë¥•:`, error);
      
      statusElement.className = 'action-status error show';
      statusElement.textContent = Utils.getErrorMessage(error);
      
      // 5ÁßíÂêéËá™Âä®ÈöêËóè
      setTimeout(() => {
        statusElement.classList.remove('show');
      }, 5000);
      
      return false;
    }
  },

  async validateAction(actionType) {
    const validations = {
      'activate': {
        check: async () => {
          if (!account) return 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ';
          
          // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊøÄÊ¥ª
          try {
            const userInfo = await lpRewardFarm.getUserInfo(account);
            const level = userInfo[3];
            if (level !== "INACTIVE") return 'Ë¥¶Êà∑Â∑≤ÊøÄÊ¥ª';
          } catch (e) {
            // Â¶ÇÊûúÊó†Ê≥ïËé∑ÂèñÁî®Êà∑‰ø°ÊÅØÔºåÁªßÁª≠Ê£ÄÊü•
          }
          
          // Ê£ÄÊü•LP‰ΩôÈ¢ù
          const lpBalance = parseFloat(document.getElementById('lpBalance').textContent);
          if (lpBalance <= 0.000001) return 'ÈúÄË¶ÅLP‰ª£Â∏ÅÊâçËÉΩÊøÄÊ¥ª';
          
          return null;
        },
        processingMessage: isChinese ? 'ÊøÄÊ¥ªË¥¶Êà∑‰∏≠...' : 'Activating...',
        successMessage: isChinese ? 'Ë¥¶Êà∑ÊøÄÊ¥ªÊàêÂäüÔºÅ' : 'Account activated!'
      },
      
      'sync': {
        check: async () => {
          if (!account) return 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ';
          
          // Ê£ÄÊü•ÊòØÂê¶ÊøÄÊ¥ª
          try {
            const userInfo = await lpRewardFarm.getUserInfo(account);
            const level = userInfo[3];
            if (level === "INACTIVE") return 'ËØ∑ÂÖàÊøÄÊ¥ªË¥¶Êà∑';
            
            // Ê£ÄÊü•ÂêåÊ≠•Êó∂Èó¥
            const nextSyncAvailable = parseInt(userInfo[5].toString());
            if (nextSyncAvailable > 0) {
              return `Ë∑ùÁ¶ª‰∏ãÊ¨°ÂêåÊ≠•ËøòÊúâ ${Utils.formatTime(nextSyncAvailable)}`;
            }
          } catch (e) {
            return 'Êó†Ê≥ïËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ';
          }
          
          // Ê£ÄÊü•LP‰ΩôÈ¢ù
          const lpBalance = parseFloat(document.getElementById('lpBalance').textContent);
          if (lpBalance <= 0.000001) return 'ÈúÄË¶ÅLP‰ª£Â∏ÅÊâçËÉΩÂêåÊ≠•';
          
          return null;
        },
        processingMessage: isChinese ? 'ÂêåÊ≠•Â•ñÂä±‰∏≠...' : 'Syncing...',
        successMessage: isChinese ? 'Â•ñÂä±ÂêåÊ≠•ÊàêÂäüÔºÅ' : 'Rewards synced!'
      },
      
      'claim': {
        check: async () => {
          if (!account) return 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ';
          
          // Ê£ÄÊü•ÊòØÂê¶ÊøÄÊ¥ª
          try {
            const userInfo = await lpRewardFarm.getUserInfo(account);
            const level = userInfo[3];
            if (level === "INACTIVE") return 'ËØ∑ÂÖàÊøÄÊ¥ªË¥¶Êà∑';
            
            // Ê£ÄÊü•Â•ñÂä±‰ΩôÈ¢ù
            const pendingRewards = parseFloat(ethers.utils.formatUnits(userInfo[1], 18));
            if (pendingRewards < 0.000001) return 'ÊöÇÊó†Â•ñÂä±ÂèØÈ¢ÜÂèñ';
          } catch (e) {
            return 'Êó†Ê≥ïËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ';
          }
          
          return null;
        },
        processingMessage: isChinese ? 'È¢ÜÂèñÂ•ñÂä±‰∏≠...' : 'Claiming...',
        successMessage: isChinese ? 'Â•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ' : 'Rewards claimed!'
      },
      
      'checkin': {
        check: async () => {
          if (!account) return 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ';
          
          // Ê£ÄÊü•ÊòØÂê¶ÊøÄÊ¥ª
          try {
            const userInfo = await lpRewardFarm.getUserInfo(account);
            const level = userInfo[3];
            if (level === "INACTIVE") return 'ËØ∑ÂÖàÊøÄÊ¥ªË¥¶Êà∑';
            
            // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•Á≠æÂà∞
            const canCheckInToday = userInfo[7];
            if (!canCheckInToday) return '‰ªäÊó•Â∑≤Á≠æÂà∞';
          } catch (e) {
            return 'Êó†Ê≥ïËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ';
          }
          
          return null;
        },
        processingMessage: isChinese ? 'Á≠æÂà∞‰∏≠...' : 'Checking in...',
        successMessage: isChinese ? 'Á≠æÂà∞ÊàêÂäüÔºÅ' : 'Checked in!'
      }
    };
    
    const validation = validations[actionType];
    if (!validation) {
      return {
        valid: false,
        message: isChinese ? 'Êú™Áü•Êìç‰ΩúÁ±ªÂûã' : 'Unknown action'
      };
    }
    
    const error = await validation.check();
    if (error) {
      return {
        valid: false,
        message: error
      };
    }
    
    return {
      valid: true,
      processingMessage: validation.processingMessage,
      successMessage: validation.successMessage
    };
  },

  async activateAccount() {
    return await this.executeWithValidation('activate', async () => {
      const tx = await lpRewardFarm.activate();
      await tx.wait();
    });
  },

  async syncRewards() {
    return await this.executeWithValidation('sync', async () => {
      const tx = await lpRewardFarm.sync();
      await tx.wait();
    });
  },

  async claimRewards() {
    return await this.executeWithValidation('claim', async () => {
      const tx = await lpRewardFarm.claimLOMRewards();
      await tx.wait();
    });
  },

  async dailyCheckIn() {
    return await this.executeWithValidation('checkin', async () => {
      const tx = await lpRewardFarm.dailyCheckIn();
      await tx.wait();
    });
  }
};

// ==================== ‰∫§ÊòìÁÆ°ÁêÜÂô® ====================
const TransactionManager = {
  async executeTransaction(operation) {
    if (transactionLock) {
      Utils.showError(isChinese ? 'Â∑≤Êúâ‰∫§ÊòìÂú®Â§ÑÁêÜ‰∏≠' : 'Transaction already in progress');
      return false;
    }
    
    if (!account) {
      Utils.showError(isChinese ? 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ' : 'Please connect wallet first');
      return false;
    }
    
    transactionLock = true;
    
    try {
      const confirmed = await ConfirmDialog.show(operation);
      if (!confirmed) {
        transactionLock = false;
        return false;
      }
      
      Utils.showNotification(operation.processingMessage, 'info');
      await operation.execute();
      
      Utils.showNotification(operation.successMessage, 'success');
      await DataManager.refreshAll();
      await FarmManager.refreshFarmData();
      return true;
      
    } catch (error) {
      console.error('‰∫§ÊòìÂ§±Ë¥•:', error);
      Utils.showNotification(Utils.getErrorMessage(error), 'error');
      return false;
    } finally {
      transactionLock = false;
    }
  },

  async executeFarmTransaction(operation) {
    return await this.executeTransaction(operation);
  },

  async checkAndApprove(tokenContract, spenderAddress, amount) {
    if (!tokenContract || !account) return true;
    
    try {
      const allowance = await tokenContract.allowance(account, spenderAddress);
      if (allowance.lt(amount)) {
        Utils.showNotification(isChinese ? 'ÊéàÊùÉ‰ª£Â∏Å‰∏≠...' : 'Approving token...', 'info');
        const approveTx = await tokenContract.approve(spenderAddress, ethers.constants.MaxUint256);
        await approveTx.wait();
      }
      return true;
    } catch (error) {
      console.error('ÊéàÊùÉÂ§±Ë¥•:', error);
      throw new Error('approval');
    }
  }
};

// ==================== Á°ÆËÆ§ÂØπËØùÊ°ÜÁÆ°ÁêÜÂô® ====================
const ConfirmDialog = {
  async show(operation) {
    return new Promise((resolve) => {
      const modal = document.getElementById('farmConfirmModal');
      const icon = document.getElementById('farmConfirmIcon');
      const action = document.getElementById('farmConfirmAction');
      const amountsDiv = document.getElementById('farmConfirmAmounts');
      const detailsDiv = document.getElementById('farmConfirmDetails');
      
      icon.textContent = operation.icon;
      action.textContent = operation.title;
      
      amountsDiv.innerHTML = this.generateAmountsHTML(operation);
      detailsDiv.innerHTML = this.generateDetailsHTML(operation);
      
      modal.style.display = "flex";
      
      const cancelBtn = document.getElementById('farmCancelBtn');
      const confirmBtn = document.getElementById('farmConfirmBtn');
      
      const cleanup = () => {
        cancelBtn.removeEventListener('click', onCancel);
        confirmBtn.removeEventListener('click', onConfirm);
        modal.style.display = 'none';
        if (operation.confirmBtnStyle) {
          confirmBtn.style.background = '';
        }
      };
      
      const onCancel = () => {
        cleanup();
        resolve(false);
      };
      
      const onConfirm = () => {
        cleanup();
        resolve(true);
      };
      
      cancelBtn.addEventListener('click', onCancel);
      confirmBtn.addEventListener('click', onConfirm);
      
      if (operation.confirmBtnStyle) {
        confirmBtn.style.background = operation.confirmBtnStyle;
      }
    });
  },

  generateAmountsHTML(operation) {
    if (operation.type === 'activate') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">ÊøÄÊ¥ªÊåñÁüøË¥¶Êà∑</div>
        </div>
      `;
    } else if (operation.type === 'sync') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">ÂêåÊ≠•LOMÂ•ñÂä±</div>
        </div>
      `;
    } else if (operation.type === 'claim') {
      const displayAmount = Utils.formatDisplay(operation.amount || 0);
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">${displayAmount} LOM</div>
        </div>
      `;
    } else if (operation.type === 'checkin') {
      return `
        <div class="confirm-amount-row">
          <div class="confirm-amount-logo" style="background-image: url('${APP_CONFIG.TOKEN_LOGOS.LOM}')"></div>
          <div class="confirm-amount-text">ÊØèÊó•Á≠æÂà∞</div>
        </div>
      `;
    }
    return '';
  },

  generateDetailsHTML(operation) {
    if (operation.type === 'activate') {
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Êìç‰ΩúÁ±ªÂûã' : 'Action Type'}</div>
          <div class="confirm-detail-value">${isChinese ? 'ÊøÄÊ¥ªÊåñÁüøË¥¶Êà∑' : 'Activate Mining Account'}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Ë¶ÅÊ±Ç' : 'Requirement'}</div>
          <div class="confirm-detail-value">${isChinese ? 'Êã•ÊúâLP‰ª£Â∏Å' : 'Must have LP tokens'}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Ë¥πÁî®' : 'Fee'}</div>
          <div class="confirm-detail-value">${isChinese ? '‰ªÖGasË¥π' : 'Gas fee only'}</div>
        </div>
      `;
    } else if (operation.type === 'sync') {
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Êìç‰ΩúÁ±ªÂûã' : 'Action Type'}</div>
          <div class="confirm-detail-value">${isChinese ? 'ÂêåÊ≠•Â•ñÂä±' : 'Sync Rewards'}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Ë¶ÅÊ±Ç' : 'Requirement'}</div>
          <div class="confirm-detail-value">${isChinese ? 'ÈúÄË¶ÅLP‰ª£Â∏Å' : 'Requires LP tokens'}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Èó¥ÈöîÊó∂Èó¥' : 'Interval'}</div>
          <div class="confirm-detail-value">${isChinese ? '12Â∞èÊó∂' : '12 hours'}</div>
        </div>
      `;
    } else if (operation.type === 'claim') {
      return `
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Êìç‰ΩúÁ±ªÂûã' : 'Action Type'}</div>
          <div class="confirm-detail-value">${isChinese ? 'È¢ÜÂèñÂ•ñÂä±' : 'Claim Rewards'}</div>
        </div>
        <div class="confirm-detail-item">
          <div class="confirm-detail-label">${isChinese ? 'Â•ñÂä±Êï∞Èáè' : 'Reward Amount'}</div>
          <div class="confirm-detail-value">${Utils.formatDisplay(operation.amount || 0)} LOM</div>
        </div>
      `;
    }
    return '';
  }
};

// ==================== Èí±ÂåÖÁÆ°ÁêÜÂô® ====================
const WalletManager = {
  async checkNetwork() {
    try {
      if (!window.ethereum) {
        throw new Error(isChinese ? "Êú™Ê£ÄÊµãÂà∞Èí±ÂåÖ" : "No wallet detected");
      }
      
      const chainId = await window.ethereum.request({ method: 'eth_chainId' });
      const targetChainId = '0x' + APP_CONFIG.CHAIN_ID.toString(16);
      
      if (chainId !== targetChainId) {
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: targetChainId }]
          });
        } catch (switchError) {
          if (switchError.code === 4902) {
            await window.ethereum.request({
              method: 'wallet_addEthereumChain',
              params: [{
                chainId: targetChainId,
                chainName: 'Conflux eSpace',
                nativeCurrency: {
                  name: 'CFX',
                  symbol: 'CFX',
                  decimals: 18
                },
                rpcUrls: ['https://evm.confluxrpc.com'],
                blockExplorerUrls: ['https://evm.confluxscan.io']
              }]
            });
          } else {
            throw switchError;
          }
        }
      }
      return true;
    } catch (error) {
      console.error("ÁΩëÁªúÂàáÊç¢Â§±Ë¥•:", error);
      const errorMsg = isChinese ? 
        `ËØ∑ÂàáÊç¢Âà∞Conflux eSpaceÁΩëÁªú (ChainID: ${APP_CONFIG.CHAIN_ID})` :
        `Please switch to Conflux eSpace network (ChainID: ${APP_CONFIG.CHAIN_ID})`;
      Utils.showError(errorMsg);
      return false;
    }
  },

  initContracts() {
    try {
      if (!provider) {
        throw new Error('Provider not initialized');
      }
      
      signer = provider.getSigner();
      
      router = new ethers.Contract(
        APP_CONFIG.CONTRACTS.ROUTER,
        ROUTER_ABI,
        signer
      );
      
      pair = new ethers.Contract(
        APP_CONFIG.CONTRACTS.PAIR,
        PAIR_ABI,
        provider
      );
      
      lom = new ethers.Contract(
        APP_CONFIG.CONTRACTS.LOM,
        ERC20_ABI,
        signer
      );
      
      usdc = new ethers.Contract(
        APP_CONFIG.CONTRACTS.USDC,
        ERC20_ABI,
        signer
      );
      
      axcnh = new ethers.Contract(
        APP_CONFIG.CONTRACTS.AXCNH,
        ERC20_ABI,
        signer
      );
      
      usdt0 = new ethers.Contract(
        APP_CONFIG.CONTRACTS.USDT0,
        ERC20_ABI,
        signer
      );
      
      cnht0 = new ethers.Contract(
        APP_CONFIG.CONTRACTS.CNHT0,
        ERC20_ABI,
        signer
      );
      
      axcnhUsdt0Pair = new ethers.Contract(
        APP_CONFIG.CONTRACTS.AXCNH_USDT0_PAIR,
        PAIR_ABI,
        provider
      );
      
      // ÂàùÂßãÂåñLPÊåñÁüøÂêàÁ∫¶
      lpRewardFarm = new ethers.Contract(
        APP_CONFIG.CONTRACTS.LP_REWARD_FARM,
        LP_REWARD_FARM_ABI,
        signer
      );
      
      console.log('ÊâÄÊúâÂêàÁ∫¶Â∑≤ÂàùÂßãÂåñ');
      return true;
    } catch (error) {
      console.error('ÂàùÂßãÂåñÂêàÁ∫¶Â§±Ë¥•:', error);
      return false;
    }
  },

  async connect() {
    try {
      const walletBtn = document.getElementById('walletBtn');
      
      if (!window.ethereum) {
        Utils.showError(isChinese ? 
          "ËØ∑ÂÆâË£ÖTPÈí±ÂåÖÊàñMetaMaskÁ≠âWeb3Èí±ÂåÖ" : 
          "Please install TP Wallet, MetaMask or other Web3 wallet"
        );
        walletBtn.textContent = isChinese ? 'ËøûÊé•Èí±ÂåÖ' : 'Connect Wallet';
        return false;
      }
      
      walletBtn.textContent = isChinese ? 'ËøûÊé•‰∏≠...' : 'Connecting...';
      walletBtn.classList.add('connecting');
      walletBtn.disabled = true;
      
      const accounts = await window.ethereum.request({
        method: 'eth_requestAccounts'
      });
      
      if (!accounts || accounts.length === 0) {
        throw new Error(isChinese ? 'Áî®Êà∑ÊãíÁªùËøûÊé•' : 'User rejected connection');
      }
      
      account = accounts[0];
      console.log('ËøûÊé•Ë¥¶Êà∑:', account);
      
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      
      const networkOk = await this.checkNetwork();
     if (!networkOk) {
        throw new Error(isChinese ? 'ÁΩëÁªúÂàáÊç¢Â§±Ë¥•' : 'Network switch failed');
      }
      
      const contractsOk = this.initContracts();
      if (!contractsOk) {
        throw new Error(isChinese ? 'ÂêàÁ∫¶ÂàùÂßãÂåñÂ§±Ë¥•' : 'Contract initialization failed');
      }
      
      this.updateUI();
      
      await DataManager.refreshAll();
      await FarmManager.refreshFarmData();
      
      if (refreshInterval) clearInterval(refreshInterval);
      refreshInterval = setInterval(() => DataManager.refreshAll(), 10000);
      
      if (farmRefreshInterval) clearInterval(farmRefreshInterval);
      farmRefreshInterval = setInterval(() => FarmManager.refreshFarmData(), 15000);
      
      Utils.showNotification(
        isChinese ? 'Èí±ÂåÖËøûÊé•ÊàêÂäü' : 'Wallet connected successfully',
        'success'
      );
      
      return true;
      
    } catch (error) {
      console.error("Èí±ÂåÖËøûÊé•Â§±Ë¥•:", error);
      
      let errorMessage;
      if (error.code === 4001) {
        errorMessage = isChinese ? 'Áî®Êà∑ÊãíÁªùËøûÊé•ËØ∑Ê±Ç' : 'User rejected connection request';
      } else if (error.code === -32002) {
        errorMessage = isChinese ? 'Â∑≤ÊúâËøûÊé•ËØ∑Ê±ÇÂú®Â§ÑÁêÜ‰∏≠' : 'Connection request already processing';
      } else {
        errorMessage = isChinese ? `ËøûÊé•Â§±Ë¥•: ${error.message}` : `Connection failed: ${error.message}`;
      }
      
      Utils.showError(errorMessage);
      return false;
      
    } finally {
      this.updateUI();
    }
  },

  disconnect() {
    account = null;
    provider = null;
    signer = null;
    router = null;
    pair = null;
    lom = null;
    usdc = null;
    axcnh = null;
    usdt0 = null;
    cnht0 = null;
    axcnhUsdt0Pair = null;
    lpRewardFarm = null;
    
    if (refreshInterval) {
      clearInterval(refreshInterval);
      refreshInterval = null;
    }
    
    if (farmRefreshInterval) {
      clearInterval(farmRefreshInterval);
      farmRefreshInterval = null;
    }
    
    this.updateUI();
    DataManager.resetAllData();
    FarmManager.clearUI();
    
    Utils.showNotification(
      isChinese ? "Èí±ÂåÖÂ∑≤Êñ≠ÂºÄËøûÊé•" : "Wallet disconnected",
      'success'
    );
  },

  updateUI() {
    const walletBtn = document.getElementById('walletBtn');
    
    if (walletBtn) {
      walletBtn.disabled = false;
      walletBtn.classList.remove('connecting');
      
      if (account) {
        const displayAddress = Utils.formatAddress(account);
        walletBtn.textContent = displayAddress;
        walletBtn.classList.add('connected');
      } else {
        walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
        walletBtn.classList.remove('connected');
      }
    }
    
    UIManager.updateAllTexts();
    DataManager.updateSwapButtonState();
  }
};

// ==================== Êï∞ÊçÆÁÆ°ÁêÜÂô® ====================
const DataManager = {
  async refreshAll() {
    if (!account) return;
    
    try {
      await this.updateAllBalances();
      await this.updatePoolInfo();
      this.updateSwapButtonState();
      await FarmManager.refreshFarmData();
    } catch (error) {
      console.error('Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•:', error);
    }
  },

  async updateAllBalances() {
    if (!account) return;
    
    try {
      const balancePromises = TOKEN_LIST.map(async (token) => {
        try {
          let balance = 0;
          
          if (token.symbol === 'CFX' && provider) {
            const cfxBal = await provider.getBalance(account);
            balance = parseFloat(ethers.utils.formatEther(cfxBal));
          } else {
            const contract = TokenUtils.getTokenContract(token.symbol);
            if (contract) {
              const tokenBal = await contract.balanceOf(account);
              balance = parseFloat(ethers.utils.formatUnits(tokenBal, token.decimals));
            }
          }
          
          return { symbol: token.symbol, balance };
        } catch (error) {
          console.error(`Ëé∑Âèñ ${token.symbol} ‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
          return { symbol: token.symbol, balance: 0 };
        }
      });
      
      const balances = await Promise.all(balancePromises);
      
      balances.forEach(({ symbol, balance }) => {
        this.updateBalanceUI(symbol, balance);
      });
      
      if (lom && provider) {
        const cfxBal = balances.find(b => b.symbol === 'CFX')?.balance || 0;
        const lomBal = balances.find(b => b.symbol === 'LOM')?.balance || 0;
        
        document.getElementById("addCfxBal").textContent = Utils.formatDisplay(cfxBal);
        document.getElementById("addLomBal").textContent = Utils.formatDisplay(lomBal);
      }
      
      if (pair) {
        const lpBal = await pair.balanceOf(account);
        const lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
        document.getElementById("removeBtn").disabled = lpBal.isZero();
      }
      
    } catch (error) {
      console.error("Êõ¥Êñ∞‰ΩôÈ¢ùÂ§±Ë¥•:", error);
    }
  },

  updateBalanceUI(symbol, balance) {
    const formattedBalance = Utils.formatDisplay(balance);
    
    if (symbol === fromToken) {
      const fromBalEl = document.getElementById('fromBal');
      if (fromBalEl) fromBalEl.textContent = formattedBalance;
    }
    
    if (symbol === toToken) {
      const toBalEl = document.getElementById('toBal');
      if (toBalEl) toBalEl.textContent = formattedBalance;
    }
  },

  async updatePoolInfo() {
    try {
      if (!pair || !account) return;
      
      const [r0, r1] = await pair.getReserves();
      const t0 = await pair.token0();
      const totalSupply = await pair.totalSupply();
      
      const reserveCfx = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r0 : r1;
      const reserveLom = t0.toLowerCase() === APP_CONFIG.CONTRACTS.WCFX.toLowerCase() ? r1 : r0;
      
      const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
      const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
      
      currentReserves.cfx = cfxReserve;
      currentReserves.lom = lomReserve;
      
      const price = lomReserve / cfxReserve;
      currentRatio = price;
      
      const priceFormatted = Utils.formatDisplay(price);
      const priceText = isChinese ? 
        `${priceFormatted} LOM` : 
        `${priceFormatted} LOM`;
      document.getElementById("price").textContent = `1 CFX = ${priceText}`;
      document.getElementById("addRatio").textContent = `1 CFX = ${priceFormatted} LOM`;

      const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
      
      let lpAmt = 0;
      let share = 0;
      let userCfx = 0;
      let userLom = 0;
      
      const lpBal = await pair.balanceOf(account);
      lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
      
      if (totalSupplyNum > 0 && lpAmt > 0) {
        share = (lpAmt / totalSupplyNum) * 100;
        userCfx = cfxReserve * (share / 100);
        userLom = lomReserve * (share / 100);
      }
      
      const cfxReserveEl = document.getElementById("cfxReserve");
      const lomReserveEl = document.getElementById("lomReserve");
      
      if (cfxReserveEl) cfxReserveEl.textContent = cfxReserve.toFixed(2);
      if (lomReserveEl) lomReserveEl.textContent = lomReserve.toFixed(2);
      
      const userCfxEl = document.getElementById("userCfx");
      const userLomEl = document.getElementById("userLom");
      const userLpEl = document.getElementById("userLp");
      const userPoolShareEl = document.getElementById("userPoolShare");
      
      if (userCfxEl) userCfxEl.textContent = userCfx.toFixed(2);
      if (userLomEl) userLomEl.textContent = userLom.toFixed(2);
      if (userLpEl) userLpEl.textContent = lpAmt.toFixed(2);
      if (userPoolShareEl) userPoolShareEl.textContent = share.toFixed(4) + "%";
      
      const poolTitle = isChinese ? 
        `CFX-LOMÊµÅÂä®Ê±†` :
        `CFX-LOM Pool`;
      
      const poolInfoTitleEl = document.getElementById("poolInfoTitle");
      if (poolInfoTitleEl) poolInfoTitleEl.textContent = poolTitle;
      
      const removeBtn = document.getElementById("removeBtn");
      if (removeBtn) {
        removeBtn.disabled = lpAmt <= 0;
      }
      
    } catch (error) {
      console.error("Êõ¥Êñ∞Ê±†Â≠ê‰ø°ÊÅØÂ§±Ë¥•:", error);
    }
  },

  updateSwapButtonState() {
    const swapBtn = document.getElementById("swapBtn");
    const fromAmount = document.getElementById("fromAmount").value;
    
    if (!account) {
      swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      swapBtn.disabled = false;
      return;
    }
    
    if (!fromAmount || fromAmount === "0" || fromAmount === "") {
      swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
      swapBtn.disabled = true;
      return;
    }
    
    swapBtn.textContent = isChinese ? "Á´ãÂç≥ÂÖëÊç¢" : "Swap Now";
    swapBtn.disabled = false;
  },

  resetAllData() {
    const elements = {
      'fromBal': '0.000000',
      'toBal': '0.000000',
      'addCfxBal': '0.000000',
      'addLomBal': '0.000000',
      'price': '1 CFX = 0.000000 LOM',
      'minReceived': '0.000000 LOM'
    };
    
    Object.keys(elements).forEach(id => {
      const element = document.getElementById(id);
      if (element) element.textContent = elements[id];
    });
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    document.getElementById("removeBtn").disabled = true;
  }
};

// ==================== ÂÖëÊç¢Ê®°Âùó ====================
const SwapModule = {
  async executeSwap() {
    const fromAmount = document.getElementById('fromAmount').value;
    const toAmount = document.getElementById('toAmount').value;
    
    if (!fromAmount || fromAmount === '0') {
      Utils.showError(isChinese ? "ËØ∑ËæìÂÖ•ÂÖëÊç¢Êï∞Èáè" : "Please enter swap amount");
      return;
    }
    
    const operation = {
      type: 'swap',
      icon: 'üîÑ',
      title: isChinese ? 'ÂÖëÊç¢Á°ÆËÆ§' : 'Swap Confirmation',
      fromToken,
      toToken,
      fromAmount: parseFloat(fromAmount),
      toAmount: parseFloat(toAmount),
      slippage: slippage,
      processingMessage: isChinese ? 'Â§ÑÁêÜÂÖëÊç¢‰∏≠...' : 'Processing swap...',
      successMessage: isChinese ? `ÂÖëÊç¢ÊàêÂäüÔºÅËé∑Âæó ${Utils.formatDisplay(toAmount)} ${toToken}` : 
                               `Swap successful! Received ${Utils.formatDisplay(toAmount)} ${toToken}`,
      execute: async () => {
        await this.processSwap(fromAmount, toAmount);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async processSwap(fromAmount, toAmount) {
    const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
    const toDecimals = TokenUtils.getTokenDecimals(toToken);
    
    const amountIn = TokenUtils.parseTokenAmount(fromAmount, fromToken);
    const path = this.getSwapPath();
    
    if (!router) {
      throw new Error('Ë∑ØÁî±Âô®ÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
    }
    
    const amounts = await router.getAmountsOut(amountIn, path);
    const amountOutMin = amounts[amounts.length - 1].mul(1000 - slippage * 10).div(1000);
    
    const deadline = Math.floor(Date.now() / 1000) + 1200;
    
    let tx;
    
    if (fromToken === "CFX") {
      tx = await router.swapExactETHForTokensSupportingFeeOnTransferTokens(
        amountOutMin, path, account, deadline, 
        { value: amountIn }
      );
    } else if (toToken === "CFX") {
      const tokenContract = TokenUtils.getTokenContract(fromToken);
      if (!tokenContract) throw new Error('‰ª£Â∏ÅÂêàÁ∫¶Êú™ÊâæÂà∞');
      
      await TransactionManager.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
      
      tx = await router.swapExactTokensForETHSupportingFeeOnTransferTokens(
        amountIn, amountOutMin, path, account, deadline
      );
    } else {
      const tokenContract = TokenUtils.getTokenContract(fromToken);
      if (!tokenContract) throw new Error('‰ª£Â∏ÅÂêàÁ∫¶Êú™ÊâæÂà∞');
      
      await TransactionManager.checkAndApprove(tokenContract, APP_CONFIG.CONTRACTS.ROUTER, amountIn);
      
      tx = await router.swapExactTokensForTokensSupportingFeeOnTransferTokens(
        amountIn, amountOutMin, path, account, deadline
      );
    }
    
    await tx.wait();
    document.getElementById('fromAmount').value = '';
    document.getElementById('toAmount').value = '';
  },

  getSwapPath() {
    let path = [];
    
    if ((fromToken === 'AXCNH' && toToken === 'USDT0') || 
        (fromToken === 'USDT0' && toToken === 'AXCNH')) {
      
      if (fromToken === 'AXCNH') {
        path.push(APP_CONFIG.CONTRACTS.AXCNH);
        path.push(APP_CONFIG.CONTRACTS.USDT0);
      } else {
        path.push(APP_CONFIG.CONTRACTS.USDT0);
        path.push(APP_CONFIG.CONTRACTS.AXCNH);
      }
      return path;
    }
    
    if (fromToken === 'CFX') {
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    } else if (toToken === 'CFX') {
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      path.push(APP_CONFIG.CONTRACTS.WCFX);
    } else {
      if (fromToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (fromToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (fromToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (fromToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (fromToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
      
      path.push(APP_CONFIG.CONTRACTS.WCFX);
      
      if (toToken === 'LOM') path.push(APP_CONFIG.CONTRACTS.LOM);
      else if (toToken === 'USDC') path.push(APP_CONFIG.CONTRACTS.USDC);
      else if (toToken === 'AXCNH') path.push(APP_CONFIG.CONTRACTS.AXCNH);
      else if (toToken === 'USDT0') path.push(APP_CONFIG.CONTRACTS.USDT0);
      else if (toToken === 'CNHT0') path.push(APP_CONFIG.CONTRACTS.CNHT0);
    }
    
    return path;
  },

  async updateOutputFromInput() {
    const amount = document.getElementById('fromAmount').value;
    
    if (!amount || amount === '0' || amount === '' || !router) {
      document.getElementById('toAmount').value = "";
      document.getElementById('minReceived').textContent = `0 ${toToken}`;
      DataManager.updateSwapButtonState();
      return;
    }
    
    try {
      const fromDecimals = TokenUtils.getTokenDecimals(fromToken);
      const toDecimals = TokenUtils.getTokenDecimals(toToken);
      
      const amountIn = TokenUtils.parseTokenAmount(amount, fromToken);
      const path = this.getSwapPath();
      
      const amounts = await router.getAmountsOut(amountIn, path);
      const out = TokenUtils.formatTokenAmount(amounts[amounts.length - 1], toToken);
      
      document.getElementById('toAmount').value = out;
      
      const amountOutMin = amounts[amounts.length - 1].mul(1000 - slippage * 10).div(1000);
      const minOutFormatted = TokenUtils.formatTokenAmount(amountOutMin, toToken);
      document.getElementById('minReceived').textContent = 
        `${minOutFormatted} ${toToken}`;
      
      const price = parseFloat(out) / parseFloat(amount);
      const priceFormatted = Utils.formatDisplay(price);
      document.getElementById('price').textContent = 
        `1 ${fromToken} = ${priceFormatted} ${toToken}`;
      
      DataManager.updateSwapButtonState();
      
    } catch (error) {
      console.error('ËÆ°ÁÆóËæìÂá∫Â§±Ë¥•:', error);
      document.getElementById('toAmount').value = "";
      document.getElementById('swapBtn').textContent = isChinese ? 'ËÆ°ÁÆóÂ§±Ë¥•' : 'Calculation Failed';
      document.getElementById('swapBtn').disabled = true;
    }
  },

  reverseTokens() {
    const tempToken = fromToken;
    fromToken = toToken;
    toToken = tempToken;
    
    document.getElementById("fromTokenSymbol").textContent = fromToken;
    document.getElementById("toTokenSymbol").textContent = toToken;
    
    const fromTokenData = TokenUtils.getToken(fromToken);
    const toTokenData = TokenUtils.getToken(toToken);
    
    if (fromTokenData) {
      document.getElementById("fromTokenLogo").style.backgroundImage = `url('${fromTokenData.logo}')`;
    }
    
    if (toTokenData) {
      document.getElementById("toTokenLogo").style.backgroundImage = `url('${toTokenData.logo}')`;
    }
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    
    DataManager.updateAllBalances();
    DataManager.updateSwapButtonState();
    document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
    
    lastInputWasFrom = true;
  }
};

// ==================== ÊµÅÂä®ÊÄßÊ®°Âùó ====================
const LiquidityModule = {
  async addLiquidity() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    
    if (!cfxAmount || !lomAmount || parseFloat(cfxAmount) <= 0 || parseFloat(lomAmount) <= 0) {
      Utils.showError(isChinese ? "ËØ∑ËæìÂÖ•ÊúâÊïàÊï∞Èáè" : "Please enter valid amounts");
      return;
    }
    
    const operation = {
      type: 'addLiquidity',
      icon: 'üíß',
      title: isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄß' : 'Add Liquidity',
      cfxAmount: parseFloat(cfxAmount),
      lomAmount: parseFloat(lomAmount),
      slippage: slippage,
      processingMessage: isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄß‰∏≠...' : 'Adding liquidity...',
      successMessage: isChinese ? 'Ê∑ªÂä†ÊµÅÂä®ÊÄßÊàêÂäüÔºÅ' : 'Liquidity added successfully!',
      execute: async () => {
        await this.executeAddLiquidity(cfxAmount, lomAmount);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async executeAddLiquidity(cfxAmount, lomAmount) {
    const amountCfx = TokenUtils.parseTokenAmount(cfxAmount, 'CFX');
    const amountLom = TokenUtils.parseTokenAmount(lomAmount, 'LOM');
    
    if (!lom || !router) {
      throw new Error('ÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
    }
    
    await TransactionManager.checkAndApprove(lom, APP_CONFIG.CONTRACTS.ROUTER, amountLom);
    
    const amountCfxMin = amountCfx.mul(1000 - slippage * 10).div(1000);
    const amountLomMin = amountLom.mul(1000 - slippage * 10).div(1000);
    const deadline = Math.floor(Date.now() / 1000) + 1800;
    
    const tx = await router.addLiquidityETH(
      APP_CONFIG.CONTRACTS.LOM,
      amountLom,
      amountLomMin,
      amountCfxMin,
      account,
      deadline,
      { value: amountCfx }
    );
    
    await tx.wait();
    document.getElementById("addModal").style.display = "none";
    document.getElementById("addCfx").value = "";
    document.getElementById("addLom").value = "";
  },

  async removeLiquidity() {
    const percent = document.getElementById("removeSlider").value;
    const cfxEst = document.getElementById("removeEstCfx").textContent;
    const lomEst = document.getElementById("removeEstLom").textContent;
    
    const operation = {
      type: 'removeLiquidity',
      icon: 'üî•',
      title: isChinese ? 'ÁßªÈô§ÊµÅÂä®ÊÄß' : 'Remove Liquidity',
      cfxEst: parseFloat(cfxEst),
      lomEst: parseFloat(lomEst),
      percent: parseFloat(percent),
      slippage: slippage,
      processingMessage: isChinese ? 'ÁßªÈô§ÊµÅÂä®ÊÄß‰∏≠...' : 'Removing liquidity...',
      successMessage: isChinese ? `ÁßªÈô§ÊµÅÂä®ÊÄßÊàêÂäüÔºÅËé∑Âæó ${cfxEst} CFX Âíå ${lomEst} LOM` : 
                               `Success! Received ${cfxEst} CFX and ${lomEst} LOM`,
      confirmBtnStyle: 'var(--gradient-red)',
      execute: async () => {
        await this.executeRemoveLiquidity(percent);
      }
    };
    
    await TransactionManager.executeTransaction(operation);
  },

  async executeRemoveLiquidity(percent) {
    if (!pair || !router) {
      throw new Error('ÂêàÁ∫¶Êú™ÂàùÂßãÂåñ');
    }
    
    const lpBal = await pair.balanceOf(account);
    const liquidity = lpBal.mul(percent).div(100);
    
    if (liquidity.isZero()) {
      throw new Error(isChinese ? 'Ê≤°ÊúâÊµÅÂä®ÊÄßÂèØÁßªÈô§' : 'No liquidity to remove');
    }
    
    await TransactionManager.checkAndApprove(pair, APP_CONFIG.CONTRACTS.ROUTER, liquidity);
    
    const deadline = Math.floor(Date.now() / 1000) + 1800;
    
    const tx = await router.removeLiquidityETH(
      APP_CONFIG.CONTRACTS.LOM, 
      liquidity, 
      0,
      0,
      account, 
      deadline
    );
    
    await tx.wait();
    document.getElementById("removeModal").style.display = "none";
  },

  async updateRemoveEstimate(percent) {
    try {
      if (!account || !pair) return;
      
      document.getElementById("removePercent").textContent = percent + "%";
      
      const lpBal = await pair.balanceOf(account);
      const liquidity = lpBal.mul(percent).div(100);
      
      if (liquidity.isZero()) {
        document.getElementById("removeEstCfx").textContent = "0.000000";
        document.getElementById("removeEstLom").textContent = "0.000000";
        return;
      }
      
      const total = await pair.totalSupply();
      const { cfx: rCfx, lom: rLom } = currentReserves;
      
      const cfxReserve = TokenUtils.parseTokenAmount(rCfx.toString(), 'CFX');
      const lomReserve = TokenUtils.parseTokenAmount(rLom.toString(), 'LOM');
      
      const cfxOut = cfxReserve.mul(liquidity).div(total);
      const lomOut = lomReserve.mul(liquidity).div(total);
      
      const cfxOutFormatted = TokenUtils.formatTokenAmount(cfxOut, 'CFX');
      const lomOutFormatted = TokenUtils.formatTokenAmount(lomOut, 'LOM');
      
      document.getElementById("removeEstCfx").textContent = cfxOutFormatted;
      document.getElementById("removeEstLom").textContent = lomOutFormatted;
      
    } catch (error) {
      console.error("Êõ¥Êñ∞ÁßªÈô§‰º∞ÁÆóÂ§±Ë¥•:", error);
      document.getElementById("removeEstCfx").textContent = "0.000000";
      document.getElementById("removeEstLom").textContent = "0.000000";
    }
  },

  handleCfxInput() {
    const cfxAmount = document.getElementById("addCfx").value;
    
    if (!cfxAmount || cfxAmount === "" || parseFloat(cfxAmount) <= 0) {
      document.getElementById("addLom").value = "";
      document.getElementById("confirmAddBtn").disabled = true;
      return;
    }
    
    if (currentRatio > 0) {
      const cfxNum = parseFloat(cfxAmount);
      const lomAmount = cfxNum * currentRatio;
      document.getElementById("addLom").value = Utils.formatDisplay(lomAmount);
    }
    
    this.updateAddButtonState();
  },

  handleLomInput() {
    const lomAmount = document.getElementById("addLom").value;
    
    if (!lomAmount || lomAmount === "" || parseFloat(lomAmount) <= 0) {
      document.getElementById("addCfx").value = "";
      document.getElementById("confirmAddBtn").disabled = true;
      return;
    }
    
    if (currentRatio > 0) {
      const lomNum = parseFloat(lomAmount);
      const cfxAmount = lomNum / currentRatio;
      document.getElementById("addCfx").value = Utils.formatDisplay(cfxAmount);
    }
    
    this.updateAddButtonState();
  },

  updateAddButtonState() {
    const cfxAmount = document.getElementById("addCfx").value;
    const lomAmount = document.getElementById("addLom").value;
    const cfxBalance = parseFloat(document.getElementById("addCfxBal").textContent);
    const lomBalance = parseFloat(document.getElementById("addLomBal").textContent);
    const confirmButton = document.getElementById("confirmAddBtn");
    
    if (!cfxAmount || !lomAmount || cfxAmount === "" || lomAmount === "") {
      confirmButton.disabled = true;
      return;
    }
    
    const cfxNum = parseFloat(cfxAmount);
    const lomNum = parseFloat(lomAmount);
    
    if (isNaN(cfxNum) || isNaN(lomNum) || cfxNum <= 0 || lomNum <= 0) {
      confirmButton.disabled = true;
      return;
    }
    
    if (cfxNum > cfxBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    if (lomNum > lomBalance) {
      confirmButton.disabled = true;
      return;
    }
    
    const remainingCfx = cfxBalance - cfxNum;
    if (remainingCfx < 0.01) {
      confirmButton.disabled = true;
      return;
    }
    
    confirmButton.disabled = false;
  },

  async setMaxCfx() {
    const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
    if (cfxBal <= 0) {
      Utils.showError(isChinese ? "CFX‰ΩôÈ¢ù‰∏çË∂≥" : "Insufficient CFX balance");
      return;
    }
    
    const maxCfx = Math.max(0, cfxBal - 0.1);
    document.getElementById("addCfx").value = Utils.formatDisplay(maxCfx);
    
    if (currentRatio > 0) {
      const requiredLom = maxCfx * currentRatio;
      const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
      
      if (requiredLom <= lomBal) {
        document.getElementById("addLom").value = Utils.formatDisplay(requiredLom);
      } else {
        const adjustedCfx = lomBal / currentRatio;
        document.getElementById("addCfx").value = Utils.formatDisplay(Math.min(adjustedCfx, maxCfx));
        document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
      }
    }
    
    this.updateAddButtonState();
  },

  async setMaxLom() {
    const lomBal = parseFloat(document.getElementById("addLomBal").textContent);
    if (lomBal <= 0) {
      Utils.showError(isChinese ? "LOM‰ΩôÈ¢ù‰∏çË∂≥" : "Insufficient LOM balance");
      return;
    }
    
    document.getElementById("addLom").value = Utils.formatDisplay(lomBal);
    
    if (currentRatio > 0) {
      const requiredCfx = lomBal / currentRatio;
      const cfxBal = parseFloat(document.getElementById("addCfxBal").textContent);
      const availableCfx = Math.max(0, cfxBal - 0.1);
      
      if (requiredCfx <= availableCfx) {
        document.getElementById("addCfx").value = Utils.formatDisplay(requiredCfx);
      } else {
        const adjustedLom = availableCfx * currentRatio;
        document.getElementById("addLom").value = Utils.formatDisplay(Math.min(adjustedLom, lomBal));
        document.getElementById("addCfx").value = Utils.formatDisplay(availableCfx);
      }
    }
    
    this.updateAddButtonState();
  }
};

// ==================== ÁïåÈù¢ÁÆ°ÁêÜÂô® ====================
const UIManager = {
  init() {
    this.setupEventListeners();
    this.setupTabs();
    this.updateAllTexts();
    
    document.getElementById('txStatusDoneBtn').addEventListener('click', () => {
      Utils.hideNotification();
    });
    
    this.showFooterAndRiskWarning();
  },

  setupEventListeners() {
    document.getElementById("walletBtn").addEventListener("click", () => this.handleWalletClick());
    document.getElementById("langBtn").addEventListener("click", () => this.toggleLanguage());
    
    const debouncedFromInput = Utils.debounce(() => this.handleFromAmountInput(), 300);
    document.getElementById("fromAmount").addEventListener("input", debouncedFromInput);
    
    document.getElementById("reverse").addEventListener("click", () => SwapModule.reverseTokens());
    document.getElementById("swapBtn").addEventListener("click", async () => {
      if (!account) {
        await this.handleWalletClick();
      } else {
        await SwapModule.executeSwap();
      }
    });
    
    document.querySelectorAll('.percent-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.handlePercentageClick(e));
    });
    
    document.querySelectorAll('.slippage-btn').forEach(btn => {
      btn.addEventListener('click', (e) => this.handleSlippageClick(e));
    });
    
    document.getElementById("fromTokenSelector").addEventListener("click", () => this.openTokenSelector('from'));
    document.getElementById("toTokenSelector").addEventListener("click", () => this.openTokenSelector('to'));
    
    document.getElementById("addBtn").addEventListener("click", () => this.openAddModal());
    document.getElementById("removeBtn").addEventListener("click", () => this.openRemoveModal());
    
    document.getElementById("activateBtn").addEventListener("click", () => this.handleFarmAction('activate'));
    document.getElementById("syncBtn").addEventListener("click", () => this.handleFarmAction('sync'));
    document.getElementById("claimBtn").addEventListener("click", () => this.handleFarmAction('claim'));
    document.getElementById("checkinBtn").addEventListener("click", () => this.handleFarmAction('checkin'));
    
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("modal-overlay") || 
          e.target.classList.contains("token-selector-modal") ||
          e.target.id === "farmConfirmModal") {
        e.target.style.display = "none";
      }
    });
    
    const debouncedCfxInput = Utils.debounce(() => LiquidityModule.handleCfxInput(), 300);
    const debouncedLomInput = Utils.debounce(() => LiquidityModule.handleLomInput(), 300);
    document.getElementById("addCfx").addEventListener("input", debouncedCfxInput);
    document.getElementById("addLom").addEventListener("input", debouncedLomInput);
    
    document.getElementById("cfxMaxBtn").addEventListener("click", () => LiquidityModule.setMaxCfx());
    document.getElementById("lomMaxBtn").addEventListener("click", () => LiquidityModule.setMaxLom());
    
    document.getElementById("cancelAddBtn").addEventListener("click", () => document.getElementById("addModal").style.display = "none");
    document.getElementById("confirmAddBtn").addEventListener("click", () => LiquidityModule.addLiquidity());
    
    document.getElementById("removeSlider").addEventListener("input", (e) => LiquidityModule.updateRemoveEstimate(e.target.value));
    document.querySelectorAll('.percentage-option').forEach(btn => {
      btn.addEventListener('click', (e) => this.handlePercentageOption(e));
    });
    document.getElementById("cancelRemoveBtn").addEventListener("click", () => document.getElementById("removeModal").style.display = "none");
    document.getElementById("confirmRemoveBtn").addEventListener("click", () => LiquidityModule.removeLiquidity());
  },

  showFooterAndRiskWarning() {
    const riskWarning = document.getElementById('riskWarning');
    const footer = document.getElementById('footerText');
    
    if (riskWarning) riskWarning.style.display = 'block';
    if (footer) footer.style.display = 'block';
  },

  async handleWalletClick() {
    if (account) {
      const confirmMessage = isChinese ? 
        "Á°ÆÂÆöË¶ÅÊñ≠ÂºÄÈí±ÂåÖËøûÊé•ÂêóÔºü" : 
        "Are you sure you want to disconnect wallet?";
      
      if (confirm(confirmMessage)) {
        WalletManager.disconnect();
      }
      return;
    }
    
    document.getElementById("walletBtn").disabled = true;
    
    try {
      const success = await WalletManager.connect();
      if (success) {
        WalletManager.updateUI();
        DataManager.refreshAll();
        FarmManager.refreshFarmData();
      }
    } catch (error) {
      console.error("Èí±ÂåÖËøûÊé•Â§±Ë¥•:", error);
    } finally {
      document.getElementById("walletBtn").disabled = false;
      WalletManager.updateUI();
    }
  },

  setupTabs() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;
        
        tabBtns.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(tabId + 'Tab').classList.add('active');
        
        if (account) {
          DataManager.refreshAll();
        }
        
        if (tabId === 'farm' && account) {
          setTimeout(() => FarmManager.refreshFarmData(), 500);
        }
      });
    });
  },

  handleFromAmountInput() {
    const amount = document.getElementById("fromAmount").value;
    if (amount && amount !== "0") {
      lastInputWasFrom = true;
      SwapModule.updateOutputFromInput();
    } else {
      document.getElementById("toAmount").value = "";
      DataManager.updateSwapButtonState();
      document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
    }
  },

  handlePercentageClick(e) {
    const percent = parseFloat(e.target.dataset.percent);
    
    document.querySelectorAll('.percent-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    let balance = parseFloat(document.getElementById("fromBal").textContent);
    
    if (balance > 0) {
      let amount;
      
      if (percent === 1) {
        if (fromToken === 'CFX') {
          amount = Math.max(0, balance - 0.1);
        } else {
          amount = balance * 0.9;
        }
      } else {
        amount = balance * percent;
      }
      
      if (amount > 0) {
        document.getElementById("fromAmount").value = Utils.formatDisplay(amount);
        lastInputWasFrom = true;
        SwapModule.updateOutputFromInput();
      }
    }
  },

  handleSlippageClick(e) {
    slippage = parseFloat(e.target.dataset.slip);
    document.querySelectorAll('.slippage-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    if (lastInputWasFrom && document.getElementById("fromAmount").value) {
      SwapModule.updateOutputFromInput();
    }
  },

  handlePercentageOption(e) {
    const percent = e.target.dataset.percent;
    document.querySelectorAll('.percentage-option').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    document.getElementById("removeSlider").value = percent;
    document.getElementById("removePercent").textContent = percent + "%";
    LiquidityModule.updateRemoveEstimate(percent);
  },

  openTokenSelector(type) {
    currentTokenSelector = type;
    const modal = document.getElementById("tokenSelectorModal");
    modal.style.display = "flex";
    document.getElementById("tokenSearch").value = "";
    this.populateTokenList();
  },

  async populateTokenList(searchTerm = "") {
    const tokenList = document.getElementById("tokenList");
    tokenList.innerHTML = "";
    
    const filteredTokens = TOKEN_LIST.filter(token => {
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        return token.symbol.toLowerCase().includes(term) || 
               token.name.toLowerCase().includes(term);
      }
      return true;
    });
    
    const fragment = document.createDocumentFragment();
    
    for (const token of filteredTokens) {
      if ((currentTokenSelector === 'from' && token.symbol === toToken) ||
          (currentTokenSelector === 'to' && token.symbol === fromToken)) {
        continue;
      }
      
      const tokenItem = document.createElement("div");
      tokenItem.className = "token-item";
      
      tokenItem.innerHTML = `
        <div class="token-item-logo" style="background-image: url('${token.logo}')"></div>
        <div class="token-item-info">
          <div class="token-item-symbol">${token.symbol}</div>
          <div class="token-item-name">${token.name}</div>
        </div>
        <div class="token-item-balance" id="selectorBalance-${token.symbol}">Ëé∑Âèñ‰∏≠...</div>
      `;
      
      tokenItem.addEventListener("click", () => {
        this.selectToken(token);
      });
      
      fragment.appendChild(tokenItem);
      
      setTimeout(async () => {
        try {
          const balance = await this.getTokenBalance(token.symbol);
          const balanceEl = document.getElementById(`selectorBalance-${token.symbol}`);
          if (balanceEl) {
            balanceEl.textContent = Utils.formatDisplay(balance);
          }
        } catch (error) {
          console.error(`Ëé∑Âèñ ${token.symbol} ‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
          const balanceEl = document.getElementById(`selectorBalance-${token.symbol}`);
          if (balanceEl) {
            balanceEl.textContent = "0.000000";
          }
        }
      }, 0);
    }
    
    tokenList.appendChild(fragment);
    
    const searchInput = document.getElementById("tokenSearch");
    searchInput.addEventListener('input', Utils.debounce((e) => {
      this.populateTokenList(e.target.value);
    }, 300));
    
    setTimeout(() => searchInput.focus(), 100);
  },

  async getTokenBalance(symbol) {
    if (!account) return 0;
    
    const token = TokenUtils.getToken(symbol);
    if (!token) return 0;
    
    try {
      if (symbol === 'CFX') {
        const balance = await provider.getBalance(account);
        return parseFloat(ethers.utils.formatEther(balance));
      } else {
        const contract = TokenUtils.getTokenContract(symbol);
        if (!contract) return 0;
        
        const balance = await contract.balanceOf(account);
        return parseFloat(ethers.utils.formatUnits(balance, token.decimals));
      }
    } catch (error) {
      console.error(`Ëé∑Âèñ ${symbol} ‰ΩôÈ¢ùÂ§±Ë¥•:`, error);
      return 0;
    }
  },

  selectToken(token) {
    if (currentTokenSelector === 'from') {
      fromToken = token.symbol;
      document.getElementById("fromTokenSymbol").textContent = token.symbol;
      document.getElementById("fromTokenLogo").style.backgroundImage = `url('${token.logo}')`;
    } else if (currentTokenSelector === 'to') {
      toToken = token.symbol;
      document.getElementById("toTokenSymbol").textContent = token.symbol;
      document.getElementById("toTokenLogo").style.backgroundImage = `url('${token.logo}')`;
    }
    
    document.getElementById("tokenSelectorModal").style.display = "none";
    
    DataManager.updateAllBalances();
    
    document.getElementById("fromAmount").value = "";
    document.getElementById("toAmount").value = "";
    
    DataManager.updateSwapButtonState();
    document.getElementById("price").textContent = `1 ${fromToken} = 0.000000 ${toToken}`;
    document.getElementById("minReceived").textContent = `0.000000 ${toToken}`;
  },

  toggleLanguage() {
    isChinese = !isChinese;
    document.getElementById("langBtn").innerText = isChinese ? "EN" : "ZN";
    this.updateAllTexts();
  },

  updateAllTexts() {
    const walletBtn = document.getElementById("walletBtn");
    if (account) {
      const displayAddress = Utils.formatAddress(account);
      walletBtn.textContent = displayAddress;
      walletBtn.classList.add('connected');
    } else {
      walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      walletBtn.classList.remove('connected');
    }
    
    document.querySelector('[data-tab="swap"]').textContent = isChinese ? "ÂÖëÊç¢" : "Swap";
    document.querySelector('[data-tab="liquidity"]').textContent = isChinese ? "ÊµÅÂä®ÊÄß" : "Liquidity";
    document.querySelector('[data-tab="farm"]').textContent = isChinese ? "LPÊåñÁüø" : "LP Farm";
    
    document.getElementById('farmTitle').textContent = isChinese ? "LPÊåñÁüøÂÜúÂú∫" : "LP Mining Farm";
    
    const swapBtn = document.getElementById("swapBtn");
    if (!account) {
      swapBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
      swapBtn.disabled = false;
    } else if (document.getElementById("fromAmount").value && document.getElementById("fromAmount").value !== "0") {
      swapBtn.textContent = isChinese ? "Á´ãÂç≥ÂÖëÊç¢" : "Swap Now";
      swapBtn.disabled = false;
    } else {
      swapBtn.textContent = isChinese ? "ËØ∑ËæìÂÖ•Êï∞Èáè" : "Enter Amount";
      swapBtn.disabled = true;
    }
    
    document.getElementById("addBtn").textContent = isChinese ? "Ê∑ªÂä†ÊµÅÂä®ÊÄß" : "Add Liquidity";
    document.getElementById("removeBtn").textContent = isChinese ? "ÁßªÈô§ÊµÅÂä®ÊÄß" : "Remove Liquidity";
    
    document.getElementById("tokenSelectorTitle").textContent = isChinese ? "ÈÄâÊã©‰ª£Â∏Å" : "Select Token";
    document.getElementById("addTitle").textContent = isChinese ? "Ê∑ªÂä†ÊµÅÂä®ÊÄß" : "Add Liquidity";
    document.getElementById("removeTitle").textContent = isChinese ? "ÁßªÈô§ÊµÅÂä®ÊÄß" : "Remove Liquidity";
    document.getElementById("confirmAddBtn").textContent = isChinese ? "Á°ÆËÆ§Ê∑ªÂä†" : "Confirm Add";
    document.getElementById("confirmRemoveBtn").textContent = isChinese ? "Á°ÆËÆ§ÁßªÈô§" : "Confirm Remove";
    document.getElementById("cancelAddBtn").textContent = isChinese ? "ÂèñÊ∂à" : "Cancel";
    document.getElementById("cancelRemoveBtn").textContent = isChinese ? "ÂèñÊ∂à" : "Cancel";
    
    document.getElementById('activateBtnText').textContent = isChinese ? 'ÊøÄÊ¥ªË¥¶Êà∑' : 'Activate Account';
    document.getElementById('syncBtnText').textContent = isChinese ? 'ÂêåÊ≠•Â•ñÂä±' : 'Sync Rewards';
    document.getElementById('claimBtnText').textContent = isChinese ? 'È¢ÜÂèñÂ•ñÂä±' : 'Claim Rewards';
    document.getElementById('checkinBtnText').textContent = isChinese ? 'ÊØèÊó•Á≠æÂà∞' : 'Daily Check-in';
    
    document.getElementById("riskTitle").textContent = isChinese ? "È£éÈô©ÊèêÁ§∫" : "Risk Warning";
    document.getElementById("riskText").textContent = isChinese ? 
      "Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ" :
      "This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.";
    
    document.getElementById("footerText").textContent = isChinese ? "LOMswap ¬∑ Conflux eSpace" : "LOMswap ¬∑ Conflux eSpace";
  },

  openAddModal() {
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    document.getElementById("addModal").style.display = "flex";
    document.getElementById("addCfx").value = "";
    document.getElementById("addLom").value = "";
    document.getElementById("confirmAddBtn").disabled = true;
    
    if (currentRatio > 0) {
      const ratioFormatted = Utils.formatDisplay(currentRatio);
      document.getElementById("addRatio").textContent = `1 CFX = ${ratioFormatted} LOM`;
    }
  },

  openRemoveModal() {
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    document.getElementById("removeModal").style.display = "flex";
    LiquidityModule.updateRemoveEstimate(100);
  },

  async handleFarmAction(action) {
    const btn = document.getElementById(action + 'Btn');
    if (btn.disabled) {
      return;
    }
    
    if (!account) {
      Utils.showError(isChinese ? "ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ" : "Please connect wallet first");
      return;
    }
    
    switch (action) {
      case 'activate':
        await FarmManager.activateAccount();
        break;
      case 'sync':
        await FarmManager.syncRewards();
        break;
      case 'claim':
        await FarmManager.claimRewards();
        break;
      case 'checkin':
        await FarmManager.dailyCheckIn();
        break;
    }
  }
};

// ==================== ÂàùÂßãÂåñÂ∫îÁî® ====================
document.addEventListener('DOMContentLoaded', function() {
  UIManager.init();
  
  if (window.ethereum) {
    window.ethereum.on('accountsChanged', (accounts) => {
      if (accounts.length === 0) {
        WalletManager.disconnect();
      } else {
        account = accounts[0];
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        WalletManager.initContracts();
        WalletManager.updateUI();
        DataManager.refreshAll();
        FarmManager.refreshFarmData();
        if (!refreshInterval) {
          refreshInterval = setInterval(() => DataManager.refreshAll(), 10000);
        }
        if (!farmRefreshInterval) {
          farmRefreshInterval = setInterval(() => FarmManager.refreshFarmData(), 15000);
        }
      }
    });
    
    window.ethereum.on('chainChanged', () => {
      location.reload();
    });
    
    window.ethereum.on('disconnect', () => {
      WalletManager.disconnect();
    });
  }
});
  </script>
</body>
      </html>
