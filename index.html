<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap - Conflux å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€</title>
  
  <!-- æ”¶è—å›¾æ ‡å’Œç¤¾äº¤åª’ä½“æ ‡ç­¾ -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <!-- Open Graph æ ‡ç­¾ï¼Œç”¨äºç¤¾äº¤åª’ä½“åˆ†äº« -->
  <meta property="og:title" content="LOMswap - Conflux å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€">
  <meta property="og:description" content="åœ¨ Conflux eSpace ä¸Šäº¤æ˜“ LOM ä»£å¸">
  <meta property="og:image" content="https://i.imgur.com/HddyTrv.jpeg">
  <meta property="og:url" content="https://lom-dex.com">
  <meta name="twitter:card" content="summary_large_image">
  
  <!-- å®‰å…¨ç­–ç•¥ (ä¼˜åŒ–ç‰ˆæœ¬) -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self' https:;
                 script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https://i.imgur.com data:;
                 connect-src 'self' https://*.confluxrpc.com wss: blob:;
                 font-src 'self' data:;
                 frame-src 'none';
                 object-src 'none';">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== åŸºç¡€æ ·å¼ ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --accent-orange: #ff6b35;
      --accent-teal: #00b4d8;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-orange: linear-gradient(135deg, #ff6b35, #ff9e6d);
      --gradient-teal: linear-gradient(135deg, #00b4d8, #48cae4);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 520px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== å¤´éƒ¨æ ·å¼ä¼˜åŒ– ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
      position: relative;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-container:hover {
      transform: translateY(-2px);
    }
    
    .logo-img {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .wallet-section {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-shrink: 0;
      width: auto;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
      max-width: 220px;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 0;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
     #walletBtn {
      min-width: 110px !important;
      max-width: 110px !important;
      width: 110px !important;
   }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      max-width: 40px;
      max-height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ========== æ ‡ç­¾é¡µæ ·å¼ ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== è´¨æŠ¼å†œåœºé¡µé¢æ ·å¼ ========== */
    #stakingTab {
      min-height: 600px;
    }
    
    .staking-container {
      padding: 2px 0;
    }
    
    /* è´¨æŠ¼æ¦‚è§ˆå¡ç‰‡ */
    .staking-overview-card {
      background: var(--gradient-card);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .staking-overview-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .staking-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .staking-title {
      font-size: 22px;
      font-weight: 800;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .staking-icon {
      font-size: 28px;
    }
    
    .apr-badge {
      background: var(--gradient-orange);
      color: #0f172a;
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    .staking-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      border-color: var(--accent-yellow);
      box-shadow: 0 8px 16px rgba(255, 215, 0, 0.1);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .stat-icon {
      color: var(--accent-yellow);
      font-size: 14px;
    }
    
    .stat-value {
      font-size: 22px;
      font-weight: 800;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .stat-value.large {
      font-size: 28px;
    }
    
    .stat-value.green {
      color: var(--accent-green);
    }
    
    .stat-value.yellow {
      color: var(--accent-yellow);
    }
    
    .stat-value.teal {
      color: var(--accent-teal);
    }
    
    .stat-value.orange {
      color: var(--accent-orange);
    }
    
    .stat-unit {
      font-size: 12px;
      color: var(--text-secondary);
      margin-left: 4px;
      font-weight: normal;
    }
    
    .time-multiplier-bar {
      margin: 20px 0;
    }
    
    .multiplier-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .multiplier-text {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .multiplier-value {
      font-size: 16px;
      font-weight: 800;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .multiplier-progress {
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    
    .multiplier-progress-fill {
      height: 100%;
      background: var(--gradient-yellow);
      border-radius: 5px;
      transition: width 1s ease-in-out;
      position: relative;
    }
    
    .multiplier-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.3) 50%, 
        transparent 100%);
      animation: shimmer 2s infinite;
    }
    
    .multiplier-stages {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 10px;
      color: var(--text-secondary);
    }
    
    .stage {
      text-align: center;
      position: relative;
      flex: 1;
    }
    
    .stage.active {
      color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .stage::before {
      content: '';
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-secondary);
    }
    
    .stage.active::before {
      background: var(--accent-yellow);
      box-shadow: 0 0 8px var(--accent-yellow);
    }
    
    /* è´¨æŠ¼æ“ä½œå¡ç‰‡ */
    .staking-action-card {
      background: var(--gradient-card);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .action-section {
      margin-bottom: 24px;
    }
    
    .action-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .action-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    .lp-balance-display {
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .lp-balance-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .lp-balance-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--accent-yellow);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .lp-balance-unit {
      font-size: 14px;
      color: var(--text-secondary);
      margin-left: 4px;
    }
    
    .activation-requirements {
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .requirements-icon {
      color: var(--primary-blue);
      margin-right: 6px;
    }
    
    .amount-input-group {
      margin-bottom: 16px;
    }
    
    .input-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .label-text {
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .balance-text {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      cursor: pointer;
      font-weight: 600;
    }
    
    .balance-amount:hover {
      text-decoration: underline;
    }
    
    .amount-input-wrapper {
      display: flex;
      align-items: center;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 0 16px;
      transition: all 0.3s ease;
    }
    
    .amount-input-wrapper.focused {
      border-color: var(--accent-yellow);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1);
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      padding: 16px 0;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }
    
    .max-btn {
      background: var(--gradient-yellow);
      color: #0f172a;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-left: 8px;
      white-space: nowrap;
    }
    
    .max-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
    }
    
    .percentage-buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-end;
    }
    
    .percentage-btn {
      flex: 1;
      max-width: 60px;
      padding: 8px 12px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    
    .percentage-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percentage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
    }
    
    /* é‚€è¯·ç³»ç»Ÿ */
    .invite-system {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(138, 43, 226, 0.1));
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .invite-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .invite-icon {
      color: var(--accent-yellow);
      font-size: 24px;
    }
    
    .invite-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .invite-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 16px;
      line-height: 1.5;
    }
    
    .invite-input-container {
      position: relative;
      margin-bottom: 12px;
    }
    
    .invite-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 215, 0, 0.05);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .invite-input:focus {
      border-color: var(--accent-yellow);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
    }
    
    .invite-input::placeholder {
      color: var(--text-muted);
    }
    
    .invite-input-error {
      border-color: var(--accent-red) !important;
      background: rgba(255, 71, 87, 0.05) !important;
    }
    
    .invite-error-text {
      color: var(--accent-red);
      font-size: 12px;
      margin-top: 8px;
      display: none;
    }
    
    .invite-error-text.show {
      display: block;
    }
    
    .invite-locked {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--success);
      margin-top: 16px;
      animation: fadeIn 0.5s ease;
    }
    
    .invite-locked-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .invite-locked-text {
      font-size: 16px;
      color: var(--success);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .locked-icon {
      font-size: 20px;
    }
    
    .invite-address-container {
      background: rgba(46, 160, 67, 0.15);
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      border: 1px solid rgba(46, 160, 67, 0.3);
    }
    
    .invite-address-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .invite-address {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 600;
      word-break: break-all;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      margin-top: 8px;
    }
    
    .invite-benefits {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .benefit-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-yellow);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .benefit-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .benefit-item {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.5;
    }
    
    .benefit-item:last-child {
      margin-bottom: 0;
    }
    
    .benefit-icon {
      color: var(--accent-yellow);
      font-size: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    /* æ“ä½œæŒ‰é’®ç»„ */
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .action-button {
      flex: 1;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 56px;
    }
    
    .action-button.primary {
      background: var(--gradient-yellow);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    .action-button.secondary {
      background: rgba(255, 215, 0, 0.1);
      color: var(--accent-yellow);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .action-button.claim {
      background: var(--gradient-green);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(46, 160, 67, 0.3);
    }
    
    .action-button.referral {
      background: var(--gradient-teal);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(0, 180, 216, 0.3);
    }
    
    .action-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    }
    
    .action-button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    /* æƒ©ç½šè­¦å‘Š */
    .penalty-warning {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 12px;
      padding: 16px;
      margin: 20px 0;
      animation: pulse 2s infinite;
    }
    
    .penalty-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .penalty-icon {
      color: var(--accent-red);
      font-size: 20px;
    }
    
    .penalty-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-red);
    }
    
    .penalty-content {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    /* å¥–åŠ±è¯¦æƒ…å¡ç‰‡ */
    .rewards-detail-card {
      background: var(--gradient-card);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .rewards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .reward-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .reward-item:hover {
      transform: translateY(-2px);
      border-color: var(--accent-yellow);
      box-shadow: 0 8px 16px rgba(255, 215, 0, 0.1);
    }
    
    .reward-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .reward-value {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .reward-value.green {
      color: var(--accent-green);
    }
    
    .reward-value.yellow {
      color: var(--accent-yellow);
    }
    
    .cooldown-timer {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 1px solid rgba(26, 115, 232, 0.3);
      margin: 20px 0;
    }
    
    .cooldown-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .cooldown-value {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary-blue);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    /* å¡ç‰‡æ ·å¼ */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title-icon {
      color: var(--accent-yellow);
      font-size: 20px;
    }
    
    /* é£é™©æç¤ºå’Œé¡µè„š */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 11px;
      color: var(--text-primary);
      line-height: 1.5;
      position: relative;
      overflow: hidden;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 12px;
      opacity: 0.7;
    }
    
    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      width: 90%;
      max-width: 420px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 20px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .modal-input-group {
      margin-bottom: 16px;
    }
    
    .modal-input-label {
      display: block;
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .modal-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(26, 115, 232, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .modal-input:focus {
      border-color: var(--accent-yellow);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .modal-btn.confirm:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.3);
    }
    
    .modal-btn.cancel:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* åŠ¨ç”»æ•ˆæœ */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    .loading-spinner.small {
      width: 20px;
      height: 20px;
      border-width: 2px;
    }
    
    .loading-spinner.white {
      border-color: rgba(255, 255, 255, 0.3);
      border-top-color: white;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 480px) {
      .app {
        max-width: 100%;
        padding: 0;
      }
      
      .staking-stats-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .rewards-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .modal-card {
        padding: 20px;
      }
      
      .staking-overview-card,
      .staking-action-card,
      .rewards-detail-card {
        padding: 20px;
        margin: 10px;
      }
    }
    
    @media (max-width: 380px) {
      .logo-text {
        font-size: 16px;
      }
      
      .logo-img {
        width: 36px;
        height: 36px;
      }
      
      .header-buttons {
        min-width: 130px;
        max-width: 150px;
      }
      
      #walletBtn {
        min-width: 100px;
        max-width: 120px;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      #langBtn {
        width: 32px;
        height: 32px;
      }
      
      .staking-title {
        font-size: 18px;
      }
      
      .apr-badge {
        font-size: 14px;
        padding: 6px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <div class="logo-container">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">è¿æ¥é’±åŒ…</button>
      </div>
    </div>

    <!-- æ ‡ç­¾é¡µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">å…‘æ¢</button>
        <button class="tab-btn" data-tab="liquidity">æµåŠ¨æ€§</button>
        <button class="tab-btn" data-tab="staking">è´¨æŠ¼å†œåœº</button>
      </div>
    </div>

    <!-- å…‘æ¢é¡µé¢ -->
    <div class="tab-content active" id="swapTab">
      <!-- ç°æœ‰çš„å…‘æ¢é¡µé¢å†…å®¹ä¿æŒä¸å˜ -->
      <div class="card">
        <div class="swap-container">
          <!-- è¾“å…¥ä»£å¸ -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- äº¤æ¢ç®­å¤´ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">ğŸ”ƒ</button>
          </div>

          <!-- è¾“å‡ºä»£å¸ -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ä½™é¢: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">â–¼</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- é”™è¯¯æç¤ºæ¡† -->
          <div class="error-box" id="swapErrorBox">
            <span class="error-icon">âš ï¸</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- äº¤æ˜“è¯¦æƒ… -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">æ»‘ç‚¹å®¹å·®</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
                <button class="slippage-btn" data-slip="10">10%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">æœ€ä½æ”¶åˆ°</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">è·¯ç”±</span>
              <span class="detail-value" id="routeInfo">CFX â†’ LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ä»·æ ¼å½±å“</span>
              <span class="detail-value positive" id="priceImpact">< 0.01%</span>
            </div>
          </div>

          <!-- äº¤æ˜“æŒ‰é’® -->
          <button class="main-action-btn" id="swapBtn">è¿æ¥é’±åŒ…</button>
        </div>
      </div>
    </div>
    
    <!-- æµåŠ¨æ€§é¡µé¢ -->
    <div class="tab-content" id="liquidityTab">
      <!-- ç°æœ‰çš„æµåŠ¨æ€§é¡µé¢å†…å®¹ä¿æŒä¸å˜ -->
      <div class="card">
        <div class="card-title">
          <span class="card-title-icon">ğŸ’§</span>
          <span id="poolInfoTitle">CFX-LOM æ± </span>
        </div>

        <div class="liquidity-summary">
          <!-- æ± å­ç»Ÿè®¡ä¿¡æ¯ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small" id="cfxReserveLabel">CFX å‚¨å¤‡</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small" id="lomReserveLabel">LOM å‚¨å¤‡</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- æˆ‘çš„æµåŠ¨æ± è¯¦æƒ… -->
          <div class="user-position" style="background: var(--gradient-card); border-radius: 12px; padding: 16px; margin-top: 16px; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);" id="myPositionTitle">æˆ‘çš„æµåŠ¨æ± </div>
              <div style="font-size: 12px; color: var(--text-secondary);" id="positionValue">$0.00</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myCfxLabel">æˆ‘çš„CFX</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userCfx">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLomLabel">æˆ‘çš„LOM</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--accent-yellow);" id="userLom">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myLpLabel">æˆ‘çš„LPä»£å¸</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--text-primary);" id="userLp">0</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;" id="myShareLabel">æ± å­ä»½é¢</div>
                <div style="font-size: 16px; font-weight: 700; color: var(--success);" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">æ·»åŠ æµåŠ¨æ€§</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ç§»é™¤æµåŠ¨æ€§</button>
          </div>
        </div>
        
        <!-- è´¨æŠ¼å…¥å£ -->
        <div class="stake-card" style="margin-top: 20px; cursor: pointer;" onclick="switchToStakingTab()">
          <div class="stake-title">è´¨æŠ¼LPèµšå–é«˜æ”¶ç›Š</div>
          <div class="stake-description">
            å°†æ‚¨çš„LPä»£å¸è´¨æŠ¼åˆ°å†œåœºä¸­ï¼Œèµšå–é¢å¤–çš„LOMå¥–åŠ±ã€‚å¹´åŒ–æ”¶ç›Šç‡é«˜è¾¾ï¼š
          </div>
          <div class="stake-apr">45.8% APY</div>
          <div style="font-size: 14px; color: var(--accent-yellow); margin-top: 12px;">
            ğŸš€ ç‚¹å‡»è¿›å…¥è´¨æŠ¼å†œåœº â†’
          </div>
        </div>
      </div>
    </div>

    <!-- è´¨æŠ¼å†œåœºé¡µé¢ -->
    <div class="tab-content" id="stakingTab">
      <div class="staking-container">
        <!-- è´¨æŠ¼æ¦‚è§ˆå¡ç‰‡ -->
        <div class="staking-overview-card">
          <div class="staking-header">
            <div class="staking-title">
              <span class="staking-icon">ğŸ†</span>
              <span id="stakingTitle">LPè´¨æŠ¼å†œåœº</span>
            </div>
            <div class="apr-badge" id="aprBadge">APR: 45.8%</div>
          </div>
          
          <div class="staking-stats-grid">
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ’°</span>
                <span id="totalStakedLabel">æ€»è´¨æŠ¼é‡</span>
              </div>
              <div class="stat-value large yellow" id="totalStaked">0</div>
              <div class="stat-unit">LP</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ¯</span>
                <span id="myStakeLabel">æˆ‘çš„è´¨æŠ¼</span>
              </div>
              <div class="stat-value large teal" id="myStake">0</div>
              <div class="stat-unit">LP</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ“ˆ</span>
                <span id="pendingRewardLabel">å¾…é¢†å–</span>
              </div>
              <div class="stat-value large green" id="pendingReward">0</div>
              <div class="stat-unit">LOM</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-label">
                <span class="stat-icon">ğŸ‘¥</span>
                <span id="referralRewardLabel">é‚€è¯·å¥–åŠ±</span>
              </div>
              <div class="stat-value large orange" id="referralReward">0</div>
              <div class="stat-unit">LOM</div>
            </div>
          </div>
          
          <!-- æ—¶é—´å€ç‡è¿›åº¦æ¡ -->
          <div class="time-multiplier-bar">
            <div class="multiplier-label">
              <div class="multiplier-text">
                <span>â±ï¸</span>
                <span id="multiplierLabel">æ—¶é—´å€ç‡:</span>
              </div>
              <div class="multiplier-value" id="multiplierValue">1.0x</div>
            </div>
            <div class="multiplier-progress">
              <div class="multiplier-progress-fill" id="multiplierProgress" style="width: 0%"></div>
            </div>
            <div class="multiplier-stages">
              <div class="stage" id="stage30">30å¤©</div>
              <div class="stage" id="stage90">90å¤©</div>
              <div class="stage" id="stage180">180å¤©</div>
              <div class="stage" id="stage360">360å¤©</div>
            </div>
          </div>
        </div>

        <!-- è´¨æŠ¼æ“ä½œå¡ç‰‡ -->
        <div class="staking-action-card">
          <div class="action-section">
            <div class="action-title">
              <span class="action-icon">ğŸš€</span>
              <span id="activateTitle">æ¿€æ´»è´¨æŠ¼</span>
            </div>
            
            <div class="lp-balance-display">
              <div class="lp-balance-label" id="lpBalanceLabel">æ‚¨çš„LPä»£å¸ä½™é¢</div>
              <div>
                <span class="lp-balance-value" id="lpBalance">0.000000</span>
                <span class="lp-balance-unit">LP</span>
              </div>
            </div>
            
            <div class="activation-requirements">
              <span class="requirements-icon">âš¡</span>
              <span id="activationRequirements">æœ€ä½æ¿€æ´»è¦æ±‚: 100 LP ä»£å¸</span>
            </div>
            
            <div class="amount-input-group" id="activationInputGroup">
              <div class="input-label">
                <div class="label-text">
                  <span>ğŸ“Š</span>
                  <span id="stakeAmountLabel">è´¨æŠ¼æ•°é‡</span>
                </div>
                <div class="balance-text">
                  <span id="stakeBalanceText">ä½™é¢:</span>
                  <span class="balance-amount" id="stakeBalance" onclick="setMaxStake()">0</span>
                  <span>LP</span>
                </div>
              </div>
              
              <div class="amount-input-wrapper" id="stakeAmountWrapper">
                <input type="number" class="amount-input" id="stakeAmount" placeholder="0" min="0" step="any">
                <button class="max-btn" id="maxStakeBtn" onclick="setMaxStake()">MAX</button>
              </div>
              
              <div class="percentage-buttons">
                <button class="percentage-btn" data-percent="0.25" onclick="setStakePercentage(0.25)">25%</button>
                <button class="percentage-btn" data-percent="0.5" onclick="setStakePercentage(0.5)">50%</button>
                <button class="percentage-btn" data-percent="0.75" onclick="setStakePercentage(0.75)">75%</button>
                <button class="percentage-btn active" data-percent="1" onclick="setStakePercentage(1)">MAX</button>
              </div>
            </div>
            
            <!-- é‚€è¯·ç³»ç»Ÿ -->
            <div class="invite-system" id="inviteSystem">
              <div class="invite-header">
                <span class="invite-icon">ğŸ‘¥</span>
                <span class="invite-title" id="inviteTitle">é‚€è¯·ç³»ç»Ÿ (å¯é€‰)</span>
              </div>
              
              <div class="invite-subtitle" id="inviteSubtitle">
                ç»‘å®šé‚€è¯·äººåœ°å€å¯è·å¾—é¢å¤–5%å¥–åŠ±åˆ†æˆã€‚é‚€è¯·äººå¯è·å¾—æ‚¨æ”¶ç›Šçš„5%ä½œä¸ºå¥–åŠ±ã€‚
              </div>
              
              <div class="invite-input-container">
                <input type="text" class="invite-input" id="inviteAddress" 
                       placeholder="è¯·è¾“å…¥é‚€è¯·äººé’±åŒ…åœ°å€ (0xå¼€å¤´)" 
                       pattern="^0x[a-fA-F0-9]{40}$">
                <div class="invite-error-text" id="inviteErrorText">
                  è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)
                </div>
              </div>
              
              <div class="invite-benefits">
                <div class="benefit-title">
                  <span>ğŸ</span>
                  <span>é‚€è¯·å¥–åŠ±å¥½å¤„</span>
                </div>
                <ul class="benefit-list">
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>é‚€è¯·äººè·å¾—æ‚¨æ”¶ç›Šçš„5%ä½œä¸ºå¥–åŠ±</span>
                  </li>
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>è¢«é‚€è¯·äººæ— ä»»ä½•æŸå¤±</span>
                  </li>
                  <li class="benefit-item">
                    <span class="benefit-icon">âœ“</span>
                    <span>å¥–åŠ±é”å®š30å¤©åå¯é¢†å–</span>
                  </li>
                </ul>
              </div>
            </div>
            
            <!-- å·²æ¿€æ´»çŠ¶æ€ -->
            <div class="invite-locked" id="activatedSection" style="display:none">
              <div class="invite-locked-header">
                <div class="invite-locked-text">
                  <span class="locked-icon">âœ…</span>
                  <span id="activatedTitle">è´¨æŠ¼å·²æ¿€æ´»</span>
                </div>
              </div>
              
              <div class="invite-address-container">
                <div class="invite-address-label">
                  <span>â°</span>
                  <span>æ¿€æ´»æ—¶é—´:</span>
                </div>
                <div class="invite-address" id="activationTime">--</div>
              </div>
              
              <div class="invite-address-container" id="referrerContainer" style="display:none">
                <div class="invite-address-label">
                  <span>ğŸ‘¤</span>
                  <span>é‚€è¯·äºº:</span>
                </div>
                <div class="invite-address" id="referrerAddress">--</div>
              </div>
            </div>
            
            <div class="action-buttons">
              <button class="action-button primary" id="activateBtn" onclick="activateStaking()">
                <span>ğŸš€</span>
                <span id="activateBtnText">æ¿€æ´»è´¨æŠ¼</span>
              </button>
            </div>
          </div>
        </div>

        <!-- å¥–åŠ±è¯¦æƒ…å¡ç‰‡ -->
        <div class="rewards-detail-card">
          <div class="action-title">
            <span class="action-icon">ğŸ†</span>
            <span id="rewardsTitle">å¥–åŠ±ç®¡ç†</span>
          </div>
          
          <div class="rewards-grid">
            <div class="reward-item">
              <div class="reward-label">
                <span>ğŸ’°</span>
                <span>å¾…é¢†å–å¥–åŠ±</span>
              </div>
              <div class="reward-value green" id="pendingRewardDetail">0</div>
              <div class="stat-unit">LOM</div>
            </div>
            
            <div class="reward-item">
              <div class="reward-label">
                <span>ğŸ‘¥</span>
                <span>é‚€è¯·å¥–åŠ±</span>
              </div>
              <div class="reward-value orange" id="pendingReferralDetail">0</div>
              <div class="stat-unit">LOM</div>
            </div>
            
            <div class="reward-item">
              <div class="reward-label">
                <span>â°</span>
                <span>ä¸‹æ¬¡å¯é¢†å–</span>
              </div>
              <div class="reward-value teal" id="nextClaimTime">--</div>
            </div>
            
            <div class="reward-item">
              <div class="reward-label">
                <span>ğŸ“…</span>
                <span>æ¿€æ´»æ—¶é•¿</span>
              </div>
              <div class="reward-value yellow" id="activeDuration">0å¤©</div>
            </div>
          </div>
          
          <!-- æƒ©ç½šè­¦å‘Š -->
          <div class="penalty-warning" id="penaltyWarning">
            <div class="penalty-header">
              <span class="penalty-icon">âš ï¸</span>
              <span class="penalty-title" id="penaltyTitle">å‡æŒæƒ©ç½šè­¦å‘Š</span>
            </div>
            <div class="penalty-content" id="penaltyContent">
              æ¿€æ´»åå‡æŒLPå°†é¢ä¸´50%çš„å¥–åŠ±æƒ©ç½šï¼30å¤©å†…å‡æŒå°†å¤±å»é‚€è¯·å¥–åŠ±èµ„æ ¼ã€‚
              7å¤©å†…æœ€å¤šå‡æŒ30%ï¼Œä¸”éœ€è¦1å¤©å†·å´æ—¶é—´ã€‚
            </div>
          </div>
          
          <!-- å†·å´æ—¶é—´æ˜¾ç¤º -->
          <div class="cooldown-timer" id="cooldownTimer" style="display:none">
            <div class="cooldown-label">
              <span>â³</span>
              <span id="cooldownLabel">å‡æŒå†·å´æ—¶é—´</span>
            </div>
            <div class="cooldown-value" id="cooldownValue">00:00:00</div>
          </div>
          
          <div class="action-buttons">
            <button class="action-button claim" id="claimBtn" onclick="claimRewards()" disabled>
              <span>ğŸ’°</span>
              <span id="claimBtnText">é¢†å–å¥–åŠ±</span>
            </button>
            <button class="action-button referral" id="claimReferralBtn" onclick="claimReferralRewards()" disabled>
              <span>ğŸ‘¥</span>
              <span id="claimReferralBtnText">é¢†å–é‚€è¯·å¥–åŠ±</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- é£é™©æç¤º -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>âš ï¸</span>
        <span id="riskTitle">é£é™©æç¤º</span>
      </div>
      <div id="riskText">
        æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚
      </div>
    </div>

    <!-- é¡µè„š -->
    <div class="footer" id="footerText">LOMswap Â· Conflux eSpace</div>
  </div>

  <!-- ç¡®è®¤æ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal-card">
      <h3 class="modal-title" id="confirmTitle">ç¡®è®¤æ“ä½œ</h3>
      <div class="modal-content" id="confirmContent">
        <!-- å†…å®¹åŠ¨æ€å¡«å…… -->
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="confirmCancelBtn">å–æ¶ˆ</button>
        <button class="modal-btn confirm" id="confirmActionBtn">ç¡®è®¤</button>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // ==================== é…ç½® ====================
    const CONFIG = {
      REWARD_CONTRACT: "0x233f9C12514A29d860e482eB29f1EE1f8fcC59aa",
      LP_TOKEN: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85", // CFX-LOM LPä»£å¸
      REWARD_TOKEN: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3", // LOMä»£å¸
      ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
      CHAIN_ID: 1030
    };

    // ==================== åˆçº¦ABI ====================
    const REWARD_ABI = [
      "function activate(address referrer)",
      "function claimAll()",
      "function claimReferral()",
      "function lpToken() view returns (address)",
      "function rewardToken() view returns (address)",
      "function minActivation() view returns (uint256)",
      "function totalShares() view returns (uint256)",
      "function accRewardPerShare() view returns (uint256)",
      "function lastRewardTime() view returns (uint256)",
      "function rewardPerSecond() view returns (uint256)",
      "function users(address) view returns (uint256 shares, uint256 rewardDebt, uint256 pendingReferral, uint256 lastClaimTime, uint256 activeTime, uint256 lastReduceTime, uint256 referralUnlockTime, address referrer, bool cleanInFirst30Days)",
      "function pendingReward(address user) view returns (uint256)",
      "function blacklist(address) view returns (bool)",
      "function paused() view returns (bool)"
    ];

    const ERC20_ABI = [
      "function approve(address spender, uint256 amount) returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)",
      "function balanceOf(address owner) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function totalSupply() view returns (uint256)"
    ];

    const PAIR_ABI = [
      "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address owner) view returns (uint256)",
      "function token0() view returns (address)",
      "function token1() view returns (address)"
    ];

    // ==================== å…¨å±€å˜é‡ ====================
    let provider, signer, account;
    let rewardContract, lpTokenContract, rewardTokenContract, pairContract;
    let isChinese = true;
    let refreshInterval;
    let cooldownInterval;
    let userStakingData = null;

    // ==================== å·¥å…·å‡½æ•° ====================
    class Utils {
      static formatNumber(num, decimals = 6) {
        if (!num && num !== 0) return '0.000000';
        const n = parseFloat(num);
        if (isNaN(n)) return '0.000000';
        
        const factor = Math.pow(10, decimals);
        const truncated = Math.floor(n * factor) / factor;
        
        const parts = truncated.toString().split('.');
        let integerPart = parts[0];
        let decimalPart = parts[1] || '';
        
        if (decimalPart.length < decimals) {
          decimalPart = decimalPart.padEnd(decimals, '0');
        } else if (decimalPart.length > decimals) {
          decimalPart = decimalPart.substring(0, decimals);
        }
        
        const result = integerPart + '.' + decimalPart;
        return this.removeTrailingZeros(result);
      }

      static removeTrailingZeros(str) {
        if (!str.includes('.')) return str;
        let result = str.replace(/0+$/, '');
        if (result.endsWith('.')) result = result.slice(0, -1);
        return result;
      }

      static formatAddress(address) {
        if (!address) return '';
        return address.slice(0, 6) + '...' + address.slice(-4);
      }

      static isValidAddress(address) {
        return /^0x[a-fA-F0-9]{40}$/.test(address);
      }

      static formatTime(seconds) {
        if (!seconds) return '--';
        const date = new Date(seconds * 1000);
        return date.toLocaleString('zh-CN');
      }

      static formatDuration(seconds) {
        if (!seconds) return '0å¤©';
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        
        if (days > 0) {
          return `${days}å¤©${hours > 0 ? ` ${hours}å°æ—¶` : ''}`;
        } else if (hours > 0) {
          return `${hours}å°æ—¶`;
        } else {
          const minutes = Math.floor((seconds % 3600) / 60);
          return `${minutes}åˆ†é’Ÿ`;
        }
      }

      static formatCountdown(seconds) {
        if (!seconds || seconds <= 0) return '00:00:00';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }

      static async showConfirm(title, content) {
        return new Promise((resolve) => {
          const modal = document.getElementById('confirmModal');
          const titleEl = document.getElementById('confirmTitle');
          const contentEl = document.getElementById('confirmContent');
          const cancelBtn = document.getElementById('confirmCancelBtn');
          const actionBtn = document.getElementById('confirmActionBtn');
          
          titleEl.textContent = title;
          contentEl.innerHTML = content;
          
          modal.style.display = 'flex';
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            actionBtn.removeEventListener('click', onAction);
            modal.style.display = 'none';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onAction = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          actionBtn.addEventListener('click', onAction);
        });
      }

      static showError(message) {
        alert(message);
      }

      static showLoading(button, text) {
        button.disabled = true;
        const originalText = button.innerHTML;
        button.innerHTML = `<div class="loading-spinner small"></div> ${text}`;
        return () => {
          button.disabled = false;
          button.innerHTML = originalText;
        };
      }
    }

    // ==================== é’±åŒ…ç®¡ç† ====================
    class WalletManager {
      static async connect() {
        try {
          if (!window.ethereum) {
            Utils.showError(isChinese ? "è¯·å®‰è£…TPæˆ–web3é’±åŒ…" : "Please install TP or WEB3 wallet");
            return false;
          }
          
          const walletBtn = document.getElementById('walletBtn');
          walletBtn.textContent = isChinese ? 'è¿æ¥ä¸­...' : 'Connecting...';
          walletBtn.classList.add('connecting');
          
          const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
          });
          
          if (!accounts || accounts.length === 0) {
            throw new Error(isChinese ? 'ç”¨æˆ·æ‹’ç»è¿æ¥' : 'User rejected connection');
          }
          
          account = accounts[0];
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          
          await this.checkNetwork();
          await this.initContracts();
          this.updateUI();
          
          if (refreshInterval) clearInterval(refreshInterval);
          refreshInterval = setInterval(() => StakingManager.refreshData(), 10000);
          
          return true;
        } catch (error) {
          console.error("é’±åŒ…è¿æ¥å¤±è´¥:", error);
          Utils.showError(isChinese ? `è¿æ¥å¤±è´¥: ${error.message}` : `Connection failed: ${error.message}`);
          return false;
        } finally {
          this.updateUI();
        }
      }

      static async checkNetwork() {
        const network = await provider.getNetwork();
        if (network.chainId !== CONFIG.CHAIN_ID) {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x' + CONFIG.CHAIN_ID.toString(16) }]
            });
          } catch (error) {
            if (error.code === 4902) {
              Utils.showError(isChinese ? 'è¯·æ·»åŠ Conflux eSpaceç½‘ç»œ' : 'Please add Conflux eSpace network');
            } else {
              Utils.showError(isChinese ? 'è¯·åˆ‡æ¢åˆ°Conflux eSpaceç½‘ç»œ' : 'Please switch to Conflux eSpace network');
            }
            throw error;
          }
        }
      }

      static async initContracts() {
        rewardContract = new ethers.Contract(CONFIG.REWARD_CONTRACT, REWARD_ABI, signer);
        lpTokenContract = new ethers.Contract(CONFIG.LP_TOKEN, ERC20_ABI, signer);
        rewardTokenContract = new ethers.Contract(CONFIG.REWARD_TOKEN, ERC20_ABI, signer);
        pairContract = new ethers.Contract(CONFIG.LP_TOKEN, PAIR_ABI, signer);
      }

      static updateUI() {
        const walletBtn = document.getElementById("walletBtn");
        walletBtn.classList.remove('connecting');
        
        if (account) {
          const displayAddress = Utils.formatAddress(account);
          walletBtn.textContent = displayAddress;
          walletBtn.classList.add('connected');
        } else {
          walletBtn.textContent = isChinese ? "è¿æ¥é’±åŒ…" : "Connect Wallet";
          walletBtn.classList.remove('connected');
        }
      }

      static disconnect() {
        account = null;
        provider = null;
        signer = null;
        rewardContract = null;
        lpTokenContract = null;
        rewardTokenContract = null;
        pairContract = null;
        
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
        
        if (cooldownInterval) {
          clearInterval(cooldownInterval);
          cooldownInterval = null;
        }
        
        this.updateUI();
        StakingManager.resetData();
      }
    }

    // ==================== è´¨æŠ¼ç®¡ç† ====================
    class StakingManager {
      static async refreshData() {
        if (!account) return;
        
        try {
          await this.updateLPBalance();
          await this.updateUserStakingData();
          await this.updatePoolInfo();
          this.updateUI();
        } catch (error) {
          console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
        }
      }

      static async updateLPBalance() {
        if (!account || !lpTokenContract) return;
        
        try {
          const balance = await lpTokenContract.balanceOf(account);
          const decimals = await lpTokenContract.decimals();
          const lpBalance = ethers.utils.formatUnits(balance, decimals);
          
          document.getElementById('lpBalance').textContent = Utils.formatNumber(lpBalance);
          document.getElementById('stakeBalance').textContent = Utils.formatNumber(lpBalance);
        } catch (error) {
          console.error('è·å–LPä½™é¢å¤±è´¥:', error);
        }
      }

      static async updateUserStakingData() {
        if (!account || !rewardContract) return;
        
        try {
          // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨é»‘åå•
          const isBlacklisted = await rewardContract.blacklist(account);
          if (isBlacklisted) {
            userStakingData = null;
            return;
          }
          
          // è·å–ç”¨æˆ·æ•°æ®
          const userData = await rewardContract.users(account);
          
          if (userData.shares.gt(0)) {
            userStakingData = {
              shares: parseFloat(ethers.utils.formatUnits(userData.shares, 18)),
              rewardDebt: parseFloat(ethers.utils.formatUnits(userData.rewardDebt, 18)),
              pendingReferral: parseFloat(ethers.utils.formatUnits(userData.pendingReferral, 18)),
              lastClaimTime: userData.lastClaimTime.toNumber(),
              activeTime: userData.activeTime.toNumber(),
              lastReduceTime: userData.lastReduceTime.toNumber(),
              referralUnlockTime: userData.referralUnlockTime.toNumber(),
              referrer: userData.referrer,
              cleanInFirst30Days: userData.cleanInFirst30Days
            };
            
            // è·å–å¾…é¢†å–å¥–åŠ±
            const pending = await rewardContract.pendingReward(account);
            userStakingData.pendingReward = parseFloat(ethers.utils.formatUnits(pending, 18));
            
            // æ›´æ–°å†·å´æ—¶é—´æ˜¾ç¤º
            this.updateCooldownDisplay();
          } else {
            userStakingData = null;
          }
        } catch (error) {
          console.error('è·å–ç”¨æˆ·è´¨æŠ¼æ•°æ®å¤±è´¥:', error);
          userStakingData = null;
        }
      }

      static async updatePoolInfo() {
        if (!rewardContract) return;
        
        try {
          // è·å–æ± å­æ€»ä¿¡æ¯
          const totalShares = await rewardContract.totalShares();
          const totalSharesFormatted = parseFloat(ethers.utils.formatUnits(totalShares, 18));
          
          document.getElementById('totalStaked').textContent = Utils.formatNumber(totalSharesFormatted);
          
          // æ›´æ–°æˆ‘çš„è´¨æŠ¼
          if (userStakingData) {
            document.getElementById('myStake').textContent = Utils.formatNumber(userStakingData.shares);
            document.getElementById('pendingReward').textContent = Utils.formatNumber(userStakingData.pendingReward || 0);
            document.getElementById('referralReward').textContent = Utils.formatNumber(userStakingData.pendingReferral || 0);
            
            document.getElementById('pendingRewardDetail').textContent = Utils.formatNumber(userStakingData.pendingReward || 0);
            document.getElementById('pendingReferralDetail').textContent = Utils.formatNumber(userStakingData.pendingReferral || 0);
            
            // è®¡ç®—æ¿€æ´»æ—¶é•¿
            const now = Math.floor(Date.now() / 1000);
            const activeDuration = now - userStakingData.activeTime;
            document.getElementById('activeDuration').textContent = Utils.formatDuration(activeDuration);
            
            // è®¡ç®—ä¸‹æ¬¡å¯é¢†å–æ—¶é—´
            const nextClaimTime = userStakingData.lastClaimTime + (7 * 24 * 3600); // 7å¤©
            if (nextClaimTime > now) {
              const remaining = nextClaimTime - now;
              document.getElementById('nextClaimTime').textContent = Utils.formatDuration(remaining);
            } else {
              document.getElementById('nextClaimTime').textContent = 'ç°åœ¨';
            }
            
            // æ›´æ–°æ¿€æ´»æ—¶é—´æ˜¾ç¤º
            document.getElementById('activationTime').textContent = Utils.formatTime(userStakingData.activeTime);
            
            // æ›´æ–°é‚€è¯·äººæ˜¾ç¤º
            if (userStakingData.referrer !== ethers.constants.AddressZero) {
              document.getElementById('referrerContainer').style.display = 'block';
              document.getElementById('referrerAddress').textContent = Utils.formatAddress(userStakingData.referrer);
            } else {
              document.getElementById('referrerContainer').style.display = 'none';
            }
            
            // æ›´æ–°æ—¶é—´å€ç‡
            this.updateTimeMultiplier();
          }
        } catch (error) {
          console.error('è·å–æ± å­ä¿¡æ¯å¤±è´¥:', error);
        }
      }

      static updateTimeMultiplier() {
        if (!userStakingData) {
          document.getElementById('multiplierValue').textContent = '1.0x';
          document.getElementById('multiplierProgress').style.width = '0%';
          return;
        }
        
        const now = Math.floor(Date.now() / 1000);
        const duration = now - userStakingData.activeTime;
        
        let multiplier = 1.0;
        let progress = 0;
        
        if (duration >= 360 * 24 * 3600) { // 360å¤©
          multiplier = 3.0;
          progress = 100;
          this.setActiveStage('stage360');
        } else if (duration >= 180 * 24 * 3600) { // 180å¤©
          multiplier = 2.0;
          progress = Math.min(100, (duration - 180 * 24 * 3600) / (180 * 24 * 3600) * 100);
          this.setActiveStage('stage180');
        } else if (duration >= 90 * 24 * 3600) { // 90å¤©
          multiplier = 1.5;
          progress = Math.min(100, (duration - 90 * 24 * 3600) / (90 * 24 * 3600) * 100);
          this.setActiveStage('stage90');
        } else if (duration >= 30 * 24 * 3600) { // 30å¤©
          multiplier = 1.0;
          progress = Math.min(100, (duration - 30 * 24 * 3600) / (60 * 24 * 3600) * 100);
          this.setActiveStage('stage30');
        } else {
          multiplier = 1.0;
          progress = Math.min(100, duration / (30 * 24 * 3600) * 100);
          this.setActiveStage('stage30');
        }
        
        document.getElementById('multiplierValue').textContent = `${multiplier.toFixed(1)}x`;
        document.getElementById('multiplierProgress').style.width = `${progress}%`;
      }

      static setActiveStage(stageId) {
        const stages = ['stage30', 'stage90', 'stage180', 'stage360'];
        stages.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.classList.toggle('active', id === stageId);
          }
        });
      }

      static updateCooldownDisplay() {
        if (!userStakingData || !cooldownInterval) {
          clearInterval(cooldownInterval);
          cooldownInterval = null;
          document.getElementById('cooldownTimer').style.display = 'none';
          return;
        }
        
        const now = Math.floor(Date.now() / 1000);
        const cooldownEnd = userStakingData.lastReduceTime + (24 * 3600); // 1å¤©å†·å´
        
        if (now < cooldownEnd) {
          const remaining = cooldownEnd - now;
          document.getElementById('cooldownValue').textContent = Utils.formatCountdown(remaining);
          document.getElementById('cooldownTimer').style.display = 'block';
        } else {
          document.getElementById('cooldownTimer').style.display = 'none';
        }
      }

      static updateUI() {
        const activateSection = document.getElementById('activationInputGroup');
        const activatedSection = document.getElementById('activatedSection');
        const inviteSystem = document.getElementById('inviteSystem');
        const activateBtn = document.getElementById('activateBtn');
        const claimBtn = document.getElementById('claimBtn');
        const claimReferralBtn = document.getElementById('claimReferralBtn');
        
        if (!account) {
          // æœªè¿æ¥é’±åŒ…
          activateSection.style.display = 'block';
          activatedSection.style.display = 'none';
          inviteSystem.style.display = 'block';
          activateBtn.disabled = false;
          activateBtnText.textContent = isChinese ? 'è¿æ¥é’±åŒ…' : 'Connect Wallet';
          claimBtn.disabled = true;
          claimReferralBtn.disabled = true;
          return;
        }
        
        if (userStakingData) {
          // å·²æ¿€æ´»
          activateSection.style.display = 'none';
          activatedSection.style.display = 'block';
          inviteSystem.style.display = 'none';
          activateBtn.style.display = 'none';
          
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          const now = Math.floor(Date.now() / 1000);
          
          // é¢†å–å¥–åŠ±æŒ‰é’®
          if (userStakingData.lastClaimTime + (7 * 24 * 3600) <= now && userStakingData.pendingReward > 0) {
            claimBtn.disabled = false;
            claimBtnText.textContent = isChinese ? 'é¢†å–å¥–åŠ±' : 'Claim Rewards';
          } else {
            claimBtn.disabled = true;
            const nextClaim = userStakingData.lastClaimTime + (7 * 24 * 3600);
            if (nextClaim > now) {
              const remaining = nextClaim - now;
              claimBtnText.textContent = `${Utils.formatDuration(remaining)}å`;
            } else {
              claimBtnText.textContent = isChinese ? 'æš‚æ— å¥–åŠ±' : 'No Rewards';
            }
          }
          
          // é¢†å–é‚€è¯·å¥–åŠ±æŒ‰é’®
          if (userStakingData.pendingReferral > 0 && now >= userStakingData.referralUnlockTime) {
            claimReferralBtn.disabled = false;
            claimReferralBtnText.textContent = isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral';
          } else {
            claimReferralBtn.disabled = true;
            if (userStakingData.pendingReferral > 0) {
              if (now < userStakingData.referralUnlockTime) {
                const remaining = userStakingData.referralUnlockTime - now;
                claimReferralBtnText.textContent = `${Utils.formatDuration(remaining)}åè§£é”`;
              } else {
                claimReferralBtnText.textContent = isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral';
              }
            } else {
              claimReferralBtnText.textContent = isChinese ? 'æš‚æ— é‚€è¯·å¥–åŠ±' : 'No Referral';
            }
          }
        } else {
          // æœªæ¿€æ´»
          activateSection.style.display = 'block';
          activatedSection.style.display = 'none';
          inviteSystem.style.display = 'block';
          activateBtn.style.display = 'block';
          activateBtn.disabled = false;
          activateBtnText.textContent = isChinese ? 'æ¿€æ´»è´¨æŠ¼' : 'Activate Staking';
          claimBtn.disabled = true;
          claimReferralBtn.disabled = true;
        }
      }

      static resetData() {
        userStakingData = null;
        
        // é‡ç½®æ‰€æœ‰æ˜¾ç¤º
        const resetElements = [
          'lpBalance', 'stakeBalance', 'totalStaked', 'myStake',
          'pendingReward', 'referralReward', 'pendingRewardDetail',
          'pendingReferralDetail', 'nextClaimTime', 'activeDuration',
          'activationTime', 'multiplierValue'
        ];
        
        resetElements.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = id.includes('Time') ? '--' : '0';
        });
        
        document.getElementById('multiplierProgress').style.width = '0%';
        document.getElementById('cooldownTimer').style.display = 'none';
        this.updateUI();
      }

      static async activateStaking() {
        if (!account) {
          await WalletManager.connect();
          return;
        }
        
        try {
          // è·å–è´¨æŠ¼æ•°é‡
          const stakeAmount = document.getElementById('stakeAmount').value;
          if (!stakeAmount || parseFloat(stakeAmount) <= 0) {
            Utils.showError(isChinese ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„è´¨æŠ¼æ•°é‡' : 'Please enter valid stake amount');
            return;
          }
          
          // è·å–é‚€è¯·åœ°å€
          const inviteAddress = document.getElementById('inviteAddress').value.trim();
          let referrer = ethers.constants.AddressZero;
          
          if (inviteAddress) {
            if (!Utils.isValidAddress(inviteAddress)) {
              Utils.showError(isChinese ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚€è¯·åœ°å€' : 'Please enter valid invite address');
              return;
            }
            
            if (inviteAddress.toLowerCase() === account.toLowerCase()) {
              Utils.showError(isChinese ? 'ä¸èƒ½é‚€è¯·è‡ªå·±' : 'Cannot invite yourself');
              return;
            }
            
            referrer = inviteAddress;
          }
          
          // æ£€æŸ¥LPä½™é¢å’Œæˆæƒ
          const lpBalance = await lpTokenContract.balanceOf(account);
          const stakeAmountBN = ethers.utils.parseUnits(stakeAmount, 18);
          
          if (lpBalance.lt(stakeAmountBN)) {
            Utils.showError(isChinese ? 'LPä»£å¸ä½™é¢ä¸è¶³' : 'Insufficient LP balance');
            return;
          }
          
          // æ£€æŸ¥æœ€å°æ¿€æ´»è¦æ±‚
          const minActivation = await rewardContract.minActivation();
          if (stakeAmountBN.lt(minActivation)) {
            const minActivationFormatted = ethers.utils.formatUnits(minActivation, 18);
            Utils.showError(isChinese ? `æœ€ä½æ¿€æ´»è¦æ±‚: ${minActivationFormatted} LP` : `Min activation: ${minActivationFormatted} LP`);
            return;
          }
          
          // æ£€æŸ¥æˆæƒ
          const allowance = await lpTokenContract.allowance(account, CONFIG.REWARD_CONTRACT);
          if (allowance.lt(stakeAmountBN)) {
            const confirmed = await Utils.showConfirm(
              isChinese ? 'æˆæƒç¡®è®¤' : 'Approve Confirmation',
              isChinese ? 
                'éœ€è¦å…ˆæˆæƒLPä»£å¸ç»™è´¨æŠ¼åˆçº¦ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ' :
                'Need to approve LP tokens to staking contract. Continue?'
            );
            
            if (!confirmed) return;
            
            const resetLoading = Utils.showLoading(
              document.getElementById('activateBtn'),
              isChinese ? 'æˆæƒä¸­...' : 'Approving...'
            );
            
            try {
              const approveTx = await lpTokenContract.approve(CONFIG.REWARD_CONTRACT, ethers.constants.MaxUint256);
              await approveTx.wait();
            } finally {
              resetLoading();
            }
          }
          
          // ç¡®è®¤æ¿€æ´»
          const confirmed = await Utils.showConfirm(
            isChinese ? 'æ¿€æ´»è´¨æŠ¼' : 'Activate Staking',
            isChinese ? 
              `ç¡®è®¤æ¿€æ´»è´¨æŠ¼ ${stakeAmount} LP ä»£å¸?` + (referrer !== ethers.constants.AddressZero ? `<br>é‚€è¯·äºº: ${Utils.formatAddress(referrer)}` : '') :
              `Confirm to stake ${stakeAmount} LP tokens?` + (referrer !== ethers.constants.AddressZero ? `<br>Referrer: ${Utils.formatAddress(referrer)}` : '')
          );
          
          if (!confirmed) return;
          
          const resetLoading = Utils.showLoading(
            document.getElementById('activateBtn'),
            isChinese ? 'æ¿€æ´»ä¸­...' : 'Activating...'
          );
          
          try {
            const tx = await rewardContract.activate(referrer);
            await tx.wait();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('stakeAmount').value = '';
            document.getElementById('inviteAddress').value = '';
            
            // åˆ·æ–°æ•°æ®
            await this.refreshData();
            
            alert(isChinese ? 'è´¨æŠ¼æ¿€æ´»æˆåŠŸï¼' : 'Staking activated successfully!');
          } finally {
            resetLoading();
          }
          
        } catch (error) {
          console.error('æ¿€æ´»è´¨æŠ¼å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('Activated')) {
            Utils.showError(isChinese ? 'å·²ç»æ¿€æ´»è¿‡è´¨æŠ¼' : 'Already activated staking');
          } else if (message.includes('Below minimum')) {
            const minActivation = await rewardContract.minActivation();
            const minFormatted = ethers.utils.formatUnits(minActivation, 18);
            Utils.showError(isChinese ? `æœ€ä½æ¿€æ´»è¦æ±‚: ${minFormatted} LP` : `Min activation: ${minFormatted} LP`);
          } else {
            Utils.showError(isChinese ? 'æ¿€æ´»å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Activation failed, please try again');
          }
        }
      }

      static async claimRewards() {
        if (!account || !userStakingData) return;
        
        try {
          const confirmed = await Utils.showConfirm(
            isChinese ? 'é¢†å–å¥–åŠ±' : 'Claim Rewards',
            isChinese ? 
              `ç¡®è®¤é¢†å– ${Utils.formatNumber(userStakingData.pendingReward)} LOM å¥–åŠ±?` :
              `Confirm to claim ${Utils.formatNumber(userStakingData.pendingReward)} LOM rewards?`
          );
          
          if (!confirmed) return;
          
          const resetLoading = Utils.showLoading(
            document.getElementById('claimBtn'),
            isChinese ? 'é¢†å–ä¸­...' : 'Claiming...'
          );
          
          try {
            const tx = await rewardContract.claimAll();
            await tx.wait();
            
            // åˆ·æ–°æ•°æ®
            await this.refreshData();
            
            alert(isChinese ? 'å¥–åŠ±é¢†å–æˆåŠŸï¼' : 'Rewards claimed successfully!');
          } finally {
            resetLoading();
          }
          
        } catch (error) {
          console.error('é¢†å–å¥–åŠ±å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('Too soon')) {
            Utils.showError(isChinese ? 'é¢†å–é—´éš”éœ€è¦7å¤©ä»¥ä¸Š' : 'Claim interval must be 7 days or more');
          } else {
            Utils.showError(isChinese ? 'é¢†å–å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Claim failed, please try again');
          }
        }
      }

      static async claimReferralRewards() {
        if (!account || !userStakingData) return;
        
        try {
          const confirmed = await Utils.showConfirm(
            isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral Rewards',
            isChinese ? 
              `ç¡®è®¤é¢†å– ${Utils.formatNumber(userStakingData.pendingReferral)} LOM é‚€è¯·å¥–åŠ±?` :
              `Confirm to claim ${Utils.formatNumber(userStakingData.pendingReferral)} LOM referral rewards?`
          );
          
          if (!confirmed) return;
          
          const resetLoading = Utils.showLoading(
            document.getElementById('claimReferralBtn'),
            isChinese ? 'é¢†å–ä¸­...' : 'Claiming...'
          );
          
          try {
            const tx = await rewardContract.claimReferral();
            await tx.wait();
            
            // åˆ·æ–°æ•°æ®
            await this.refreshData();
            
            alert(isChinese ? 'é‚€è¯·å¥–åŠ±é¢†å–æˆåŠŸï¼' : 'Referral rewards claimed successfully!');
          } finally {
            resetLoading();
          }
          
        } catch (error) {
          console.error('é¢†å–é‚€è¯·å¥–åŠ±å¤±è´¥:', error);
          const message = error.message || error.toString();
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“' : 'Transaction rejected by user');
          } else if (message.includes('Locked')) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = userStakingData.referralUnlockTime - now;
            Utils.showError(isChinese ? 
              `é‚€è¯·å¥–åŠ±é”å®šä¸­ï¼Œ${Utils.formatDuration(remaining)}åè§£é”` :
              `Referral rewards locked, unlock in ${Utils.formatDuration(remaining)}`
            );
          } else {
            Utils.showError(isChinese ? 'é¢†å–å¤±è´¥ï¼Œè¯·é‡è¯•' : 'Claim failed, please try again');
          }
        }
      }
    }

    // ==================== UIç®¡ç† ====================
    class UIManager {
      static init() {
        this.setupEventListeners();
        this.setupTabs();
        this.updateTexts();
        
        // æ£€æŸ¥å†·å´æ—¶é—´
        if (cooldownInterval) clearInterval(cooldownInterval);
        cooldownInterval = setInterval(() => {
          if (userStakingData) {
            StakingManager.updateCooldownDisplay();
          }
        }, 1000);
      }

      static setupEventListeners() {
        // é’±åŒ…æŒ‰é’®
        document.getElementById('walletBtn').addEventListener('click', async () => {
          if (account) {
            if (confirm(isChinese ? 'ç¡®å®šè¦æ–­å¼€é’±åŒ…è¿æ¥å—ï¼Ÿ' : 'Are you sure to disconnect?')) {
              WalletManager.disconnect();
            }
          } else {
            await WalletManager.connect();
          }
        });
        
        // è¯­è¨€åˆ‡æ¢
        document.getElementById('langBtn').addEventListener('click', () => {
          isChinese = !isChinese;
          document.getElementById('langBtn').textContent = isChinese ? 'EN' : 'ZN';
          this.updateTexts();
        });
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        this.setupTabs();
        
        // è´¨æŠ¼è¾“å…¥æ¡†äº‹ä»¶
        document.getElementById('stakeAmount').addEventListener('input', () => {
          this.updateStakeButtons();
        });
        
        // é‚€è¯·åœ°å€éªŒè¯
        document.getElementById('inviteAddress').addEventListener('input', (e) => {
          const errorText = document.getElementById('inviteErrorText');
          e.target.classList.remove('invite-input-error');
          errorText.classList.remove('show');
        });
        
        // ç›‘å¬é’±åŒ…äº‹ä»¶
        if (window.ethereum) {
          window.ethereum.on('accountsChanged', (accounts) => {
            if (accounts.length === 0) {
              WalletManager.disconnect();
            } else {
              location.reload();
            }
          });
          
          window.ethereum.on('chainChanged', () => {
            location.reload();
          });
        }
      }

      static setupTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const tabId = btn.dataset.tab;
            
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            // åˆ‡æ¢åˆ°è´¨æŠ¼é¡µé¢æ—¶åˆ·æ–°æ•°æ®
            if (tabId === 'staking' && account) {
              StakingManager.refreshData();
            }
          });
        });
      }

      static updateStakeButtons() {
        const amount = document.getElementById('stakeAmount').value;
        const buttons = document.querySelectorAll('.percentage-btn');
        
        buttons.forEach(btn => {
          const percent = parseFloat(btn.dataset.percent);
          btn.classList.toggle('active', percent === 1); // é»˜è®¤é€‰ä¸­MAX
        });
      }

      static updateTexts() {
        // æ›´æ–°æ‰€æœ‰æ–‡æœ¬
        const texts = {
          // è´¨æŠ¼é¡µé¢
          'stakingTitle': isChinese ? 'LPè´¨æŠ¼å†œåœº' : 'LP Staking Farm',
          'totalStakedLabel': isChinese ? 'æ€»è´¨æŠ¼é‡' : 'Total Staked',
          'myStakeLabel': isChinese ? 'æˆ‘çš„è´¨æŠ¼' : 'My Stake',
          'pendingRewardLabel': isChinese ? 'å¾…é¢†å–' : 'Pending',
          'referralRewardLabel': isChinese ? 'é‚€è¯·å¥–åŠ±' : 'Referral',
          'multiplierLabel': isChinese ? 'æ—¶é—´å€ç‡:' : 'Time Multiplier:',
          'activateTitle': isChinese ? 'æ¿€æ´»è´¨æŠ¼' : 'Activate Staking',
          'lpBalanceLabel': isChinese ? 'æ‚¨çš„LPä»£å¸ä½™é¢' : 'Your LP Balance',
          'activationRequirements': isChinese ? 'æœ€ä½æ¿€æ´»è¦æ±‚: 100 LP ä»£å¸' : 'Min activation: 100 LP tokens',
          'stakeAmountLabel': isChinese ? 'è´¨æŠ¼æ•°é‡' : 'Stake Amount',
          'stakeBalanceText': isChinese ? 'ä½™é¢:' : 'Balance:',
          'inviteTitle': isChinese ? 'é‚€è¯·ç³»ç»Ÿ (å¯é€‰)' : 'Referral System (Optional)',
          'inviteSubtitle': isChinese ? 'ç»‘å®šé‚€è¯·äººåœ°å€å¯è·å¾—é¢å¤–5%å¥–åŠ±åˆ†æˆã€‚é‚€è¯·äººå¯è·å¾—æ‚¨æ”¶ç›Šçš„5%ä½œä¸ºå¥–åŠ±ã€‚' : 
                                      'Bind referrer address to get extra 5% reward share. Referrer gets 5% of your rewards.',
          'activatedTitle': isChinese ? 'è´¨æŠ¼å·²æ¿€æ´»' : 'Staking Activated',
          'activateBtnText': isChinese ? 'æ¿€æ´»è´¨æŠ¼' : 'Activate Staking',
          'rewardsTitle': isChinese ? 'å¥–åŠ±ç®¡ç†' : 'Rewards Management',
          'penaltyTitle': isChinese ? 'å‡æŒæƒ©ç½šè­¦å‘Š' : 'Reduction Penalty Warning',
          'penaltyContent': isChinese ? 'æ¿€æ´»åå‡æŒLPå°†é¢ä¸´50%çš„å¥–åŠ±æƒ©ç½šï¼30å¤©å†…å‡æŒå°†å¤±å»é‚€è¯·å¥–åŠ±èµ„æ ¼ã€‚7å¤©å†…æœ€å¤šå‡æŒ30%ï¼Œä¸”éœ€è¦1å¤©å†·å´æ—¶é—´ã€‚' :
                                      'Reducing LP after activation will incur 50% reward penalty! Reduction within 30 days loses referral rewards. Max 30% reduction within 7 days, with 1-day cooldown.',
          'cooldownLabel': isChinese ? 'å‡æŒå†·å´æ—¶é—´' : 'Reduction Cooldown',
          'claimBtnText': isChinese ? 'é¢†å–å¥–åŠ±' : 'Claim Rewards',
          'claimReferralBtnText': isChinese ? 'é¢†å–é‚€è¯·å¥–åŠ±' : 'Claim Referral',
          
          // é£é™©æç¤º
          'riskTitle': isChinese ? 'é£é™©æç¤º' : 'Risk Warning',
          'riskText': isChinese ? 
            'æœ¬åº”ç”¨ä»…ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨å·¨å¤§ï¼ŒæŠ•èµ„éœ€è°¨æ…ï¼Œè¯·ç†æ€§å¯¹å¾…æ•°å­—èµ„äº§äº¤æ˜“ã€‚' :
            'This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.',
          
          // é¡µè„š
          'footerText': isChinese ? 'LOMswap Â· Conflux eSpace' : 'LOMswap Â· Conflux eSpace',
          
          // æ ‡ç­¾é¡µ
          'swap': isChinese ? 'å…‘æ¢' : 'Swap',
          'liquidity': isChinese ? 'æµåŠ¨æ€§' : 'Liquidity',
          'staking': isChinese ? 'è´¨æŠ¼å†œåœº' : 'Staking'
        };
        
        Object.keys(texts).forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = texts[id];
          }
        });
        
        // æ›´æ–°ç™¾åˆ†æ¯”æŒ‰é’®æ–‡æœ¬
        document.querySelectorAll('.percentage-btn').forEach((btn, index) => {
          const percents = isChinese ? ['25%', '50%', '75%', 'MAX'] : ['25%', '50%', '75%', 'MAX'];
          btn.textContent = percents[index];
        });
        
        // æ›´æ–°é‚€è¯·è¾“å…¥æ¡†placeholder
        document.getElementById('inviteAddress').placeholder = isChinese ? 
          'è¯·è¾“å…¥é‚€è¯·äººé’±åŒ…åœ°å€ (0xå¼€å¤´)' : 
          'Enter referrer wallet address (0x...)';
          
        document.getElementById('inviteErrorText').textContent = isChinese ? 
          'è¯·è¾“å…¥æœ‰æ•ˆçš„é’±åŒ…åœ°å€ (0xå¼€å¤´ï¼Œå…±42ä½)' : 
          'Please enter valid wallet address (0x..., 42 chars)';
      }
    }

    // ==================== å·¥å…·å‡½æ•°å¯¼å‡º ====================
    function switchToStakingTab() {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector('[data-tab="staking"]').classList.add('active');
      document.getElementById('stakingTab').classList.add('active');
      
      if (account) {
        StakingManager.refreshData();
      }
    }

    function setMaxStake() {
      const balance = document.getElementById('stakeBalance').textContent;
      document.getElementById('stakeAmount').value = balance;
      setStakePercentage(1);
    }

    function setStakePercentage(percent) {
      const balance = parseFloat(document.getElementById('stakeBalance').textContent);
      if (balance > 0) {
        const amount = balance * percent;
        document.getElementById('stakeAmount').value = Utils.formatNumber(amount);
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.percentage-btn').forEach(btn => {
          const btnPercent = parseFloat(btn.dataset.percent);
          btn.classList.toggle('active', btnPercent === percent);
        });
      }
    }

    async function activateStaking() {
      await StakingManager.activateStaking();
    }

    async function claimRewards() {
      await StakingManager.claimRewards();
    }

    async function claimReferralRewards() {
      await StakingManager.claimReferralRewards();
    }

    // ==================== åˆå§‹åŒ– ====================
    document.addEventListener('DOMContentLoaded', () => {
      UIManager.init();
      
      // å°è¯•è‡ªåŠ¨è¿æ¥é’±åŒ…
      if (window.ethereum && window.ethereum.selectedAddress) {
        setTimeout(() => {
          WalletManager.connect();
        }, 1000);
      }
    });
  </script>
</body>
</html>
