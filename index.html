<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOMswap - Conflux Âéª‰∏≠ÂøÉÂåñ‰∫§ÊòìÊâÄ</title>
  
  <!-- Êî∂ËóèÂõæÊ†á -->
  <link rel="icon" type="image/x-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="apple-touch-icon" href="https://i.imgur.com/HddyTrv.jpeg">
  <link rel="shortcut icon" href="https://i.imgur.com/HddyTrv.jpeg">
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* ========== Âü∫Á°ÄÊ†∑Âºè ========== */
    :root {
      --primary-dark: #0d1117;
      --primary-blue: #1a73e8;
      --accent-purple: #8a2be2;
      --accent-yellow: #ffd700;
      --accent-red: #ff4757;
      --accent-green: #2ea043;
      --accent-orange: #ff6b35;
      --accent-teal: #00b4d8;
      --card-bg: #161b22;
      --card-bg-light: #1c2128;
      --border-color: #30363d;
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      --text-muted: #6e7681;
      --success: #2ea043;
      --warning: #ff6b6b;
      --gradient-primary: linear-gradient(135deg, #1a73e8, #8a2be2);
      --gradient-yellow: linear-gradient(135deg, #ffd700, #ffa500);
      --gradient-red: linear-gradient(135deg, #ff4757, #ff6b81);
      --gradient-green: linear-gradient(135deg, #2ea043, #3ddc84);
      --gradient-orange: linear-gradient(135deg, #ff6b35, #ff9e6d);
      --gradient-teal: linear-gradient(135deg, #00b4d8, #48cae4);
      --gradient-card: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(138, 43, 226, 0.05));
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent !important;
    }
    
    *:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    body {
      background: var(--primary-dark);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI Emoji', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(26, 115, 232, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.05) 0%, transparent 40%);
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      animation: fadeIn 0.5s ease-out;
    }

    /* ========== Â§¥ÈÉ®Ê†∑Âºè ========== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 10px;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logo-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
      background-size: cover;
      background-position: center;
      border: 2px solid var(--accent-yellow);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .logo-text {
      font-size: 22px;
      font-weight: 900;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    .header-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }
    
    .btn {
      background: var(--gradient-primary);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      font-size: 14px;
      height: 40px;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.3);
    }
    
    #walletBtn.connected {
      background: rgba(46, 160, 67, 0.15);
      border: 1px solid var(--success);
      color: var(--success);
      font-size: 13px;
      min-width: 140px;
      max-width: 160px;
      padding: 10px 12px;
    }
    
    #walletBtn.connecting {
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid var(--accent-yellow);
      color: var(--accent-yellow);
      min-width: 140px;
      max-width: 160px;
    }
    
    #langBtn {
      width: 40px;
      height: 40px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* ========== Ê†áÁ≠æÈ°µÊ†∑Âºè ========== */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* ========== Âç°ÁâáÊ†∑Âºè ========== */
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent-yellow), transparent);
    }
    
    /* ========== ÂÖëÊç¢È°µÈù¢Ê†∑Âºè ========== */
    .swap-container {
      position: relative;
      padding: 2px 0;
    }
    
    .token-input-wrapper {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border-color);
      margin-bottom: 8px;
    }
    
    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .balance-info {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .balance-amount {
      color: var(--accent-yellow);
      font-weight: 600;
      cursor: pointer;
    }
    
    .token-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(26, 115, 232, 0.15);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 12px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 100px;
    }
    
    .token-selector:hover {
      background: rgba(26, 115, 232, 0.25);
    }
    
    .token-logo {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .token-symbol {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 16px;
    }
    
    .token-dropdown-arrow {
      color: var(--text-secondary);
      font-size: 12px;
    }
    
    .percentage-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .percent-btn {
      flex: 1;
      max-width: 70px;
      padding: 8px 12px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    
    .percent-btn:hover {
      background: rgba(26, 115, 232, 0.2);
      border-color: var(--primary-blue);
    }
    
    .percent-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 700;
    }
    
    .amount-input-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .amount-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 28px;
      font-weight: 700;
      padding: 8px 0;
      width: 100%;
      outline: none;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .amount-input::placeholder {
      color: var(--text-muted);
    }
    
    .swap-center {
      position: relative;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      z-index: 10;
    }
    
    .swap-arrow-btn {
      background: transparent;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      color: var(--accent-yellow);
      z-index: 2;
    }
    
    .swap-arrow-btn:hover {
      transform: rotate(180deg) scale(1.1);
      background: rgba(255, 215, 0, 0.1);
    }
    
    .swap-details {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 16px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      font-size: 13px;
    }
    
    .detail-row:not(:last-child) {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .detail-value {
      color: var(--text-primary);
      font-weight: 600;
      text-align: right;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .slippage-options {
      display: flex;
      gap: 8px;
    }
    
    .slippage-btn {
      padding: 6px 10px;
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
      min-width: 40px;
      text-align: center;
    }
    
    .slippage-btn:hover {
      border-color: var(--primary-blue);
    }
    
    .slippage-btn.active {
      background: var(--accent-yellow);
      color: #0f172a;
      border-color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .main-action-btn {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      padding: 16px;
      border: none;
      border-radius: 16px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .main-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 115, 232, 0.4);
    }
    
    .main-action-btn:disabled {
      background: #475569;
      color: var(--text-secondary);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .error-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 12px 16px;
      margin: 12px 0;
      font-size: 13px;
      color: var(--accent-red);
      display: none;
    }
    
    .error-box.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* ========== ÊµÅÂä®ÊÄßÈ°µÈù¢Ê†∑Âºè ========== */
    .liquidity-summary {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
    }
    
    .liquidity-pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .pair-logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .pair-logo.cfx {
      background-image: url('https://i.imgur.com/70cXbUI.jpeg');
    }
    
    .pair-logo.lom {
      background-image: url('https://i.imgur.com/HddyTrv.jpeg');
    }
    
    .pair-symbol {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .liquidity-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label-small {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .stat-value-large {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .user-position {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }
    
    .position-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .position-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .position-value {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .position-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .position-stat {
      text-align: center;
    }
    
    .position-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    
    .position-amount {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-yellow);
    }
    
    .lp-amount {
      color: var(--text-primary);
    }
    
    .pool-share {
      color: var(--success);
    }
    
    .position-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .position-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }
    
    .add-btn {
      background: var(--gradient-primary);
      color: white;
    }
    
    .remove-btn {
      background: rgba(255, 71, 87, 0.15);
      color: var(--accent-red);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }
    
    .remove-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .add-btn:hover, .remove-btn:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    
    /* ========== LPÂ•ñÂä±È°µÈù¢Ê†∑Âºè ========== */
    .lp-rewards-container {
      padding: 2px 0;
    }
    
    .rewards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .rewards-title {
      font-size: 22px;
      font-weight: 800;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .rewards-icon {
      font-size: 28px;
    }
    
    .rewards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .reward-stat {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .reward-stat:hover {
      transform: translateY(-2px);
      border-color: var(--accent-yellow);
    }
    
    .reward-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .reward-value {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, monospace;
      margin-bottom: 4px;
    }
    
    .reward-value.green {
      color: var(--accent-green);
    }
    
    .reward-value.yellow {
      color: var(--accent-yellow);
    }
    
    .reward-value.teal {
      color: var(--accent-teal);
    }
    
    .reward-value.orange {
      color: var(--accent-orange);
    }
    
    .reward-unit {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .multiplier-section {
      background: var(--gradient-card);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }
    
    .multiplier-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .multiplier-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .multiplier-value {
      font-size: 16px;
      font-weight: 800;
      background: var(--gradient-yellow);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .multiplier-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    
    .multiplier-fill {
      height: 100%;
      background: var(--gradient-yellow);
      border-radius: 4px;
      transition: width 1s ease-in-out;
    }
    
    .multiplier-stages {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      color: var(--text-secondary);
    }
    
    .stage {
      text-align: center;
    }
    
    .stage.active {
      color: var(--accent-yellow);
      font-weight: 600;
    }
    
    .activation-section {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .activation-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .activation-icon {
      color: var(--accent-yellow);
      font-size: 24px;
    }
    
    .activation-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .lp-balance-display {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .lp-balance-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .lp-balance-value {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent-yellow);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .lp-balance-unit {
      font-size: 14px;
      color: var(--text-secondary);
      margin-left: 6px;
    }
    
    .min-requirement {
      background: rgba(26, 115, 232, 0.1);
      border: 1px solid rgba(26, 115, 232, 0.3);
      border-radius: 10px;
      padding: 12px;
      margin: 16px 0;
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .requirement-icon {
      color: var(--primary-blue);
      margin-right: 6px;
    }
    
    .invite-input-container {
      position: relative;
      margin: 16px 0;
    }
    
    .invite-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 215, 0, 0.05);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .invite-input:focus {
      border-color: var(--accent-yellow);
      box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
    }
    
    .invite-input::placeholder {
      color: var(--text-muted);
    }
    
    .invite-benefits {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 10px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .benefit-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-yellow);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .benefit-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .benefit-item {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.5;
    }
    
    .benefit-icon {
      color: var(--accent-yellow);
      font-size: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .action-button {
      flex: 1;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .action-button.primary {
      background: var(--gradient-yellow);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    .action-button.claim {
      background: var(--gradient-green);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(46, 160, 67, 0.3);
    }
    
    .action-button.referral {
      background: var(--gradient-teal);
      color: #0f172a;
      box-shadow: 0 4px 12px rgba(0, 180, 216, 0.3);
    }
    
    .action-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    }
    
    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    .activated-status {
      background: rgba(46, 160, 67, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--success);
    }
    
    .status-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .status-text {
      font-size: 16px;
      color: var(--success);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status-details {
      background: rgba(46, 160, 67, 0.15);
      border-radius: 10px;
      padding: 16px;
      margin: 16px 0;
      border: 1px solid rgba(46, 160, 67, 0.3);
      text-align: center;
    }
    
    .status-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .status-value {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 600;
      word-break: break-all;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    .warning-box {
      background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 71, 87, 0.05));
      border: 1px solid var(--accent-red);
      border-radius: 10px;
      padding: 16px;
      margin: 20px 0;
    }
    
    .warning-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .warning-icon {
      color: var(--accent-red);
      font-size: 18px;
    }
    
    .warning-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-red);
    }
    
    .warning-content {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .cooldown-timer {
      background: rgba(26, 115, 232, 0.1);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border: 1px solid rgba(26, 115, 232, 0.3);
      margin: 16px 0;
      display: none;
    }
    
    .cooldown-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .cooldown-value {
      font-size: 20px;
      font-weight: 800;
      color: var(--primary-blue);
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    /* ========== È£éÈô©ÊèêÁ§∫ÂíåÈ°µËÑö ========== */
    .risk-warning {
      background: var(--gradient-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
      font-size: 12px;
      color: var(--text-primary);
      line-height: 1.5;
    }
    
    .risk-title {
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--accent-yellow);
    }
    
    .footer {
      text-align: center;
      padding: 16px 0;
      color: var(--text-secondary);
      font-size: 13px;
      opacity: 0.7;
    }
    
    /* ========== Ê®°ÊÄÅÊ°ÜÊ†∑Âºè ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 17, 23, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 20px;
      text-align: center;
    }
    
    .modal-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
    }
    
    .modal-btn.cancel {
      background: var(--card-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }
    
    .modal-btn.confirm {
      background: var(--gradient-yellow);
      color: #0f172a;
    }
    
    .modal-btn.confirm:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.3);
    }
    
    /* ========== Âä®ÁîªÊïàÊûú ========== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ========== Âä†ËΩΩÂä®Áîª ========== */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(26, 115, 232, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }
    
    /* ========== ÂìçÂ∫îÂºèË∞ÉÊï¥ ========== */
    @media (max-width: 480px) {
      .app {
        max-width: 100%;
        padding: 0;
      }
      
      .card {
        margin: 10px;
        padding: 20px;
      }
      
      .header {
        padding: 10px;
        margin-bottom: 16px;
      }
      
      .logo-img {
        width: 40px;
        height: 40px;
      }
      
      .logo-text {
        font-size: 18px;
      }
      
      .rewards-grid,
      .liquidity-stats,
      .position-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .position-actions {
        flex-direction: column;
      }
      
      .amount-input {
        font-size: 24px;
      }
      
      .lp-balance-value {
        font-size: 22px;
      }
      
      .reward-value {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Â§¥ÈÉ® -->
    <div class="header">
      <div class="logo-container">
        <div class="logo-img"></div>
        <div class="logo-text">LOMswap</div>
      </div>
      <div class="header-buttons">
        <button class="btn" id="langBtn">EN</button>
        <button class="btn" id="walletBtn">ËøûÊé•Èí±ÂåÖ</button>
      </div>
    </div>

    <!-- Ê†áÁ≠æÈ°µ -->
    <div class="tab-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="swap">ÂÖëÊç¢</button>
        <button class="tab-btn" data-tab="liquidity">ÊµÅÂä®ÊÄß</button>
        <button class="tab-btn" data-tab="lpRewards">LPÂ•ñÂä±</button>
      </div>
    </div>

    <!-- ÂÖëÊç¢È°µÈù¢ -->
    <div class="tab-content active" id="swapTab">
      <div class="card">
        <div class="swap-container">
          <!-- ËæìÂÖ•‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="fromTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="fromBal">0</span>
              </div>
              <div class="token-selector" id="fromTokenSelector">
                <div class="token-logo" id="fromTokenLogo" style="background-image: url('https://i.imgur.com/70cXbUI.jpeg');"></div>
                <div class="token-symbol" id="fromTokenSymbol">CFX</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="percentage-buttons">
              <button class="percent-btn" data-percent="0.25">25%</button>
              <button class="percent-btn" data-percent="0.5">50%</button>
              <button class="percent-btn active" data-percent="1">MAX</button>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="fromAmount" placeholder="0" type="number" min="0" step="any">
            </div>
          </div>

          <!-- ‰∫§Êç¢ÁÆ≠Â§¥ -->
          <div class="swap-center">
            <button class="swap-arrow-btn" id="reverse">‚áÖ</button>
          </div>

          <!-- ËæìÂá∫‰ª£Â∏Å -->
          <div class="token-input-wrapper" id="toTokenWrapper">
            <div class="token-header">
              <div class="balance-info">
                ‰ΩôÈ¢ù: <span class="balance-amount" id="toBal">0</span>
              </div>
              <div class="token-selector" id="toTokenSelector">
                <div class="token-logo" id="toTokenLogo" style="background-image: url('https://i.imgur.com/HddyTrv.jpeg');"></div>
                <div class="token-symbol" id="toTokenSymbol">LOM</div>
                <div class="token-dropdown-arrow">‚ñº</div>
              </div>
            </div>
            
            <div class="amount-input-area">
              <input class="amount-input" id="toAmount" placeholder="0" type="number" min="0" step="any" readonly>
            </div>
          </div>

          <!-- ÈîôËØØÊèêÁ§∫Ê°Ü -->
          <div class="error-box" id="swapErrorBox">
            <span>‚ö†Ô∏è</span>
            <span id="swapErrorText"></span>
          </div>

          <!-- ‰∫§ÊòìËØ¶ÊÉÖ -->
          <div class="swap-details">
            <div class="detail-row">
              <span class="detail-label">ÊªëÁÇπÂÆπÂ∑Æ</span>
              <div class="slippage-options">
                <button class="slippage-btn active" data-slip="0.1">0.1%</button>
                <button class="slippage-btn" data-slip="0.5">0.5%</button>
                <button class="slippage-btn" data-slip="1">1%</button>
                <button class="slippage-btn" data-slip="5">5%</button>
              </div>
            </div>
            <div class="detail-row">
              <span class="detail-label">‰ª∑Ê†º</span>
              <span class="detail-value" id="price">1 CFX = 0 LOM</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ÊúÄ‰ΩéÊî∂Âà∞</span>
              <span class="detail-value" id="minReceived">0 LOM</span>
            </div>
          </div>

          <!-- ‰∫§ÊòìÊåâÈíÆ -->
          <button class="main-action-btn" id="swapBtn">ËøûÊé•Èí±ÂåÖ</button>
        </div>
      </div>
    </div>
    
    <!-- ÊµÅÂä®ÊÄßÈ°µÈù¢ -->
    <div class="tab-content" id="liquidityTab">
      <div class="card">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <span style="color: var(--accent-yellow); font-size: 20px;">üíß</span>
          <span style="font-size: 18px; font-weight: 700;">CFX-LOM ÊµÅÂä®Ê±†</span>
        </div>

        <div class="liquidity-summary">
          <!-- Ê±†Â≠êÁªüËÆ°‰ø°ÊÅØ -->
          <div class="liquidity-pair">
            <div class="pair-logo cfx"></div>
            <div class="pair-symbol">+</div>
            <div class="pair-logo lom"></div>
            <div class="pair-symbol">CFX-LOM</div>
          </div>
          
          <div class="liquidity-stats">
            <div class="stat-item">
              <div class="stat-label-small">CFX ÂÇ®Â§á</div>
              <div class="stat-value-large" id="cfxReserve">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label-small">LOM ÂÇ®Â§á</div>
              <div class="stat-value-large" id="lomReserve">0</div>
            </div>
          </div>
          
          <!-- ÊàëÁöÑÊµÅÂä®Ê±†ËØ¶ÊÉÖ -->
          <div class="user-position">
            <div class="position-header">
              <div class="position-title">ÊàëÁöÑÊµÅÂä®Ê±†</div>
              <div class="position-value" id="positionValue">$0.00</div>
            </div>
            
            <div class="position-grid">
              <div class="position-stat">
                <div class="position-label">ÊàëÁöÑCFX</div>
                <div class="position-amount" id="userCfx">0</div>
              </div>
              <div class="position-stat">
                <div class="position-label">ÊàëÁöÑLOM</div>
                <div class="position-amount" id="userLom">0</div>
              </div>
              <div class="position-stat">
                <div class="position-label">ÊàëÁöÑLP‰ª£Â∏Å</div>
                <div class="position-amount lp-amount" id="userLp">0</div>
              </div>
              <div class="position-stat">
                <div class="position-label">Ê±†Â≠ê‰ªΩÈ¢ù</div>
                <div class="position-amount pool-share" id="userPoolShare">0%</div>
              </div>
            </div>
          </div>

          <div class="position-actions">
            <button class="position-btn add-btn" id="addBtn">Ê∑ªÂä†ÊµÅÂä®ÊÄß</button>
            <button class="position-btn remove-btn" id="removeBtn" disabled>ÁßªÈô§ÊµÅÂä®ÊÄß</button>
          </div>
        </div>
        
        <!-- Ë¥®ÊäºÂÖ•Âè£ -->
        <div class="lp-balance-display" style="margin-top: 20px; cursor: pointer;" onclick="switchToRewardsTab()">
          <div class="lp-balance-label">‰ΩøÁî®LP‰ª£Â∏ÅËµöÂèñÂ•ñÂä±</div>
          <div style="margin-top: 8px;">
            <span class="lp-balance-value">45.8%</span>
            <span class="lp-balance-unit">APY</span>
          </div>
          <div style="font-size: 14px; color: var(--accent-yellow); margin-top: 12px;">
            üöÄ ÁÇπÂáªËøõÂÖ•LPÂ•ñÂä±È°µÈù¢ ‚Üí
          </div>
        </div>
      </div>
    </div>

    <!-- LPÂ•ñÂä±È°µÈù¢ -->
    <div class="tab-content" id="lpRewardsTab">
      <div class="card">
        <!-- Â•ñÂä±Ê¶ÇËßà -->
        <div class="rewards-header">
          <div class="rewards-title">
            <span class="rewards-icon">üèÜ</span>
            <span id="rewardsTitle">LPÊåÅ‰ªìÂ•ñÂä±</span>
          </div>
          <div style="background: var(--gradient-orange); color: #0f172a; padding: 8px 16px; border-radius: 12px; font-weight: 700; font-size: 16px;">
            APR: 45.8%
          </div>
        </div>
        
        <!-- Â•ñÂä±ÁªüËÆ° -->
        <div class="rewards-grid">
          <div class="reward-stat">
            <div class="reward-label">
              <span>üí∞</span>
              <span>ÊàëÁöÑLPÊåÅ‰ªì</span>
            </div>
            <div class="reward-value yellow" id="myLPHolding">0</div>
            <div class="reward-unit">LP</div>
          </div>
          
          <div class="reward-stat">
            <div class="reward-label">
              <span>üìä</span>
              <span>Ê¥ªË∑É‰ªΩÈ¢ù</span>
            </div>
            <div class="reward-value teal" id="activeShares">0</div>
            <div class="reward-unit">LP</div>
          </div>
          
          <div class="reward-stat">
            <div class="reward-label">
              <span>üìà</span>
              <span>ÂæÖÈ¢ÜÂèñÂ•ñÂä±</span>
            </div>
            <div class="reward-value green" id="pendingReward">0</div>
            <div class="reward-unit">LOM</div>
          </div>
          
          <div class="reward-stat">
            <div class="reward-label">
              <span>üë•</span>
              <span>ÈÇÄËØ∑Â•ñÂä±</span>
            </div>
            <div class="reward-value orange" id="referralReward">0</div>
            <div class="reward-unit">LOM</div>
          </div>
        </div>
        
        <!-- Êó∂Èó¥ÂÄçÁéá -->
        <div class="multiplier-section">
          <div class="multiplier-header">
            <div class="multiplier-label">
              <span>‚è±Ô∏è</span>
              <span>Êó∂Èó¥ÂÄçÁéá:</span>
            </div>
            <div class="multiplier-value" id="multiplierValue">1.0x</div>
          </div>
          <div class="multiplier-bar">
            <div class="multiplier-fill" id="multiplierProgress" style="width: 0%"></div>
          </div>
          <div class="multiplier-stages">
            <div class="stage" id="stage30">30Â§©</div>
            <div class="stage" id="stage90">90Â§©</div>
            <div class="stage" id="stage180">180Â§©</div>
            <div class="stage" id="stage360">360Â§©</div>
          </div>
        </div>
        
        <!-- ÊøÄÊ¥ªÂ•ñÂä± -->
        <div class="activation-section" id="activationSection">
          <div class="activation-header">
            <span class="activation-icon">üöÄ</span>
            <span class="activation-title">ÊøÄÊ¥ªÂ•ñÂä±</span>
          </div>
          
          <div class="lp-balance-display">
            <div class="lp-balance-label">ÊÇ®ÁöÑLP‰ª£Â∏Å‰ΩôÈ¢ù</div>
            <div>
              <span class="lp-balance-value" id="lpBalance">0.000000</span>
              <span class="lp-balance-unit">LP</span>
            </div>
          </div>
          
          <div class="min-requirement">
            <span class="requirement-icon">‚ö°</span>
            <span>ÊøÄÊ¥ªÊù°‰ª∂ÔºöÈí±ÂåÖ‰∏≠ÈúÄÊåÅÊúâËá≥Â∞ë 100 LP ‰ª£Â∏Å</span>
          </div>
          
          <!-- ÈÇÄËØ∑Á≥ªÁªü -->
          <div class="invite-input-container">
            <input type="text" class="invite-input" id="inviteAddress" 
                   placeholder="ËæìÂÖ•ÈÇÄËØ∑‰∫∫Âú∞ÂùÄ (ÂèØÈÄâ)">
          </div>
          
          <div class="invite-benefits">
            <div class="benefit-title">
              <span>üéÅ</span>
              <span>ÈÇÄËØ∑Â•ñÂä±Â•ΩÂ§Ñ</span>
            </div>
            <ul class="benefit-list">
              <li class="benefit-item">
                <span class="benefit-icon">‚úì</span>
                <span>ÈÇÄËØ∑‰∫∫Ëé∑ÂæóÊÇ®Êî∂ÁõäÁöÑ5%‰Ωú‰∏∫Â•ñÂä±</span>
              </li>
              <li class="benefit-item">
                <span class="benefit-icon">‚úì</span>
                <span>Â•ñÂä±ÈîÅÂÆö30Â§©ÂêéÂèØÈ¢ÜÂèñ</span>
              </li>
            </ul>
          </div>
          
          <div class="action-buttons" id="activationButtons">
            <button class="action-button primary" id="activateBtn" onclick="activateRewards()">
              <span>üöÄ</span>
              <span id="activateBtnText">ÊøÄÊ¥ªÂ•ñÂä±</span>
            </button>
          </div>
        </div>
        
        <!-- Â∑≤ÊøÄÊ¥ªÁä∂ÊÄÅ -->
        <div class="activated-status" id="activatedStatus" style="display: none;">
          <div class="status-header">
            <div class="status-text">
              <span>‚úÖ</span>
              <span>Â•ñÂä±Â∑≤ÊøÄÊ¥ª</span>
            </div>
          </div>
          
          <div class="status-details">
            <div class="status-label">
              <span>‚è∞</span>
              <span>ÊøÄÊ¥ªÊó∂Èó¥:</span>
            </div>
            <div class="status-value" id="activationTime">--</div>
          </div>
          
          <div class="status-details" id="referrerDetails" style="display: none;">
            <div class="status-label">
              <span>üë§</span>
              <span>ÈÇÄËØ∑‰∫∫:</span>
            </div>
            <div class="status-value" id="referrerAddress">--</div>
          </div>
        </div>
        
        <!-- Â•ñÂä±È¢ÜÂèñ -->
        <div class="action-buttons">
          <button class="action-button claim" id="claimBtn" onclick="claimRewards()" disabled>
            <span>üí∞</span>
            <span id="claimBtnText">È¢ÜÂèñÂ•ñÂä±</span>
          </button>
          <button class="action-button referral" id="claimReferralBtn" onclick="claimReferralRewards()" disabled>
            <span>üë•</span>
            <span id="claimReferralBtnText">È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±</span>
          </button>
        </div>
        
        <!-- ÂÜ∑Âç¥Êó∂Èó¥ÊòæÁ§∫ -->
        <div class="cooldown-timer" id="cooldownTimer">
          <div class="cooldown-label">
            <span>‚è≥</span>
            <span>ÂáèÊåÅÂÜ∑Âç¥Êó∂Èó¥</span>
          </div>
          <div class="cooldown-value" id="cooldownValue">00:00:00</div>
        </div>
        
        <!-- ÊÉ©ÁΩöË≠¶Âëä -->
        <div class="warning-box">
          <div class="warning-header">
            <span class="warning-icon">‚ö†Ô∏è</span>
            <span class="warning-title">ÂáèÊåÅÊÉ©ÁΩöË≠¶Âëä</span>
          </div>
          <div class="warning-content">
            ‚ö†Ô∏è ÊøÄÊ¥ªÂêéÂáèÊåÅLPÂ∞ÜÈù¢‰∏¥50%ÁöÑÂ•ñÂä±ÊÉ©ÁΩö<br>
            ‚ö†Ô∏è 30Â§©ÂÜÖÂáèÊåÅÂ∞ÜÂ§±ÂéªÈÇÄËØ∑Â•ñÂä±ËµÑÊ†º<br>
            ‚ö†Ô∏è 7Â§©ÂÜÖÊúÄÂ§öÂáèÊåÅ30%Ôºå‰∏îÈúÄË¶Å1Â§©ÂÜ∑Âç¥Êó∂Èó¥
          </div>
        </div>
      </div>
    </div>

    <!-- È£éÈô©ÊèêÁ§∫ -->
    <div class="risk-warning" id="riskWarning">
      <div class="risk-title">
        <span>‚ö†Ô∏è</span>
        <span id="riskTitle">È£éÈô©ÊèêÁ§∫</span>
      </div>
      <div id="riskText">
        Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ
      </div>
    </div>

    <!-- È°µËÑö -->
    <div class="footer" id="footerText">LOMswap ¬∑ Conflux eSpace</div>
  </div>

  <!-- Á°ÆËÆ§Ê®°ÊÄÅÊ°Ü -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal-card">
      <h3 class="modal-title" id="confirmTitle">Á°ÆËÆ§Êìç‰Ωú</h3>
      <div class="modal-content" id="confirmContent">
        <!-- ÂÜÖÂÆπÂä®ÊÄÅÂ°´ÂÖÖ -->
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="confirmCancelBtn">ÂèñÊ∂à</button>
        <button class="modal-btn confirm" id="confirmActionBtn">Á°ÆËÆ§</button>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // ==================== ÈÖçÁΩÆ ====================
    const CONFIG = {
      REWARD_CONTRACT: "0x233f9C12514A29d860e482eB29f1EE1f8fcC59aa",
      LP_TOKEN: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85", // CFX-LOM LP‰ª£Â∏Å
      LOM_TOKEN: "0xb4ca1cb2651a822bf65c614c880a26fd124932a3", // LOM‰ª£Â∏Å
      WCFX: "0x14b2d3bc65e74dae1030eafd8ac30c533c976a9b",
      ROUTER: "0x62b0873055bf896dd869e172119871ac24aea305",
      PAIR: "0x063128f4e6BDFBC693d03649000B6E4dA00Bec85",
      CHAIN_ID: 1030
    };

    // ==================== ÂêàÁ∫¶ABI ====================
    const REWARD_ABI = [
      "function activate(address referrer)",
      "function claimAll()",
      "function claimReferral()",
      "function minActivation() view returns (uint256)",
      "function totalShares() view returns (uint256)",
      "function accRewardPerShare() view returns (uint256)",
      "function lastRewardTime() view returns (uint256)",
      "function rewardPerSecond() view returns (uint256)",
      "function users(address) view returns (uint256 shares, uint256 rewardDebt, uint256 pendingReferral, uint256 lastClaimTime, uint256 activeTime, uint256 lastReduceTime, uint256 referralUnlockTime, address referrer, bool cleanInFirst30Days)",
      "function pendingReward(address user) view returns (uint256)",
      "function blacklist(address) view returns (bool)"
    ];

    const ERC20_ABI = [
      "function balanceOf(address owner) view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function symbol() view returns (string)",
      "function name() view returns (string)"
    ];

    const PAIR_ABI = [
      "function getReserves() view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address owner) view returns (uint256)",
      "function token0() view returns (address)",
      "function token1() view returns (address)"
    ];

    // ==================== ÂÖ®Â±ÄÂèòÈáè ====================
    let provider, signer, account;
    let rewardContract, lpTokenContract, lomTokenContract, pairContract;
    let isChinese = true;
    let userRewardData = null;
    let refreshInterval;
    let cooldownInterval;

    // ==================== Â∑•ÂÖ∑ÂáΩÊï∞ ====================
    class Utils {
      static formatNumber(num, decimals = 6) {
        if (!num && num !== 0) return '0.000000';
        const n = parseFloat(num);
        if (isNaN(n)) return '0.000000';
        
        const factor = Math.pow(10, decimals);
        const truncated = Math.floor(n * factor) / factor;
        
        const parts = truncated.toString().split('.');
        let integerPart = parts[0];
        let decimalPart = parts[1] || '';
        
        if (decimalPart.length < decimals) {
          decimalPart = decimalPart.padEnd(decimals, '0');
        } else if (decimalPart.length > decimals) {
          decimalPart = decimalPart.substring(0, decimals);
        }
        
        const result = integerPart + '.' + decimalPart;
        return this.removeTrailingZeros(result);
      }

      static removeTrailingZeros(str) {
        if (!str.includes('.')) return str;
        let result = str.replace(/0+$/, '');
        if (result.endsWith('.')) result = result.slice(0, -1);
        return result;
      }

      static formatAddress(address) {
        if (!address) return '';
        return address.slice(0, 6) + '...' + address.slice(-4);
      }

      static isValidAddress(address) {
        return /^0x[a-fA-F0-9]{40}$/.test(address);
      }

      static formatTime(seconds) {
        if (!seconds) return '--';
        const date = new Date(seconds * 1000);
        return date.toLocaleString('zh-CN');
      }

      static formatDuration(seconds) {
        if (!seconds) return '0Â§©';
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        
        if (days > 0) {
          return `${days}Â§©${hours > 0 ? ` ${hours}Â∞èÊó∂` : ''}`;
        } else if (hours > 0) {
          return `${hours}Â∞èÊó∂`;
        } else {
          const minutes = Math.floor((seconds % 3600) / 60);
          return `${minutes}ÂàÜÈíü`;
        }
      }

      static formatCountdown(seconds) {
        if (!seconds || seconds <= 0) return '00:00:00';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }

      static async showConfirm(title, content) {
        return new Promise((resolve) => {
          const modal = document.getElementById('confirmModal');
          const titleEl = document.getElementById('confirmTitle');
          const contentEl = document.getElementById('confirmContent');
          const cancelBtn = document.getElementById('confirmCancelBtn');
          const actionBtn = document.getElementById('confirmActionBtn');
          
          titleEl.textContent = title;
          contentEl.innerHTML = content;
          
          modal.style.display = 'flex';
          
          const cleanup = () => {
            cancelBtn.removeEventListener('click', onCancel);
            actionBtn.removeEventListener('click', onAction);
            modal.style.display = 'none';
          };
          
          const onCancel = () => {
            cleanup();
            resolve(false);
          };
          
          const onAction = () => {
            cleanup();
            resolve(true);
          };
          
          cancelBtn.addEventListener('click', onCancel);
          actionBtn.addEventListener('click', onAction);
        });
      }

      static showError(message) {
        const errorBox = document.getElementById('swapErrorBox');
        if (!errorBox) {
          alert(message);
          return;
        }
        const errorText = document.getElementById('swapErrorText');
        errorText.textContent = message;
        errorBox.classList.add('show');
        
        setTimeout(() => {
          errorBox.classList.remove('show');
        }, 5000);
      }
    }

    // ==================== Èí±ÂåÖÁÆ°ÁêÜ ====================
    class WalletManager {
      static async connect() {
        try {
          if (!window.ethereum) {
            Utils.showError(isChinese ? "ËØ∑ÂÆâË£ÖTPÊàñweb3Èí±ÂåÖ" : "Please install TP or WEB3 wallet");
            return false;
          }
          
          const walletBtn = document.getElementById('walletBtn');
          walletBtn.textContent = isChinese ? 'ËøûÊé•‰∏≠...' : 'Connecting...';
          walletBtn.classList.add('connecting');
          
          const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
          });
          
          if (!accounts || accounts.length === 0) {
            throw new Error(isChinese ? 'Áî®Êà∑ÊãíÁªùËøûÊé•' : 'User rejected connection');
          }
          
          account = accounts[0];
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          
          await this.checkNetwork();
          await this.initContracts();
          this.updateUI();
          
          if (refreshInterval) clearInterval(refreshInterval);
          refreshInterval = setInterval(() => {
            RewardsManager.refreshData();
            LiquidityManager.refreshData();
          }, 10000);
          
          return true;
        } catch (error) {
          console.error("Èí±ÂåÖËøûÊé•Â§±Ë¥•:", error);
          Utils.showError(isChinese ? `ËøûÊé•Â§±Ë¥•: ${error.message}` : `Connection failed: ${error.message}`);
          return false;
        } finally {
          this.updateUI();
        }
      }

      static async checkNetwork() {
        const network = await provider.getNetwork();
        if (network.chainId !== CONFIG.CHAIN_ID) {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x' + CONFIG.CHAIN_ID.toString(16) }]
            });
          } catch (error) {
            if (error.code === 4902) {
              Utils.showError(isChinese ? 'ËØ∑Ê∑ªÂä†Conflux eSpaceÁΩëÁªú' : 'Please add Conflux eSpace network');
            } else {
              Utils.showError(isChinese ? 'ËØ∑ÂàáÊç¢Âà∞Conflux eSpaceÁΩëÁªú' : 'Please switch to Conflux eSpace network');
            }
            throw error;
          }
        }
      }

      static async initContracts() {
        rewardContract = new ethers.Contract(CONFIG.REWARD_CONTRACT, REWARD_ABI, signer);
        lpTokenContract = new ethers.Contract(CONFIG.LP_TOKEN, ERC20_ABI, signer);
        lomTokenContract = new ethers.Contract(CONFIG.LOM_TOKEN, ERC20_ABI, signer);
        pairContract = new ethers.Contract(CONFIG.PAIR, PAIR_ABI, signer);
      }

      static updateUI() {
        const walletBtn = document.getElementById("walletBtn");
        walletBtn.classList.remove('connecting');
        
        if (account) {
          const displayAddress = Utils.formatAddress(account);
          walletBtn.textContent = displayAddress;
          walletBtn.classList.add('connected');
        } else {
          walletBtn.textContent = isChinese ? "ËøûÊé•Èí±ÂåÖ" : "Connect Wallet";
          walletBtn.classList.remove('connected');
        }
      }

      static disconnect() {
        account = null;
        provider = null;
        signer = null;
        rewardContract = null;
        lpTokenContract = null;
        lomTokenContract = null;
        pairContract = null;
        
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
        
        if (cooldownInterval) {
          clearInterval(cooldownInterval);
          cooldownInterval = null;
        }
        
        this.updateUI();
        RewardsManager.resetData();
        LiquidityManager.resetData();
      }
    }

    // ==================== LPÂ•ñÂä±ÁÆ°ÁêÜ ====================
    class RewardsManager {
      static async refreshData() {
        if (!account) return;
        
        try {
          await this.updateLPBalance();
          await this.updateUserRewardData();
          await this.updatePoolInfo();
          this.updateUI();
        } catch (error) {
          console.error('Âà∑Êñ∞Â•ñÂä±Êï∞ÊçÆÂ§±Ë¥•:', error);
        }
      }

      static async updateLPBalance() {
        if (!account || !lpTokenContract) return;
        
        try {
          const balance = await lpTokenContract.balanceOf(account);
          const lpBalance = parseFloat(ethers.utils.formatUnits(balance, 18));
          
          document.getElementById('lpBalance').textContent = Utils.formatNumber(lpBalance);
          document.getElementById('myLPHolding').textContent = Utils.formatNumber(lpBalance);
          
        } catch (error) {
          console.error('Ëé∑ÂèñLP‰ΩôÈ¢ùÂ§±Ë¥•:', error);
        }
      }

      static async updateUserRewardData() {
        if (!account || !rewardContract) return;
        
        try {
          // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Âú®ÈªëÂêçÂçï
          const isBlacklisted = await rewardContract.blacklist(account);
          if (isBlacklisted) {
            userRewardData = null;
            return;
          }
          
          // Ëé∑ÂèñÁî®Êà∑Êï∞ÊçÆ
          const userData = await rewardContract.users(account);
          
          if (userData.shares.gt(0)) {
            userRewardData = {
              shares: parseFloat(ethers.utils.formatUnits(userData.shares, 18)),
              rewardDebt: parseFloat(ethers.utils.formatUnits(userData.rewardDebt, 18)),
              pendingReferral: parseFloat(ethers.utils.formatUnits(userData.pendingReferral, 18)),
              lastClaimTime: userData.lastClaimTime.toNumber(),
              activeTime: userData.activeTime.toNumber(),
              lastReduceTime: userData.lastReduceTime.toNumber(),
              referralUnlockTime: userData.referralUnlockTime.toNumber(),
              referrer: userData.referrer,
              cleanInFirst30Days: userData.cleanInFirst30Days
            };
            
            // Ëé∑ÂèñÂæÖÈ¢ÜÂèñÂ•ñÂä±
            const pending = await rewardContract.pendingReward(account);
            userRewardData.pendingReward = parseFloat(ethers.utils.formatUnits(pending, 18));
            
            // Êõ¥Êñ∞ÂÜ∑Âç¥Êó∂Èó¥ÊòæÁ§∫
            this.updateCooldownDisplay();
          } else {
            userRewardData = null;
          }
        } catch (error) {
          console.error('Ëé∑ÂèñÁî®Êà∑Â•ñÂä±Êï∞ÊçÆÂ§±Ë¥•:', error);
          userRewardData = null;
        }
      }

      static async updatePoolInfo() {
        if (!rewardContract) return;
        
        try {
          // Ëé∑ÂèñÊ±†Â≠êÊÄª‰ø°ÊÅØ
          const totalShares = await rewardContract.totalShares();
          const totalSharesFormatted = parseFloat(ethers.utils.formatUnits(totalShares, 18));
          
          document.getElementById('activeShares').textContent = Utils.formatNumber(totalSharesFormatted);
          
          // Êõ¥Êñ∞ÊàëÁöÑÊï∞ÊçÆ
          if (userRewardData) {
            document.getElementById('pendingReward').textContent = Utils.formatNumber(userRewardData.pendingReward || 0);
            document.getElementById('referralReward').textContent = Utils.formatNumber(userRewardData.pendingReferral || 0);
            
            // ËÆ°ÁÆóÊøÄÊ¥ªÊó∂Èïø
            const now = Math.floor(Date.now() / 1000);
            const activeDuration = now - userRewardData.activeTime;
            
            // ËÆ°ÁÆó‰∏ãÊ¨°ÂèØÈ¢ÜÂèñÊó∂Èó¥
            const nextClaimTime = userRewardData.lastClaimTime + (7 * 24 * 3600);
            if (nextClaimTime > now) {
              const remaining = nextClaimTime - now;
            }
            
            // Êõ¥Êñ∞ÊøÄÊ¥ªÊó∂Èó¥ÊòæÁ§∫
            document.getElementById('activationTime').textContent = Utils.formatTime(userRewardData.activeTime);
            
            // Êõ¥Êñ∞ÈÇÄËØ∑‰∫∫ÊòæÁ§∫
            if (userRewardData.referrer !== ethers.constants.AddressZero) {
              document.getElementById('referrerDetails').style.display = 'block';
              document.getElementById('referrerAddress').textContent = Utils.formatAddress(userRewardData.referrer);
            } else {
              document.getElementById('referrerDetails').style.display = 'none';
            }
            
            // Êõ¥Êñ∞Êó∂Èó¥ÂÄçÁéá
            this.updateTimeMultiplier();
          }
        } catch (error) {
          console.error('Ëé∑ÂèñÊ±†Â≠ê‰ø°ÊÅØÂ§±Ë¥•:', error);
        }
      }

      static updateTimeMultiplier() {
        if (!userRewardData) {
          document.getElementById('multiplierValue').textContent = '1.0x';
          document.getElementById('multiplierProgress').style.width = '0%';
          return;
        }
        
        const now = Math.floor(Date.now() / 1000);
        const duration = now - userRewardData.activeTime;
        
        let multiplier = 1.0;
        let progress = 0;
        
        if (duration >= 360 * 24 * 3600) {
          multiplier = 3.0;
          progress = 100;
          this.setActiveStage('stage360');
        } else if (duration >= 180 * 24 * 3600) {
          multiplier = 2.0;
          progress = Math.min(100, (duration - 180 * 24 * 3600) / (180 * 24 * 3600) * 100);
          this.setActiveStage('stage180');
        } else if (duration >= 90 * 24 * 3600) {
          multiplier = 1.5;
          progress = Math.min(100, (duration - 90 * 24 * 3600) / (90 * 24 * 3600) * 100);
          this.setActiveStage('stage90');
        } else if (duration >= 30 * 24 * 3600) {
          multiplier = 1.0;
          progress = Math.min(100, (duration - 30 * 24 * 3600) / (60 * 24 * 3600) * 100);
          this.setActiveStage('stage30');
        } else {
          multiplier = 1.0;
          progress = Math.min(100, duration / (30 * 24 * 3600) * 100);
          this.setActiveStage('stage30');
        }
        
        document.getElementById('multiplierValue').textContent = `${multiplier.toFixed(1)}x`;
        document.getElementById('multiplierProgress').style.width = `${progress}%`;
      }

      static setActiveStage(stageId) {
        const stages = ['stage30', 'stage90', 'stage180', 'stage360'];
        stages.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.classList.toggle('active', id === stageId);
          }
        });
      }

      static updateCooldownDisplay() {
        if (!userRewardData) {
          document.getElementById('cooldownTimer').style.display = 'none';
          return;
        }
        
        const now = Math.floor(Date.now() / 1000);
        const cooldownEnd = userRewardData.lastReduceTime + (24 * 3600);
        
        if (now < cooldownEnd) {
          const remaining = cooldownEnd - now;
          document.getElementById('cooldownValue').textContent = Utils.formatCountdown(remaining);
          document.getElementById('cooldownTimer').style.display = 'block';
        } else {
          document.getElementById('cooldownTimer').style.display = 'none';
        }
      }

      static updateUI() {
        const activationSection = document.getElementById('activationSection');
        const activatedStatus = document.getElementById('activatedStatus');
        const activateBtn = document.getElementById('activateBtn');
        const claimBtn = document.getElementById('claimBtn');
        const claimReferralBtn = document.getElementById('claimReferralBtn');
        
        if (!account) {
          // Êú™ËøûÊé•Èí±ÂåÖ
          if (activatedStatus) activatedStatus.style.display = 'none';
          if (activationSection) activationSection.style.display = 'block';
          if (activateBtn) {
            activateBtn.disabled = false;
            activateBtn.innerHTML = `<span>üöÄ</span><span>${isChinese ? 'ËøûÊé•Èí±ÂåÖ' : 'Connect Wallet'}</span>`;
          }
          if (claimBtn) claimBtn.disabled = true;
          if (claimReferralBtn) claimReferralBtn.disabled = true;
          return;
        }
        
        if (userRewardData) {
          // Â∑≤ÊøÄÊ¥ª
          if (activatedStatus) activatedStatus.style.display = 'block';
          if (activationSection) activationSection.style.display = 'none';
          
          // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
          const now = Math.floor(Date.now() / 1000);
          
          // È¢ÜÂèñÂ•ñÂä±ÊåâÈíÆ
          if (userRewardData.lastClaimTime + (7 * 24 * 3600) <= now && userRewardData.pendingReward > 0) {
            if (claimBtn) {
              claimBtn.disabled = false;
              claimBtn.innerHTML = `<span>üí∞</span><span>${isChinese ? 'È¢ÜÂèñÂ•ñÂä±' : 'Claim Rewards'}</span>`;
            }
          } else {
            if (claimBtn) {
              claimBtn.disabled = true;
              const nextClaim = userRewardData.lastClaimTime + (7 * 24 * 3600);
              if (nextClaim > now) {
                const remaining = nextClaim - now;
                claimBtn.innerHTML = `<span>‚è∞</span><span>${Utils.formatDuration(remaining)}Âêé</span>`;
              } else {
                claimBtn.innerHTML = `<span>üí∞</span><span>${isChinese ? 'ÊöÇÊó†Â•ñÂä±' : 'No Rewards'}</span>`;
              }
            }
          }
          
          // È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±ÊåâÈíÆ
          if (userRewardData.pendingReferral > 0 && now >= userRewardData.referralUnlockTime) {
            if (claimReferralBtn) {
              claimReferralBtn.disabled = false;
              claimReferralBtn.innerHTML = `<span>üë•</span><span>${isChinese ? 'È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±' : 'Claim Referral'}</span>`;
            }
          } else {
            if (claimReferralBtn) {
              claimReferralBtn.disabled = true;
              if (userRewardData.pendingReferral > 0) {
                if (now < userRewardData.referralUnlockTime) {
                  const remaining = userRewardData.referralUnlockTime - now;
                  claimReferralBtn.innerHTML = `<span>‚è∞</span><span>${Utils.formatDuration(remaining)}ÂêéËß£ÈîÅ</span>`;
                } else {
                  claimReferralBtn.innerHTML = `<span>üë•</span><span>${isChinese ? 'È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±' : 'Claim Referral'}</span>`;
                }
              } else {
                claimReferralBtn.innerHTML = `<span>üë•</span><span>${isChinese ? 'ÊöÇÊó†ÈÇÄËØ∑Â•ñÂä±' : 'No Referral'}</span>`;
              }
            }
          }
        } else {
          // Êú™ÊøÄÊ¥ª
          if (activatedStatus) activatedStatus.style.display = 'none';
          if (activationSection) activationSection.style.display = 'block';
          if (activateBtn) {
            activateBtn.disabled = false;
            activateBtn.innerHTML = `<span>üöÄ</span><span>${isChinese ? 'ÊøÄÊ¥ªÂ•ñÂä±' : 'Activate Rewards'}</span>`;
          }
          if (claimBtn) claimBtn.disabled = true;
          if (claimReferralBtn) claimReferralBtn.disabled = true;
        }
      }

      static resetData() {
        userRewardData = null;
        
        // ÈáçÁΩÆÊâÄÊúâÊòæÁ§∫
        const resetElements = [
          'lpBalance', 'myLPHolding', 'activeShares', 'pendingReward',
          'referralReward', 'activationTime', 'multiplierValue'
        ];
        
        resetElements.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = id.includes('Time') ? '--' : '0';
        });
        
        const progressBar = document.getElementById('multiplierProgress');
        if (progressBar) progressBar.style.width = '0%';
        
        const cooldownTimer = document.getElementById('cooldownTimer');
        if (cooldownTimer) cooldownTimer.style.display = 'none';
        
        this.updateUI();
      }

      static async activateRewards() {
        if (!account) {
          await WalletManager.connect();
          return;
        }
        
        try {
          // Ëé∑ÂèñÈÇÄËØ∑Âú∞ÂùÄ
          const inviteInput = document.getElementById('inviteAddress');
          const inviteAddress = inviteInput ? inviteInput.value.trim() : '';
          let referrer = ethers.constants.AddressZero;
          
          if (inviteAddress) {
            if (!Utils.isValidAddress(inviteAddress)) {
              Utils.showError(isChinese ? 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÄËØ∑Âú∞ÂùÄ' : 'Please enter valid invite address');
              return;
            }
            
            if (inviteAddress.toLowerCase() === account.toLowerCase()) {
              Utils.showError(isChinese ? '‰∏çËÉΩÈÇÄËØ∑Ëá™Â∑±' : 'Cannot invite yourself');
              return;
            }
            
            referrer = inviteAddress;
          }
          
          // Ê£ÄÊü•LP‰ΩôÈ¢ù
          const lpBalance = await lpTokenContract.balanceOf(account);
          const minActivation = await rewardContract.minActivation();
          
          if (lpBalance.lt(minActivation)) {
            const minFormatted = parseFloat(ethers.utils.formatUnits(minActivation, 18));
            Utils.showError(isChinese ? `ÊúÄ‰ΩéÊøÄÊ¥ªË¶ÅÊ±Ç: ${minFormatted} LP` : `Min activation: ${minFormatted} LP`);
            return;
          }
          
          // Á°ÆËÆ§ÊøÄÊ¥ª
          const confirmed = await Utils.showConfirm(
            isChinese ? 'ÊøÄÊ¥ªLPÂ•ñÂä±' : 'Activate LP Rewards',
            isChinese ? 
              `Á°ÆËÆ§ÊøÄÊ¥ªLPÊåÅ‰ªìÂ•ñÂä±Ôºü` + (referrer !== ethers.constants.AddressZero ? `<br><br>ÈÇÄËØ∑‰∫∫: ${Utils.formatAddress(referrer)}` : '') +
              `<br><br>ÊøÄÊ¥ªÂêéÁ≥ªÁªüÂ∞ÜÂü∫‰∫éÊÇ®ÁöÑLPÊåÅ‰ªìËá™Âä®ËÆ°ÁÆóÂ•ñÂä±„ÄÇ` :
              `Confirm to activate LP holding rewards?` + (referrer !== ethers.constants.AddressZero ? `<br><br>Referrer: ${Utils.formatAddress(referrer)}` : '') +
              `<br><br>After activation, system will calculate rewards based on your LP holding.`
          );
          
          if (!confirmed) return;
          
          // ÊâßË°åÊøÄÊ¥ª‰∫§Êòì
          const activateBtn = document.getElementById('activateBtn');
          const originalText = activateBtn.innerHTML;
          activateBtn.innerHTML = `<div class="loading-spinner"></div> ${isChinese ? 'ÊøÄÊ¥ª‰∏≠...' : 'Activating...'}`;
          activateBtn.disabled = true;
          
          try {
            // ÈáçË¶ÅÔºöÁõ¥Êé•Ë∞ÉÁî®activateÔºå‰∏çÈúÄË¶ÅÊéàÊùÉÔºÅ
            const tx = await rewardContract.activate(referrer);
            await tx.wait();
            
            // Ê∏ÖÁ©∫ÈÇÄËØ∑ËæìÂÖ•Ê°Ü
            if (inviteInput) inviteInput.value = '';
            
            // Âà∑Êñ∞Êï∞ÊçÆ
            await this.refreshData();
            
            Utils.showError(isChinese ? '‚úÖ Â•ñÂä±ÊøÄÊ¥ªÊàêÂäüÔºÅ' : '‚úÖ Rewards activated successfully!');
            
          } finally {
            activateBtn.disabled = false;
            activateBtn.innerHTML = originalText;
          }
          
        } catch (error) {
          console.error('ÊøÄÊ¥ªÂ•ñÂä±Â§±Ë¥•:', error);
          const message = error.message || error.toString();
          
          const activateBtn = document.getElementById('activateBtn');
          if (activateBtn) {
            activateBtn.disabled = false;
            activateBtn.innerHTML = `<span>üöÄ</span><span>${isChinese ? 'ÊøÄÊ¥ªÂ•ñÂä±' : 'Activate Rewards'}</span>`;
          }
          
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? '‚ùå Áî®Êà∑ÂèñÊ∂à‰∫Ü‰∫§Êòì' : '‚ùå Transaction rejected by user');
          } else if (message.includes('Activated')) {
            Utils.showError(isChinese ? '‚ùå Â∑≤ÁªèÊøÄÊ¥ªËøáÂ•ñÂä±' : '‚ùå Already activated rewards');
          } else if (message.includes('Below minimum')) {
            Utils.showError(isChinese ? '‚ùå LP‰ΩôÈ¢ù‰∏çË∂≥' : '‚ùå Insufficient LP balance');
          } else {
            Utils.showError(isChinese ? '‚ùå ÊøÄÊ¥ªÂ§±Ë¥•ÔºåËØ∑ÈáçËØï' : '‚ùå Activation failed, please try again');
          }
        }
      }

      static async claimRewards() {
        if (!account || !userRewardData) return;
        
        try {
          const confirmed = await Utils.showConfirm(
            isChinese ? 'È¢ÜÂèñÂ•ñÂä±' : 'Claim Rewards',
            isChinese ? 
              `Á°ÆËÆ§È¢ÜÂèñ ${Utils.formatNumber(userRewardData.pendingReward)} LOM Â•ñÂä±?` :
              `Confirm to claim ${Utils.formatNumber(userRewardData.pendingReward)} LOM rewards?`
          );
          
          if (!confirmed) return;
          
          // ÊâßË°åÈ¢ÜÂèñ‰∫§Êòì
          const claimBtn = document.getElementById('claimBtn');
          const originalText = claimBtn.innerHTML;
          claimBtn.innerHTML = `<div class="loading-spinner"></div> ${isChinese ? 'È¢ÜÂèñ‰∏≠...' : 'Claiming...'}`;
          claimBtn.disabled = true;
          
          try {
            const tx = await rewardContract.claimAll();
            await tx.wait();
            
            // Âà∑Êñ∞Êï∞ÊçÆ
            await this.refreshData();
            
            Utils.showError(isChinese ? '‚úÖ Â•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ' : '‚úÖ Rewards claimed successfully!');
            
          } finally {
            claimBtn.disabled = false;
            claimBtn.innerHTML = originalText;
          }
          
        } catch (error) {
          console.error('È¢ÜÂèñÂ•ñÂä±Â§±Ë¥•:', error);
          const message = error.message || error.toString();
          
          const claimBtn = document.getElementById('claimBtn');
          if (claimBtn) {
            claimBtn.disabled = false;
            claimBtn.innerHTML = `<span>üí∞</span><span>${isChinese ? 'È¢ÜÂèñÂ•ñÂä±' : 'Claim Rewards'}</span>`;
          }
          
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? '‚ùå Áî®Êà∑ÂèñÊ∂à‰∫Ü‰∫§Êòì' : '‚ùå Transaction rejected by user');
          } else if (message.includes('Too soon')) {
            Utils.showError(isChinese ? '‚ùå È¢ÜÂèñÈó¥ÈöîÈúÄË¶Å7Â§©‰ª•‰∏ä' : '‚ùå Claim interval must be 7 days or more');
          } else {
            Utils.showError(isChinese ? '‚ùå È¢ÜÂèñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï' : '‚ùå Claim failed, please try again');
          }
        }
      }

      static async claimReferralRewards() {
        if (!account || !userRewardData) return;
        
        try {
          const confirmed = await Utils.showConfirm(
            isChinese ? 'È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±' : 'Claim Referral Rewards',
            isChinese ? 
              `Á°ÆËÆ§È¢ÜÂèñ ${Utils.formatNumber(userRewardData.pendingReferral)} LOM ÈÇÄËØ∑Â•ñÂä±?` :
              `Confirm to claim ${Utils.formatNumber(userRewardData.pendingReferral)} LOM referral rewards?`
          );
          
          if (!confirmed) return;
          
          // ÊâßË°åÈ¢ÜÂèñ‰∫§Êòì
          const claimReferralBtn = document.getElementById('claimReferralBtn');
          const originalText = claimReferralBtn.innerHTML;
          claimReferralBtn.innerHTML = `<div class="loading-spinner"></div> ${isChinese ? 'È¢ÜÂèñ‰∏≠...' : 'Claiming...'}`;
          claimReferralBtn.disabled = true;
          
          try {
            const tx = await rewardContract.claimReferral();
            await tx.wait();
            
            // Âà∑Êñ∞Êï∞ÊçÆ
            await this.refreshData();
            
            Utils.showError(isChinese ? '‚úÖ ÈÇÄËØ∑Â•ñÂä±È¢ÜÂèñÊàêÂäüÔºÅ' : '‚úÖ Referral rewards claimed successfully!');
            
          } finally {
            claimReferralBtn.disabled = false;
            claimReferralBtn.innerHTML = originalText;
          }
          
        } catch (error) {
          console.error('È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±Â§±Ë¥•:', error);
          const message = error.message || error.toString();
          
          const claimReferralBtn = document.getElementById('claimReferralBtn');
          if (claimReferralBtn) {
            claimReferralBtn.disabled = false;
            claimReferralBtn.innerHTML = `<span>üë•</span><span>${isChinese ? 'È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±' : 'Claim Referral'}</span>`;
          }
          
          if (message.includes('user rejected')) {
            Utils.showError(isChinese ? '‚ùå Áî®Êà∑ÂèñÊ∂à‰∫Ü‰∫§Êòì' : '‚ùå Transaction rejected by user');
          } else if (message.includes('Locked')) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = userRewardData.referralUnlockTime - now;
            Utils.showError(isChinese ? 
              `‚ùå ÈÇÄËØ∑Â•ñÂä±ÈîÅÂÆö‰∏≠Ôºå${Utils.formatDuration(remaining)}ÂêéËß£ÈîÅ` :
              `‚ùå Referral rewards locked, unlock in ${Utils.formatDuration(remaining)}`
            );
          } else {
            Utils.showError(isChinese ? '‚ùå È¢ÜÂèñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï' : '‚ùå Claim failed, please try again');
          }
        }
      }
    }

    // ==================== ÊµÅÂä®ÊÄßÁÆ°ÁêÜ ====================
    class LiquidityManager {
      static async refreshData() {
        if (!account) return;
        
        try {
          await this.updatePoolInfo();
        } catch (error) {
          console.error('Âà∑Êñ∞ÊµÅÂä®ÊÄßÊï∞ÊçÆÂ§±Ë¥•:', error);
        }
      }

      static async updatePoolInfo() {
        try {
          if (!pairContract || !account) return;
          
          // Ëé∑ÂèñÊ±†Â≠êÂÇ®Â§á
          const [r0, r1] = await pairContract.getReserves();
          const t0 = await pairContract.token0();
          
          const reserveCfx = t0.toLowerCase() === CONFIG.WCFX.toLowerCase() ? r0 : r1;
          const reserveLom = t0.toLowerCase() === CONFIG.WCFX.toLowerCase() ? r1 : r0;
          
          const cfxReserve = parseFloat(ethers.utils.formatEther(reserveCfx));
          const lomReserve = parseFloat(ethers.utils.formatUnits(reserveLom, 18));
          
          // Ëé∑ÂèñÊÄª‰æõÂ∫îÈáè
          const totalSupply = await pairContract.totalSupply();
          const totalSupplyNum = parseFloat(ethers.utils.formatUnits(totalSupply, 18));
          
          // Ëé∑ÂèñÁî®Êà∑LP‰ΩôÈ¢ù
          const lpBal = await pairContract.balanceOf(account);
          const lpAmt = parseFloat(ethers.utils.formatUnits(lpBal, 18));
          
          let share = 0;
          let userCfx = 0;
          let userLom = 0;
          
          if (totalSupplyNum > 0 && lpAmt > 0) {
            share = (lpAmt / totalSupplyNum) * 100;
            userCfx = cfxReserve * (share / 100);
            userLom = lomReserve * (share / 100);
          }
          
          // Êõ¥Êñ∞ÊòæÁ§∫
          document.getElementById("cfxReserve").textContent = cfxReserve.toFixed(2);
          document.getElementById("lomReserve").textContent = lomReserve.toFixed(2);
          document.getElementById("userCfx").textContent = Utils.formatNumber(userCfx);
          document.getElementById("userLom").textContent = Utils.formatNumber(userLom);
          document.getElementById("userLp").textContent = Utils.formatNumber(lpAmt);
          document.getElementById("userPoolShare").textContent = share.toFixed(4) + "%";
          
          const removeBtn = document.getElementById("removeBtn");
          if (removeBtn) {
            removeBtn.disabled = lpAmt <= 0;
          }
          
        } catch (error) {
          console.error("Êõ¥Êñ∞Ê±†Â≠ê‰ø°ÊÅØÂ§±Ë¥•:", error);
        }
      }

      static resetData() {
        const elements = {
          'cfxReserve': '0.00',
          'lomReserve': '0.00',
          'userCfx': '0.000000',
          'userLom': '0.000000',
          'userLp': '0.000000',
          'userPoolShare': '0%'
        };
        
        Object.keys(elements).forEach(id => {
          const element = document.getElementById(id);
          if (element) element.textContent = elements[id];
        });
        
        document.getElementById("removeBtn").disabled = true;
      }
    }

    // ==================== UIÁÆ°ÁêÜ ====================
    class UIManager {
      static init() {
        this.setupEventListeners();
        this.setupTabs();
        this.updateTexts();
        
        // Ê£ÄÊü•ÂÜ∑Âç¥Êó∂Èó¥
        if (cooldownInterval) clearInterval(cooldownInterval);
        cooldownInterval = setInterval(() => {
          if (userRewardData) {
            RewardsManager.updateCooldownDisplay();
          }
        }, 1000);
      }

      static setupEventListeners() {
        // Èí±ÂåÖÊåâÈíÆ
        document.getElementById('walletBtn').addEventListener('click', async () => {
          if (account) {
            if (confirm(isChinese ? 'Á°ÆÂÆöË¶ÅÊñ≠ÂºÄÈí±ÂåÖËøûÊé•ÂêóÔºü' : 'Are you sure to disconnect?')) {
              WalletManager.disconnect();
            }
          } else {
            await WalletManager.connect();
          }
        });
        
        // ËØ≠Ë®ÄÂàáÊç¢
        document.getElementById('langBtn').addEventListener('click', () => {
          isChinese = !isChinese;
          document.getElementById('langBtn').textContent = isChinese ? 'EN' : 'ZN';
          this.updateTexts();
        });
        
        // Ê†áÁ≠æÈ°µÂàáÊç¢
        this.setupTabs();
        
        // ÈÇÄËØ∑Âú∞ÂùÄÈ™åËØÅ
        const inviteInput = document.getElementById('inviteAddress');
        if (inviteInput) {
          inviteInput.addEventListener('input', (e) => {
            const value = e.target.value.trim();
            if (value && !Utils.isValidAddress(value)) {
              e.target.style.borderColor = 'var(--accent-red)';
            } else {
              e.target.style.borderColor = 'rgba(255, 215, 0, 0.3)';
            }
          });
        }
        
        // ÁõëÂê¨Èí±ÂåÖ‰∫ã‰ª∂
        if (window.ethereum) {
          window.ethereum.on('accountsChanged', (accounts) => {
            if (accounts.length === 0) {
              WalletManager.disconnect();
            } else {
              location.reload();
            }
          });
          
          window.ethereum.on('chainChanged', () => {
            location.reload();
          });
        }
      }

      static setupTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const tabId = btn.dataset.tab;
            
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            
            // ÂàáÊç¢Âà∞Áõ∏ÂÖ≥È°µÈù¢Êó∂Âà∑Êñ∞Êï∞ÊçÆ
            if (account) {
              if (tabId === 'liquidity') {
                LiquidityManager.refreshData();
              } else if (tabId === 'lpRewards') {
                RewardsManager.refreshData();
              }
            }
          });
        });
      }

      static updateTexts() {
        // Êõ¥Êñ∞ÊâÄÊúâÊñáÊú¨
        const texts = {
          // LPÂ•ñÂä±È°µÈù¢
          'rewardsTitle': isChinese ? 'LPÊåÅ‰ªìÂ•ñÂä±' : 'LP Holding Rewards',
          'activateBtnText': isChinese ? 'ÊøÄÊ¥ªÂ•ñÂä±' : 'Activate Rewards',
          'claimBtnText': isChinese ? 'È¢ÜÂèñÂ•ñÂä±' : 'Claim Rewards',
          'claimReferralBtnText': isChinese ? 'È¢ÜÂèñÈÇÄËØ∑Â•ñÂä±' : 'Claim Referral',
          
          // È£éÈô©ÊèêÁ§∫
          'riskTitle': isChinese ? 'È£éÈô©ÊèêÁ§∫' : 'Risk Warning',
          'riskText': isChinese ? 
            'Êú¨Â∫îÁî®‰ªÖ‰Ωú‰∏∫ÊäÄÊúØÊºîÁ§∫Ôºå‰∏çÊûÑÊàê‰ªª‰ΩïÊäïËµÑÂª∫ËÆÆ„ÄÇÂä†ÂØÜË¥ßÂ∏ÅÂ∏ÇÂú∫Ê≥¢Âä®Â∑®Â§ßÔºåÊäïËµÑÈúÄË∞®ÊÖéÔºåËØ∑ÁêÜÊÄßÂØπÂæÖÊï∞Â≠óËµÑ‰∫ß‰∫§Êòì„ÄÇ' :
            'This application is for technical demonstration only and does not constitute investment advice. The cryptocurrency market is highly volatile. Please invest cautiously and treat digital asset trading rationally.',
          
          // È°µËÑö
          'footerText': isChinese ? 'LOMswap ¬∑ Conflux eSpace' : 'LOMswap ¬∑ Conflux eSpace',
          
          // Ê†áÁ≠æÈ°µ
          'swap': isChinese ? 'ÂÖëÊç¢' : 'Swap',
          'liquidity': isChinese ? 'ÊµÅÂä®ÊÄß' : 'Liquidity',
          'lpRewards': isChinese ? 'LPÂ•ñÂä±' : 'LP Rewards'
        };
        
        Object.keys(texts).forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = texts[id];
          }
        });
        
        // Êõ¥Êñ∞ÈÇÄËØ∑ËæìÂÖ•Ê°Üplaceholder
        const inviteInput = document.getElementById('inviteAddress');
        if (inviteInput) {
          inviteInput.placeholder = isChinese ? 
            'ËæìÂÖ•ÈÇÄËØ∑‰∫∫Âú∞ÂùÄ (ÂèØÈÄâ)' : 
            'Enter referrer address (optional)';
        }
      }
    }

    // ==================== Â∑•ÂÖ∑ÂáΩÊï∞ÂØºÂá∫ ====================
    function switchToRewardsTab() {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector('[data-tab="lpRewards"]').classList.add('active');
      document.getElementById('lpRewardsTab').classList.add('active');
      
      if (account) {
        RewardsManager.refreshData();
      }
    }

    async function activateRewards() {
      await RewardsManager.activateRewards();
    }

    async function claimRewards() {
      await RewardsManager.claimRewards();
    }

    async function claimReferralRewards() {
      await RewardsManager.claimReferralRewards();
    }

    // ==================== ÂàùÂßãÂåñ ====================
    document.addEventListener('DOMContentLoaded', () => {
      UIManager.init();
      
      // Â∞ùËØïËá™Âä®ËøûÊé•Èí±ÂåÖ
      if (window.ethereum && window.ethereum.selectedAddress) {
        setTimeout(() => {
          WalletManager.connect();
        }, 1000);
      }
    });
  </script>
</body>
</html>
